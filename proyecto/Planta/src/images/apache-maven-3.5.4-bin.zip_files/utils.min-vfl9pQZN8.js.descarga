define(["require","exports","tslib","modules/clean/ajax","modules/clean/api_v2/client","modules/core/browser","modules/clean/sharing/api/client","modules/constants/file_viewer","modules/clean/file_store/utils","modules/clean/viewer","modules/clean/react/paper/paper_log","modules/core/i18n","external/lodash","modules/clean/react/bubble_dropdown_v2","modules/core/notify","modules/clean/react/size_class/constants","modules/clean/react/sign_in/utils"],function(e,r,n,t,o,i,s,a,l,p,c,u,d,_,f,m,h){"use strict";function b(e,r){var n=51200;return"CONTROL"===r?n=20971520:"ONE_HUNDRED_KB"===r?n=102400:"FIFTY_KB"===r&&(n=51200),e.bytes<=n}function g(e){var r=e.file,n=e.sharedLink;return P(e)?v(r)?n?N.Button:N.Dropdown:N.Ellipsis:N.Off}function T(e){return e===N.Dropdown||e===N.Ellipsis?_.BubbleDropdownPositions.BOTTOM_LEFT:_.BubbleDropdownPositions.BOTTOM}function P(e){var r=e.file,n=e.user,t=e.sharedLink;return!!r&&((v(r)&&S.includes(a.OPEN_IN_PAPER_VARIANT)||x(r)&&"ON"===a.EMBED_TO_PAPER_FETCH_MATTE_VARIANT||A(r)&&D.includes(a.EMBED_TO_PAPER_VARIANT))&&!p.Viewer.get_viewer().is_assume_user_session&&!i.is_mobile_or_tablet()&&i.is_supported_paper_browser()&&(!n&&!!t||!!n&&!n.is_paper_disabled))}function x(e){var r=l.getExtension(e);return!!r&&y.includes(r)}function A(e){var r=l.getExtension(e);return!!r&&V.includes(r)}function v(e){var r=l.getExtension(e);return!!r&&(R.includes(r)&&e.bytes<20971520)}function w(e){var r=u._("Copy to Paper");return A(e)&&(r=u._("Add to Paper doc")),r}function E(e){return x(e)?u._("Share specific pages from this file using Dropbox Paper."):u._("Collect ideas and connect all kinds of files in a single doc.")}function C(e,r){return r===m.SizeClass.Large&&(A(e)||x(e))}function k(e){return x(e)?u._("New! Share specific pages"):A(e)?u._("Bring it all together"):u._("Bring this doc to life")}function I(e){return x(e)?u._("Help others focus on what’s important by sharing specific pages from this file. Try it now in Dropbox Paper."):A(e)?u._("Add this file to a Paper doc to collect ideas and organize your thoughts."):u._("Copy to Paper and make changes or ask for feedback.")}function O(e){var r=e.file,n=e.sharedLink,o=e.contUrl,i=e.successCallback,s=e.errorCallback,a=e.extension,l=e._tk,p=e.oqa,c=e.fromModal;t.WebRequest({url:"/paper/sign_request_data",data:{path:r.file_id,sharedLink:n,cont_url:o,extension:a,_tk:l,oqa:p,fromModal:c},success:i,error:s})}function B(e){var r=e.file,n=e.user,t=e.fromModal;if(!n)return void i.redirect(h.getSignInAndContinueUrl());var o=window.open("","_blank"),a=function(e){o?i.redirect(e,o):i.redirect(e)},p=function(){o&&o.close(),f.Notify.error(u._("Can’t copy file to Paper"))},d=e.sharedLink?e.sharedLink:"",_=e.sharedLink?"shared_file_actions":"mounted_file_actions",m=l.getExtension(r);c.paperLog(c.PaperEventTypes.CTA_CLICK,{source:_,cta:"open_in_paper_button",extension:m});var b=m,g={file:r,sharedLink:d,contUrl:"/create-doc-from-dropbox-file",extension:m,successCallback:a,errorCallback:p,_tk:"dropbox_web_copy_from_previews",oqa:b,fromModal:t};if(v(r))O(g);else if(g._tk="dropbox_web_embed_from_previews",!d&&n){var T=new s.FileShareApiClient({userId:n.id});T.sharedLinkInfo({fileIdOrPath:r.file_id}).then(function(e){e?(g.sharedLink=e.url,g.contUrl="/dropbox-file-embed",O(g)):T.createSharedLink({fileIdOrPath:r.file_id}).then(function(e){g.sharedLink=e.url,g.contUrl="/dropbox-file-embed",O(g)}).catch(function(e){p&&p()})}).catch(function(e){p&&p()})}else g.contUrl="/dropbox-file-embed",O(g)}function L(e){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(r){return[2,M().ns("paper_post_tti").rpc("paper_experiments",{},{subjectUserId:e.id}).then(function(e){return e.experiments})]})})}Object.defineProperty(r,"__esModule",{value:!0}),t=n.__importStar(t),i=n.__importStar(i),a=n.__importStar(a),d=n.__importStar(d);var N,S=["VARIANT_A","VARIANT_B1","VARIANT_B2","VARIANT_B3","VARIANT_B4","ON"],D=["BUTTON","DROPDOWN","ELLIPSIS"],R=["docx"],y=["ppt","pptx","pptm","pps","ppsx","ppsm","odp","pdf","ai"],V=["jpg","jpeg","png","pdf","xls","xlsx","mp4","mov","pptx","ppt","zip","rar","mp3"];(function(e){e[e.Off=1]="Off",e[e.Control=2]="Control",e[e.Button=3]="Button",e[e.Dropdown=4]="Dropdown",e[e.Ellipsis=5]="Ellipsis"})(N=r.OpenInPaperButtonVariant||(r.OpenInPaperButtonVariant={})),r.fileSizeWithinExperimentLimits=b,r.getOpenInPaperButtonVariant=g,r.getCalloutPosition=T,r.shouldShowOpenInPaper=P,r.fileSupportsEmbedToPaperFetchMatte=x,r.fileSupportsEmbedToPaper=A,r.fileSupportsCopyToPaper=v,r.getCTAText=w,r.getCTATextDescription=E,r.shouldShowCTADescription=C,r.getCalloutTitle=k,r.getCalloutMessage=I,r.createPaperAccountAndRedirect=O,r.openFileInPaper=B;var M=d.once(function(){return new o.ApiV2Client});r.getPaperExperimentsPostTTI=L});
//# sourceMappingURL=utils.min.js-vfl-2jP6v.map