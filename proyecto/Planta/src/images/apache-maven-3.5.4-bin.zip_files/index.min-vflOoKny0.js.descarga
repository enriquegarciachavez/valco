define(["require","exports","spectrum_comments/comment_editor/reducers/macros/draft","spectrum_comments/comment_editor/reducers/macros/macro","spectrum_comments/comment_editor/reducers/macros/mentions_macro_composers","spectrum_comments/comment_editor/core/composer_wrappers","spectrum_comments/comment_editor/composers/mention_suggestions_list","spectrum_comments/comment_editor/composers/mention_decorator","spectrum_comments/comment_editor/draft_utils","draft-js","spectrum_comments/comment_editor/reducers/macros/user_suggestion_composers"],function(e,t,n,r,o,i,c,s,m,a,u){"use strict";function d(e){var t=e.innerProps,n=t.text,r=t.offset,o=t.delimiter,i=t.input,c=r-o.length+i.length;if(n.substring(c,r)+i===o&&(0===c||" "===n.substr(c-1,1)))return{start:c,end:r,text:n.substring(c,r)+i}}function p(e){return Object.keys(e).map(function(t){var o=e[t],i=o.onMacro,c=void 0===i?function(){}:i,s=o.type,m=void 0===s?"macro: "+t:s,a=o.spanProps,u=void 0===a?{}:a,p=o.macroDecorators,f=void 0===p?[]:p,l=o.onAutoComplete,g=o.onDelimiter,v=void 0===g?d:g;return{draft:{values:n.createDraftValuesReducers(m,t,u,c,v,f)},macro:{evts:r.createMacroEventReducers(m,l),values:r.createMacroValuesReducers(m,c)}}})}function f(e){window.setTimeout(function(){l(e)},0)}function l(e){function t(e,t,n,i,c,u){var d=s.createEntity("mention","IMMUTABLE",{identifier:t,type:n}),p=d.getLastCreatedEntityKey(),f=m.replaceText(d,e.blockKey,c,u,"@"+i,p);o.draft.change(m.replaceContent(r.draft.editorState,a.Modifier.insertText(f,f.getSelectionAfter()," ")))}function n(e,t){return e.entityKey===t.getEntity()}var r=e.status,o=e.triggers,i=r.draft,c=r.macro,s=(r.mentionSuggestions,r.suggestion,i.editorState.getCurrentContent());if(c.active){var d=s.getBlockForKey(c.active.blockKey),p=e.kernel.compose(u.getSelectedUser);if(p){var f=p.name.public||p.email,l=p.id||p.email,g=p.id?"id":"email",v=function(e){return!!c.active&&n(c.active,e)},_=function(e,n){return c.active&&t(c.active,l,g,f,e,n)};d.findEntityRanges(v,_)}else{var y=c.active.content.substring(u.mentionsDelimiter.length);if(m.parseEmail(y)){var v=function(e){return!!c.active&&n(c.active,e)},_=function(e,n){return c.active&&t(c.active,y,"email",y,e,n)};d.findEntityRanges(v,_)}}}}Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOnDelimiter=d;var g={strategy:function(e,t,n){e.findEntityRanges(function(e){var t=e.getEntity();return null!==t&&"mention"===n.getEntity(t).getType()},t)},component:s.MentionDecorator};t.macrosReducers=function(e){var t=e.onMentionSuggestionsQuery;return p({"@":{onDelimiter:d,onMacro:i.bindComposer(o.mentionsMacroComposer,{onMentionSuggestionsQuery:t}),spanProps:{className:"active-mention",chrome:i.wrapComposerComponent(c.mentionSuggestionsListComposer)},macroDecorators:[g],onAutoComplete:f}})}});
//# sourceMappingURL=index.min.js-vflC3VrTc.map