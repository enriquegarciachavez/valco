define(["require","exports","tslib","react","classnames","spectrum_comments/thread","spectrum_comments/comment","spectrum_comments/comment_editor/comment_utils","spectrum_comments/comment_editor/comment_editor","spectrum_comments/comment_editor/components/post_bar","spectrum_comments/utils/scroll_list","spectrum_comments/utils/calc_unread_pill_data","spectrum_comments/utils/throttle","prop-types"],function(e,t,n,o,r,a,i,d,s,c,l,m,u,p){"use strict";function h(e,t){var r=t.localization;return e.isEmpty?null:o.createElement(c.PostBar,n.__assign({},e,{postLabel:r.streamPostLabel,cancelLabel:r.streamCancelLabel,disableCancelButton:e.isEmpty}))}Object.defineProperty(t,"__esModule",{value:!0});var C=function(){};h.contextTypes={localization:p.object};var f=(function(e){function t(t){var n=e.call(this,t)||this;return n.threadIdToRef={},n.editorHasChanges={},n.onThreadActivated=function(e){return function(){n.props.actionsAdapter.onThreadActivated(e)}},n.onStartEdit=function(e){n.setState({editedComment:e})},n.onEndEdit=function(){n.setState({editedComment:void 0})},n.handleClick=function(e){e.currentTarget===e.target&&n.props.actionsAdapter.onAllThreadsDeactivated()},n.onThreadReplyCancel=function(){n.props.actionsAdapter.onAllThreadsDeactivated()},n.onPrimaryEditorCancel=function(){n.setState({content:d.createEmptyContent(),editedComment:void 0})},n.onPrimaryEditorFocus=function(){n.props.actionsAdapter.onAllThreadsDeactivated(),n.props.actionsAdapter.onEditorFocused()},n.onEditorContentChange=function(e){return function(t){n.editorHasChanges[e]=!t.isEmpty}},n.onPrimaryEditorContentChange=n.onEditorContentChange("PRIMARY"),n.hasUnsavedChanges=function(){var e=n.props.threads;return n.editorHasChanges.PRIMARY||e.some(function(e){return n.editorHasChanges[e.id]||!!e.pending})||void 0!==n.state.editedComment},n.promptBeforeCloseHandler=function(e){if(n.hasUnsavedChanges())return e.returnValue="",e.preventDefault(),""},n.createThreadActions=function(e){var t=n.props.actionsAdapter,o=t.onCommentDeleted,r=t.onCommentEdited,a=t.onClickTimeCode,i=t.onEditorFocused,d=t.onMentionsQueryUpdated,s=t.onThreadMarkedAsRead,c=t.onThreadMarkedAsUnread,l=t.onThreadRepliedTo,m=t.onThreadResolved,u=t.onThreadUnresolved,p=t.onThreadMouseEnter,h=void 0===p?C:p,f=t.onThreadMouseLeave,v=void 0===f?C:f;return{onClickTimeCode:a,onReply:function(t){return l(e,t)},onMarkAsRead:function(){return s(e)},onMarkAsUnread:function(){return c(e)},onResolve:function(){return m(e)},onUnresolve:function(){return u(e)},onMouseEnter:function(){return h(e)},onMouseLeave:function(){return v(e)},onEditorFocused:function(){return i(e)},onCommentDeleted:function(t){return o(t,e)},onCommentEdited:function(t,n){return r(t,n,e)},onMentionsQueryUpdated:d,onEditorContentChange:n.onEditorContentChange(e)}},n.renewUnreadPillData=function(){var e=n.scrollListRef.listRef;if(e){var t=e.getBoundingClientRect();n.setState({unreadPillData:m.calcUnreadPillData({containerTop:t.top,containerBottom:t.bottom,threadIdToRef:n.threadIdToRef,threads:n.props.threads})})}},n.state={content:d.createEmptyContent(),editedComment:void 0,unreadPillData:{unreadsAbove:0,nearestUnreadThreadAbove:null,unreadsBelow:0,nearestUnreadThreadBelow:null}},n.throttledRenewUnreadPillData=u.throttle(n.renewUnreadPillData,250),n}return n.__extends(t,e),t.prototype.getChildContext=function(){var e=this.props;return{localization:e.localization,renderWithOldComponents:e.renderWithOldComponents}},t.prototype.componentDidMount=function(){window.addEventListener("beforeunload",this.promptBeforeCloseHandler),this.renewUnreadPillData()},t.prototype.componentWillUnmount=function(){window.removeEventListener("beforeunload",this.promptBeforeCloseHandler)},t.prototype.render=function(){var e=this,t=this.props,d=t.actionsAdapter,c=d.onMentionsQueryUpdated,m=d.onThreadCreated,u=t.className,p=void 0===u?"":u,C=t.commentComponent,f=void 0===C?function(e){return o.createElement(i.Comment,n.__assign({},e))}:C,v=t.editorComponent,E=void 0===v?function(e){return o.createElement(s.CommentEditor,n.__assign({},e))}:v,T=t.enabled,y=t.user,_=t.mentionsMatches,g=t.activeThreadID,A=t.isMobile,R=t.threads,P=t.localization,M=r(p,{"sc-comment-stream":!0,"sc-comment-stream-enabled":T,"sc-comment-stream-all-changes-saved":!this.hasUnsavedChanges()}),U=null;y&&(U=E({author:y,className:"sc-comment-stream-editor",content:this.state.content,placeholder:P.streamEditorPlaceholder,postSignalComponent:h,onCancel:this.onPrimaryEditorCancel,onPost:m,mentionsMatches:_,onMentionsQueryUpdated:c,onFocus:this.onPrimaryEditorFocus,onContentChange:this.onPrimaryEditorContentChange}));var b=R.map(function(t){return o.createElement(a.Thread,{key:t.id,ref:function(n){e.threadIdToRef[t.id]=n},actions:e.createThreadActions(t.id),active:t.id===g,commentComponent:f,editedComment:e.state.editedComment,onActivated:e.onThreadActivated(t),onCancel:e.onThreadReplyCancel,onStartEdit:e.onStartEdit,onEndEdit:e.onEndEdit,isMobile:A,thread:t,user:y,mentionsMatches:_})});return o.createElement("div",{className:M},!A&&U,o.createElement(l.ScrollList,{className:"sc-comment-stream-threads",onClick:this.handleClick,onScroll:this.throttledRenewUnreadPillData,onWindowResize:this.throttledRenewUnreadPillData,ref:function(t){e.scrollListRef=t}},b))},t.childContextTypes={localization:p.object,renderWithOldComponents:p.bool},t})(o.PureComponent);t.CommentStream=f,a.Thread.displayName="Thread"});
//# sourceMappingURL=comment_stream.min.js-vflGgSSiO.map