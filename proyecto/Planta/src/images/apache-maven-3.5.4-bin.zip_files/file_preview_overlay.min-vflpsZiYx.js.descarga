define(["require","exports","tslib","external/create-react-class","external/react","external/react-dom-factories","external/prop-types","external/react-addons-pure-render-mixin","external/lodash","modules/clean/comments/annotation_utils","modules/clean/comments/constants","modules/clean/comments/flux","modules/clean/comments/store","modules/clean/comments/utils","modules/clean/react/file_comments/annotation_bubble","modules/clean/react/file_comments/annotation_comments_list_ui_bubble"],function(t,n,e,o,i,a,r,s,u,l,c,v,p,d,m,b){"use strict";o=e.__importDefault(o),i=e.__importStar(i),a=e.__importStar(a),r=e.__importStar(r),s=e.__importStar(s),u=e.__importStar(u),l=e.__importStar(l),v=e.__importStar(v),p=e.__importDefault(p),d=e.__importStar(d),m=e.__importDefault(m),b=e.__importDefault(b);var f=o.default({displayName:"FilePreviewOverlay",mixins:[s],propTypes:{previewContainer:r.instanceOf(HTMLElement).isRequired,activity:r.object,actorId:r.number,context:r.number.isRequired,useAnnotationCreationExpand:r.bool.isRequired,showCreateBubble:r.bool.isRequired,draftAnnotation:r.object,viewingAnnotation:r.object,viewingAnnotationHover:r.bool.isRequired,viewingCommentActivity:r.object,viewingAnnotationReplyDraft:r.string,actionCreators:r.object.isRequired},getInitialState:function(){return{isExpanded:!1}},onConversationExpand:function(){return this.setState({isExpanded:!0})},onMouseEnterAnnotationConversationBubble:function(){return this.props.actionCreators.updateAnnotationConversationHover(!0)},onMouseLeaveAnnotationConversationBubble:function(){var t=this;if(this.props.actionCreators.updateAnnotationConversationHover(!1),null==this.props.draftAnnotation&&!this.state.isExpanded){var n=function(){if(t.isMounted()&&!t.props.viewingAnnotationHover)return t.props.actionCreators.hideAnnotationConversation()};return window.setTimeout(n,50)}},maybeRenderAnnotationInputBubble:function(){var t=this.props,n=t.activity,o=t.actorId,a=t.context,r=t.previewContainer,s=t.draftAnnotation,c=t.draftAnnotationText,v=t.showCreateBubble,p=t.useAnnotationCreationExpand;if(null!=s){var b={context:a,activity:n,user:d.getActivityUser(o),shouldShowExpandBubble:p,commentText:c,position:"top",x:0,y:0,showBubble:!1,actionCreators:this.props.actionCreators};if(v){if(!l.isAnnotationOffscreen(s,r)){var f=Array.from(l.getBubblePosition(s,r)),y=f[0],A=f[1],x=A.x,_=A.y,C=f[2];if(null!=y&&null!=x&&null!=_)return u.assignIn(b,{showBubble:!0,position:y,x:x,y:_,maxHeight:C}),i.createElement(m.default,e.__assign({},b))}}return i.createElement(m.default,e.__assign({},b))}},maybeRenderAnnotationConversationBubble:function(){var t=this.props,n=t.actorId,e=t.context,o=t.activity,a=t.previewContainer,r=t.viewingAnnotationReplyDraft,s=t.viewingCommentActivity,u=t.viewingAnnotation;if(s&&u&&!l.isAnnotationOffscreen(u,a)){var c=Array.from(l.getBubblePosition(u,a)),v=c[0],p=c[1],m=p.x,f=p.y,y=c[2];if(null!=v&&null!=m&&null!=f&&null!=y)return i.createElement(b.default,{context:e,activity:o,commentActivity:s,user:d.getActivityUser(n),position:v,replyText:r,x:m,y:f,maxHeight:y,onMouseEnter:this.onMouseEnterAnnotationConversationBubble,onMouseLeave:this.onMouseLeaveAnnotationConversationBubble,onConversationExpand:this.onConversationExpand,actionCreators:this.props.actionCreators})}},render:function(){return a.div({},this.maybeRenderAnnotationInputBubble(),this.maybeRenderAnnotationConversationBubble())}}),y=function(t){return(null!=t?t.annotation.type:void 0)===c.AnnotationTypes.HIGHLIGHT},A=function(t){var n,e,o,i=t.activity,a=t.viewAnnotation,r=t.createAnnotation;return a&&(o=u.find(i.comment_activities,{activity_key:a.activityKey}),o&&(e=t.annotationReplyTextByKey[o.activity_key])),r&&(n=r.showBubble),{activity:i,actorId:t.actorId,context:t.viewing.context,useAnnotationCreationExpand:y(r),showCreateBubble:!!n,draftAnnotation:null!=r?r.annotation:void 0,draftAnnotationText:t.annotationText,viewingAnnotation:null!=a?a.annotation:void 0,viewingAnnotationHover:!!(null!=a?a.annotationHover:void 0),viewingCommentActivity:o,viewingAnnotationReplyDraft:e}};return v.connect(p.default,A)(f)});
//# sourceMappingURL=file_preview_overlay.min.js-vfl-jIVSA.map