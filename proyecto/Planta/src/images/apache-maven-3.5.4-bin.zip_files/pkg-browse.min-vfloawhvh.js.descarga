define("modules/clean/browse/browse_bolt_client",["require","exports","tslib","modules/clean/ajax","modules/clean/bolt","modules/clean/react/browse/constants"],function(e,t,r,o,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);var a=(function(){function e(e){var t=this;this.startLiveUpdate=function(e){void 0===e&&(e=null),e&&(t.handleUpdate=e),t.updateBoltClient(),t.status=i.BrowseBoltClientStatus.Live},this.onBoltRefresh=function(){t.updateBoltClient(),t.status=i.BrowseBoltClientStatus.Live},this.onBoltUpdate=function(){t.handleUpdate&&t.handleUpdate()},this.updateBoltClient=function(){var e=t.boltData.map(function(e){return new s.SignedChannelState("sfj",e.bolt_unique_id,e.latest_sjid.toString(),e.bolt_token)});t.boltClient?t.boltClient.update_states(e):(t.boltClient=new s.BoltClient(e,t.onBoltUpdate,t.onBoltRefresh),t.boltClient.start())},this.userId=e,this.status=i.BrowseBoltClientStatus.NotReady,this.boltData=[]}return e.prototype.isReady=function(){return this.status!==i.BrowseBoltClientStatus.NotReady},e.prototype.setInitialBoltData=function(e){this.boltData=e,this.status=i.BrowseBoltClientStatus.NotLive},e.prototype.fetchInitialBoltData=function(e){var t=this;this.initialBoltDataRequest&&this.initialBoltDataRequest.abort(),this.initialBoltDataRequest=o.WebRequest({url:"/get_browse_bolt_data",dataType:"json",subject_user:this.userId,success:function(r,o,s){t.setInitialBoltData(r),e()},error:function(e,r,o){t.status=i.BrowseBoltClientStatus.NotReady},complete:function(){delete t.initialBoltDataRequest}})},e.prototype.handleUpdateBoltClient=function(e){this.boltData=e,this.updateBoltClient()},e.prototype.getNsMap=function(){var e={};return this.boltData.forEach(function(t){e[t.bolt_unique_id]=parseInt(t.latest_sjid,10)}),e},e.prototype.stopLiveUpdate=function(){this.status=i.BrowseBoltClientStatus.NotLive,this.boltClient&&this.boltClient.unsubscribe()},e})();t.BrowseBoltClient=a}),define("modules/clean/cloud_docs/constants",["require","exports","tslib","external/lodash"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);(function(e){e.PAPER="paper"})(t.PaperFileTypes||(t.PaperFileTypes={}));(function(e){e.GOOGLE_DSS_DOC="gdoc",e.GOOGLE_DSS_SHEET="gsheet",e.GOOGLE_DSS_SLIDES="gslides"})(t.GoogleFileTypes||(t.GoogleFileTypes={}));var s;(function(e){e.WORD="docx",e.EXCEL="xlsx",e.POWERPOINT="pptx"})(s=t.MicrosoftFileTypes||(t.MicrosoftFileTypes={}));(function(e){e.HOME="new_file_menu_home",e.BROWSE="new_file_menu_browse"})(t.NewFileMenuFromType||(t.NewFileMenuFromType={})),t.isMicrosoftFileType=function(e){return o.values(s).includes(e)},t.IFRAME_LOAD_EVENT_TIMEOUT=3e4}),define("modules/clean/cloud_docs/create_api",["require","exports","tslib","modules/clean/cloud_docs/constants","modules/clean/react/async_folder_selector_modal","modules/clean/react/snackbar","modules/clean/react/browse/api","modules/clean/react/browse/action_logger","modules/clean/web_user_action_events","modules/core/browser","modules/core/cookies","modules/core/i18n"],function(e,t,r,o,s,i,a,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s),a=r.__importStar(a),c=r.__importStar(c),t.getDepthFromPath=function(e){return(e.replace(/\/$/,"").match(/\//g)||[]).length},t.showAsyncFolderSelectorModal=function(e){var r=e.user,o=e.source,i=e.documentType;s.show({primaryAction:u._("Create"),secondaryAction:u._("Cancel"),title:u._("Create file in..."),ariaLabel:u._("Create file in..."),user:r,initialFolderSelection:"",forceRootSelectable:!1,onFolderSelected:function(e){n.logFileCreateClick({uid:r.id,source:o,action:l.WebUserActionLogEvent.FILE_CREATE_HOME_FOLDER_SELECTED,depth_folder_selected:t.getDepthFromPath(e)}),t.createNewFile({userId:r.id,path:e,documentType:i})},showFolderPicker:!1})},t.createNewFile=function(e){var r=e.userId,s=e.path,i=e.documentType;o.isMicrosoftFileType(i)?p({userId:r,path:s,documentType:i}):t.createNewCloudOnlyDoc({userId:r,pathName:s,title:"Untitled",documentType:i})};var p=function(e){var r=e.userId,o=e.path,s=e.documentType,i={fq_path:o,extension:s,_subject_uid:String(r),t:d.Cookies.read("__Host-js_csrf")},a=t.constructFormForCreateNewMicrosoftFile(i);document.body.appendChild(a),a.submit()};t.constructFormForCreateNewMicrosoftFile=function(e){var t=document.createElement("form");t.action="/ow/msft/create_new_file",t.method="POST",t.target="_blank";for(var r=0,o=Object.keys(e);r<o.length;r++){var s=o[r],i=document.createElement("input");i.type="hidden",i.name=s,i.value=e[s],t.appendChild(i)}return t},t.createNewCloudOnlyDoc=function(e){var t,r=e.userId,s=e.pathName,n=e.title,l=e.documentType;switch(l){case o.PaperFileTypes.PAPER:t="Paper doc";break;case o.GoogleFileTypes.GOOGLE_DSS_DOC:t="Google Docs";break;case o.GoogleFileTypes.GOOGLE_DSS_SHEET:t="Google Sheets";break;case o.GoogleFileTypes.GOOGLE_DSS_SLIDES:t="Google Slides";break;default:t="Cloud Doc"}i.Snackbar.sync(u._("Creating new %(type)s...").format({type:t}),!0),a.createCloudDoc({pathName:s,title:n,documentType:l,userId:r,onSuccess:function(e){var r=(e.changesets,e.createdFile);i.Snackbar.complete(u._("%(type)s created!").format({type:t})),c.redirect(r.preview_url)},onError:function(e){i.Snackbar.fail(e)}})}}),define("modules/clean/cloud_docs/new_file_menu",["require","exports","tslib","external/classnames","external/react","spectrum/icon_partners","spectrum/popover","spectrum/button","spectrum/tertiary_link","modules/clean/cloud_docs/constants","modules/clean/cloud_docs/create_api","modules/clean/react/browse/action_logger","modules/clean/web_user_action_events","modules/clean/react/css","modules/core/i18n"],function(e,t,r,o,s,i,a,n,l,c,d,u,p,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),s=r.__importStar(s);var f=_._("Google"),m=_._("Microsoft Office Online"),S=_._("Create in Microsoft Office Online");t.NewFileCreateLabel=_._("Create new file");var E=_._("Google Docs"),T=_._("Google Sheets"),g=_._("Google Slides"),F=_._("Excel workbook"),w=_._("PowerPoint presentation"),y=_._("Word document"),v=_._("Paper doc"),A=_._("Dropbox Paper");t.handleNewFileSelection=function(e){e.handleClick()};var R=function(e){switch(e){case c.MicrosoftFileTypes.WORD:return p.WebUserActionLogEvent.FILE_CREATE_WORD;case c.MicrosoftFileTypes.EXCEL:return p.WebUserActionLogEvent.FILE_CREATE_EXCEL;case c.MicrosoftFileTypes.POWERPOINT:return p.WebUserActionLogEvent.FILE_CREATE_POWERPOINT;case c.GoogleFileTypes.GOOGLE_DSS_DOC:return p.WebUserActionLogEvent.FILE_CREATE_GOOGLE_DOC;case c.GoogleFileTypes.GOOGLE_DSS_SHEET:return p.WebUserActionLogEvent.FILE_CREATE_GOOGLE_SHEET;case c.GoogleFileTypes.GOOGLE_DSS_SLIDES:return p.WebUserActionLogEvent.FILE_CREATE_GOOGLE_SLIDES;case c.PaperFileTypes.PAPER:return p.WebUserActionLogEvent.FILE_CREATE_PAPER}},b=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.renderIcon=function(){return s.createElement(i.IconPartners,{name:this.props.item.iconName,width:"24px",height:"24px"})},t.prototype.render=function(){return s.createElement(a.PopoverContentItem,{key:this.props.item.displayName,value:this.props.item,className:this.props.item.className},s.createElement("div",{className:"newfile-popover--item"},this.renderIcon(),s.createElement("div",{className:"newfile-popover--item-text"},this.props.item.displayName)))},t})(s.Component);t.NewFileTypeRow=b;var I=(function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCreateNewFile=function(e){return function(){u.logFileCreateClick({uid:t.props.user.id,source:t.props.source,action:R(e)}),t.props.path?d.createNewFile({userId:t.props.user.id,path:t.props.path,documentType:e}):d.showAsyncFolderSelectorModal({user:t.props.user,source:t.props.source,documentType:e})}},t.logTriggerClick=function(){u.logFileCreateClick({uid:t.props.user.id,source:t.props.source,action:p.WebUserActionLogEvent.FILE_CREATE_OPEN_MENU})},t}return r.__extends(i,e),i.prototype.getNewFileTypeSections=function(){var e=[];this.props.showPaper&&e.push({title:A,items:[{displayName:v,iconName:"dropbox_paper",className:"action-create-file-paper-doc",handleClick:this.handleCreateNewFile(c.PaperFileTypes.PAPER)}]});var t=[];t.push({displayName:y,iconName:"microsoft_docx",className:"action-create-file-word",handleClick:this.handleCreateNewFile(c.MicrosoftFileTypes.WORD)}),t.push({displayName:F,iconName:"microsoft_xlsx",className:"action-create-file-excel",handleClick:this.handleCreateNewFile(c.MicrosoftFileTypes.EXCEL)}),t.push({displayName:w,iconName:"microsoft_pptx",className:"action-create-file-powerpoint",handleClick:this.handleCreateNewFile(c.MicrosoftFileTypes.POWERPOINT)});var r=!(this.props.showGdd||this.props.showPaper);if(e.push({title:r?S:m,items:t}),this.props.showGdd){var o=[];o.push({displayName:E,iconName:"google_gdoc",className:"action-create-file-google-doc",handleClick:this.handleCreateNewFile(c.GoogleFileTypes.GOOGLE_DSS_DOC)}),o.push({displayName:T,iconName:"google_gsheet",className:"action-create-file-google-sheet",handleClick:this.handleCreateNewFile(c.GoogleFileTypes.GOOGLE_DSS_SHEET)}),o.push({displayName:g,iconName:"google_gslides",className:"action-create-file-google-slides",handleClick:this.handleCreateNewFile(c.GoogleFileTypes.GOOGLE_DSS_SLIDES)}),e.push({title:f,items:o})}return e},i.prototype.renderTrigger=function(){return this.props.primaryButton?s.createElement(n.Button,{key:t.NewFileCreateLabel,onClick:this.logTriggerClick,disabled:this.props.disabled,className:o.default("primary-action-menu__button","action-create-file"),tagName:"span"},t.NewFileCreateLabel):s.createElement(l.TertiaryLink,{key:t.NewFileCreateLabel,icon:"create",onClick:this.logTriggerClick,disabled:this.props.disabled,className:o.default("secondary-action-menu__button","action-create-file")},t.NewFileCreateLabel)},i.prototype.renderSection=function(e){return s.createElement("div",{className:"newfile-popover--section",key:e.title},s.createElement("div",{className:"newfile-popover--title"},e.title),e.items.map(function(e){return s.createElement(b,{item:e,key:e.displayName})}))},i.prototype.render=function(){return s.createElement(a.Popover,{onSelection:t.handleNewFileSelection},s.createElement(a.PopoverTrigger,{disabled:this.props.disabled,className:"newfile-popover--trigger"},this.renderTrigger()),s.createElement(a.PopoverContent,{attachment:"right"},s.createElement("div",{className:"newfile-popover"},this.getNewFileTypeSections().map(this.renderSection))))},i})(s.Component),P=h.requireCssWithComponent(I,["/static/css/spectrum/index.web-vflsx5vgZ.css","/static/css/cloud_docs/new_file_menu-vfle33Fuy.css"]);t.NewFileMenu=P}),define("modules/clean/file_operations/notifications",["require","exports","tslib","external/lodash","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/api","modules/clean/undo","modules/core/html","modules/core/i18n","modules/core/notify"],function(e,t,r,o,s,i,a,n,l,c,d,u){"use strict";function p(e,t,r,o,s){var i=function(){return n.rollbackChangeSets({changesets:r,userId:t.id,progressText:d._("Undoing…"),rollbackHints:o?o:void 0,onSuccess:function(){u.Notify.success(d._("Undo complete.")),s&&s()}})};l.notifyWithUndo(e,r,i)}function h(e,t){var r=s.browse_uri_for_fq_path(t,e),n=i.Emstring.em_snippet(a.filename(e),40);return{href:r,text:o.escape(n)}}function _(e,t,r,o,s,i){var a;if(o){var n=h(o,t);a=d.ungettext('Copied %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Copied %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e).format({num_items:e,dest_href:n.href,dest_name:n.text}),a=new c.HTML(a)}else a=d.ungettext("Copied %(num_items)d item.","Copied %(num_items)d items.",e).format({num_items:e});p(a,t,r,s,i)}function f(e,t,r,o,s,i){var a;if(o){var n=h(o,t);a=d.ungettext('Moved %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Moved %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e).format({num_items:e,dest_href:n.href,dest_name:n.text}),a=new c.HTML(a)}else a=d.ungettext("Moved %(num_items)d item.","Moved %(num_items)d items.",e).format({num_items:e});p(a,t,r,s,i)}function m(e,t,r,o,s){p(d.ungettext("Deleted %(num_items)d item.","Deleted %(num_items)d items.",e).format({num_items:e}),t,r,o,s)}function S(e,t,r,o){p(d._("Rename complete."),e,t,r,o)}function E(e,t,r){p(d._("Created folder %(folder_name)s.").format({folder_name:e}),t,r)}function T(e){var t=d.ungettext("Permanently deleted %(num)s item.","Permanently deleted %(num)s items.",e).format({num:e});u.Notify.success(t)}function g(e){var t,r=e.length;if(1===r){var s=o.escape(a.filename(e[0].fq_path));t=d._("Restored <strong>%(filename)s</strong>.").format({filename:s}),t=new c.HTML(t)}else t=d.ungettext("Restored %(num)s file.","Restored %(num)s files.",r).format({num:r});u.Notify.success(t)}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),a=r.__importStar(a),n=r.__importStar(n),l=r.__importStar(l),t.notifyCopySuccess=_,t.notifyMoveSuccess=f,t.notifyDeleteSuccess=m,t.notifyRenameSuccess=S,t.notifyFolderCreationSuccess=E,t.notifyPurgeSuccess=T,t.notifyRestoreSuccess=g}),define("modules/clean/pagination_manager",["require","exports","tslib","modules/clean/ajax","modules/core/i18n","modules/core/notify"],function(e,t,r,o,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);var a=(function(){function e(e){this.hasMoreItems=e}return e.prototype.areAllItemsReady=function(){return!this.hasMoreItems},e.prototype.invalidateHasMore=function(){this.hasMoreItems=!0},e.prototype.addDataToAjax=function(e){},e})(),n=(function(){function e(e){this.ajaxURL=e.ajaxURL,this.newDataCallback=e.newDataAvailableCallback,this.autoFetching=!1,this.mode=e.mode,this.keyName=e.keyName,this.items={},this.pages=[],this.nextRequestVoucher=e.firstPage.next_request_voucher,this.userID=e.userID,this.fqPathPrefix=e.fqPathPrefix?"/"+e.fqPathPrefix:"",this.addPage(e.firstPage.items)}return e.prototype.areAllItemsReady=function(){return this.mode.areAllItemsReady()},e.prototype.addPage=function(e){for(var t=[],r=[],o=0,a=e;o<a.length;o++){var n=a[o],l=n[this.keyName];if(null==l)return void i.Notify.warning(s._("Invalid server response"));null==this.items[l]&&(this.items[l]=n,r.push(n),t.push(l))}this.pages.push(t),this.newDataCallback(this,r)},e.prototype.startAutoFetching=function(){this.autoFetching=!0,this.fetchNext()},e.prototype.stopAutoFetching=function(){this.autoFetching=!1},e.prototype.reSync=function(e){void 0===e&&(e=!1),e&&(this.nextRequestVoucher=null,this.items={},this.pages=[]);var t=this.autoFetching&&this.mode.areAllItemsReady();this.mode.invalidateHasMore(),t&&this.startAutoFetching()},e.prototype.fetchNext=function(){var e=this;if(!this.mode.areAllItemsReady()){var t={};this.nextRequestVoucher&&(t.voucher=this.nextRequestVoucher),this.mode.addDataToAjax(t),o.WebRequest({url:this.ajaxURL,data:t,subject_user:this.userID,success:function(t){var r=JSON.parse(t);e.nextRequestVoucher=r.next_request_voucher,e.mode.hasMoreItems=r.has_more_items,e.autoFetching&&e.fetchNext();for(var o=0,s=r.items;o<s.length;o++){var i=s[o];i.fq_path=e.fqPathPrefix+i.fq_path}e.addPage(r.items)},error:function(){i.Notify.error(s._("There was a problem completing this request."))}})}},e.prototype.loadedPageCount=function(){return this.pages.length},e.prototype.getLoadedPage=function(e){var t=this,r=this.pages[e];return null==r?null:r.map(function(e){return t.items[e]})},e.prototype.getLastLoadedPage=function(){return this.getLoadedPage(this.loadedPageCount()-1)},e})();t.BasePaginationManager=n;var l=(function(e){function t(t){return e.call(this,r.__assign({},t,{mode:new a(t.firstPage.has_more_items)}))||this}return r.__extends(t,e),t.create=function(e){return new t(e)},t})(n);t.PaginationManager=l}),define("modules/clean/react/app_actions/app_actions_store",["require","exports","tslib","modules/clean/filepath","modules/clean/api_v2/client"],function(e,t,r,o,s){"use strict";function i(e){return void 0!==e.ext}function a(e){return void 0!==e.fq_path}function n(e){return i(e)?e.ext:a(e)?"."+o.file_extension(o.filename(e.fq_path)):void 0}function l(){return d||(d=new c(new s.ApiV2Client)),d}Object.defineProperty(t,"__esModule",{value:!0});var c=(function(){function e(e){this.actionIdToAppAction={},this.client=e}return e.prototype.getActionsForFile=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var o;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this.getActionsForFileBatch([e],t)];case 1:return o=r.sent(),[2,o[e.file_id]]}})})},e.prototype.getActionsForFileBatch=function(e,t){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(r){return[2,this.loadActionsByUser(e,t)]})})},e.prototype.loadActionsByUser=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var o,s,i,a;return r.__generator(this,function(r){switch(r.label){case 0:this.stateRequest||(this.stateRequest=this.loadActions(t)),o=this.stateRequest,s={},r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.stateRequest];case 2:return i=r.sent(),e.forEach(function(e){var t=void 0,r=n(e);r&&(t=i.extToCategories[r]),t||!i.appActionsEnabled||e.is_dir||(t=[]),t&&(s[e.file_id]=t)}),[3,4];case 3:return a=r.sent(),o===this.stateRequest&&(this.stateRequest=void 0),[3,4];case 4:return[2,s]}})})},e.prototype.loadActions=function(e){return r.__awaiter(this,void 0,void 0,function(){var t,o,s=this;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this.client.ns("app_actions").rpc("get_available_actions_for_user",void 0,{subjectUserId:e})];case 1:return t=r.sent(),t.actions.forEach(function(e){s.actionIdToAppAction[e.id]||(s.actionIdToAppAction[e.id]=e)}),o={},t.exts_to_action_ids.forEach(function(e){var t={},r=[];e.action_ids.forEach(function(e){var o=s.actionIdToAppAction[e],i=t[o.category];i?i.actions.push(o):(i={categoryId:o.category,actions:[o]},t[o.category]=i,r.push(i))}),r=r.map(function(e){return{categoryId:e.categoryId,actions:s.prioritizeActions(e.actions)}}),r.sort(function(e,t){return e.categoryId<t.categoryId?-1:t.categoryId<e.categoryId?1:0}),o[e.ext]=r}),[2,{appActionsEnabled:t.app_actions_enabled,extToCategories:o}]}})})},e.prototype.prioritizeActions=function(e){return e.sort(function(e,t){return e.priority&&t.priority?t.priority-e.priority:e.priority?-1:t.priority?1:e.description<t.description?-1:e.description>t.description?1:0})},e})();t.AppActionsStore=c;var d;t.getAppActionsStore=l});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/async_fileops_modals",["require","exports"],function(e,t){"use strict";function r(t){new Promise(function(t,r){e(["modules/clean/react/fileops_modals"],t,r)}).then(__importStar).then(t)}function o(e){r(function(t){return(0,t.showCopy)(e)})}function s(e){r(function(t){return(0,t.showMove)(e)})}function i(e){r(function(t){return(0,t.showUpload)(e)})}function a(e){r(function(t){return(0,t.showAdminUpload)(e)})}function n(t){new Promise(function(t,r){e(["modules/clean/react/folder_dialog/move_dialog_modal"],t,r)}).then(__importStar).then(function(e){return e.MoveDialogModal.show(t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.showCopy=o,t.showMove=s,t.showUpload=i,t.showAdminUpload=a,t.showMoveDialog=n});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/async_folder_selector_modal",["require","exports"],function(e,t){"use strict";function r(t){new Promise(function(t,r){e(["modules/clean/react/folder_selector_modal"],t,r)}).then(__importStar).then(function(e){e.FolderSelectorModal.show(t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.show=r});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/async_onboarding_move_modal",["require","exports"],function(e,t){"use strict";function r(t){new Promise(function(t,r){e(["modules/clean/react/onboarding_folder_dialog/onboarding_move_dialog"],t,r)}).then(__importStar).then(t)}function o(e){r(function(t){return(0,t.showMove)(e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.showOnboardingMoveDialog=o}),define("modules/clean/react/browse/actions",["require","exports","tslib","external/lodash","modules/clean/browse_interface","modules/clean/downloads","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/history","modules/clean/react/fileops_actions","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/dispatcher","modules/clean/react/browse/models","modules/clean/react/browse/nav_actions","modules/clean/react/browse/store","modules/constants/python","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/notify","modules/clean/search/constants","modules/clean/react/file_viewer/async_controller","modules/clean/search/search_results/dispatcher","modules/clean/react/files_view/types","modules/clean/user_education/user_education_client","modules/clean/sharing/browse_exports"],function(e,t,r,o,s,i,a,n,l,c,d,u,p,h,_,f,m,S,E,T,g,F,w,y,v,A,R,b){"use strict";function I(){return e("modules/clean/react/file_viewer/controller")}function P(){return e.defined("modules/clean/react/file_viewer/controller")}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),i=r.__importStar(i),a=r.__importStar(a),n=r.__importStar(n),l=r.__importDefault(l),c=r.__importStar(c),d=r.__importStar(d),u=r.__importStar(u),E=r.__importStar(E),w=r.__importStar(w);var C=(function(){function e(e){var o=this;this.nameNewFolder=function(){h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.REQUEST_FOLDER_NAME})},this.showTimeline=function(){h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.SHOW_TIMELINE})},this.hideTimeline=function(){h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.HIDE_TIMELINE})},this.createFolderPending=function(){h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.CREATE_FOLDER_PENDING})},this.cancelCreateFolder=function(){h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.CANCEL_CREATE_FOLDER}),window.setTimeout(function(){R.UEClient.sendEvent("CdmNewFolderModal","maybeFinished")},2500)},this.createFolderComplete=function(e){var t=e.folderName,r=e.user,o=e.changesets;h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.CREATE_FOLDER_COMPLETE}),a.notifyFolderCreationSuccess(t,r,o),window.setTimeout(function(){R.UEClient.sendEvent("CdmNewFolderModal","maybeFinished")},2500)},this.createFolder=function(e){var t=e.folderName,s=e.pathName,i=e.nsId,a=void 0===i?null:i,l=e.checkFSWs,c=e.showShareModalOnSuccess,u=e.redirectOnSuccess,p=m.getBrowseStore().user();o.createFolderPending(),o.dataApi.createNewFolder({pathName:s,folderName:t,nsId:a,checkFSWs:l,userId:p.id,onSuccess:function(s){var i=s.changesets,a=s.createdFolder,l=s.failureDetails;if(l){var h=function(){o.createFolder(r.__assign({},e,{checkFSWs:!1}))};d.showFileSystemWarningsModal({fsws:l,onFinalAccept:h,confirmText:g._("Create folder"),onAbortAction:o.cancelCreateFolder})}else{var _=a?n.filename(a.fq_path):t;o.createFolderComplete({user:p,folderName:_,changesets:i}),a&&(o.selectRowsFromBoltClient([a]),u&&u(a.fq_path),c&&o.handleShowShareModal(a,"browse_new_folder_modal"))}},onError:o.cancelCreateFolder})},this.createFolderInNewFolderModal=function(e){var r=e.folderName,s=e.isConfidential,i=e.user,a=e.context;s&&!a.isInsideTeamFolderTree?b.asyncShowNewFolderShareModal(i,null,a.currentFQPath,r,!1,!1,null,f.browseNavActions.setPath,f.browseNavActions.setUrl):t.browseActions.createFolder({pathName:a.currentFQPath,folderName:r,nsId:a.rootNSID,checkFSWs:!0,showShareModalOnSuccess:(i.is_cdm_member||s)&&a.isInsideTeamFolderTree,redirectOnSuccess:o.handleNewFolderRedirectOnSuccess})},this.handleNewFolderRedirectOnSuccess=function(e){f.browseNavActions.setUrl({path:e})},this.doDeleteFilesWithModal=function(e){var t=e.files,r=m.getBrowseStore(),s=r.user(),i=r.context();d.showDelete(s,t,i,n.filename(i.currentFQPath),function(){o.dataApi.deleteFiles({files:t,userId:s.id,onSuccess:function(e){var r=e.changesets,i=e.rollbackHints,n=e.fileDeltas;v.SearchResultsDispatcher.dispatch({type:w.CHANGE_FILES_ACTION,data:{fileDeltas:n.filter(function(e){return!!e.before}).map(function(e){return{before:e.before.fq_path,after:null}})}}),a.notifyDeleteSuccess(t.length,s,r,i,function(){o.selectRowsFromBoltClient(t),v.SearchResultsDispatcher.dispatch({type:w.CHANGE_FILES_ACTION,data:{fileDeltas:n.filter(function(e){return!!e.before}).map(function(e){return{before:null,after:e.before}})}})})}})})},this.onPurgeSuccessCallback=function(e){a.notifyPurgeSuccess(e.length),t.browseActions.reloadCurrentPath(),v.SearchResultsDispatcher.dispatch({type:w.CHANGE_FILES_ACTION,data:{fileDeltas:e.map(function(e){return{before:e.fq_path,after:null}})}})},this.onPurge=function(e,t){o.dataApi.purgeFiles({files:t,userId:e,onSuccess:o.onPurgeSuccessCallback})},this.doPermanentDeleteWithModal=function(e){var t=e.files,r=m.getBrowseStore(),s=r.user(),i=r.context();d.showPurgeModal({userId:s.id,context:i,files:t,onPurge:o.onPurge})},this.onRestore=function(e,t,r){o.dataApi.restoreFiles({files:t,userId:e,onSuccess:function(){a.notifyRestoreSuccess(t)},isSearchMode:r})},this.doRestoreFilesWithUnifiedTrashModal=function(e){var t=e.files,r=m.getBrowseStore(),s=r.user(),i=r.context();d.showUnifiedTrashModal({userId:s.id,context:i,files:t,onRestore:function(e,t){o.onRestore(e,t,!1)}})},this.dataApi=e}return e.prototype.appInit=function(e){var t=e.experiments,r=e.shouldShowDeletedFiles,o=e.user,s=e.viewer;h.BrowseDispatcher.dispatch({type:p.DEPRECATED__BrowseActionType.APP_INIT,data:{experiments:t,shouldShowDeletedFiles:r,user:o,viewer:s}})},e.prototype.initializeEverything=function(e){var t=e.path,r=e.files,o=e.paginatedTotalNumFiles,s=e.context,i=e.mountPoints,a=e.fqPathsToSelect,n=e.loadingState,l=e.teamFolders;h.BrowseDispatcher.dispatch({type:p.DEPRECATED__BrowseActionType.INITIALIZE_EVERYTHING,data:{path:t,files:r,paginatedTotalNumFiles:o,context:s,mountPoints:i,fqPathsToSelect:a,loadingState:n,teamFolders:l}})},e.prototype.load=function(e){var t=e.path,r=e.files,o=e.paginatedTotalNumFiles,s=e.context;f.browseNavActions.load({path:t,files:r,paginatedTotalNumFiles:o,context:s})},e.prototype.addFilesAndSetLoadingState=function(e){var t=e.path,r=e.loadingState,o=e.files,s=e.paginatedTotalNumFiles;f.browseNavActions.addFilesAndSetLoadingState({path:t,loadingState:r,files:o,paginatedTotalNumFiles:s})},e.prototype.setMountPoints=function(e){var t=e.mountPoints;f.browseNavActions.setMountPoints({mountPoints:t})},e.prototype.setPath=function(e){var t=e.path,r=e.onPathLoaded,o=e.logFetchedDataRequiredForTTI,s=void 0!==o&&o,i=e.ajaxWebTimer;f.browseNavActions.setPath({path:t,onPathLoaded:r,logFetchedDataRequiredForTTI:s,ajaxWebTimer:i})},e.prototype.reloadCurrentPath=function(){var e=m.getBrowseStore();this.setPath({path:e.path()})},e.prototype.updatePreview=function(e){var t=e.files;P()&&I().updateFiles(t)},e.prototype.closeFileViewer=function(){P()&&I().close()},e.prototype.setUrl=function(e){var t=e.path,r=e.qargs;f.browseNavActions.setUrl({path:t,qargs:r})},e.prototype.selectRowsFromBoltClient=function(e){void 0===e&&(e=[]),this.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:e.map(function(e){return e.fq_path})})},e.prototype.setFilePathsToSelectOnNextUpdate=function(e){var t=e.fqPathsToSelect;h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,data:{fqPathsToSelect:t}})},e.prototype.addFileJumpKeyCode=function(e){var t=e.keyChar;h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.ADD_FILE_JUMP_KEY_CODE,data:{keyChar:t}})},e.prototype.resetFileJump=function(){h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.RESET_FILE_JUMP})},e.prototype.setBrowsePostTTIExperiments=function(e){var t=e.browsePostTTIExperiments;h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.SET_BROWSE_POST_TTI_EXPERIMENTS,data:{browsePostTTIExperiments:t}})},e.prototype.copyFiles=function(e){c.copyFiles(e)},e.prototype.moveFiles=function(e){c.moveFiles(e)},e.prototype.applyFileDeltas=function(e){var t=e.path,r=e.fileDeltas;h.BrowseDispatcher.dispatch({type:p.DEPRECATED__BrowseActionType.CHANGE_FILES,data:{path:t,fileDeltas:r}})},e.prototype.openLocalCopy=function(e){var t=e.nsId,r=e.nsPath,o=e.userId,s=e.onSuccess,i=e.onError;this.dataApi.openLocalCopy({nsId:t,nsPath:r,userId:o,onSuccess:s,onError:i})},e.prototype.getMountPointUpdateForCurrentPath=function(e){var t,r,s=m.getBrowseStore().path(),i=m.getBrowseStore().mountPoints(),a=i?i.toJS():{},n=function(e){return e===s},l=parseInt(o.findKey(a,n),10);if(l)t=e[l]||null,r=a[l]||null;else{r=null;t=!!o.findKey(e,n)?s:null}return[r,t]},e.prototype.getPathForNewMountPoint=function(e,t){return e&&!t?m.getBrowseStore().path():e&&t?n.paths_are_equal(e,t)?null:t:!e&&t?m.getBrowseStore().path():null},e.prototype.showUserNotificationForPathChange=function(e,t){function r(e){return o.escape(n.filename(e))}function i(e){F.Notify.success(new T.HTML(e))}function a(e){F.Notify.error(new T.HTML(e))}var l=t.old_fq_path,c=s.get_browse_root(e)+t.new_fq_path,d=!t.is_changing_view,u=null!=t.change_type?t.change_type.toLowerCase():null;if("moved"===u)if(d)i(g._("This folder has been moved"));else{var p=g._('The folder ‘%(folder_name)s’ has been moved. <a href="%(href)s">View</a>').format({folder_name:r(l),href:o.escape(c)});a(p)}else if("renamed"===u)if(d){var p=g._("This folder has been renamed to ‘%(folder_name)s’").format({folder_name:r(t.change_to_fq_path)});i(p)}else{var p=g._('The folder ‘%(folder_name)s’ has been renamed. <a href="%(href)s">View</a>').format({folder_name:r(l),href:o.escape(c)});a(p)}else if("deleted"===u){var p=g._("The folder ‘%(folder_name)s’ has been deleted").format({folder_name:r(l)});a(p)}},e.prototype.computeAndApplyDeltasFromBoltClient=function(e){var t=e.path,r=e.payload,o=r.added,s=r.moved,i=r.removed,a=r.mount_points,n=r.parent_changes;if(n&&n.change_to_fq_path){var l=m.getBrowseStore().user();return this.showUserNotificationForPathChange(l,n),void this.setUrl({path:n.change_to_fq_path})}var c=this.getMountPointUpdateForCurrentPath(a),d=c[0],u=c[1];d&&!u&&F.Notify.success(g._("The folder was unshared."));var p=this.getPathForNewMountPoint(d,u);if(p)return void this.setPath({path:p});this.setMountPoints({mountPoints:a});for(var h=m.getBrowseStore().filesMap(),f=[],S=0,E=o;S<E.length;S++){var T=E[S],w=null,y=_.File.fromServerObject(T);f.push({before:w,after:y})}for(var v=0,A=s;v<A.length;v++){var R=A[v],b=R[0],T=R[1],w=h.get(b,null),y=_.File.fromServerObject(T);f.push({before:w,after:y})}for(var I=0,P=i;I<P.length;I++){var C=P[I],w=h.get(C,null),y=null;f.push({before:w,after:y})}this.applyFileDeltas({path:t,fileDeltas:f})},e.prototype.setSelection=function(e){var t=e.selection;h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.SET_SELECTION,data:{selection:t}})},e.prototype.selectFilesAfterUpload=function(e){var t=e.fqPathsToSelect;h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.SELECT_FILES_AFTER_UPLOAD,data:{fqPathsToSelect:t}})},e.prototype.selectFilesByFqPath=function(e){var t=e.fqPathsToSelect;h.BrowseDispatcher.dispatch({
type:p.DEPRECATED_PRIVATE__BrowseActionType.SELECT_FILES_BY_FQ_PATH,data:{fqPathsToSelect:t}})},e.prototype.navigateToFileOrFolder=function(e){var t=e.file,r=e.shouldFocusComment,o=void 0!==r&&r,s=e.shouldPrepareForSignature,i=void 0!==s&&s,a=e.onFileViewerUnmount,n=e.fileViewAction,l=void 0===n?S.FileViewActionType.CLICK:n,c=e.fileViewOrigin,p=void 0===c?S.FileViewOriginType.BROWSE:c,h=m.getBrowseStore().user(),f=m.getBrowseStore().context();t.isDeleted?this.doRestoreFilesWithUnifiedTrashModal({files:[t]}):t.is_dir?_.File.isNoAccessSharedFolder(t)?d.showNoAccess(h,t,f):this.setUrl({path:t.fq_path}):this.openPreviewForBrowseFile(t,o,i,h,l,p,function(e){return u.fetchPreviewData(e,h)},a)},e.prototype.openPreviewForBrowseFile=function(e,t,r,o,s,i,a,n){var l=m.getBrowseStore().getIndexOfFile(e),c=l<0?[e]:m.getBrowseStore().files().toArray();if(l<0?l=0:c[l]=e,e.is_cloud_doc&&a){var d=window.open("about:blank","_blank");a(e).then(function(e){e.preview_url&&null!==d&&E.redirect(e.preview_url,d)})}else{var u=function(){y.showElementsBehindFileViewer(),n&&n()};y.asyncOpenPreview({containerId:p.BROWSE_FILE_VIEWER_ELEMENT_ID,files:c,indexOfPreviewFile:l,shouldFocusComment:t,user:o,onFileViewerDidMount:y.hideElementsBehindFileViewer,onFileViewerUnmount:u,fileViewAction:s,fileViewOrigin:i,fileViewTarget:S.FileViewTargetType.PRIVATE,filePreviewDataFetcher:a,shouldPrepareForSignature:r})}},e.prototype.navigateToResultObjectParentFolder=function(e){var t=e.file,r=e.fileViewAction;void 0===r&&S.FileViewActionType.CLICK;if(_.File.isNoAccessSharedFolder(t))d.showNoAccess(m.getBrowseStore().user(),t,m.getBrowseStore().context());else{var o=n.parent_dir(t.fq_path);this.setUrl({path:o})}},e.prototype.navigateToParentFolder=function(){var e=n.parent_dir(m.getBrowseStore().path());this.setUrl({path:e})},e.prototype.setShouldShowDeletedFiles=function(e){var t=e.shouldShowDeletedFiles,r=e.shouldReloadFolder,o=void 0===r||r,s=e.shouldUpdateUrl,i=void 0===s||s;h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.SET_SHOULD_SHOW_DELETED_FILES,data:{shouldShowDeletedFiles:t}}),o&&this.reloadCurrentPath(),i&&(t?l.default.update_query_param(p.BrowseQueryArg.d,"1"):l.default.remove_query_param(p.BrowseQueryArg.d))},e.prototype.sortFiles=function(e){var t=e.sortField,r=e.sortDirection;h.BrowseDispatcher.dispatch({type:p.DEPRECATED__BrowseActionType.SORT_FILES,data:{sortField:t,sortDirection:r}})},e.prototype.setViewType=function(e){var t=e.viewType,r=e.isSearchMode;h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.SET_VIEW_TYPE,data:{viewType:t,isSearchMode:r}})},e.prototype.setColumnDependentCapabilities=function(e){var t=e.canDisplayFolderSizes;h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.SET_COLUMN_DEPENDENT_CAPABILITIES,data:{canDisplayFolderSizes:t}})},e.prototype.setColumnConfiguration=function(e){var t=e.columns,r=e.viewType,o=e.canDisplayFolderSizes;h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.SET_COLUMN_CONFIGURATION,data:{columns:t,viewType:r,canDisplayFolderSizes:o}})},e.prototype.downloadFiles=function(e){var t=e.files,r=e.context,o=e.user;if(1===t.count()&&!t.first().is_dir)return void i.get_blockserver_link({url:t.first().direct_blockserver_link});if(r.blockHash){var s=r.currentFQPath,a=t.toArray().map(function(e){return e.fq_path});i.get_zip({fq_paths:a,subject_uid:o.id,block_hash:r.blockHash,parent_path:s})}},e.prototype.setDataApi=function(e){this.dataApi=e,f.browseNavActions.setDataApi(e)},e.prototype.fetchFolderSizes=function(e){var t=e.file;return r.__awaiter(this,void 0,void 0,function(){var e,o,s,i,a,n,l,c,d;return r.__generator(this,function(r){switch(r.label){case 0:e=m.getBrowseStore().user(),o=p.MAX_FOLDER_SIZE_ITERATIONS,r.label=1;case 1:return r.trys.push([1,7,,8]),h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.REQUEST_FETCH_FOLDER_SIZES,data:{fqPath:t.fq_path}}),[4,this.dataApi.fetchSharedFolderSizes(e.id,{fq_path:t.fq_path})];case 2:return s=r.sent(),h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.FETCHED_FOLDER_SIZES,data:{fqPath:t.fq_path,resp:s}}),i=[],[4,this.fetchAndSetSameNamespaceFolderSize(e.id,{fq_path:t.fq_path,folder_limit:p.MAX_FOLDERS_PER_CALL})];case 3:a=r.sent(),a.queue&&(i=i.concat(a.queue)),r.label=4;case 4:return i.length>0&&o>0?(o--,n=Math.min(p.MAX_FOLDER_SIZE_QUEUE_SIZE,i.length),l=i.splice(0,n),[4,this.fetchAndSetSameNamespaceFolderSize(e.id,{fq_path:t.fq_path,folder_limit:p.MAX_FOLDERS_PER_CALL,queue:l})]):[3,6];case 5:return a=r.sent(),a.queue&&i&&(i=i.concat(a.queue)),[3,4];case 6:return c=0!==o&&a.queue&&0===a.queue.length?A.FetchFolderSizeState.COMPLETE:A.FetchFolderSizeState.ERROR,h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.COMPLETE_FETCH_FOLDER_SIZES,data:{state:c}}),[3,8];case 7:return d=r.sent(),h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.COMPLETE_FETCH_FOLDER_SIZES,data:{state:A.FetchFolderSizeState.ERROR}}),[3,8];case 8:return[2]}})})},e.prototype.fetchAndSetSameNamespaceFolderSize=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var o;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this.dataApi.fetchSameNamespaceFolderSizes(e,t)];case 1:return o=r.sent(),h.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.FETCHED_FOLDER_SIZES,data:{fqPath:t.fq_path,resp:o}}),[2,o]}})})},e.prototype.handleShowShareModal=function(e,t){var r=m.getBrowseStore(),o=r.user(),s=r.context();b.asyncShowShareModal(o,e,{browseContext:s,origin:t},f.browseNavActions.setPath,f.browseNavActions.setUrl)},e.prototype.handleShowShareInterstitialModal=function(e,t,r,o,s){var i=m.getBrowseStore(),a=i.user(),n=i.context();b.expAsyncShowShareInterstitialModal(a,e,r,o,s,{browseContext:n,origin:t},f.browseNavActions.setPath,f.browseNavActions.setUrl)},e})();t.browseActions=new C(u)}),define("modules/clean/react/browse/api",["require","exports","tslib","external/lodash","modules/clean/ajax","modules/clean/api_v2/client","modules/clean/api_v2/root_aware_client","modules/clean/react/browse/models","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,r,o,s,i,a,n,l,c,d){"use strict";function u(e){try{return JSON.parse(e)}catch(e){if(!(e instanceof SyntaxError))throw e}return null}function p(e){var t=e.sortLabel,r=e.sortIsAscending,o=e.path,i=e.userId,a=e.onSuccess,n=e.includeDeletedFiles,l=void 0!==n&&n,c=e.sortFoldersFirst,d=void 0===c||c,p=e.onError;return s.WebRequest({data:{sort_label:t,sort_is_ascending:r.toString(),show_deleted:l||"",sort_folders_first:d,include_file_info:"True",path2:o},url:"/browse",subject_user:i,success:function(e,t,r){var s=u(e);s&&a({path:o,data:s,xhr:r})},error:function(e,t,r){p&&p(e,t,r)}})}function h(e){var t=e.files,r=e.newPath,i=e.userId,a=e.onSuccess,d=e.checkFSWs,u=t.map(function(e){return e.fq_path});return u.includes(r)?(c.Notify.error(l._("You can’t copy a folder into itself.")),null):s.WebProgressRequest({url:"/cmd/copy",data:{files:u,to_path:r,fsw_request:d?"check":void 0},subject_user:i,progress_text:l._("Copying files..."),success:function(e){try{var t=o.isString(e)?JSON.parse(e):e;a({newFiles:t.new_browse_files?t.new_browse_files.map(n.File.fromServerObject):[],destinationPath:r,changesets:t.changesets,rollbackHints:t.rollback_hints,failureDetails:t.failure_details})}catch(e){}}})}function _(e){var t=e.files,r=e.userId,i=e.onSuccess,a=t.map(function(e){return e.fq_path});return s.WebProgressRequest({url:"/cmd/delete",data:{files:a},subject_user:r,progress_text:l._("Deleting files..."),success:function(e){try{var r=o.isString(e)?JSON.parse(e):e;i({fileDeltas:t.map(function(e){return{before:e,after:null}}),changesets:r.changesets,rollbackHints:r.rollback_hints})}catch(e){}}})}function f(e){var t=e.path,r=e.files,i=e.newPath,a=e.userId,d=e.onSuccess,u=e.allowOwnershipTransfer,p=e.checkFSWs;if(t===i)return c.Notify.error(l._("Those files already exist in that folder.")),null;var h=r.map(function(e){return e.fq_path});return h.includes(i)?(c.Notify.error(l._("You can’t move a folder into itself.")),null):s.WebProgressRequest({url:"/cmd/move",data:{files:h,to_path:i,allow_ownership_transfer:u,fsw_request:p?"check":void 0},subject_user:a,progress_text:l._("Moving files..."),skipNotifyError:!u,success:function(e){try{var r=o.isString(e)?JSON.parse(e):e;d({path:t,destinationPath:i,newFiles:r.new_browse_files?r.new_browse_files.map(n.File.fromServerObject):[],changesets:r.changesets,rollbackHints:r.rollback_hints,failureDetails:r.failure_details})}catch(e){}},error:function(t,r,o){c.Notify.error(o),e.onError&&e.onError(o)}})}function m(e){var t=e.files,r=e.userId,o=e.onSuccess,i=e.isSearchMode;return s.WebProgressRequest({url:"/cmd/restore",data:{files:t.map(function(e){return e.fq_path}),source:i?"search":"browse"},subject_user:r,dataType:"json",progress_text:l._("Restoring…"),success:function(){o()}})}function S(e){var t=e.files,r=e.userId,o=e.onSuccess,i=e.progressText,a=void 0===i?l._("Deleting…"):i;return s.WebProgressRequest({url:"/cmd/purge",data:{files:t.map(function(e){return e.fq_path})},subject_user:r,dataType:"text",progress_text:a,success:function(e){var r=u(e);r&&"success"===r.status&&o(t)}})}function E(e){var t=e.userId,r=e.changesets,o=void 0===r?null:r,i=e.progressText,a=e.rollbackHints,n=void 0===a?{}:a,l=e.onSuccess;return s.WebProgressRequest({url:"/cmd/rollback",data:{ns_to_cs:JSON.stringify(o),rollback_hints:JSON.stringify(n)},subject_user:t,progress_text:i,success:function(){l()}})}function T(e){var t=e.pathName,r=e.folderName,o=e.userId,i=e.onSuccess,a=e.onError,l=e.checkFSWs;return s.WebProgressRequest({url:new d.URI({path:"/cmd/new"+t}).toString(),data:{to_path:r,folder:"yes",fsw_request:l?"check":void 0},subject_user:o,success:function(e){var t=u(e);if(t){var r=t.new_browse_files?n.File.fromServerObject(t.new_browse_files[0]):null;i({changesets:t.changesets,createdFolder:r,failureDetails:t.failure_details})}},error:function(){a()}})}function g(e){var t=e.pathName,r=e.title,o=e.documentType,i=e.userId,a=e.onSuccess,l=e.onError,c=(t+"/"+r+"."+o).replace("//","/");return s.WebRequest({url:new d.URI({path:"/cmd/create_cloud_doc"}).toString(),subject_user:i,data:{to_path:c,title:r},success:function(e){var t=u(e);if(t){a({changesets:null,createdFile:n.File.fromServerObject(t.new_browse_files[0])})}},error:function(e,t,r){l(r)},skipNotifyError:!0})}function F(e){var t=e.path,r=e.userId,i=e.namespaceToJournalIdMap,a=e.onSuccess,n=e.includeDeletedFiles,l="/"===t?"":t,c={fq_dir:l,ns_map:o.map(i,function(e,t){return t+"_"+e}).join(","),show_deleted:!!n};return s.WebRequest({url:"/update/list_dir",subject_user:r,data:c,dataType:"text",success:function(e){var t=u(e);t&&a(t)}})}function w(e,t){if(!b(e))return Promise.resolve(e);var o=[[e.ns_id,e.sjid,e.fq_path.substr(0,e.fq_path.length-e.ns_path.length)]];return new Promise(function(i,a){s.WebRequest({data:{nsid_sjid_fq_mount_point_tuples:JSON.stringify(o)},url:"/browse_file_info",dataType:"json",subject_user:t,success:function(t,o,s){var a=t.file_results[0];i(r.__assign({},e,a))},error:function(e,t,r){a(r)}})})}function y(e,t){return(new i.ApiV2Client).ns("folders").rpc("get_shared_subfolder_sizes",t,{subjectUserId:e})}function v(e,t){return(new i.ApiV2Client).ns("folders").rpc("get_subfolder_sizes_in_same_namespace",t,{subjectUserId:e})}function A(e,t){return(new a.ApiV2RootAwareClient).ns("ml").rpc("get_folder_suggestion",{paths:t,action:"MOVE"},{subjectUserId:e})}function R(t){var o,s=t.nsId,i=t.nsPath,a=t.userId,n=t.onSuccess,l=t.onError;return o="string"==typeof i?i.startsWith("/")?i:"/"+i:"/",new Promise(function(t,r){e(["modules/clean/unity/features"],t,r)}).then(r.__importStar).then(function(e){e.default.open_file(s,o,a,n,l,!1)})}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),t.loadPath=p,t.copyFiles=h,t.deleteFiles=_,t.moveFiles=f,t.renameFile=function(e){var t=e.file,r=e.name,o=e.user;return new Promise(function(e,i){s.WebRequest({url:new d.URI({path:"/cmd/rename"+t.fq_path}).toString(),subject_user:o.id,data:{to_path:r},success:function(r){var o=u(r);if(o){var s=t.merge(o.new_browse_files[0]);e({changesets:o.changesets,renamedFile:s,rollbackHints:o.rollback_hints})}else i(r)},error:i})})},t.restoreFiles=m,t.purgeFiles=S,t.rollbackChangeSets=E,t.createNewFolder=T,t.createCloudDoc=g,t.getChangesForDirectory=F;var b=function(e){return e.is_cloud_doc||!(e.event_type||e.preview_url||e.preview_thumbnail_url||e.preview_type||e.linkfile_data||e.htmlified_link||e.preview_ssr_image_url_tmpl||e.preview_ssr_refresh_url||e.preview_ssr_text_url_tmpl)};t.fetchPreviewData=w,t.fetchSharedFolderSizes=y,t.fetchSameNamespaceFolderSizes=v,t.fetchMoveSuggestion=A,t.openLocalCopy=R}),define("modules/clean/react/browse/browse",["require","exports","tslib","external/react","external/react-redux","modules/clean/react/browse/actions","modules/clean/react/browse/controller","modules/clean/react/browse/data/action_creators","modules/clean/react/browse/data/selectors","modules/clean/search/search_bar/data/action_creators","modules/clean/search/search_bar/data/selectors","modules/clean/react/browse/data/store","modules/clean/react/browse/store","modules/clean/viewer","modules/clean/web_timing_logger"],function(e,t,r,o,s,i,a,n,l,c,d,u,p,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importStar(n),l=r.__importStar(l),c=r.__importStar(c),d=r.__importStar(d),_=r.__importStar(_);var f=function(e){var t=l.viewType,r=l.context,o=l.sortedFilesWithFoldersSizesWithoutTeamFolders,s=l.sortedFilesWithFolderSizes,i=l.teamFolders,a=l.paginatedTotalNumFiles,n=l.loadingState,c=l.path,u=l.selection,p=l.selectedFiles,h=l.fileRename,_=l.shouldShowDeletedFiles,f=l.shouldShowPinnedTeamFolders,m=l.newFolderCreationState,S=l.isTimelineVisible,E=l.sortOrder,T=l.urlPrefix,g=l.canDisplayFolderSizes,F=l.viewTypeColumns,w=l.isQueryingFolderSizes,y=l.user,v=l.viewer,A=l.browsePostTTIExperiments,R=l.mountPoints,b=l.isFileJumping,I=d.searchSessionId,P=d.isSearchBarFocused;return{viewType:t(e),files:s(e),filesWithoutTeamFolders:o(e),teamFolders:i(e),paginatedTotalNumFiles:a(e),loadingState:n(e),path:c(e),fileRename:h(e),shouldShowDeletedFiles:_(e),shouldShowPinnedTeamFolders:f(e),isTextSelectable:!!h(e),createNewFolderState:m(e),isTimelineVisible:S(e),currentSort:E(e),urlPrefix:T(e),canDisplayFolderSizes:g(e),viewTypeColumns:F(e),isQueryingFolderSizes:w(e),user:y(e),viewer:v(e),browsePostTTIExperiments:A(e),brsContext:r(e),brsSelection:u(e),brsSelectedFiles:p(e),mountPoints:R(e),isFileJumping:b(e),searchSessionId:I(e),isSearchBarFocused:P(e)}},m={setSearchBarExperiments:c.setExperiments,setBrowseScope:c.setBrowseScope,setFileCategories:c.setFileCategories,setSearchQuery:c.setSearchQuery,clearSearchBar:c.clearSearchBar,blurSearchBar:c.blurSearchBar,copyFilesToClipboard:n.copyFilesToClipboard,pasteFilesFromClipboard:n.pasteFilesFromClipboard,renameFile:n.renameFile,setFileRename:n.setFileRename},S=s.connect(f,m)(a.BrowseController),E=(function(e){function t(t){var r=e.call(this,t)||this;_.log_js_modules_application_code_start(),r.reduxStore=u.getStoreForBrowse();var o=h.Viewer.get_viewer(),s=o.get_user_by_id(t["user-id"]);return p.getBrowseStore(),i.browseActions.appInit({experiments:t["exp-browse-experiments"]||{},shouldShowDeletedFiles:!!t["should-show-deleted-files"],user:s,viewer:o}),r}return r.__extends(t,e),t.prototype.render=function(){return o.createElement(s.Provider,{store:this.reduxStore},o.createElement(S,r.__assign({},this.props)))},t})(o.PureComponent);t.BrowseApp=E}),define("modules/clean/react/browse/browse_prefetch_loader",["require","exports","tslib","modules/core/exception","modules/clean/react/files_view/types","modules/clean/react/browse/models","modules/clean/pagination_manager","modules/core/notify","modules/clean/web_timing_logger"],function(e,t,r,o,s,i,a,n,l){"use strict";function c(e){if(0===e.indexOf("err:")){var t=e.substr("err:".length);n.Notify.error(t)}}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),l=r.__importStar(l);var d=(function(){function e(e,t,r,n){var d=e.user,u=e.path,p=e.fqPathsToSelect,h=t.onPrefetchComplete,_=t.onPrefetchError,f=t.onLoadComplete,m=t.onPostTTIPrefetchComplete,S=t.onPostTTIPrefetchError,E=r.onInitializeEverything,T=r.onLoad,g=r.onAddFilesAndSetLoadingState;void 0===n&&(n=window);var F=this;this.isPrefetching=function(){return!!F.browsePreloadHandler&&!!F.firstPagePreloadHandler},this.handlePrefetch=function(){o.assert(F.isPrefetching(),"trying to handle prefetching and think we aren't prefetching at the same time.  something is wrong"),F.browsePreloadHandler(F.handlePrefetchDataSuccess,F.onPrefetchError),l.waitForTTI().then(function(){F.postTTIPreloadHandler(F.handlePostTTIDataSuccess,F.onPostTTIPrefetchError)})},this.handlePostTTIDataSuccess=function(e){var t=void 0;try{t=JSON.parse(e)}catch(e){return void F.onPostTTIPrefetchError(e)}if(!t)return void F.onPostTTIPrefetchError();F.onPostTTIPrefetchComplete(t)},this.handlePrefetchDataSuccess=function(e){var t=F.extractAjaxInitData(e);if(!t)return void F.onPrefetchError();var r,o,a=[],n=0,l=s.LoadingState.LOADING_FIRST_PAGE,c=F.firstPagePreloadHandler.getDataIfAvailable();if(c){if(!c.payload||c.error)return void F.onPrefetchError();var d=F.extractAjaxFileInfo(c.payload);if(!d)return void F.onPrefetchError();r=d.file_info,o=d.first_page,o?(a=[],n=o.total_num_items,l=s.LoadingState.LOADING_REMAINING_PAGES):r&&(a=r,n=a.length,l=s.LoadingState.LOADED)}var u=i.BrowseContext.fromServerObject(t);F.onInitializeEverything({path:F.path,files:a,paginatedTotalNumFiles:n,context:u,mountPoints:t.ns_id_to_mount_point,fqPathsToSelect:F.fqPathsToSelect,loadingState:l,teamFolders:t.team_folders_js_info}),r||o?(o?F.initializePaginationManager(o):F.onLoadComplete(),F.onPrefetchComplete(t)):F.firstPagePreloadHandler(function(e){F.handleFirstPagePrefetchDataSuccess(e,t,u)},F.onPrefetchError)},this.handleFirstPagePrefetchDataSuccess=function(e,t,r){var o=F.extractAjaxFileInfo(e);if(!o)return void F.onPrefetchError();o.paginated?F.initializePaginationManager(o.first_page):(F.onLoad({path:F.path,files:o.file_info,paginatedTotalNumFiles:o.file_info.length,context:r}),F.onLoadComplete()),F.onPrefetchComplete(t)},this.extractAjaxInitData=function(e){var t=void 0;try{t=JSON.parse(e)}catch(t){c(e)}return t},this.extractAjaxFileInfo=function(e){var t=void 0;try{t=JSON.parse(e)}catch(t){c(e)}return t},this.initializePaginationManager=function(e){var t=e.total_num_items,r=a.PaginationManager.create({firstPage:e,keyName:"sjid",ajaxURL:"/browse_get_next",userID:F.user.id,newDataAvailableCallback:function(e,r){var o=e.areAllItemsReady(),i=o?s.LoadingState.LOADED:s.LoadingState.LOADING_REMAINING_PAGES;F.onAddFilesAndSetLoadingState({path:F.path,files:r,paginatedTotalNumFiles:t,loadingState:i}),o&&(e.stopAutoFetching(),F.onLoadComplete())}});l.waitForTTI().then(function(){return r.startAutoFetching()})},this.user=d,this.path=u,this.fqPathsToSelect=p,this.onPrefetchComplete=h,this.onPrefetchError=_,this.onLoadComplete=f,this.onPostTTIPrefetchComplete=m,this.onPostTTIPrefetchError=S,this.onInitializeEverything=E,this.onLoad=T,this.onAddFilesAndSetLoadingState=g,this.browsePreloadHandler=n.__REGISTER_BROWSE_PRELOAD_HANDLER,this.firstPagePreloadHandler=n.__REGISTER_BROWSE_FIRST_PAGE_PRELOAD_HANDLER,this.postTTIPreloadHandler=n.__REGISTER_BROWSE_POST_TTI_PRELOAD_HANDLER}return e})();t.BrowsePrefetchLoader=d}),define("modules/clean/react/browse/browse_view",["require","exports","tslib","external/immutable","external/react","modules/clean/browse_uri_interface","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/browse/action_logger","modules/clean/react/browse/constants","modules/clean/react/browse/logger_util","modules/clean/react/browse/models","modules/clean/react/browse/sidebar","modules/clean/react/browse/title","modules/clean/react/browse/web_team_sharing_experiment","modules/clean/react/file_uploader/file_uploader","modules/clean/react/files_view/constants","modules/clean/react/files_view/controller","modules/clean/react/files_view/types","modules/clean/react/maestro/layout","modules/clean/react/search_success_banner/constants","modules/clean/react/search_success_banner/search_success_banner","modules/clean/react/search_success_banner/util","modules/clean/search/search_bar/experiments","modules/clean/search/search_bar/log_helper","modules/clean/search/search_results/controller","modules/clean/search/search_results/log_helper","modules/clean/sharing/access_level","modules/clean/sharing/browse_exports","modules/clean/user_education/user_education_client","modules/clean/web_timing_logger","modules/core/browser","modules/clean/react/async/loadable","modules/clean/web_user_action_events"],function(e,t,r,o,s,i,a,n,l,c,d,u,p,h,_,f,m,S,E,T,g,F,w,y,v,A,R,b,I,P,C,D,O,N){"use strict";var L=this;Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),a=r.__importStar(a),l=r.__importStar(l),d=r.__importStar(d),D=r.__importStar(D);var x=[b.NameSpaceAccess.ACCESS_NO_ACCESS,b.NameSpaceAccess.ACCESS_READER,b.NameSpaceAccess.ACCESS_READER_NO_COMMENT],M=(function(t){function b(i){var h=t.call(this,i)||this;return h.onSearchBarAbandonedEvent=function(e){var t=e.detail.searchBarState;h.setState({searchBarAbandoned:t.abandoned})},h.handleGetOverflowMenuActions=function(e,t,r){var s=h.handleGetFileActionsForSetOfFiles(o.Set([e]),t,r,!1),i=new Array;return s.forEach(function(e){"function"!=typeof e&&i.push(e)}),[i]},h.handleGetFileActionsForSetOfFiles=function(t,r,o,s,i){if(h.props.arePostTTIModulesLoaded){var a=h.props,n=a.context,l=a.user,c=a.actionHandlers,d=a.isSearchMode,u=a.isOverFreeQuota,p=a.isQueryingFolderSizes,_=a.browsePostTTIExperiments,f=a.viewType,m=e("modules/clean/react/browse/file_actions"),S=_.expShowAddToShowcase,E=_.expShowAddFolderToShowcase,T=_.expShowcaseFileActions,g=_.expBrowseMoveSuggestions,F=_.expEsignatureEnabled,w=_.expHasCreatedShowcase,y=_.expHasShowcaseFreemium,v=_.expNewBrowseMoveDialog,A=_.expShowShowcaseInterstitial,R="ON"===g,b=h.state.fileIdToActionCategories;return m.getActionsForFileCollection({files:t,context:n,user:l,viewType:f,fileIdToActionCategories:b,canDisplayFolderSizes:r,actionHandlers:c,skipSharing:!1,isSearchMode:d,isOverFreeQuota:u,isQueryingFolderSizes:p,canShowUJPopup:s,showAddToShowcase:!!S,showAddFolderToShowcase:!!E,showAddToShowcaseUpsell:!!T,hasCreatedShowcase:!!w,hasShowcaseFreemium:!!y,isSidebar:i,showShowcaseInterstitialExp:!!A,responsive:o,showNewMoveDialog:!!v,showFolderSuggestion:R,showPrepareForSignature:!!F})}return[]},h.handleLocationLinkClick=function(e,t){if(!t){var r=a.parent_dir(e.fq_path);h.props.onNavigateToPath(r)}},h.handleOpenPaper=function(e){var t=h.props,r=t.user,o=t.isSearchMode,s=t.viewType;o&&R.recordSearchResultsAction({result:e,user:r,action_type:N.WebUserActionLogEvent.PAPER_OPEN,view_type:s}),D.redirect(e.url)},h.handleUploadButtonClick=function(e){f.FileUploaderController.setPath(h.props.path),f.FileUploaderController.handleUploadButtonClick(e)},h.handleShowFileUploader=function(){f.FileUploaderController.setPath(h.props.path),f.FileUploaderController.showModal()},h.handleSelectionChange=function(e){var t=h.props.getFileByFullPath(e.selected.first());if(t){var r=t.ns_id,o=t.sjid,s=t.file_id,i=t.fq_path,n=t.bytes,c=t.ext,d=t.request_id;l.logSelectRow({uid:h.props.user.id,entity_type:t.is_dir?"folder":"file",view_type:h.props.viewType,file_nsid:r,file_sjid:o,file_id:s,file_name:a.filename(t.fq_path),file_path:i,file_size:n,file_extension:c,request_id:d})}h.props.onSelectionChange({selection:e})},h.handleFileListSortChange=function(e,t){l.logSortRecords({uid:h.props.user.id,sort_by:e,sort_direction:t,view_type:h.props.viewType}),h.props.onSortFiles({sortField:e,sortDirection:t})},h.handleStarClick=function(e,t){var r=t?N.WebUserActionLogEvent.STAR:N.WebUserActionLogEvent.REMOVE_STAR,o=h.props,s=o.user,i=o.isSearchMode,a=o.viewType,n=o.selectedFiles,c=d.countFilesAndFolders(n),u=c.num_files_selected,p=c.num_folders_selected;i&&R.recordSearchResultsAction({result:e,user:s,action_type:r,view_type:a}),l.logBrowseAction(s.id,"BROWSE",r,u,p,a,e)},h.handleSearchFromSearchBar=function(e){var t=e.query,r=e.searchPath,o=e.qargs;t?h.props.onSearch(t,r,!0,o):h.props.onSetUrl({path:r})},h.handleSearchResultOpen=function(e){e instanceof u.File?e.is_unmounted?I.asyncShowSharedContentLinkSyncModal(h.props.user,e):(v.logDropdownSearchAction({result:e,user:h.props.user,action_type:e.is_dir?N.WebUserActionLogEvent.FOLDER_OPEN:N.WebUserActionLogEvent.FILE_VIEW,viewport:"dropdown-view"}),h.props.onSearchBarResultOpen(e)):(e instanceof u.Paper||e instanceof u.PaperFolder)&&(v.logDropdownSearchAction({result:e,user:h.props.user,action_type:N.WebUserActionLogEvent.PAPER_OPEN,viewport:"dropdown-view"}),D.open_tab(e.url))},h.handleResultObjectPathClick=function(e){v.logDropdownSearchAction({result:e,user:h.props.user,action_type:N.WebUserActionLogEvent.CLICK_PATH_LINK,viewport:"dropdown-view"}),h.props.onSearchBarPathClicked(e)},h.setFilesViewControllerRef=function(e){h.filesViewControllerRef=e},h.handleSearchFromSearchResults=function(e,t,r){h.props.onSearch(e,t,!1,r)},h.handleFocusSearchBar=function(){return document.getElementsByClassName("search-bar__text-input")[0].focus()},h.renderSharedWithController=function(t){var r=h.props,o=r.context;if(!r.arePostTTIModulesLoaded)return null;if(t.type===n.FileTypes.TEAM_SHARED_FOLDER&&("archived"===t.team_folder_status||"archive_in_progress"===t.team_folder_status))return null;var i=h.props.selectedFiles,a=!!i.size,l=e("modules/clean/react/browse/shared_with").SharedWithController;return s.createElement("div",{className:"brws-vertically-center brws-shared-with-wrapper"},s.createElement(l,{file:t,browseContext:o,inSelectMode:a}))},h.renderAppContent=function(e){return h.props.isSearchMode?h.renderSearchResults(e):h.renderFilesViewController(e)},h.getPageHeaderHeight=function(e){return e.isMatchedLarge||e.isMatchedMedium?c.DEFAULT_PAGE_HEADER_HEIGHT:c.COMPACT_PAGE_HEADER_HEIGHT},h.renderSidebar=function(e){var t=h.props,o=t.fileCategories,i=t.isNautilusEnabled,a=t.isPaperEnabled;return s.createElement(p.BrowseSidebar,r.__assign({},h.props,{onSearch:h.handleSearchFromSearchResults,onUploadButtonClick:h.handleUploadButtonClick,onGetFileActionsForFiles:h.handleGetFileActionsForSetOfFiles,responsive:e,fileCategories:o,isNautilusEnabled:i,isPaperEnabled:a}))},h.hideTimeline=function(){h.props.onHideTimeline()},h.state={searchBarProps:h.getCurrentSearchBarProps(h.props),fileIdToActionCategories:{},searchBarAbandoned:!1},window.addEventListener(g.SEARCH_BAR_ABANDONED_EVENT,h.onSearchBarAbandonedEvent),h}return r.__extends(b,t),b.prototype.componentWillReceiveProps=function(e){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(t){switch(t.label){case 0:return e.isSearchMode===this.props.isSearchMode&&e.path===this.props.path||this.setState({searchBarProps:this.getCurrentSearchBarProps(e)}),this.props.files===e.files?[3,2]:[4,this.getAppActions(e.files,e.path)];case 1:t.sent(),t.label=2;case 2:return[2]}})})},b.prototype.componentDidMount=function(){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(t){switch(t.label){case 0:return[4,C.waitForTTI()];case 1:return t.sent(),this.defineFileUploader(),this.maybeOpenUploaderOnMount(),new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){e.OverquotaHelper.maybeShowSubgrowthProOQRecurringModal("wb_oq_ups_recur_fb")}),P.UEClient.sendEvent("BrowseView","componentDidMount",this.props.context.toJSON()),[4,this.getAppActions(this.props.files,this.props.path)];case 2:return t.sent(),[2]}})})},b.prototype.componentDidUpdate=function(){this.props.loadingState===E.LoadingState.LOADED&&P.UEClient.sendEvent("BrowseView","componentDidUpdate",this.props.context.toJSON())},b.prototype.componentWillUnmount=function(){window.removeEventListener(g.SEARCH_BAR_ABANDONED_EVENT,this.onSearchBarAbandonedEvent)},b.prototype.maybeOpenUploaderOnMount=function(){this.props.shouldOpenUploadModal&&this.handleShowFileUploader()},b.prototype.getCurrentDropTargetHighlightMode=function(){var e=this.props,t=e.selectedFiles,r=e.context;return r.isInsideSharedFolder&&x.includes(r.currentSharedFolderPermissionRole)?E.DropTargetHighlightMode.NONE:this.props.isDraggingInternalFiles?t.some(function(e){return e.isDeleted||e.type===n.FileTypes.TEAM_SHARED_FOLDER})?E.DropTargetHighlightMode.NONE:t.some(function(e){return e.type===n.FileTypes.SHARED_FOLDER})?r.currentNSAllowsNesting?E.DropTargetHighlightMode.NONSELECTED_FOLDERS:E.DropTargetHighlightMode.NONSELECTED_NONSHARED_FOLDERS:E.DropTargetHighlightMode.NONSELECTED_FOLDERS:this.props.isDraggingExternalFiles&&!this.props.isUploadModalOpen?E.DropTargetHighlightMode.ALL_FOLDERS:E.DropTargetHighlightMode.NONE},b.prototype.getCurrentSearchBarProps=function(e){return{showSearchBar:!0,currentPath:e.path,onSearch:this.handleSearchFromSearchBar,onSearchResultOpen:this.handleSearchResultOpen,onResultObjectPathClick:this.handleResultObjectPathClick,isSearchBarExpanded:e.isSearchMode,searchBarExperiments:e.searchBarExperiments,onSearchFiltersChanged:e.onSearchFiltersChanged,searchFrom:e.searchFrom}},b.prototype.getFilesViewControllerRef=function(){return this.filesViewControllerRef},b.prototype.renderSearchSuccessBanner=function(){var e=this.props.searchBarExperiments,t=e.expSearchSuccessBanner,r=this.state.searchBarAbandoned||w.shouldShowSearchSuccessBanner();return t&&!w.isFilePreview()&&!w.userIsOptedOutOfSearchSuccessBanner()&&r?s.createElement(F.SearchSuccessBanner,{user:this.props.user,displayContext:g.SearchSuccessDisplayContext.IN_EMBEDDED_APP}):null},b.prototype.getAppActions=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var o,s,i=this;return r.__generator(this,function(a){switch(a.label){case 0:return[4,C.waitForTTI()];case 1:return a.sent(),o=[],e.toArray().forEach(function(e){e&&e instanceof u.File&&!e.isDeleted&&o.push(e)}),[4,this.props.appActionsStore.getActionsForFileBatch(o,this.props.user.id)];case 2:return s=a.sent(),this.setState(function(e){return i.props.path===t?{fileIdToActionCategories:r.__assign({},e.fileIdToActionCategories,s)}:e}),[2]}})})},b.prototype.renderSearchResults=function(e){var t=this.props,r=t.actionHandlers,o=t.filesViewActionHandlers,a=t.fileRename,n=t.path,l=t.user,c=t.handleComponentTTI,d=t.isFileViewerShown,u=t.arePostTTIModulesLoaded,p=t.getIsFileJumping,h=t.ensureFileViewerClosedIfNotPreviewing,_=t.browseExperiments,m=t.searchResultsExperiments,S=t.searchBarExperiments,E=t.onNavigateToParentFolder,T=t.onNavigateToPath,g=t.shouldShowDeletedFiles,F=t.onNavigateToFileOrFolder,w=t.onSearchFiltersChanged,v=t.starredState,R=t.fileCategories,b=t.isPaperEnabled,I=t.viewType;return s.createElement("div",null,this.renderSearchSuccessBanner(),s.createElement(A.SearchResultsController,{actionHandlers:r,filesViewActionHandlers:o,path:n,user:l,searchResultsExperiments:m,searchBarExperiments:S,browseExperiments:_,onSearch:this.handleSearchFromSearchResults,setFileUploaderPath:f.FileUploaderController.setPathAndPermissions,maestroSearchBarProps:this.state.searchBarProps,handleComponentTTI:c,ensureFileViewerClosedIfNotPreviewing:h,getIsFileJumping:p,renderSharedWithController:this.renderSharedWithController,hrefForFile:i.href_for_file,isFileViewerShown:d,fileRename:a,arePostTTIModulesLoaded:u,getOverflowMenuActions:this.handleGetOverflowMenuActions,onFocusSearchBar:this.handleFocusSearchBar,onNavigateToFileOrFolder:F,onNavigateToParentFolder:E,onNavigateToPath:T,onOpenPaper:this.handleOpenPaper,shouldShowDeletedFiles:y.isInDeletedFilterRightRailExperiment(S)?g:void 0,responsive:e,onSearchFiltersChanged:w,starredState:v,viewType:I,
fileCategories:R,isPaperEnabled:b,pageHeaderHeight:this.getPageHeaderHeight(e)}))},b.prototype.renderFilesViewController=function(e){var t=this.props.shouldShowPinnedTeamFolders,o=t?this.props.filesWithoutTeamFolders:this.props.files;return s.createElement("div",{className:"maestro-browse-app-content"},this.renderSearchSuccessBanner(),s.createElement(_.WebTeamSharingModalExperiment,{context:this.props.context,user:this.props.user,path:this.props.path,selectedFiles:this.props.selectedFiles,browsePostTTIExperiments:this.props.browsePostTTIExperiments}),s.createElement(S.FilesViewController,r.__assign({},this.props.filesViewActionHandlers,{disabledMultiselect:this.props.isTimelineVisible,getOverflowMenuActions:this.handleGetOverflowMenuActions,renderSharedWithController:this.renderSharedWithController,hrefForFile:i.href_for_file,onLocationLinkClick:this.handleLocationLinkClick,onNavigateToFileOrFolder:this.props.onNavigateToFileOrFolder,onNavigateToParentFolder:this.props.onNavigateToParentFolder,onOpenPaper:this.handleOpenPaper,onFocusSearchBar:this.handleFocusSearchBar,context:this.props.context,createNewFolderState:this.props.createNewFolderState,currentSort:this.props.currentSort,dropTargetHighlightMode:this.getCurrentDropTargetHighlightMode(),fileRename:this.props.fileRename,items:o,responsive:e,getIsFileJumping:this.props.getIsFileJumping,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isFileViewerShown:this.props.isFileViewerShown,isOverFreeQuota:this.props.isOverFreeQuota,shouldShowPinnedTeamFolders:t,arePostTTIModulesLoaded:this.props.arePostTTIModulesLoaded,fileIdToActionCategories:this.state.fileIdToActionCategories,isTextSelectable:this.props.isTextSelectable,loadingState:this.props.loadingState,onComponentTTI:this.props.handleComponentTTI,onSelectionChange:this.handleSelectionChange,onSortChange:this.handleFileListSortChange,onStarClick:this.handleStarClick,path:this.props.path,ref:this.setFilesViewControllerRef,selectedFiles:this.props.selectedFiles,selection:this.props.selection,setFileUploaderPath:f.FileUploaderController.setPathAndPermissions,showFileUploaderModal:this.handleShowFileUploader,teamFolders:this.props.teamFolders,totalNumFiles:this.props.totalNumItems,user:this.props.user,viewType:this.props.viewType,isQueryingFolderSizes:this.props.isQueryingFolderSizes,columns:this.props.columns,viewTypeColumns:this.props.viewTypeColumns,viewTypes:m.AllViewTypes,viewTypeLabels:m.ViewTypeLabels,starredState:this.props.starredState,pageHeaderHeight:this.getPageHeaderHeight(e)})))},b.prototype.defineFileUploader=function(){f.FileUploaderController.loadCoreComponent()},b.prototype.render=function(){var e=this.props,t=e.user,r=e.path,o=e.isDraggingExternalFiles,i=e.isDraggingInternalFiles,a=e.isUploadModalOpen,n=e.isSearchMode,l=e.context,c=e.isTimelineVisible,d=e.onSetUrl;return s.createElement("div",null,s.createElement(B,{user:t,browseContext:l,hideTimeline:this.hideTimeline,isTimelineVisible:c}),s.createElement(T.MaestroChrome,{user:t,titleRegion:s.createElement(h.BrowseTitle,{path:r,user:t,isDraggingExternalFiles:o,isDraggingInternalFiles:i,isUploadModalOpen:a,isSearchMode:n,onSetUrl:d}),titleClass:"page-header__title-overflow",embeddedAppRegion:this.renderAppContent,actionSidebarRegion:this.renderSidebar,searchBarProps:this.state.searchBarProps}))},b.defaultProps={selectedFiles:o.OrderedMap(),viewType:E.ViewType.List},b})(s.PureComponent);t.BrowseView=M;var B=O.Loadable({loader:function(){return r.__awaiter(L,void 0,void 0,function(){var t;return r.__generator(this,function(o){switch(o.label){case 0:return[4,C.waitForTTI()];case 1:return o.sent(),[4,new Promise(function(t,r){e(["modules/clean/react/timeline/timeline"],t,r)}).then(r.__importStar)];case 2:return t=o.sent().Timeline,[2,t]}})})}})}),define("modules/clean/react/browse/controller",["require","exports","tslib","external/lodash","external/react","external/react-dom","modules/clean/analytics","modules/clean/browse/browse_bolt_client","modules/clean/em_string","modules/clean/filepath","modules/clean/filepath","modules/clean/filetypes","modules/clean/history","modules/clean/pagelet_logger","modules/clean/react/app_actions/app_actions_store","modules/clean/react/async_overquota_modal_controller","modules/clean/react/browse/action_logger","modules/clean/react/browse/actions","modules/clean/react/browse/api","modules/clean/react/browse/browse_prefetch_loader","modules/clean/react/browse/browse_view","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/nav_actions","modules/clean/react/browse/professional_collection_actions","modules/clean/react/browse/store","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/file_uploader","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/utils","modules/clean/react/file_viewer/async_controller","modules/clean/react/fileops_actions","modules/clean/react/files_view/types","modules/clean/react/search_success_banner/util","modules/clean/react/snackbar","modules/clean/search/logger","modules/clean/search/search_bar/chips","modules/clean/search/search_bar/experiments","modules/clean/search/search_helpers","modules/clean/search/search_results/actions","modules/clean/search/search_results/log_helper","modules/clean/search/search_results/store","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/sharing/ui_notifications_util","modules/clean/storage","modules/clean/upsell/prompt_event_emitter","modules/clean/user_education/user_education_client","modules/clean/web_timing_logger","modules/clean/web_user_action_events","modules/constants/python","modules/core/browser","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,r,o,s,i,a,n,l,c,d,u,p,h,_,f,m,S,E,T,g,F,w,y,v,A,R,b,I,P,C,D,O,N,L,x,M,B,U,q,k,V,W,H,G,z,j,Q,J,K,Y,Z,X,$,ee,te,re){"use strict";function oe(e){te.Notify.success(ee._("%(file_name)s added to your Dropbox.").format({file_name:d.filename(e)}))}function se(e){var t=ee._('Added “%(folder_name)s” <a href="%(href)s">Learn More</a>').format({folder_name:l.Emstring.em_snippet(d.filename(e),H.SNIPPET_SIZES.FILENAME),href:"/help/business/team-space-overview#acceptfolder"});te.Notify.success(new $.HTML(t))}function ie(e){var t=d.parent_dir(e);"/"!==t&&te.Notify.success(ee._("Folder is in %(path)s").format({path:l.Emstring.em_snippet(t,22)}))}function ae(e){var t=ne();p.default.replace_state(e,o.pick.apply(o,[t,F.BrowseQueryArg.d,F.BrowseQueryArg.select,F.BrowseQueryArg.preview,F.BrowseQueryArg.activity,F.BrowseQueryArg.preselected_for_showcase].concat(F.FRAMEWORK_ARGS)))}function ne(){var e=p.default.deconstruct_url().qargs;return{d:e[F.BrowseQueryArg.d],select:e[F.BrowseQueryArg.select],path:e[F.BrowseQueryArg.path],last_fq_path:e[F.BrowseQueryArg.last_fq_path],query:e[F.BrowseQueryArg.query],query_unnormalized:e[F.BrowseQueryArg.query_unnormalized],preview:e[F.BrowseQueryArg.preview],search_session_id:e[F.BrowseQueryArg.search_session_id],country_override:e[F.BrowseQueryArg.country_override],cProfile:e[F.BrowseQueryArg.cProfile],public_mode_override:e[F.BrowseQueryArg.public_mode_override],stormcrow_override:e[F.BrowseQueryArg.stormcrow_override],stormcrow_override_data_field:e[F.BrowseQueryArg.stormcrow_override_data_field],stormcrow_override_population:e[F.BrowseQueryArg.stormcrow_override_population],stormcrow_override_ttl:e[F.BrowseQueryArg.stormcrow_override_ttl],stormcrow_panel:e[F.BrowseQueryArg.stormcrow_panel],uncompressed_js:e[F.BrowseQueryArg.uncompressed_js],use_packages:e[F.BrowseQueryArg.use_packages],file_categories:e[F.BrowseQueryArg.file_categories],preselected_for_showcase:e[F.BrowseQueryArg.preselected_for_showcase],activity:e[F.BrowseQueryArg.activity],search_from:e[F.BrowseQueryArg.search_from]}}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),i=r.__importStar(i),c=r.__importStar(c),p=r.__importDefault(p),f=r.__importStar(f),m=r.__importStar(m),E=r.__importStar(E),P=r.__importStar(P),D=r.__importStar(D),x=r.__importStar(x),U=r.__importStar(U),J=r.__importStar(J),Z=r.__importStar(Z);var le;(function(e){e[e.BROWSE=0]="BROWSE",e[e.SEARCH=1]="SEARCH"})(le||(le={}));var ce=(function(t){function l(s){var n=t.call(this,s)||this;n.logOnceFetchedDataRequiredForTTI=o.once(function(){return J.log_js_modules_fetched_data_required_for_tti()}),n.previousHistoryCallbackMode=le.BROWSE,n.handlePreviewAndShareModalsOnLoad=function(t){var o=n.getPathFromProps(),s=n.props.user,i=!!n.props["open-preview"],a=!!n.props["show-share-modal"],l=n.props["share-prefill-email"];if(i&&!t){te.Notify.error(ee._("The file doesn’t exist"));var c=n.props.urlPrefix,d=n.getUrlForFQPath(c,o),u=ne();delete u.preview,p.default.replace_state(d,u)}if(t){var h=w.File.fromServerObject(t);C.asyncOpenPreview({containerId:F.BROWSE_FILE_VIEWER_ELEMENT_ID,files:[h],fileViewAction:Y.FileViewActionType.CLICK,fileViewOrigin:Y.FileViewOriginType.BROWSE,fileViewTarget:Y.FileViewTargetType.PRIVATE,indexOfPreviewFile:0,user:s,updateBrowserLocation:!1,onFileViewerDidMount:C.hideElementsBehindFileViewer,filePreviewDataFetcher:function(e){return E.fetchPreviewData(e,s)},onFileViewerUnmount:function(){C.showElementsBehindFileViewer();var e=n.browseViewRef;(e=e.getFilesViewControllerRef())&&(e=e.getFilesViewTileGridRef())&&(e=e.getTileGridRef())&&e.getAndUpdateTileLayout(),n.restoreUrlAfterFileViewClose()}}),a&&J.waitForTTI().then(function(){n.mounted&&W.asyncShowPrefilledShareModal({user:s,sharePrefillEmail:l,content:h,setPath:y.browseNavActions.setPath,setUrl:y.browseNavActions.setUrl})})}else a&&J.waitForTTI().then(function(){if(n.mounted){var e=n.props["ns-id"],t=n.props["ns-path"];W.asyncShowPrefilledShareModal({user:s,sharePrefillEmail:l,content:{fqPath:o,isFolder:!0,nsId:e&&t?e:null,targetNsId:e&&!t?e:null},setPath:y.browseNavActions.setPath,setUrl:y.browseNavActions.setUrl})}});a||n.props["showing-mobile-billing-modal"]||n.props["showing-client-modal"]||J.waitForTTI().then(function(){j.promptBufferedEventEmitter.on(j.Events.ON_PROMPT_INITIALIZED,function(t){return r.__awaiter(n,void 0,void 0,function(){var o,s,i,a;return r.__generator(this,function(n){switch(n.label){case 0:return t&&(t.didMainCampaignLoad()||t.didCampaignForUserEducationLoad())?[2]:[4,new Promise(function(t,r){e(["modules/clean/react/ncct/post_tti_ncct_modal"],t,r)}).then(r.__importStar)];case 1:return o=n.sent().postTTINCCTReminderModal,[4,o()];case 2:return(s=n.sent())?[2]:(i="V2"===this.props.browsePostTTIExperiments.expSubgrowthBizTeamsTriggersClientLinkWork,i&&this.props.user.is_team?[4,new Promise(function(t,r){e(["modules/clean/growth/experiments/open_in_desktop_modal"],t,r)}).then(r.__importStar)]:[3,4]);case 3:a=n.sent().openInDesktopModalExperiment,a(this.props.user,this.browseContext),n.label=4;case 4:return[2]}})})})})},n.receiveStateFromStores=function(){n.setState(n.getStateFromStores())},n.handleComponentTTI=function(e){n.browseLogger&&(n.browseLogger.componentReady(e),n.browseLogger.ttiLogged&&n.ajaxRequestWebTimer&&(n.ajaxRequestWebTimer.markTimeToInteractive(),delete n.ajaxRequestWebTimer))},n.onAllUploadsComplete=function(e){var t=e.detail.files,r=t.map(function(e){return c.normalize(e.path)+c.normalize(e.name)});S.browseActions.selectFilesAfterUpload({fqPathsToSelect:r})},n.getIsFileJumping=function(){return n.props.isFileJumping},n.getFileByFullPath=function(e){return n.props.files.find(function(t){return t.fq_path===e})||null},n.getFileByFilename=function(e){return n.props.files.find(function(t){return c.filename(t.fq_path)===e})||null},n.setBrowseViewRef=function(e){n.browseViewRef=e},n.startBoltLiveUpdate=function(){n.browseBoltClient.startLiveUpdate(function(){n.getChangesRequest&&n.getChangesRequest.abort();var e=n.props,t=e.user,r=e.path,o=e.shouldShowDeletedFiles;n.getChangesRequest=E.getChangesForDirectory({path:r,userId:t.id,namespaceToJournalIdMap:n.browseBoltClient.getNsMap(),includeDeletedFiles:o,onSuccess:function(e){delete n.getChangesRequest,S.browseActions.computeAndApplyDeltasFromBoltClient({payload:e,path:r}),n.browseBoltClient.handleUpdateBoltClient(e.bolt_data)}})})},n.toggleTimelineIfNecessary=function(){var e=ne().activity;e&&!n.props.isTimelineVisible&&S.browseActions.showTimeline(),!e&&n.props.isTimelineVisible&&S.browseActions.hideTimeline()},n.handleFileLocationChange=function(e,t){e="/"+re.URI.decode(e),n.ensureFileViewerIsOpenedOrClosedIfNeeded(t),n.toggleTimelineIfNecessary(),n.previousHistoryCallbackMode===le.BROWSE&&c.paths_are_equal(n.props.path,e)||(n.previousHistoryCallbackMode=le.BROWSE,n.navigateToPath({path:e}))},n.getPathFromProps=function(){return n.props["init-fq-path"]||"/"},n._handleSearchLocationChange=function(e,t){if(t){var r=n.searchBarExperiments,o=t.query||t.query_unnormalized||"";e=t.path||t.last_fq_path||"/";var s=t.search_session_id||"",i=t.file_categories||"",a=void 0,l=void 0;if(B.isInDeletedFilterRightRailExperiment(r)&&(a="1"===t.d,setTimeout(function(){S.browseActions.setShouldShowDeletedFiles({shouldShowDeletedFiles:a,shouldUpdateUrl:!1,shouldReloadFolder:!1}),a&&S.browseActions.setViewType({viewType:O.ViewType.List})},0)),o&&(!c.paths_are_equal(e,n.props.path)||o!==n.state.latestQuery||B.isInDeletedFilterRightRailExperiment(r)&&a!==n.props.shouldShowDeletedFiles||U.isInFileTypeFilterExperiment(r)&&i!==U.fileCategoriesToString(n.state.latestFileCategories))){var d=n.props.user;setTimeout(function(){y.browseNavActions.clear({path:e,context:new w.BrowseContext})}),n.previousHistoryCallbackMode=le.SEARCH,c.paths_are_equal(n.props.path,e)||S.browseActions.setPath({path:e}),n.props.setBrowseScope({browseScope:e}),U.isInFileTypeFilterExperiment(r)&&(l=U.fileCategoriesFromString(i),i!==U.fileCategoriesToString(n.state.latestFileCategories)&&n.props.setFileCategories({fileCategories:l})),n.props.setSearchQuery({query:o,searchSessionId:s,searchPath:e});var u=n.searchResultsExperiments,p=u.expShowSymlinkIcon,h=u.expDeletedFileInCerebro;q.searchResultsActions.runSearch({user:d,path:e,query:o,searchSessionId:s,showSymlinkIcon:!!p,webTimer:n.ajaxRequestWebTimer,logOnceFetchedDataRequiredForTTI:n.logOnceFetchedDataRequiredForTTI,deletedFiles:a,expSinglePageSearch:n.isInSinglePageSearchExperiment,fileCategories:l,deletedFileInCerebro:!!h,isPaperEnabled:!!n.props["paper-enabled-for-user"]})}}},n.handleSearchExit=function(){n.props.clearSearchBar(),q.searchResultsActions.clearSearch(),n.searchBarExperiments.expSearchSuccessBanner&&!N.getClickedOnSearchResultsPageItem()&&N.setSearchSuccessBannerVisible(),n.isInSinglePageSearchExperiment&&!n.props.isSearchBarFocused&&n.props.blurSearchBar()},n.markTTVIfNeeded=function(){if(!n.hasTTVBeenLogged&&n.mounted&&(n.prefetchComplete||n.props["search-query"])){var e=window.ensemble;e&&e.markPageletRenderedByDOMNode(i.findDOMNode(n)),J.mark_time_to_view(),n.hasTTVBeenLogged=!0}},n.handleFileListUpdated=function(){n.fileViewerIsShown()?n.props.files.isEmpty()?S.browseActions.closeFileViewer():S.browseActions.updatePreview({files:n.props.files.toJS()}):n.ensureFileViewerIsOpenedOrClosedIfNeeded(ne()),n.prefetchPreviewData(n.props.files.toArray(),n.props.user)},n.handleOnNavigateToPath=function(e){n.blurSearchBarIfInSinglePageSearch(),S.browseActions.setUrl({path:e})},n.handleOnNavigateToParentFolder=function(){n.blurSearchBarIfInSinglePageSearch(),S.browseActions.navigateToParentFolder()},n.handleDelete=function(e){var t=e.some(w.File.isTeamSharedFolder),r=e.some(function(e){return e.read_only}),o=e.every(function(e){return e.isDeleted});!n.browseContext.isCurrentPathWriteable()||t||r?t?te.Notify.error(ee._("Team folders can’t be deleted.")):te.Notify.warning(ee._("You don’t have permission to delete files in this folder.")):o?S.browseActions.doPermanentDeleteWithModal({files:e}):S.browseActions.doDeleteFilesWithModal({files:e})},n.handleSearchBarResultOpen=function(e){S.browseActions.navigateToFileOrFolder({file:e,fileViewAction:Y.FileViewActionType.SEARCH})},n.handleSearchBarPathClicked=function(e){S.browseActions.navigateToResultObjectParentFolder({file:e,fileViewAction:Y.FileViewActionType.SEARCH})},n.handleOnNavigateToFileOrFolder=function(e,t){if(n.blurSearchBarIfInSinglePageSearch(),n.searchBarExperiments.expSearchSuccessBanner&&!N.userIsOptedOutOfSearchSuccessBanner()){var r=e.is_dir;if(n.state.isSearchMode)N.setClickedOnSearchResultsPageItem(),N.setSearchSuccessBannerVisible(),r&&N.setFolderSearchResultData(e.fq_path);else{N.doSearchBarInteractionBroadcast(!1);var o=e.fq_path,s=N.getSearchResultPath(),i=N.getSearchResultClickTimestamp();Date.now()-i<=3e4&&N.parentPathOfFileEqualsSearchResultPath(o,s,r)?N.setSearchSuccessBannerVisible():N.resetSearchSuccessBannerSettings()}}S.browseActions.hideTimeline(),n.ensureFullFileObjectPopulated(e,n.completeNavigateToFileOrFolder,t)},n.ensureFullFileObjectPopulated=function(e,t,r){n.state.isSearchMode?q.searchResultsActions.fetchCompleteSearchResultSRP({searchResult:e,user:n.props.user,onSuccess:t}):t(e,r)},n.completeNavigateToFileOrFolder=function(e,t){var r=n.props,o=r.user,s=r.viewer,i=r.viewType,l=n.state.isSearchMode,d=e.ns_id,p=e.sjid,h=e.file_id,_=e.fq_path,f=e.bytes,E=e.ext,T=e.request_id;if(m.logOpenRow({uid:o.id,entity_type:e.is_dir?"folder":"file",source:"list_browse",view_type:i,file_nsid:d,file_sjid:p,file_id:h,file_name:c.filename(e.fq_path),file_path:_,file_size:f,file_extension:E,request_id:T}),e.type===u.FileTypes.TEAM_SHARED_FOLDER&&(Q.UEClient.sendEvent("FileItemRow","TeamFolderClicked"),a.TeamsWebActionsLogger.log("clicked_team_folder_web",{team_id:s.team_id})),l){var g=K.WebUserActionLogEvent.FILE_VIEW;e.is_unmounted?g=K.WebUserActionLogEvent.UNMOUNTED_VIEW:e.is_dir&&(g=K.WebUserActionLogEvent.FOLDER_OPEN),k.recordSearchResultsAction({result:e,user:o,action_type:g,view_type:i})}l&&e.is_unmounted?W.asyncShowSharedContentLinkSyncModal(o,e):S.browseActions.navigateToFileOrFolder({file:e,onFileViewerUnmount:t,fileViewAction:l?Y.FileViewActionType.SEARCH:Y.FileViewActionType.CLICK})},n.actionHandlers={onDelete:n.handleDelete,onShowRename:function(e){return n.props.setFileRename({file:e,renameState:O.RenameState.PENDING_INPUT})},onRestore:function(e){var t=n.state.isOverFreeQuota;!n.props.user.is_team&&t?f.showOverquota("wb_oq_rstdel_f"):S.browseActions.doRestoreFilesWithUnifiedTrashModal({files:e})},onPermanentDelete:function(e){S.browseActions.doPermanentDeleteWithModal({files:e})},onShowComment:function(e){return n.onShowComment(e)},onPrepareForSignature:function(e){return n.onPrepareForSignature(e)}},n.getOnShowShareHandler=function(e,t){var r=n.props.browsePostTTIExperiments,o=r.expShowShowcaseInterstitial,s=r.expHasCreatedShowcase,i=r.expHasShowcaseFreemium;o?S.browseActions.handleShowShareInterstitialModal(e,t,!!s,!!i,n.props.viewType):S.browseActions.handleShowShareModal(e,t)},n.filesViewActionHandlers={onDelete:n.handleDelete,onShowRename:function(e){return n.props.setFileRename({file:e,renameState:O.RenameState.PENDING_INPUT})},onCopyToClipboard:function(e){return n.props.copyFilesToClipboard({files:e})},onPasteFromClipboard:function(){return n.props.pasteFilesFromClipboard({copyFiles:D.copyFiles})},onNewFolderSubmit:function(e){return S.browseActions.createFolder({pathName:n.browseContext.currentFQPath,folderName:e,nsId:n.browseContext.rootNSID,checkFSWs:!0})},onNewFolderCancel:function(){return S.browseActions.cancelCreateFolder()},onRenameSubmit:function(e,t){return n.props.renameFile({file:e,name:t,isSearchMode:n.state.isSearchMode})},onRenameCancel:function(e){return n.props.setFileRename({file:e,renameState:null})},onSwitchViewType:function(e){return S.browseActions.setViewType({viewType:e,isSearchMode:n.state.isSearchMode})},onColumnsChanged:function(e,t,r){return S.browseActions.setColumnConfiguration({columns:e,viewType:t,canDisplayFolderSizes:r})},onCanDisplayFolderSizesChanged:function(e){return S.browseActions.setColumnDependentCapabilities({canDisplayFolderSizes:e})},onAddFileJumpKeyCode:function(e){return S.browseActions.addFileJumpKeyCode({keyChar:e})},onResetFileJump:function(){return S.browseActions.resetFileJump()},onShowShare:n.getOnShowShareHandler},n.uploadAjaxInterceptor={interceptUploadPrecheck:function(e){return e},interceptUpload:function(e,t){var o=t.ns_id_for_routing,s=t.ns_id;if(!o||!s){var i=n.props.mountPoints,a=n.browseContext.rootNSID;X.assert(null!=i,"mountPoints is null"),X.assert(null!=a,"rootNSID is null"),o=P.getNsId(i,a,e.dest)}return r.__assign({},t,{ns_id_for_routing:o,ns_id:o})}},n.handleSearch=function(e,t,r,o){var s=U.buildSearchURL({user:n.props.user,searchPath:t,normalizedQuery:e,searchSessionId:r?n.props.searchSessionId:V.getSearchResultsStore().searchSessionId(),searchToken:U.getSearchCsrfToken(),qargs:o});n.ensureTimer("search_results"),n.isInSinglePageSearchExperiment&&(e.length>1||n.state.latestQuery)?p.default.replace_state(s.getPath(),s.getQuery()):p.default.push_state(s.getPath(),s.getQuery())},n.handleSearchFiltersChanged=function(e){var t=e.path,r=void 0===t?n.props.path:t,o=e.deletedFiles,s=e.fileCategories,i=void 0===s?n.state.latestFileCategories:s,a=n.state,l=a.searchSessionId,c=a.latestQuery,d=n.props.user;r&&r!==n.props.path&&x.logScopeChipChanged({searchSessionId:l,user:d,chipAdded:!M.isScopeChipRoot(r),filePath:r,viewport:"right-rail",searchType:"full_page"}),void 0!==o&&o!==n.props.shouldShowDeletedFiles&&x.logDeletedFilterChanged({searchSessionId:l,user:d,deletedFiles:o,viewport:"right-rail",searchType:"full_page"});var u={};if(void 0!==o&&(u.d=o?"1":"0"),void 0!==i&&!U.allCategoriesUnchecked(i)){var p=U.fileCategoriesToString(i);u.file_categories=p}n.handleSearch(c,r,!1,u)},n.fileViewerIsShown=function(){if(n.state.arePostTTIModulesLoaded){return e("modules/clean/react/file_viewer/controller").isShown()}return!1},n.ensureFileViewerClosedIfNotPreviewing=function(e){!e.preview&&n.fileViewerIsShown()&&S.browseActions.closeFileViewer()},n.prefetchPreviewData=function(t,r){if(n.state.arePostTTIModulesLoaded){e("modules/clean/react/file_viewer/controller").prewarmPreviewData(t,r)}},n.ensureFileViewerIsOpenedOrClosedIfNeeded=function(e){var t=n.fileViewerIsShown();if(e.preview&&!t){var r=n.getFileByFilename(e.preview);r&&S.browseActions.navigateToFileOrFolder({file:r})}else t&&!e.preview&&S.browseActions.closeFileViewer()},n.getLearnMoreLinkHandler=function(){window.open("/help/business/unsynced-team-folder","_blank")};var l=V.getSearchResultsStore();return n.props.setSearchBarExperiments({experiments:n.searchBarExperiments}),n.appActionsStore=_.getAppActionsStore(),l.add_change_listener(n.receiveStateFromStores),I.uploaderStore.add_change_listener(n.receiveStateFromStores),window.addEventListener(R.ALL_UPLOADS_COMPLETE_EVENT,n.onAllUploadsComplete),n.state=r.__assign({},n.getStateFromStores(),{arePostTTIModulesLoaded:!1,searchFrom:ne().search_from}),n}return r.__extends(l,t),Object.defineProperty(l.prototype,"uploaderExperiments",{get:function(){return this.props["exp-uploader-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"uploaderPostTTIExperiments",{get:function(){return this.state.uploaderPostTTIExperiments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"searchBarExperiments",{get:function(){return this.props["exp-search-bar-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"searchResultsExperiments",{get:function(){return this.props["exp-search-results-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"browseExperiments",{get:function(){return this.props["exp-browse-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isInSinglePageSearchExperiment",{get:function(){return B.isInSinglePageSearchExperiment(this.searchBarExperiments)},enumerable:!0,configurable:!0}),l.prototype.componentWillMount=function(){var t,o=this;t=this.props["search-query"]?["FilesViewController"]:["FilesViewController","AppActionsView"],this.browseLogger=new h.PageletLogger("browse",t,!0,{view_type:this.props.viewType.toLowerCase()});var s=this.props,i=s.urlPrefix,a=s.user,l=s.viewer,c=this.props["search-query"],d=this.props["share-link"],u=!!this.props["open-preview"],_=this.getPathFromProps();c||d||u||ae(this.getUrlForFQPath(i,_));var f=l.get_users().map(function(e){return e.id});z.UserLocalStorage.clearOtherUsers(f),this.browseBoltClient=new n.BrowseBoltClient(a.id);var m=new T.BrowsePrefetchLoader({user:a,path:_,fqPathsToSelect:this.props["select-fq-paths"]},{onPrefetchComplete:function(e){o.prefetchComplete=!0,o.props.setBrowseScope({browseScope:_}),o.handlePreviewAndShareModalsOnLoad(e.preview_file_info),J.log_js_modules_fetched_data_required_for_tti(),o.markTTVIfNeeded()},onPrefetchError:function(){o.prefetchComplete=!0,S.browseActions.setUrl({path:""}),o.navigateToPath({path:""})},onLoadComplete:function(){o.maybeShowPrepopulatedAddToCollectionModal(o.props.files)},onPostTTIPrefetchComplete:function(t){var s=t["exp-browse-post-tti-experiments"],i=t["exp-uploader-post-tti-experiments"],a=!!t["is-over-free-quota"],n=!!t["maybe-render-team-admin-modals"];s.expShouldShowNcctPaywall&&Z.redirect("/ncct-trial-end"),n&&new Promise(function(t,r){e(["modules/clean/react/ncct/post_tti_ncct_modal"],t,r)}).then(r.__importStar).then(function(e){(0,e.postTTINCCTReminderModal)()}),o.setState({uploaderPostTTIExperiments:i,isOverFreeQuota:a}),S.browseActions.setBrowsePostTTIExperiments({browsePostTTIExperiments:s})},onPostTTIPrefetchError:function(e){X.reportException({err:e||new Error("failed to load post TTI experiments")})}},{onInitializeEverything:S.browseActions.initializeEverything,onLoad:S.browseActions.load,onAddFilesAndSetLoadingState:S.browseActions.addFilesAndSetLoadingState});m.isPrefetching()?m.handlePrefetch():c||this.navigateToPath({path:_,logFetchedDataRequiredForTTI:!0}),this.searchBarExperiments.expSearchSuccessBanner&&(window.addEventListener("popstate",function(){N.resetSearchSuccessBannerSettings(),N.doSearchBarInteractionBroadcast(!1)}),p.default.deconstruct_url(document.referrer).qargs.search_session_id&&!N.getClickedOnSearchResultsPageItem()?N.setSearchSuccessBannerVisible():N.resetSearchSuccessBannerSettings());p.default.add_callback(i,this.handleFileLocationChange,!0),p.default.add_callback("/search",this._handleSearchLocationChange,!c),p.default.add_exit_callback("/search",this.handleSearchExit)},l.prototype.componentDidMount=function(){var t=this;this.mounted=!0;var s=this.getPathFromProps(),i=this.props.user,a=this.props["search-query"],n=this.props["share-link"],c=!!this.props["open-preview"];this.props["from-scl-sync-modal"]&&(i.is_cdm_member?se(s):oe(s)),this.props["show-share-success-snackbar"]&&G.showInBandShareSuccessSnackbar(d.filename(s)),this.shouldShowUnsyncNotification()&&this.showUnsyncNotification(),!a&&n&&!c&&i.is_cdm_member&&ie(s),this.toggleTimelineIfNecessary(),this.markTTVIfNeeded(),l.mountFileViewerTarget(),J.waitForTTI().then(function(){t.props["search-query"]||t.fetchAndStartBoltUpdates();var s=function(e){var r=e[0],s=(r[0],r[1],r[2].SharedWithStore),i=(r[3],r[4]),a=i.checkForMissingStarredData,n=i.StarredStore,l=(r[5],r[6],r[7],e[1]),c=(l[0],l[1],l[2].BloodhoundContactsV2),d=l[3].EmailVerification;if(l[4],l[5],l[6],t.mounted){var u=t.props,p=u.user,h=u.path,_=u.files,f=_.toArray();s.initializeWith({path:h,files:f}),a({items:f,user:p});var m=n.addListener(function(){t.setState({starredState:n.getLoadingStates()})}),S=A.getBrowseStore(),E=function(){return o.defer(function(){a({items:t.props.files.toArray(),user:p})})};S.add_change_listener(E),t.removeStarredStoreListener=function(){m(),S.remove_change_listener(E)},c.getOrCreateForUser(p),t.setState({arePostTTIModulesLoaded:!0}),t.props["email-just-verified"]?d.getForRole(p.role).show_verified_modal():t.props["email-just-verified-and-changed"]?d.getForRole(p.role).show_verified_and_changed_modal():t.props["send-verification-email"]&&d.getForRole(p.role).show_sent_modal(),t.prefetchPreviewData(_.toArray(),p)}};s.perfName="browse_post_tti",Promise.all([Promise.all([new Promise(function(t,r){e(["modules/clean/react/file_viewer/controller"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/browse/file_actions"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/browse/shared_with"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/files_view/overflow_menu_with_star"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/starred/browse_exports"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/file_modal_controller"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/sharing/share_modal_util"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/sharing/shared_content_link_sync_utils"],t,r)}).then(r.__importStar)]),Promise.all([new Promise(function(t,r){e(["modules/clean/sharing/ui_util"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/sharing/wizard/wizard_modals"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/contacts/bloodhound_contacts_v2"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/account/email"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/unity_browse_interface"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/unity/features"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/unity/check_file_cache"],t,r)}).then(r.__importStar)])]).then(s)})},l.prototype.componentWillUpdate=function(e,t){t.isSearchMode&&!this.state.isSearchMode?this.browseBoltClient.stopLiveUpdate():!t.isSearchMode&&this.state.isSearchMode&&this.fetchAndStartBoltUpdates(),e.files.equals(this.props.files)||o.defer(this.handleFileListUpdated)},l.prototype.componentWillUnmount=function(){this.removeStarredStoreListener&&this.removeStarredStoreListener(),window.removeEventListener("popstate",function(){N.resetSearchSuccessBannerSettings()}),l.unmountFileViewerTarget(),V.getSearchResultsStore().remove_change_listener(this.receiveStateFromStores),I.uploaderStore.remove_change_listener(this.receiveStateFromStores),window.removeEventListener(R.ALL_UPLOADS_COMPLETE_EVENT,this.onAllUploadsComplete),this.mounted=!1},Object.defineProperty(l.prototype,"browseContext",{get:function(){return this.state.isSearchMode?this.state.srpContext:this.props.brsContext},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"selection",{get:function(){return this.state.isSearchMode?this.state.srpSelection:this.props.brsSelection},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"selectedFiles",{get:function(){return this.state.isSearchMode?this.state.srpSelectedFiles:this.props.brsSelectedFiles},enumerable:!0,configurable:!0}),l.prototype.getStateFromStores=function(){var e=V.getSearchResultsStore(),t=e.latestQuery(),r=!!t;return{isDraggingInternalFiles:b.FileUploaderController.isDraggingInternalFiles(),isDraggingExternalFiles:b.FileUploaderController.isDraggingExternalFiles(),isUploadModalOpen:b.FileUploaderController.isUploadModalOpen(),isSearchMode:r,latestFileCategories:e.latestFileCategories(),srpContext:e.browseContext(),srpSelection:e.selection(),srpSelectedFiles:e.selectedFiles(),searchSessionId:e.searchSessionId(),latestQuery:t}},l.prototype.restoreUrlAfterFileViewClose=function(){var e,t=this.props.urlPrefix,r=this.getUrlForFQPath(t,this.props.path);e=this.props["open-preview"]?o.omit(ne(),F.BrowseQueryArg.preview,F.BrowseQueryArg.select):{},p.default.replace_state(r,e)},l.prototype.getUrlForFQPath=function(e,t){return e+("/"===t?"":re.URI.encode_parts(t))},l.prototype.fetchAndStartBoltUpdates=function(){
this.browseBoltClient.isReady()?this.startBoltLiveUpdate():this.browseBoltClient.fetchInitialBoltData(this.startBoltLiveUpdate)},l.prototype.ensureTimer=function(e,t){if(this.ajaxRequestWebTimer&&this.ajaxRequestWebTimer.getContextName()!==e&&delete this.ajaxRequestWebTimer,this.ajaxRequestWebTimer)this.ajaxRequestWebTimer.restart();else{this.ajaxRequestWebTimer=J.get_timer(e);var r={requireTTI:!0,requireTTV:!1};t&&(r.url=t),this.ajaxRequestWebTimer.initialize(r)}},l.prototype.navigateToPath=function(e){var t=e.path,r=e.logFetchedDataRequiredForTTI,o=void 0!==r&&r;this.browseLogger&&this.browseLogger.ttiLogged&&this.ensureTimer("browse_ajax","browse_ajax_nav"),S.browseActions.setPath({path:t,logFetchedDataRequiredForTTI:o,onPathLoaded:this.markTTVIfNeeded,ajaxWebTimer:this.ajaxRequestWebTimer}),this.props.clearSearchBar(),this.props.setBrowseScope({browseScope:t})},l.prototype.blurSearchBarIfInSinglePageSearch=function(){this.isInSinglePageSearchExperiment&&this.props.blurSearchBar()},l.prototype.onShowComment=function(e){this.ensureFullFileObjectPopulated(e,function(e){S.browseActions.navigateToFileOrFolder({file:e,shouldFocusComment:!0})})},l.prototype.onPrepareForSignature=function(e){this.ensureFullFileObjectPopulated(e,function(e){S.browseActions.navigateToFileOrFolder({file:e,shouldPrepareForSignature:!0})})},l.prototype.maybeShowPrepopulatedAddToCollectionModal=function(e){var t=ne();if(t.preselected_for_showcase){var r=t.preselected_for_showcase.split(".").map(function(e){return"id:"+e});v.showPrepopulatedAddToCollectionModal(r,this.props.user,e.toJS());var o=this.getPathFromProps(),s=this.getUrlForFQPath(this.props.urlPrefix,o);delete t[F.BrowseQueryArg.preselected_for_showcase],p.default.replace_state(s,t)}},l.prototype.shouldShowUnsyncNotification=function(){return this.props["should-show-unsync-notification"]},l.prototype.showUnsyncNotification=function(){L.Snackbar.show(s.createElement(L.Snackbar,{variant:"generic",title:ee._("Do you also need this on your computer?",{comment:'\'"this" refers to the folder that the user is currently browsing. (limited space, please keep the phase short)'}),timeoutDelayMs:1e5,actionButtonText:ee._("Learn more"),closeButtonText:ee._("Close"),onActionClick:this.getLearnMoreLinkHandler}))},l.prototype.render=function(){var e=this.state,t=e.isUploadModalOpen,r=e.isSearchMode,o=e.starredState,i=e.arePostTTIModulesLoaded,a=e.isDraggingExternalFiles,n=e.isDraggingInternalFiles,l=e.isOverFreeQuota,c=e.searchSessionId,d=e.latestQuery,u=e.latestFileCategories,p=e.searchFrom,h=this.props,_=h.viewType,f=h.user,m=h.path,E=h.createNewFolderState,T=h.currentSort,F=h.fileRename,w=h.files,v=h.teamFolders,A=h.isTextSelectable,R=h.loadingState,b=h.canDisplayFolderSizes,I=h.viewTypeColumns,P=h.filesWithoutTeamFolders,C=h.isQueryingFolderSizes,D=h.paginatedTotalNumFiles,O=h.shouldShowDeletedFiles,N=h.shouldShowPinnedTeamFolders,L=h.isTimelineVisible,x=this,M=x.browseContext,B=x.selection,U=x.selectedFiles;return s.createElement(g.BrowseView,{autoTeamGroupId:this.props["auto-team-group-id"],ref:this.setBrowseViewRef,actionHandlers:this.actionHandlers,filesViewActionHandlers:this.filesViewActionHandlers,onNavigateToParentFolder:this.handleOnNavigateToParentFolder,onNavigateToPath:this.handleOnNavigateToPath,onNavigateToFileOrFolder:this.handleOnNavigateToFileOrFolder,onSearchBarResultOpen:this.handleSearchBarResultOpen,context:M,onSearchBarPathClicked:this.handleSearchBarPathClicked,createNewFolderState:E,currentSort:T,ensureFileViewerClosedIfNotPreviewing:this.ensureFileViewerClosedIfNotPreviewing,fileRename:F,files:w,filesWithoutTeamFolders:P,getIsFileJumping:this.getIsFileJumping,getFileByFullPath:this.getFileByFullPath,handleComponentTTI:this.handleComponentTTI,isDraggingExternalFiles:a,isDraggingInternalFiles:n,isFileViewerShown:this.fileViewerIsShown,isSearchMode:r,isTextSelectable:A,isTimelineVisible:L,isUploadModalOpen:t,loadingState:R,onSearch:this.handleSearch,path:m,selectedFiles:U,selection:B,shouldOpenUploadModal:this.props["should-open-upload-modal"],shouldShowDeletedFiles:O,shouldShowPinnedTeamFolders:N,starredState:o,teamFolders:v,totalNumItems:D,uploadAjaxInterceptor:this.uploadAjaxInterceptor,user:f,viewType:_,canDisplayFolderSizes:b,columns:I[_],viewTypeColumns:I,arePostTTIModulesLoaded:i,isNoComment:this.props["is-no-comment"],isOverFreeQuota:l,isQueryingFolderSizes:C,nsId:this.props["ns-id"],uploaderExperiments:this.uploaderExperiments,uploaderPostTTIExperiments:this.uploaderPostTTIExperiments,searchBarExperiments:this.searchBarExperiments,searchResultsExperiments:this.searchResultsExperiments,browseExperiments:this.browseExperiments,browsePostTTIExperiments:this.props.browsePostTTIExperiments,searchSessionId:c,latestQuery:d,onSearchFiltersChanged:this.handleSearchFiltersChanged,appActionsStore:this.appActionsStore,fileCategories:u,isNautilusEnabled:!!this.props["nautilus-enabled-for-user"],isPaperEnabled:!!this.props["paper-enabled-for-user"],searchFrom:p,onShowTimeline:S.browseActions.showTimeline,onHideTimeline:S.browseActions.hideTimeline,onSelectionChange:S.browseActions.setSelection,onSortFiles:S.browseActions.sortFiles,onSetUrl:y.browseNavActions.setUrl})},l.mountFileViewerTarget=function(){var e=document.getElementById(F.BROWSE_FILE_VIEWER_ELEMENT_ID);e||(e=document.createElement("div"),e.id=F.BROWSE_FILE_VIEWER_ELEMENT_ID,document.body.insertBefore(e,document.body.children[0]))},l.unmountFileViewerTarget=function(){var e=document.getElementById(F.BROWSE_FILE_VIEWER_ELEMENT_ID);e&&document.body.removeChild(e)},l})(s.Component);t.BrowseController=ce}),define("modules/clean/react/browse/data/action_creators",["require","exports","tslib","external/immutable","modules/clean/file_operations/notifications","modules/clean/react/browse/action_logger","modules/clean/react/browse/api","modules/clean/react/browse/data/selectors","modules/clean/react/browse/data/types","modules/clean/react/browse/models","modules/clean/react/files_view/constants","modules/clean/react/files_view/types","modules/clean/react/snackbar","modules/clean/search/constants","modules/clean/search/search_results/dispatcher","modules/clean/storage","modules/core/cookies","modules/core/i18n","modules/clean/react/browse/constants"],function(e,t,r,o,s,i,a,n,l,c,d,u,p,h,_,f,m,S,E){"use strict";var T=this;Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),a=r.__importStar(a),n=r.__importStar(n),h=r.__importStar(h);t.appInit=function(e){var t=e.experiments,r=e.shouldShowDeletedFiles,o=e.user,s=e.viewer;return{type:l.ActionTypes.APP_INIT,payload:{experiments:t,shouldShowDeletedFiles:r,user:o,viewer:s}}},t.selectFilesByFqPath=function(e){var t=e.fqPathsToSelect;return{type:l.ActionTypes.SELECT_FILES_BY_FQ_PATH,payload:{fqPathsToSelect:t}}},t.setCanDisplayFolderSizes=function(e){var t=e.canDisplayFolderSizes;return{type:l.ActionTypes.SET_CAN_DISPLAY_FOLDER_SIZES,payload:{canDisplayFolderSizes:t}}},t.setClipboardFiles=function(e){var t=e.clipboardFiles;return{type:l.ActionTypes.SET_CLIPBOARD_FILES,payload:{clipboardFiles:t}}},t.copyFilesToClipboard=function(e){var r=e.files;return function(e,o){if(r.length){if(r.some(function(e){return e.isDeleted}))return void p.Snackbar.fail(S._("Deleted files cannot be added to the clipboard"));if(r.some(c.File.isTeamSharedFolder))return void p.Snackbar.fail(S._("Team Folders can’t be copied."));var s=S.ungettext("Added %(num_items)s item to clipboard","Added %(num_items)s items to clipboard",r.length).format({num_items:r.length});p.Snackbar.complete(s),e(t.setClipboardFiles({clipboardFiles:r}))}}},t.pasteFilesFromClipboard=function(e){var t=e.copyFiles;return function(e,r){t({user:n.user(r()),files:n.clipboardFiles(r()),newPath:n.path(r()),checkFSWs:!0,dataApi:a,onSuccess:function(e){var t=S.ungettext("Pasted %(num_items)s item from clipboard","Pasted %(num_items)s items from clipboard",e.length).format({num_items:e.length});p.Snackbar.complete(t)}})}},t.setContext=function(e){var t=e.context;return{type:l.ActionTypes.SET_CONTEXT,payload:{context:t}}},t.setBrowsePostTTIExperiments=function(e){var t=e.browsePostTTIExperiments;return{type:l.ActionTypes.SET_BROWSE_POST_TTI_EXPERIMENTS,payload:{browsePostTTIExperiments:t}}},t.setFileJumpFilter=function(e){var t=e.fileJumpFilter;return{type:l.ActionTypes.SET_FILE_JUMP_FILTER,payload:{fileJumpFilter:t}}},t.addFileJumpKeyCode=function(e){var r=e.keyChar;return function(e,o){var s=n.fileJumpFilter(o())+r.toLowerCase();e(t.setFileJumpFilter({fileJumpFilter:s}));for(var i=null,a=n.fileJumpIndex(o()),l=0,c=a;l<c.length;l++){var d=c[l],u=d.fqPath;if(d.filename>=s){i=u;break}}null!=i&&e(t.selectFilesByFqPath({fqPathsToSelect:[i]}))}},t.setFilePathsToSelectOnNextUpdate=function(e){var t=e.filePathsToSelectOnNextUpdate;return{type:l.ActionTypes.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,payload:{filePathsToSelectOnNextUpdate:t}}},t.showTimeline=function(){return{type:l.ActionTypes.SHOW_TIMELINE,payload:{}}},t.hideTimeline=function(){return{type:l.ActionTypes.HIDE_TIMELINE,payload:{}}},t.setFileRename=function(e){var t=e.file,r=e.renameState;return{type:l.ActionTypes.SET_FILE_RENAME,payload:{file:t,renameState:r}}};var g=function(e,t){_.SearchResultsDispatcher.dispatch({type:h.CHANGE_FILES_ACTION,data:{fileDeltas:[{before:e.fq_path,after:e.is_dir?t.set("icon",e.icon):t}]}})};t.renameFile=function(e){var i=e.file,l=e.name,c=e.isSearchMode;return function(e,d){return r.__awaiter(T,void 0,void 0,function(){var p,h,_,f,m,S;return r.__generator(this,function(r){switch(r.label){case 0:p=n.user(d()),e(t.setFileRename({file:i,renameState:u.RenameState.SAVING_INPUT})),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,a.renameFile({file:i,name:l,user:p})];case 2:return h=r.sent(),_=h.renamedFile,f=h.changesets,m=h.rollbackHints,s.notifyRenameSuccess(p,f,m,function(){c&&g(_,i),e(t.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:o.Set([i.fq_path])}))}),e(t.setFileRename({file:i,renameState:null})),c&&g(i,_),e(t.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:o.Set([_.fq_path])})),[3,4];case 3:return S=r.sent(),e(t.setFileRename({file:i,renameState:null})),[3,4];case 4:return[2]}})})}},t.setFolderSizes=function(e){var t=e.folderSizes;return{type:l.ActionTypes.SET_FOLDER_SIZES,payload:{folderSizes:t}}},t.setLoadingState=function(e){var t=e.loadingState,r=e.path;return{type:l.ActionTypes.SET_LOADING_STATE,payload:{loadingState:t,path:r}}},t.setMountPoints=function(e){var t=e.mountPoints;return{type:l.ActionTypes.SET_MOUNT_POINTS,payload:{mountPoints:t}}},t.setNewFolderCreationState=function(e){var t=e.newFolderCreationState;return{type:l.ActionTypes.SET_NEW_FOLDER_CREATION_STATE,payload:{newFolderCreationState:t}}},t.setPaginatedTotalNumFiles=function(e){var t=e.paginatedTotalNumFiles;return{type:l.ActionTypes.SET_PAGINATED_TOTAL_NUM_FILES,payload:{paginatedTotalNumFiles:t}}},t.setPath=function(e){var t=e.path;return{type:l.ActionTypes.SET_PATH,payload:{path:t}}},t.setSelection=function(e){var t=e.selection;return{type:l.ActionTypes.SET_SELECTION,payload:{selection:t}}},t.setShouldShowDeletedFiles=function(e){var t=e.shouldShowDeletedFiles;return{type:l.ActionTypes.SET_SHOULD_SHOW_DELETED_FILES,payload:{shouldShowDeletedFiles:t}}};var F=function(e){var t=e.sortOrder;return{type:l.ActionTypes.SET_SORT_ORDER,payload:{sortOrder:t}}};t.restoreSortOrder=function(){return function(e,t){var r=m.Cookies.read(E.BROWSE_SORT_COOKIE_NAME);if(r&&r.indexOf("|")>-1){var o=r.split("|",2),s={sortField:o[0],sortDirection:o[1]},i=n.sortOrder(t());s.sortDirection===i.sortDirection&&s.sortField===i.sortField||e(F({sortOrder:s}))}}},t.setAndStoreSortOrder=function(e){var t=e.sortOrder;return function(e,r){m.Cookies.delete(E.BROWSE_SORT_COOKIE_NAME);var o=t.sortField+"|"+t.sortDirection;m.Cookies.create(E.BROWSE_SORT_COOKIE_NAME,o,1095),e(F({sortOrder:t}))}},t.setUnsortedFiles=function(e){var t=e.unsortedFiles;return{type:l.ActionTypes.SET_UNSORTED_FILES,payload:{unsortedFiles:t}}},t.setAndStoreViewType=function(e){var t=e.viewType,r=e.isSearchMode;return function(e,o){var s=n.user(o()).id;m.Cookies.delete(E.VIEW_TYPE_COOKIE_NAME),m.Cookies.create(E.VIEW_TYPE_COOKIE_NAME,t,1095),i.logSwitchViewType({uid:s,isSearchMode:r,viewType:t}),e(w({viewType:t}))}};var w=function(e){var t=e.viewType;return{type:l.ActionTypes.SET_VIEW_TYPE,payload:{viewType:t}}};t.restoreViewType=function(){return function(e,t){var r=m.Cookies.read(E.VIEW_TYPE_COOKIE_NAME);null!==r&&r!==n.viewType(t())&&e(w({viewType:r}))}};var y=function(e){var t=e.viewTypeColumns;return{type:l.ActionTypes.SET_VIEW_TYPE_COLUMNS,payload:{viewTypeColumns:t}}};t.setAndStoreViewTypeColumns=function(e){var t=e.columns,o=e.viewType;return function(e,s){var i=n.user(s()).id;f.UserLocalStorage.set(i,E.COLUMNS_STORAGE_KEY+"_"+o,t),e(y({viewTypeColumns:r.__assign({},n.viewTypeColumns(s()),(a={},a[o]=t,a))}));var a}},t.restoreViewTypeColumns=function(){return function(e,t){var r=n.user(t()).id,o=n.viewTypeColumns(t());d.AllViewTypes.forEach(function(e){var t=f.UserLocalStorage.get(r,E.COLUMNS_STORAGE_KEY+"_"+e);t&&(o[e]=t)}),e(y({viewTypeColumns:o}))}},t.requestFolderSizes=function(e){var t=e.fqPath;return{type:l.ActionTypes.REQUEST_FOLDER_SIZES,payload:{fqPath:t}}},t.setFolderSizesPending=function(e){var t=e.fetchFolderSizesResp;return{type:l.ActionTypes.SET_FOLDER_SIZES_PENDING,payload:{fetchFolderSizesResp:t}}},t.completeFolderSizes=function(e){var t=e.fetchFolderSizeState;return{type:l.ActionTypes.COMPLETE_FOLDER_SIZES,payload:{fetchFolderSizeState:t}}}}),define("modules/clean/react/browse/data/reducer",["require","exports","tslib","external/immutable","modules/clean/filepath","modules/clean/react/browse/data/types","modules/clean/react/browse/models","modules/clean/react/files_view/constants","modules/clean/react/files_view/types","modules/clean/react/selection","modules/core/exception"],function(e,t,r,o,s,i,a,n,l,c,d){"use strict";function u(e,t){var o=t.payload,s=o.experiments,i=o.shouldShowDeletedFiles,a=o.user,n=o.viewer;return d.assert(null===e.user,"Cannot reinitialize Browse store; changing invariants such as `user` is untested"),r.__assign({},e,{experiments:s,shouldShowDeletedFiles:i,user:a,viewer:n})}function p(e,t){var s=t.payload.fqPathsToSelect,i=s.map(function(e){return e.toLowerCase()}),a=e.unsortedFiles.toList().filter(function(e){return i.includes(e.fq_path.toLowerCase())}),n=a.map(function(e){return e.fq_path}),l=o.OrderedSet(n),c=n.size?n.get(0):null;return r.__assign({},e,{selection:e.selection.set("selected",l).set("anchor",c)})}function h(e,t){var o=t.payload.canDisplayFolderSizes;return r.__assign({},e,{canDisplayFolderSizes:o})}function _(e,t){var o=t.payload.clipboardFiles;return r.__assign({},e,{clipboardFiles:o})}function f(e,t){var o=t.payload.context;return r.__assign({},e,{context:o})}function m(e,t){var o=t.payload.fileJumpFilter;return r.__assign({},e,{fileJumpFilter:o})}function S(e,t){var o=t.payload.filePathsToSelectOnNextUpdate;return r.__assign({},e,{filePathsToSelectOnNextUpdate:o})}function E(e,t){var o=t.payload,s=o.file,i=o.renameState;return i?r.__assign({},e,{fileRename:{file:s,state:i}}):r.__assign({},e,{fileRename:null})}function T(e,t){var o=t.payload.folderSizes;return r.__assign({},e,{folderSizes:o})}function g(e,t){var i=t.payload,a=i.loadingState,n=i.path;return s.paths_are_equal(n,e.path)?a===l.LoadingState.LOADED?r.__assign({},e,{loadingState:a,filePathsToSelectOnNextUpdate:o.Set()}):r.__assign({},e,{loadingState:a}):e}function F(e,t){var s=t.payload.mountPoints;return r.__assign({},e,{mountPoints:o.Map(s)})}function w(e,t){var o=t.payload.newFolderCreationState;return r.__assign({},e,{newFolderCreationState:o})}function y(e,t){var o=t.payload.paginatedTotalNumFiles;return r.__assign({},e,{paginatedTotalNumFiles:o})}function v(e,t){var o=t.payload.path;return r.__assign({},e,{path:o})}function A(e,t){var o=t.payload.selection;return r.__assign({},e,{selection:o})}function R(e,t){var o=t.payload.shouldShowDeletedFiles;return r.__assign({},e,{shouldShowDeletedFiles:o})}function b(e,t){var o=t.payload.sortOrder;return r.__assign({},e,{sortOrder:o})}function I(e,t){var o=t.payload.unsortedFiles;return r.__assign({},e,{unsortedFiles:o})}function P(e,t){var o=t.payload.viewType;return r.__assign({},e,{viewType:o})}function C(e,t){var o=t.payload.browsePostTTIExperiments;return r.__assign({},e,{browsePostTTIExperiments:o})}function D(e,t){var o=t.payload.viewTypeColumns;return r.__assign({},e,{viewTypeColumns:o})}function O(e,t){var o=t.payload.fqPath;if(e.isQueryingFolderSizes)return e;var s=e.folderSizes.withMutations(function(e){e.set(o,{size:0,state:l.FetchFolderSizeState.LOADING})});return r.__assign({},e,{folderSizes:s,isQueryingFolderSizes:!0})}function N(e,t){var o=t.payload.fetchFolderSizesResp,s=e.currentFolderSizesQuery,i=e.folderSizes.withMutations(function(e){for(var t=function(t){e.update(t.fq_path,{size:0,state:l.FetchFolderSizeState.LOADING},function(e){return{size:e.size+t.size,state:l.FetchFolderSizeState.LOADING}}),s=s.withMutations(function(e){return e.add(t.fq_path)})},r=0,i=o.sizes_dict;r<i.length;r++){t(i[r])}});return r.__assign({},e,{currentFolderSizesQuery:s,folderSizes:i})}function L(e,t){var s=t.payload.fetchFolderSizeState,i=e.folderSizes.withMutations(function(t){e.currentFolderSizesQuery.forEach(function(r){var o=e.folderSizes.get(r);o&&t.update(r,function(){return{size:o.size,state:s}})})});return r.__assign({},e,{currentFolderSizesQuery:o.Set(),folderSizes:i,isQueryingFolderSizes:!1})}function x(e,t){return r.__assign({},e,{isTimelineVisible:!0})}function M(e,t){return r.__assign({},e,{isTimelineVisible:!1})}function B(e,r){switch(void 0===e&&(e=t.defaultBrowseState),r.type){case i.ActionTypes.APP_INIT:return u(e,r);case i.ActionTypes.RESET_TO_DEFAULT_FOR_TESTS_ONLY:return t.defaultBrowseState;case i.ActionTypes.SELECT_FILES_BY_FQ_PATH:return p(e,r);case i.ActionTypes.SET_CAN_DISPLAY_FOLDER_SIZES:return h(e,r);case i.ActionTypes.SET_CLIPBOARD_FILES:return _(e,r);case i.ActionTypes.SET_CONTEXT:return f(e,r);case i.ActionTypes.SET_FILE_JUMP_FILTER:return m(e,r);case i.ActionTypes.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE:return S(e,r);case i.ActionTypes.SET_FILE_RENAME:return E(e,r);case i.ActionTypes.SET_FOLDER_SIZES:return T(e,r);case i.ActionTypes.SET_LOADING_STATE:return g(e,r);case i.ActionTypes.SET_MOUNT_POINTS:return F(e,r);case i.ActionTypes.SET_NEW_FOLDER_CREATION_STATE:return w(e,r);case i.ActionTypes.SET_PAGINATED_TOTAL_NUM_FILES:return y(e,r);case i.ActionTypes.SET_PATH:return v(e,r);case i.ActionTypes.SET_SELECTION:return A(e,r);case i.ActionTypes.SET_SHOULD_SHOW_DELETED_FILES:return R(e,r);case i.ActionTypes.SET_SORT_ORDER:return b(e,r);case i.ActionTypes.SET_UNSORTED_FILES:return I(e,r);case i.ActionTypes.SET_VIEW_TYPE:return P(e,r);case i.ActionTypes.SHOW_TIMELINE:return x(e,r);case i.ActionTypes.HIDE_TIMELINE:return M(e,r);case i.ActionTypes.SET_VIEW_TYPE_COLUMNS:return D(e,r);case i.ActionTypes.REQUEST_FOLDER_SIZES:return O(e,r);case i.ActionTypes.SET_FOLDER_SIZES_PENDING:return N(e,r);case i.ActionTypes.COMPLETE_FOLDER_SIZES:return L(e,r);case i.ActionTypes.SET_BROWSE_POST_TTI_EXPERIMENTS:return C(e,r)}return e}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),t.defaultBrowseState={canDisplayFolderSizes:!1,clipboardFiles:[],context:new a.BrowseContext,experiments:{},browsePostTTIExperiments:{},fileJumpFilter:"",filePathsToSelectOnNextUpdate:o.Set(),fileRename:null,folderSizes:o.Map(),isTimelineVisible:!1,loadingState:l.LoadingState.LOADING_FIRST_PAGE,mountPoints:null,newFolderCreationState:l.NewFolderCreationState.CREATE_FOLDER_INACTIVE,paginatedTotalNumFiles:0,path:"",selection:c.createSelection(),shouldShowDeletedFiles:!1,sortOrder:{sortField:l.SortField.FILENAME,sortDirection:l.SortDirection.ASCENDING},user:null,unsortedFiles:o.Map(),viewer:null,viewType:l.ViewType.List,viewTypeColumns:(U={},U[l.ViewType.List]=n.LIST_VIEW_COLUMNS,U[l.ViewType.Grid]=n.GRID_VIEW_COLUMNS,U[l.ViewType.LargeGrid]=n.GRID_VIEW_COLUMNS,U),currentFolderSizesQuery:o.Set(),isQueryingFolderSizes:!1},t.browseReducer=B;var U}),define("modules/clean/react/browse/data/selectors",["require","exports","tslib","external/immutable","external/reselect","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/browse/data/reducer","modules/clean/react/browse/uri_helper","modules/clean/react/browse/util","modules/clean/react/files_view/types","modules/clean/redux/selectors","modules/clean/redux/types","modules/core/browser","modules/core/exception"],function(e,t,r,o,s,i,a,n,l,c,d,u,p,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),i=r.__importStar(i),h=r.__importStar(h);var f=function(e){return u.getStateAtNamespace(e,p.BROWSE_NAMESPACE_KEY)||n.defaultBrowseState};t.canDisplayFolderSizes=function(e){return f(e).canDisplayFolderSizes},t.clipboardFiles=function(e){return f(e).clipboardFiles},t.context=function(e){return f(e).context},t.experiments=function(e){return f(e).experiments},t.postTTIExperiments=function(e){return f(e).browsePostTTIExperiments},t.fileJumpFilter=function(e){return f(e).fileJumpFilter},t.filePathsToSelectOnNextUpdate=function(e){return f(e).filePathsToSelectOnNextUpdate},t.fileRename=function(e){return f(e).fileRename},t.folderSizes=function(e){return f(e).folderSizes},t.isFileJumping=function(e){return f(e).fileJumpFilter.length>0},t.isQueryingFolderSizes=function(e){return f(e).isQueryingFolderSizes},t.loadingState=function(e){return f(e).loadingState},t.mountPoints=function(e){return f(e).mountPoints},t.newFolderCreationState=function(e){return f(e).newFolderCreationState},t.paginatedTotalNumFiles=function(e){return t.loadingState(e)===d.LoadingState.LOADED?t.sortedFiles(e).count():f(e).paginatedTotalNumFiles},t.path=function(e){return f(e).path},t.selection=function(e){return f(e).selection},t.shouldShowDeletedFiles=function(e){return f(e).shouldShowDeletedFiles},t.sortOrder=function(e){return f(e).sortOrder},t.unsortedFiles=function(e){return f(e).unsortedFiles},t.user=function(e){var t=f(e).user;return _.assert(null!=t,"Browse store `user` accessed before APP_INIT action"),t},t.viewer=function(e){var t=f(e).viewer;return _.assert(null!=t,"Browse store `viewer` accessed before APP_INIT action"),t},t.viewType=function(e){return f(e).viewType},t.viewTypeColumns=function(e){return f(e).viewTypeColumns},t.isTimelineVisible=function(e){return f(e).isTimelineVisible},t.browsePostTTIExperiments=function(e){return f(e).browsePostTTIExperiments||{}},t.fileJumpIndex=s.createSelector(t.unsortedFiles,function(e){return e.keySeq().toArray().map(function(e){return{filename:i.filename(e).toLowerCase(),fqPath:e}}).sort(function(e,t){return e.filename<t.filename?-1:e.filename>t.filename?1:0})}),t.sortedFiles=s.createSelector(t.unsortedFiles,t.sortOrder,t.folderSizes,function(e,t,r){return c.sortFiles(e.toList(),t,r,h.mac)}),t.selectedFiles=s.createSelector(t.sortedFiles,t.selection,function(e,t){if(t.selected.isEmpty()||e.isEmpty())return o.OrderedMap();var r=e.filter(function(e){return t.selected.has(e.fq_path)});return o.OrderedMap(r.map(function(e){return[e.fq_path,e]}))}),t.urlPrefix=s.createSelector(t.user,t.viewer,function(e,t){return l.browse_root(t,e)}),t.teamFolders=s.createSelector(t.unsortedFiles,t.folderSizes,function(e,t){var r={sortField:d.SortField.FILENAME,sortDirection:d.SortDirection.ASCENDING};return c.sortFiles(e.toList().filter(function(e){return e.type===a.FileTypes.TEAM_SHARED_FOLDER}),r,t,h.mac)}),t.sortedFilesWithFolderSizes=s.createSelector(t.sortedFiles,t.folderSizes,function(e,t){return e.map(function(e){var r=t.get(e.fq_path);return r?e.updateSize(r.size,r.state):e})}),t.unsortedFilesWithFolderSizes=s.createSelector(t.unsortedFiles,t.folderSizes,function(e,t){return e.withMutations(function(r){t.forEach(function(t,o){var s=e.get(o);if(s&&t){var i=s.updateSize(t.size,t.state);r.set(o,i)}})})}),t.sortedFilesWithFoldersSizesWithoutTeamFolders=s.createSelector(t.sortedFilesWithFolderSizes,function(e){return e.filter(function(e){return e.type!==a.FileTypes.TEAM_SHARED_FOLDER})}),t.shouldShowPinnedTeamFolders=s.createSelector(t.context,t.loadingState,t.path,t.teamFolders,t.viewType,function(e,t,r,o,s){return e.showPinnedTeamFolder&&!o.isEmpty()&&i.paths_are_equal(r,"/")&&s===d.ViewType.List&&(t===d.LoadingState.LOADED||t===d.LoadingState.LOADING_REMAINING_PAGES)})}),define("modules/clean/react/browse/data/store",["require","exports","modules/clean/redux/types","modules/clean/react/browse/data/reducer","modules/clean/redux/store"],function(e,t,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i;t.getStoreForBrowse=function(){return i||(i=s.getStoreAndRegisterReducers((e={},e[r.BROWSE_NAMESPACE_KEY]=o.browseReducer,e))),i;var e}}),define("modules/clean/react/browse/data/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.RESET_TO_DEFAULT_FOR_TESTS_ONLY="BROWSE/RESET_TO_DEFAULT_FOR_TESTS_ONLY",e.APP_INIT="BROWSE/APP_INIT",e.SELECT_FILES_BY_FQ_PATH="BROWSE/SELECT_FILES_BY_FQ_PATH",e.SHOW_TIMELINE="BROWSE/SHOW_TIMELINE",e.HIDE_TIMELINE="BROWSE/HIDE_TIMELINE",e.SET_BROWSE_POST_TTI_EXPERIMENTS="BROWSE/SET_BROWSE_POST_TTI_EXPERIMENTS",e.SET_CAN_DISPLAY_FOLDER_SIZES="BROWSE/SET_CAN_DISPLAY_FOLDER_SIZES",e.SET_CLIPBOARD_FILES="BROWSE/SET_CLIPBOARD_FILES",e.SET_CONTEXT="BROWSE/SET_CONTEXT",e.SET_FILE_JUMP_FILTER="BROWSE/SET_FILE_JUMP_FILTER",e.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE="BROWSE/SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE",e.SET_FILE_RENAME="BROWSE/SET_FILE_RENAME",e.SET_FOLDER_SIZES="BROWSE/SET_FOLDER_SIZES",e.SET_LOADING_STATE="BROWSE/SET_LOADING_STATE",e.SET_MOUNT_POINTS="BROWSE/SET_MOUNT_POINTS",e.SET_NEW_FOLDER_CREATION_STATE="BROWSE/SET_NEW_FOLDER_CREATION_STATE",e.SET_PAGINATED_TOTAL_NUM_FILES="BROWSE/SET_PAGINATED_TOTAL_NUM_FILES",e.SET_PATH="BROWSE/SET_PATH",e.SET_SELECTION="BROWSE/SET_SELECTION",e.SET_SHOULD_SHOW_DELETED_FILES="BROWSE/SET_SHOULD_SHOW_DELETED_FILES",e.SET_SORT_ORDER="BROWSE/SET_SORT_ORDER",e.SET_UNSORTED_FILES="BROWSE/SET_UNSORTED_FILES",e.SET_VIEW_TYPE="BROWSE/SET_VIEW_TYPE",e.SET_VIEW_TYPE_COLUMNS="BROWSE/SET_VIEW_TYPE_COLUMNS",e.REQUEST_FOLDER_SIZES="BROWSE/REQUEST_FOLDER_SIZES",e.SET_FOLDER_SIZES_PENDING="BROWSE/SET_FOLDER_SIZES_PENDING",e.COMPLETE_FOLDER_SIZES="BROWSE/COMPLETE_FOLDER_SIZES"})(t.ActionTypes||(t.ActionTypes={}))}),define("modules/clean/react/browse/dispatcher",["require","exports","tslib","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/react/browse/store"],function(e,t,r,o,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.BrowseDispatcher={dispatch:function(e){o.assert(i.browseStoreInstantiated(),"Must call getBrowseStore() before a dispatch"),s.Dispatcher.dispatch(e)}}}),define("modules/clean/react/browse/global_actions",["require","exports","tslib","external/lodash","external/react","modules/clean/analytics","modules/clean/cloud_docs/constants","modules/clean/cloud_docs/new_file_menu","modules/clean/filepath","modules/clean/react/browse/action_logger","modules/clean/react/async_file_modal_controller","modules/clean/react/async_onboarding_move_modal","modules/clean/react/browse/actions","modules/clean/react/browse/nav_actions","modules/clean/react/file_uploader/action_logger","modules/clean/react/modal","modules/clean/sharing/access_level","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/viewer","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/user_education/user_education_client","modules/clean/web_user_action_events"],function(e,t,r,o,s,i,a,n,l,c,d,u,p,h,_,f,m,S,E,T,g,F,w,y,v,A){"use strict";function R(t){var r=t.arePostTTIModulesLoaded,l=t.context,c=t.user,d=t.viewType,p=t.showDeletedFiles,h=t.onUpload,m=void 0===h?o.noop:h,E=t.isNoComment,w=void 0!==E&&E,y=t.autoTeamGroupId,R=(t.browseExperiments,t.browsePostTTIExperiments),I=l.isCurrentlyInRoot,P=!l.canViewContainingNSMembers,C=l.isCurrentPathWriteable(),k=g.is_input_webkitdirectory_supported(),V={className:"action-upload",label:D(b.UploadFiles),popoverLabel:D(b.Files),iconName:k?"upload-file":"upload",performAction:function(){return m(!1)},disabled:!C},W=k?{className:"action-upload",label:D(b.UploadFolder),popoverLabel:D(b.Folder),iconName:"upload-folder",performAction:function(){return m(!0)},disabled:!C}:void 0,H=!l.isInsideSandboxFolder,G=R.expTimeline,z=R.expEnableCloudDocsPaperCreate,j=R.expEnableCloudDocsGddCreate,Q=R.expCloudDocsFileCreatePrimaryButton,J=function(){return s.createElement(n.NewFileMenu,{key:"new-file-menu",user:c,source:a.NewFileMenuFromType.BROWSE,path:l.currentFQPath,disabled:!C,showGdd:!!j,showPaper:!!z,primaryButton:!1})},K=function(){return s.createElement(n.NewFileMenu,{key:"new-file-menu",user:c,source:a.NewFileMenuFromType.BROWSE,path:l.currentFQPath,disabled:!C,showGdd:!!j,showPaper:!!z,primaryButton:!0})},Y=[];if(l.isInsideTeamFolderTree||!l.isInsideDeletedSharedFolder&&!l.isInsideDeletedNestedSharedFolder)if(l.isInsideDeletedFolder)Y.push({label:D(b.RestoreFolder),iconName:"restore",className:"action-restore",performAction:M(c,d,l),disabled:!C});else{var Z={label:D(b.NewFolder),iconName:"new-folder",performAction:O(c,d,l,y,R.expSubgrowthProOQNewFolder,R.expNewFolderModal),disabled:!C,className:"action-new-folder"},X={label:D(I?b.NewSharedFolder:b.ShareFolder),iconName:"new-shared-folder",performAction:L(c,l,R.expSubgrowthProOQNewFolder),disabled:P,className:"action-share-folder"},$={label:D(b.NewTeamFolder),iconName:"new-team-folder",performAction:U(c,l),disabled:!1,className:"action-team-folder"};if(c.is_cdm_member&&"/"===l.currentFQPath){v.UEClient.registerBulkCallbackForEducationStep([{moduleName:"trial_admin_setup_team_space",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_v2",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_mobile",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_mobile_v2",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_folder_structure",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_folder_structure_v2",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_free_order",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_free_order_v2",stepName:"team_folder_modal"}],Z.performAction);var ee=function(e){i.TeamsWebActionsLogger.log(e),window.setTimeout(function(){v.UEClient.sendEvent("SetStructureModal","Close")},2500),f.Modal.close()};v.UEClient.registerBulkCallbackForEducationStep([{moduleName:"trial_admin_shared_workspace",stepName:"set_structure_modal"},{moduleName:"trial_admin_shared_workspace_v2",stepName:"set_structure_modal"}],function(){var e={user:c,teamName:T.Viewer.get_viewer().team_name,onSuccess:function(){return ee("uj_ss_modal_success")},onError:function(){return ee("uj_ss_modal_error")},onCancel:function(){return ee("uj_ss_modal_cancel")}};u.showOnboardingMoveDialog(e)}),Q&&Y.push(K),Y.push(V),k&&Y.push(W),Y.push(Z),Q||Y.push(J)}else if(I)Q&&Y.push(K),Y.push(V),k&&Y.push(W),!c.is_cdm_member&&S.GoldenGate.hasContentManagerAndSuperAdmin(c.id)&&Y.push($),Y.push(X,Z),Q||Y.push(J);else{H&&Y.push(X);var te=!H&&!!Q;te&&Y.push(K),Y.push(V),k&&Y.push(W),Y.push(Z),te||Y.push(J)}w||Y.push({label:D(p?b.HideDeletedFiles:b.ShowDeletedFiles),iconName:p?"hide":"show-deleted-files",performAction:x(c,d,p),disabled:P,className:"action-deleted-files"}),!T.Viewer.get_viewer().is_assume_user_session&&(S.GoldenGate.hasContentManagerAndSuperAdmin(c.id)&&S.GoldenGate.hasNewOwnershipModel(c.id)&&l.isInsideTeamFolderTree||!c.is_cdm_member&&S.GoldenGate.hasContentManagerAndSuperAdmin(c.id)&&l.isCurrentlyInRoot)&&Y.push({label:D(b.ManageAsAdmin),iconName:"settings-gear",performAction:U(c,l)}),G&&Y.push({label:D(b.ViewTimeline),
iconName:"view-version-history",performAction:N(c,l)})}else Y.push({label:D(b.ReAddSharedFolder),iconName:"restore",performAction:B(c,l),disabled:!C});if(W&&Y[0]===V){F.assert(Y[1]===W,"`uploadFolderItem` does not immediately follow `uploadFilesItem`");var re={className:"action-upload",label:D(b.Upload),iconName:"upload",performAction:function(){return _.logUploadAction(c.id,A.WebUserActionLogEvent.UPLOAD_CLICK)},disabled:!C,subItems:[V,W]};Y.splice(0,2,re)}if(r){var oe=e("modules/clean/unity/features"),se=R.expSubgrowthBizTeamsTriggersClientLinkWork||"";["V1","V2"].includes(se)&&null!=oe&&c.is_team&&Y.push({iconName:"monitor",label:D(b.ShowLocalCopy),performAction:q(c,l)})}return Y}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),l=r.__importStar(l),d=r.__importStar(d),_=r.__importStar(_),g=r.__importStar(g);var b;(function(e){e[e.UploadFiles=1]="UploadFiles",e[e.UploadFolder=2]="UploadFolder",e[e.Upload=3]="Upload",e[e.Files=4]="Files",e[e.Folder=5]="Folder",e[e.NewPaperDoc=6]="NewPaperDoc",e[e.NewFolder=7]="NewFolder",e[e.RestoreFolder=8]="RestoreFolder",e[e.ReAddSharedFolder=9]="ReAddSharedFolder",e[e.ShowDeletedFiles=10]="ShowDeletedFiles",e[e.HideDeletedFiles=11]="HideDeletedFiles",e[e.NewSharedFolder=12]="NewSharedFolder",e[e.ShareFolder=13]="ShareFolder",e[e.ManageAsAdmin=14]="ManageAsAdmin",e[e.NewTeamFolder=15]="NewTeamFolder",e[e.ShowLocalCopy=16]="ShowLocalCopy",e[e.ViewTimeline=17]="ViewTimeline"})(b||(b={}));var I={},P=function(){return g.mac?w._("Show in Finder"):g.windows?w._("Show in Explorer"):w._("Show local copy")},C=function(e){switch(e){case b.UploadFiles:return w._("Upload files");case b.UploadFolder:return w._("Upload folder");case b.Upload:return w._("Upload");case b.ViewTimeline:return w._("View Timeline");case b.Files:return w._("Files");case b.Folder:return w._("Folder");case b.NewPaperDoc:return w._("New Paper Document");case b.NewFolder:return w._("New folder");case b.RestoreFolder:return w._("Restore folder");case b.ReAddSharedFolder:return w._("Re-add shared folder");case b.ShowDeletedFiles:return w._("Show deleted files");case b.HideDeletedFiles:return w._("Hide deleted files");case b.NewSharedFolder:return w._("New shared folder");case b.ShareFolder:return w._("Share folder");case b.ManageAsAdmin:return w._("View in admin console");case b.NewTeamFolder:return w._("New team folder");case b.ShowLocalCopy:return P()}},D=function(e){return e in I||(I[e]=C(e)),I[e]},O=function(t,o,s,i,a,n){return function(){if("V1"===a)new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){e.OverquotaHelper.showSubgrowthProOQNewFolderModal({oqa:"wb_oq_ad_fo_fi"})});else{var u=s.currentNSID,_=s.currentFQPath;if(c.logCreateFolder({uid:t.id,view_type:o,file_nsid:u,file_path:_,file_name:l.filename(_)}),t.is_cdm_member&&"/"===_){F.assert(!!i,"All CDM Users should have an auto team group in their team");var f=function(e){y.Notify.error(e?e:w._("There was a problem completing this request.")),p.browseActions.cancelCreateFolder()},E=function(e){var t=e.user,r=e.folderName,o=e.fqPath;p.browseActions.createFolderComplete({user:t,folderName:r,changesets:null}),p.browseActions.selectFilesByFqPath({fqPathsToSelect:[o]}),n&&p.browseActions.handleNewFolderRedirectOnSuccess(o)};S.asyncShowAppropriateNewFolderModalForCdmUser({user:t,context:s,autoTeamGroupId:i,showFileSystemWarningsModal:d.showFileSystemWarningsModal,onPending:p.browseActions.createFolderPending,onComplete:E,onCancel:f,autoTeamGroupDefaultAccessLevel:m.ACCESS_LEVEL.WRITER,setPath:h.browseNavActions.setPath,setUrl:h.browseNavActions.setUrl})}else if(n){var T=function(e){var r=e.folderName,o=e.isConfidential;p.browseActions.createFolderInNewFolderModal({folderName:r,isConfidential:o,user:t,context:s})};S.asyncShowCdmNewFolderModal(T,t,s,!1,!1,!0)}else p.browseActions.nameNewFolder();"CONTROL"===a&&new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){e.OverquotaHelper.logExposureSubgrowthProOQNewFolderModal("CONTROL")})}}},N=function(e,t){return function(){p.browseActions.showTimeline()}},L=function(t,o,s){return function(){"V1"===s?new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){e.OverquotaHelper.showSubgrowthProOQNewFolderModal({oqa:"wb_oq_ad_shfo_fi"})}):o.isCurrentlyInRoot?S.asyncShowShareAFolderWizardModal(t):S.asyncShowShareModal(t,o,{origin:E.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS},h.browseNavActions.setPath,h.browseNavActions.setUrl),"CONTROL"===s&&new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){e.OverquotaHelper.logExposureSubgrowthProOQNewFolderModal("CONTROL")})}},x=function(e,t,r){return function(){c.logToggleDeletedFiles({uid:e.id,show_deleted_files:!r,view_type:t}),p.browseActions.setShouldShowDeletedFiles({shouldShowDeletedFiles:!r})}},M=function(e,t,r){return function(){var o=r.currentNSID,s=r.currentFQPath;c.logRestore({uid:e.id,view_type:t,file_nsid:o,file_path:s,file_name:l.filename(s),num_files_selected:0,num_folders_selected:1}),p.browseActions.doRestoreFilesWithUnifiedTrashModal({})}},B=function(e,t){return function(){var r=t.currentFQPath.toLowerCase(),o=t.inactiveNSIDByFQPath[r],s=t.isInsideDeletedNestedSharedFolder;o&&S.asyncMountSharedFolder(o,e.role,E.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS,!1,null,s)}},U=function(e,t){return function(){S.asyncGoToContentManagerForPath({isLimitedTeam:T.Viewer.get_viewer().team_is_limited,containingFolder:t.currentFQPath,isCDM:e.is_cdm_member})}},q=function(e,t){return function(){var r=t.currentNSID,o=t.currentNSPath,s=T.Viewer.get_viewer().team_id,i=g.get_uri().path;c.logOpenLocalCopyAction({event_name:"view_in_dropbox_link_clicked",team_id:s,url:i}),p.browseActions.openLocalCopy({nsId:r,nsPath:o,userId:e.id,onSuccess:function(){c.logOpenLocalCopyAction({event_name:"view_in_dropbox_client_open",team_id:s,url:i})},onError:function(e){c.logOpenLocalCopyAction({error_message:e,event_name:"view_in_dropbox_link_error",team_id:s,url:i}),y.Notify.error(w._("Please make sure you are logged into the same account on your Dropbox desktop app."))}})}};t.getGlobalActions=R}),define("modules/clean/react/browse/nav_actions",["require","exports","tslib","modules/clean/history","modules/clean/pagination_manager","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/files_view/types","modules/clean/react/browse/dispatcher","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/selection","modules/clean/web_timing_logger","modules/core/browser","modules/core/uri"],function(e,t,r,o,s,i,a,n,l,c,d,u,p,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),i=r.__importStar(i),p=r.__importStar(p),h=r.__importStar(h);var f=(function(){function e(e){var t=this;this.dataApi=e,this.setPath=function(e){var r=e.path,o=e.onPathLoaded,i=e.logFetchedDataRequiredForTTI,u=void 0!==i&&i,_=e.ajaxWebTimer,f=d.getBrowseStore(),m=f.user().id;l.BrowseDispatcher.dispatch({type:a.DEPRECATED__BrowseActionType.SET_PATH,data:{path:r}}),t.setLoadingState({loadingState:n.LoadingState.LOADING_FIRST_PAGE,path:r});var S=function(e){var r=e.path,i=e.data,a=e.xhr;if(u&&p.log_js_modules_fetched_data_required_for_tti(),_){var l=a.getResponseHeader("x-dropbox-request-id");_.end(l?l:void 0)}t.setMountPoints({mountPoints:i.ns_id_to_mount_point});var d=c.BrowseContext.fromServerObject(i);if(i.paginated){t.clear({path:r,context:d});var h=i.first_page.total_num_items;s.PaginationManager.create({firstPage:i.first_page,keyName:"sjid",ajaxURL:"/browse_get_next",userID:m,newDataAvailableCallback:function(e,o){var s=e.areAllItemsReady()?n.LoadingState.LOADED:n.LoadingState.LOADING_REMAINING_PAGES;t.addFilesAndSetLoadingState({path:r,files:o,paginatedTotalNumFiles:h,loadingState:s}),e.areAllItemsReady()&&e.stopAutoFetching()}}).startAutoFetching()}else{var S=i.file_info,E=S?S.length:0;t.load({path:r,files:S,paginatedTotalNumFiles:E,context:d})}o&&o(f.context())};t.dataApi.loadPath({sortLabel:f.sortLabel(),sortIsAscending:f.sortIsAscending(),path:r,userId:m,sortFoldersFirst:!h.mac,includeDeletedFiles:f.shouldShowDeletedFiles(),onSuccess:S,onError:function(){"/"!==r&&t.setPath({path:"/",onPathLoaded:o})}})}}return e.prototype.setUrl=function(e){var t=e.path,r=(e.qargs,{});"1"===o.default.deconstruct_url().qargs.d&&(r.d="1");var s=t?_.URI.encode_parts(t):"";o.default.push_state(d.getBrowseStore().urlPrefix()+s,r),l.BrowseDispatcher.dispatch({type:a.DEPRECATED_PRIVATE__BrowseActionType.SET_SELECTION,data:{selection:u.createSelection()}})},e.prototype.setLoadingState=function(e){var t=e.loadingState,r=e.path;l.BrowseDispatcher.dispatch({type:a.DEPRECATED__BrowseActionType.SET_LOADING_STATE,data:{loadingState:t,path:r}})},e.prototype.setMountPoints=function(e){var t=e.mountPoints;l.BrowseDispatcher.dispatch({type:a.DEPRECATED_PRIVATE__BrowseActionType.SET_MOUNT_POINTS,data:{mountPoints:t}})},e.prototype.load=function(e){var t=e.path,r=e.files,o=e.paginatedTotalNumFiles,s=e.context;l.BrowseDispatcher.dispatch({type:a.DEPRECATED__BrowseActionType.LOAD_PATH,data:{path:t,files:r,paginatedTotalNumFiles:o,context:s}})},e.prototype.clear=function(e){var t=e.path,r=e.context;l.BrowseDispatcher.dispatch({type:a.DEPRECATED__BrowseActionType.CLEAR_FILES,data:{path:t,context:r}})},e.prototype.addFilesAndSetLoadingState=function(e){var t=e.path,r=e.loadingState,o=e.files,s=e.paginatedTotalNumFiles;l.BrowseDispatcher.dispatch({type:a.DEPRECATED__BrowseActionType.ADD_FILES_AND_SET_LOADING_STATE,data:{path:t,loadingState:r,files:o,paginatedTotalNumFiles:s}})},e.prototype.setDataApi=function(e){this.dataApi=e},e})();t.BrowseNavActions=f,t.browseNavActions=new f(i)}),define("modules/clean/react/browse/professional_collection_actions",["require","exports","tslib","external/lodash","modules/core/exception"],function(e,t,r,o,s){"use strict";function i(t,i,a){var n=o.keyBy(a,"file_id");if(!o.every(t,function(e){return!!n[e]}))return void s.reportException({err:new Error("Could not find specified files to add to Showcase")});var l=t.map(function(e){var t=n[e];return{ns_id:t.ns_id,ns_path:t.ns_path,fq_path:t.fq_path}});new Promise(function(t,r){e(["modules/clean/react/professional_collection/add_to_collection_modal_controller"],t,r)}).then(r.__importStar).then(function(e){(0,e.showAddToCollectionModal)(l,i)})}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.showPrepopulatedAddToCollectionModal=i}),define("modules/clean/react/browse/sidebar",["require","exports","tslib","external/react","modules/clean/search/search_results/sidebar_view","modules/clean/react/browse/sidebar_view"],function(e,t,r,o,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.BrowseSidebar=function(e){var t=e.autoTeamGroupId,a=e.arePostTTIModulesLoaded,n=e.canDisplayFolderSizes,l=e.context,c=e.handleComponentTTI,d=e.isNoComment,u=e.isSearchMode,p=e.isTimelineVisible,h=e.selectedFiles,_=e.shouldShowDeletedFiles,f=e.starredState,m=e.user,S=e.viewType,E=e.uploaderExperiments,T=e.uploaderPostTTIExperiments,g=e.browseExperiments,F=e.browsePostTTIExperiments,w=e.uploadAjaxInterceptor,y=e.searchBarExperiments,v=e.actionHandlers,A=e.path,R=e.onSearch,b=e.onUploadButtonClick,I=e.onGetFileActionsForFiles,P=e.responsive,C=e.onSearchFiltersChanged,D=e.fileCategories,O=e.isNautilusEnabled,N=e.isPaperEnabled,L={user:m,selectedFiles:h,arePostTTIModulesLoaded:a,context:l,viewType:S,shouldShowDeletedFiles:_,responsive:P};return u?o.createElement(s.SearchResultsSidebarView,r.__assign({},L,{path:A,actionHandlers:v,searchBarExperiments:y,onSearch:R,onSearchFiltersChanged:C,fileCategories:D,isNautilusEnabled:O,isPaperEnabled:N})):o.createElement(i.BrowseSidebarView,r.__assign({},L,{isTimelineVisible:p,autoTeamGroupId:t,canDisplayFolderSizes:n,uploaderExperiments:E,uploaderPostTTIExperiments:T,browseExperiments:g,browsePostTTIExperiments:F,handleComponentTTI:c,onUploadButtonClick:b,isNoComment:d,onGetFileActionsForFiles:I,starredState:f,uploadAjaxInterceptor:w}))}}),define("modules/clean/react/browse/sidebar_view",["require","exports","tslib","external/react","modules/clean/react/app_actions_view","modules/clean/react/browse/global_actions","modules/clean/react/browse/util","modules/clean/react/file_uploader/file_uploader","modules/core/i18n"],function(e,t,r,o,s,i,a,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);var c=(function(t){function c(e){var r=t.call(this,e)||this;return r.state={appActionsProps:r.getCurrentAppActionsProps(r.props)},r}return r.__extends(c,t),c.prototype.componentWillReceiveProps=function(e){e.selectedFiles===this.props.selectedFiles&&e.context===this.props.context&&e.user===this.props.user&&e.shouldShowDeletedFiles===this.props.shouldShowDeletedFiles&&e.isNoComment===this.props.isNoComment&&e.arePostTTIModulesLoaded===this.props.arePostTTIModulesLoaded&&e.viewType===this.props.viewType&&e.starredState===this.props.starredState&&e.canDisplayFolderSizes===this.props.canDisplayFolderSizes&&e.uploadAjaxInterceptor===this.props.uploadAjaxInterceptor&&e.responsive.isMatchedMedium===this.props.responsive.isMatchedMedium&&e.responsive.isMatchedLarge===this.props.responsive.isMatchedLarge&&e.uploaderExperiments===this.props.uploaderExperiments&&e.uploaderPostTTIExperiments===this.props.uploaderPostTTIExperiments&&e.browseExperiments===this.props.browseExperiments&&e.browsePostTTIExperiments===this.props.browsePostTTIExperiments||this.setState({appActionsProps:this.getCurrentAppActionsProps(e)})},c.prototype.renderSingleSelectionAudienceBox=function(t){var r=t.selectedFiles,s=t.arePostTTIModulesLoaded,i=t.context,a=r.first();if(s){var n=e("modules/clean/react/browse/shared_with").SharedWithController;return o.createElement(n,{file:a,browseContext:i,isInAudienceBox:!0})}return null},c.prototype.getCurrentAppActionsProps=function(t){function r(e){return"function"==typeof e?e:{displayName:e.label,popoverMenuName:e.popoverLabel,iconName:e.iconName,handleClick:e.performAction,disabled:e.disabled,className:e.className,badge:e.badge}}var s,n=t.selectedFiles,c=t.autoTeamGroupId,d=t.context,u=t.canDisplayFolderSizes,p=t.onGetFileActionsForFiles,h=t.user,_=t.viewType,f=t.shouldShowDeletedFiles,m=t.onUploadButtonClick,S=t.isNoComment,E=t.browseExperiments,T=t.browsePostTTIExperiments,g=t.arePostTTIModulesLoaded,F=t.handleComponentTTI,w=t.responsive,y=a.getSelectedFilesText(n,d),v=n.count(),A=o.createElement("div",null);if(v>0)s=p(n,u,w,!0,!0),1===v&&(A=this.renderSingleSelectionAudienceBox(t));else if(s=i.getGlobalActions({arePostTTIModulesLoaded:g,context:d,user:h,viewType:_,showDeletedFiles:f,onUpload:m,isNoComment:S,autoTeamGroupId:c,browseExperiments:E,browsePostTTIExperiments:T}),g){var R=e("modules/clean/react/browse/shared_with").SharedWithController;A=o.createElement(R,{browseContext:d,isInAudienceBox:!0})}var b,I=s[0];if(I)if("function"==typeof I)b=I;else{var P=void 0;I.subItems&&(P=I.subItems.map(r)),b={displayName:I.label,iconName:I.iconName,handleClick:I.performAction,disabled:I.disabled,className:I.className,subItems:P}}var C=s.slice(1).map(r);return t.isNoComment&&(A=o.createElement("div",null)),{headerText:y,popoverTriggerLabel:l._("Actions"),primaryMenuItem:b,primarySubnode:A,secondaryMenuItems:C,handleComponentTTI:F}},c.prototype.maybeRenderBrowseFileUploader=function(){var e=this.props,t=e.context,r=e.viewType,s=e.uploadAjaxInterceptor,i=e.uploaderExperiments,a=e.uploaderPostTTIExperiments;return null!=t.currentFQPath?o.createElement(n.FileUploaderController,{key:"file-uploader-controller",ref:"fileUploader",loadOnRender:!1,needToSetStoreValues:!1,ajaxInterceptor:s,uploaderExperiments:i,uploaderPostTTIExperiments:a,browseViewType:r}):null},c.prototype.render=function(){return o.createElement("div",{className:"maestro-browse-action-sidebar"},this.maybeRenderBrowseFileUploader(),o.createElement(s.AppActionsView,r.__assign({},this.state.appActionsProps,{responsive:this.props.responsive})))},c})(o.PureComponent);t.BrowseSidebarView=c}),define("modules/clean/react/browse/store",["require","exports","tslib","modules/clean/filepath","external/immutable","modules/clean/react/browse/data/action_creators","modules/clean/react/browse/data/selectors","modules/clean/react/browse/data/store","modules/core/exception","modules/clean/react/browse/models","modules/clean/react/selection","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/files_view/constants","modules/clean/react/files_view/types"],function(e,t,r,o,s,i,a,n,l,c,d,u,p,h,_){"use strict";function f(){return null===E&&(E=new S),E}function m(){return null!==E}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),i=r.__importStar(i),a=r.__importStar(a),n=r.__importStar(n);var S=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._init=function(){this._reduxStore=n.getStoreForBrowse()},t.prototype.sortedFiles=function(){return a.sortedFiles(this._reduxStore.getState())},t.prototype.unsortedFiles=function(){return a.unsortedFiles(this._reduxStore.getState())},t.prototype.setUnsortedFiles=function(e){this._reduxStore.dispatch(i.setUnsortedFiles({unsortedFiles:e}))},t.prototype.files=function(){return a.sortedFilesWithFolderSizes(this._reduxStore.getState())},t.prototype.filesMap=function(){return a.unsortedFilesWithFolderSizes(this._reduxStore.getState())},t.prototype.filesWithoutTeamFolders=function(){return a.sortedFilesWithFoldersSizesWithoutTeamFolders(this._reduxStore.getState())},t.prototype.teamFolders=function(){return a.teamFolders(this._reduxStore.getState())},t.prototype.path=function(){return a.path(this._reduxStore.getState())},t.prototype.user=function(){return a.user(this._reduxStore.getState())},t.prototype.viewer=function(){return a.viewer(this._reduxStore.getState())},t.prototype.urlPrefix=function(){return a.urlPrefix(this._reduxStore.getState())},t.prototype.selection=function(){return a.selection(this._reduxStore.getState())},t.prototype.paginatedTotalNumFiles=function(){return a.paginatedTotalNumFiles(this._reduxStore.getState())},t.prototype.selectedFiles=function(){return a.selectedFiles(this._reduxStore.getState())},t.prototype.loadingState=function(){return a.loadingState(this._reduxStore.getState())},t.prototype.context=function(){return a.context(this._reduxStore.getState())},t.prototype.mountPoints=function(){return a.mountPoints(this._reduxStore.getState())},t.prototype.shouldShowDeletedFiles=function(){return a.shouldShowDeletedFiles(this._reduxStore.getState())},t.prototype.isTimelineVisible=function(){return a.isTimelineVisible(this._reduxStore.getState())},t.prototype.currentSort=function(){return a.sortOrder(this._reduxStore.getState())},t.prototype.sortIsAscending=function(){return this.currentSort().sortDirection===_.SortDirection.ASCENDING},t.prototype.sortLabel=function(){return h.SortIsFilename.includes(this.currentSort().sortField)?_.SortLabel.FILENAME:this.currentSort().sortField===_.SortField.MODIFIED?_.SortLabel.MODIFIED:_.SortLabel.SIZE},t.prototype.viewType=function(){return a.viewType(this._reduxStore.getState())},t.prototype.viewTypeColumns=function(){return a.viewTypeColumns(this._reduxStore.getState())},t.prototype.getIndexOfFile=function(e){return this.sortedFiles().findIndex(function(t){return t.sjid===e.sjid&&t.ns_id===e.ns_id})},t.prototype.getFileByFilename=function(e){return this.sortedFiles().find(function(t){return o.filename(t.fq_path)===e})||null},t.prototype.getFileByFullPath=function(e){return this.sortedFiles().find(function(t){return t.fq_path===e})||null},t.prototype.clipboardFiles=function(){return a.clipboardFiles(this._reduxStore.getState())},t.prototype.newFolderCreationState=function(){return a.newFolderCreationState(this._reduxStore.getState())},t.prototype.isFileJumping=function(){return a.isFileJumping(this._reduxStore.getState())},t.prototype.canDisplayFolderSizes=function(){return a.canDisplayFolderSizes(this._reduxStore.getState())},t.prototype.isQueryingFolderSizes=function(){return a.isQueryingFolderSizes(this._reduxStore.getState())},t.prototype.experiments=function(){return a.experiments(this._reduxStore.getState())},t.prototype.postTTIExperiments=function(){return a.postTTIExperiments(this._reduxStore.getState())},t.prototype.filePathsToSelectOnNextUpdate=function(){return a.filePathsToSelectOnNextUpdate(this._reduxStore.getState())},t.prototype.folderSizes=function(){return a.folderSizes(this._reduxStore.getState())},t.prototype.activeFileJumpFilter=function(){return a.fileJumpFilter(this._reduxStore.getState())},t.prototype.initializeEverything=function(e){var t=e.path,r=e.files,o=e.paginatedTotalNumFiles,s=e.context,a=e.mountPoints,n=e.fqPathsToSelect,l=e.loadingState,c=e.teamFolders;this.setPath({path:t}),this.appendFiles({path:t,files:r.concat(c),paginatedTotalNumFiles:o},!1),this.setMountPoints({mountPoints:a}),this.setLoadingState({path:t,loadingState:l}),l===_.LoadingState.LOADED?this.selectFqPaths({fqPathsToSelect:n},!1):this.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:n}),this._reduxStore.dispatch(i.setContext({context:s})),this.emit_change()},t.prototype.appInit=function(e){var t=e.experiments,r=e.shouldShowDeletedFiles,o=e.user,s=e.viewer;this._reduxStore.dispatch(i.appInit({experiments:t,shouldShowDeletedFiles:r,user:o,viewer:s})),this._reduxStore.dispatch(i.restoreViewType()),this._reduxStore.dispatch(i.restoreViewTypeColumns()),this._reduxStore.dispatch(i.restoreSortOrder())},t.prototype.setPathData=function(e,t){var r=e.path,s=e.files,a=e.paginatedTotalNumFiles,n=e.context;void 0===t&&(t=!0),o.paths_are_equal(r,this.path())&&(this.setUnsortedFiles(this.unsortedFiles().clear()),this._reduxStore.dispatch(i.setSelection({selection:d.createSelection()})),this.appendFiles({path:r,files:s,paginatedTotalNumFiles:a},!1),this._reduxStore.dispatch(i.setContext({context:n})),t&&this.emit_change())},t.prototype.clearFiles=function(e){var t=e.path,r=e.context;o.paths_are_equal(t,this.path())&&(this.setUnsortedFiles(this.unsortedFiles().clear()),this._reduxStore.dispatch(i.setSelection({selection:d.createSelection()})),this._reduxStore.dispatch(i.setPaginatedTotalNumFiles({paginatedTotalNumFiles:0})),this._reduxStore.dispatch(i.setContext({context:r})),this.emit_change())},t.prototype.appendFiles=function(e,t){var r=e.path,a=e.files,n=e.paginatedTotalNumFiles;if(void 0===t&&(t=!0),o.paths_are_equal(r,this.path())){for(var d=[],u=[],p=0,h=a;p<h.length;p++){var _=h[p],f=_ instanceof c.File?_:c.File.fromServerObject(_);d.push([_.fq_path,f]),this.unsortedFiles().has(_.fq_path)||u.push(f)}var m=this.unsortedFiles().size;this.setUnsortedFiles(this.unsortedFiles().merge(s.Map(d))),this.unsortedFiles().size!==m+a.length&&l.reportException({err:new Error("appendFiles ended up with unexpected number of files."),tags:["browse_file_collections_mismatch"],severity:l.SEVERITY.CRITICAL,exc_extra:{previous_unsorted_files_size:m,incoming_files_size:a.length,updated_unsorted_files_size:this.unsortedFiles().size,is_deleted_files_on:this.shouldShowDeletedFiles()}}),this.filePathsToSelectOnNextUpdate().count()&&this.selectFqPaths({fqPathsToSelect:this.filePathsToSelectOnNextUpdate().toArray()},!1),this._reduxStore.dispatch(i.setPaginatedTotalNumFiles({paginatedTotalNumFiles:n})),t&&this.emit_change()}},t.prototype.applyFileDeltas=function(e){var t=e.path,r=e.fileDeltas;if(o.paths_are_equal(t,this.path())){for(var s=this.unsortedFiles().size,i=0,a=r;i<a.length;i++){var n=a[i],c=n.before,d=n.after;!c&&d&&(s+=1),c&&!d&&(s-=1),this.applyFileDelta({before:c,after:d,pathForDelta:t})}if(this.filePathsToSelectOnNextUpdate().size){this.selectFqPaths({fqPathsToSelect:this.filePathsToSelectOnNextUpdate().toArray()},!1).size===this.filePathsToSelectOnNextUpdate().size&&this.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:[]})}this.unsortedFiles().size!==s&&l.reportException({err:new Error("applyFileDeltas ended up with unexpected number of items"),tags:["browse_file_collections_mismatch"],severity:l.SEVERITY.CRITICAL,exc_extra:{expected_unsorted_files_size:s,actual_unsorted_files_size:this.unsortedFiles().size,is_deleted_files_on:this.shouldShowDeletedFiles(),fileDeltas:r}}),this.emit_change()}},t.prototype.setPath=function(e){var t=e.path;this._reduxStore.dispatch(i.setPath({path:t})),this.emit_change()},t.prototype.setLoadingState=function(e){var t=e.path,r=e.loadingState;this._reduxStore.dispatch(i.setLoadingState({loadingState:r,path:t})),this.emit_change()},t.prototype.setMountPoints=function(e){var t=e.mountPoints;this._reduxStore.dispatch(i.setMountPoints({mountPoints:t}))},t.prototype.setSelection=function(e){var t=e.selection;this._reduxStore.dispatch(i.setSelection({selection:t})),this.emit_change()},t.prototype.selectFilesAfterUpload=function(e){var t=this,r=e.fqPathsToSelect;r.every(function(e){return t.filesMap().has(e)})?this.selectFqPaths({fqPathsToSelect:r}):this.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:r})},t.prototype.selectFqPaths=function(e,t){var r=e.fqPathsToSelect;return void 0===t&&(t=!0),this._reduxStore.dispatch(i.selectFilesByFqPath({fqPathsToSelect:r})),t&&this.emit_change(),this.selection().selected},t.prototype.setShouldShowDeletedFiles=function(e){var t=e.shouldShowDeletedFiles;this._reduxStore.dispatch(i.setShouldShowDeletedFiles({shouldShowDeletedFiles:t})),this.emit_change()},t.prototype.setViewType=function(e){var t=e.viewType,r=e.isSearchMode;this._reduxStore.dispatch(i.setAndStoreViewType({viewType:t,isSearchMode:!!r})),this.emit_change()},t.prototype.setColumnDependentCapabilities=function(e){var t=e.canDisplayFolderSizes;this.canDisplayFolderSizes()!==t&&(this._reduxStore.dispatch(i.setCanDisplayFolderSizes({canDisplayFolderSizes:t})),this.emit_change())},t.prototype.setColumnConfiguration=function(e){var t=e.columns,r=e.viewType,o=e.canDisplayFolderSizes;this._reduxStore.dispatch(i.setAndStoreViewTypeColumns({columns:t,viewType:r})),this._reduxStore.dispatch(i.setCanDisplayFolderSizes({canDisplayFolderSizes:o})),this.emit_change()},t.prototype.sortFiles=function(e,t){void 0===t&&(t=!0),this._reduxStore.dispatch(i.setAndStoreSortOrder({sortOrder:e})),t&&this.emit_change()},t.prototype.setNewFolderCreationState=function(e){this._reduxStore.dispatch(i.setNewFolderCreationState({newFolderCreationState:e})),this.emit_change()},t.prototype.setFilePathsToSelectOnNextUpdate=function(e){var t=e.fqPathsToSelect,r=void 0===t?[]:t;this._reduxStore.dispatch(i.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:s.Set(r)}))},t.prototype.showTimeline=function(){this._reduxStore.dispatch(i.showTimeline()),this.emit_change()},t.prototype.hideTimeline=function(){this._reduxStore.dispatch(i.hideTimeline()),this.emit_change()},t.prototype.setBrowsePostTTIExperiments=function(e){var t=e.browsePostTTIExperiments;this._reduxStore.dispatch(i.setBrowsePostTTIExperiments({browsePostTTIExperiments:t})),this.emit_change()},t.prototype.addFileJumpKeyCode=function(e){var t=e.keyChar;this._reduxStore.dispatch(i.addFileJumpKeyCode({keyChar:t})),this.emit_change()},t.prototype.resetFileJump=function(){this._reduxStore.dispatch(i.setFileJumpFilter({fileJumpFilter:""}))},t.prototype.applyFileDelta=function(e){var t=e.before,r=e.after,s=e.pathForDelta;if(r&&!o.paths_are_equal(o.parent_dir(r.fq_path),s)&&(r=null),r!==t){var i=r&&this.unsortedFiles().get(r.fq_path);if(!(i&&i.sjid>=r.sjid)){if(a.fileRename(this._reduxStore.getState())&&r&&t){var n=this.folderSizes().get(t.fq_path);n&&this.setFolderSizes(this.folderSizes().set(r.fq_path,{size:n.size,state:n.state}))}return t&&this.setFolderSizes(this.folderSizes().delete(t.fq_path)),r&&t?this.replaceFile({existingFile:t,newFile:r}):r&&!t?this.insertOrUpdateFile({file:r}):t&&!r?this.removeFile({file:t}):void 0}}},t.prototype.insertOrUpdateFile=function(e){var t=e.file;this.setUnsortedFiles(this.unsortedFiles().set(t.fq_path,t))},t.prototype.removeFile=function(e){var t=e.file;l.assert(this.unsortedFiles().has(t.fq_path),"trying to remove a file that doesn't exist in the file map"),this.setUnsortedFiles(this.unsortedFiles().delete(t.fq_path))},t.prototype.replaceFile=function(e){function t(e){return e.fq_path.toLowerCase()===s}var r=e.existingFile,o=e.newFile;l.assert(this.unsortedFiles().has(r.fq_path),"tried to replace file, but previous file doesn't exist in map");var s=r.fq_path.toLowerCase(),n=this.sortedFiles().findEntry(t),c=n?n[0]:-1;if(l.assert(c!==-1,"tried to update file, but previous file doesn't exist in sorted list"),r.fq_path===o.fq_path)this.setUnsortedFiles(this.unsortedFiles().set(r.fq_path,o));else{this.setUnsortedFiles(this.unsortedFiles().delete(r.fq_path).set(o.fq_path,o));var d=a.fileRename(this._reduxStore.getState());d&&d.state===_.RenameState.SAVING_INPUT&&(this._reduxStore.dispatch(i.setFileRename({file:r,renameState:null})),this.selectFqPaths({fqPathsToSelect:[o.fq_path]}))}},t.prototype.requestFolderSizes=function(e){this._reduxStore.dispatch(i.requestFolderSizes({fqPath:e})),this.emit_change()},t.prototype.setFolderSizesPending=function(e){this._reduxStore.dispatch(i.setFolderSizesPending({fetchFolderSizesResp:e})),this.emit_change()},t.prototype.completeFolderSizes=function(e){this._reduxStore.dispatch(i.completeFolderSizes({fetchFolderSizeState:e})),this.emit_change()},t.prototype.setFolderSizes=function(e){this._reduxStore.dispatch(i.setFolderSizes({folderSizes:e}))},t.prototype._new_payload=function(e){var t=e.action;switch(t.type){case p.DEPRECATED__BrowseActionType.APP_INIT:this.appInit(t.data);break;case p.DEPRECATED__BrowseActionType.INITIALIZE_EVERYTHING:this.initializeEverything(t.data);break;case p.DEPRECATED__BrowseActionType.LOAD_PATH:this.setPathData(t.data,!1),this.setLoadingState({path:t.data.path,loadingState:_.LoadingState.LOADED});break;case p.DEPRECATED__BrowseActionType.CLEAR_FILES:this.clearFiles(t.data);break;case p.DEPRECATED__BrowseActionType.ADD_FILES_AND_SET_LOADING_STATE:this.appendFiles(t.data,!1),this.setLoadingState(t.data);break;case p.DEPRECATED__BrowseActionType.SET_PATH:this.setPath(t.data);break;case p.DEPRECATED__BrowseActionType.CHANGE_FILES:this.applyFileDeltas(t.data);break;case p.DEPRECATED_PRIVATE__BrowseActionType.SET_SELECTION:this.setSelection(t.data);break;case p.DEPRECATED_PRIVATE__BrowseActionType.SELECT_FILES_AFTER_UPLOAD:this.selectFilesAfterUpload(t.data);break;case p.DEPRECATED_PRIVATE__BrowseActionType.SELECT_FILES_BY_FQ_PATH:this.selectFqPaths(t.data);break;case p.DEPRECATED__BrowseActionType.SET_LOADING_STATE:this.setLoadingState(t.data);break;case p.DEPRECATED_PRIVATE__BrowseActionType.SET_MOUNT_POINTS:this.setMountPoints(t.data);break;case p.DEPRECATED_PRIVATE__BrowseActionType.SET_SHOULD_SHOW_DELETED_FILES:this.setShouldShowDeletedFiles(t.data);break;case p.DEPRECATED_PRIVATE__BrowseActionType.SET_VIEW_TYPE:this.setViewType(t.data);break;case p.DEPRECATED__BrowseActionType.SORT_FILES:this.sortFiles(t.data);break;case p.DEPRECATED_PRIVATE__BrowseActionType.REQUEST_FOLDER_NAME:this.setNewFolderCreationState(_.NewFolderCreationState.PENDING_INPUT);break;case p.DEPRECATED_PRIVATE__BrowseActionType.CREATE_FOLDER_PENDING:this.setNewFolderCreationState(_.NewFolderCreationState.SAVING_INPUT);break;case p.DEPRECATED_PRIVATE__BrowseActionType.CREATE_FOLDER_COMPLETE:case p.DEPRECATED_PRIVATE__BrowseActionType.CANCEL_CREATE_FOLDER:this.setNewFolderCreationState(_.NewFolderCreationState.CREATE_FOLDER_INACTIVE);break;case p.DEPRECATED_PRIVATE__BrowseActionType.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE:this.setFilePathsToSelectOnNextUpdate(t.data);break;case p.DEPRECATED_PRIVATE__BrowseActionType.ADD_FILE_JUMP_KEY_CODE:this.addFileJumpKeyCode(t.data);break
;case p.DEPRECATED_PRIVATE__BrowseActionType.RESET_FILE_JUMP:this.resetFileJump();break;case p.DEPRECATED_PRIVATE__BrowseActionType.REQUEST_FETCH_FOLDER_SIZES:this.requestFolderSizes(t.data.fqPath);break;case p.DEPRECATED_PRIVATE__BrowseActionType.FETCHED_FOLDER_SIZES:this.setFolderSizesPending(t.data.resp);break;case p.DEPRECATED_PRIVATE__BrowseActionType.COMPLETE_FETCH_FOLDER_SIZES:this.completeFolderSizes(t.data.state);break;case p.DEPRECATED_PRIVATE__BrowseActionType.SET_COLUMN_DEPENDENT_CAPABILITIES:this.setColumnDependentCapabilities(t.data);break;case p.DEPRECATED_PRIVATE__BrowseActionType.SET_COLUMN_CONFIGURATION:this.setColumnConfiguration(t.data);break;case p.DEPRECATED_PRIVATE__BrowseActionType.SHOW_TIMELINE:this.showTimeline();break;case p.DEPRECATED_PRIVATE__BrowseActionType.HIDE_TIMELINE:this.hideTimeline();break;case p.DEPRECATED_PRIVATE__BrowseActionType.SET_BROWSE_POST_TTI_EXPERIMENTS:this.setBrowsePostTTIExperiments(t.data)}},t})(u.Store);t.BrowseStore=S;var E=null;t.getBrowseStore=f,t.browseStoreInstantiated=m}),define("modules/clean/react/browse/title",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/browse_uri_interface","modules/clean/filepath","modules/clean/react/file_uploader/file_uploader","modules/clean/viewer","modules/clean/react/maestro/header","modules/clean/react/path_breadcrumbs"],function(e,t,r,o,s,i,a,n,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),a=r.__importStar(a);var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleGetUrlForPath=function(e){return i.browse_uri_for_fq_path(t.props.user,e).toString()},t}return r.__extends(t,e),t.setPageTitle=function(e){e&&(document.title=s._("%(folder_name)s - Dropbox").format({folder_name:a.filename(e,s._("Files"))}))},t.prototype.componentDidMount=function(){t.setPageTitle(this.props.path)},t.prototype.componentWillReceiveProps=function(e){e.path!==this.props.path&&t.setPageTitle(e.path)},t.prototype.render=function(){var e=this.props,t=e.path,r=e.user,i=e.isDraggingInternalFiles,u=e.isDraggingExternalFiles,p=e.isUploadModalOpen,h=e.isSearchMode,_=e.onSetUrl;if(h)return o.createElement(c.MaestroHeaderTitle,null,s._("Search results"));var f=a.filename("",l.Viewer.get_root_name(r)),m="work"===r.role?s._("Work"):s._("Personal");return o.createElement(d.PathBreadcrumbs,{path:t,isDraggingInternalFiles:i,setFileUploaderPath:n.FileUploaderController.setPathAndPermissions,getUrlForPath:this.handleGetUrlForPath,firstBreadcrumbName:f,firstBreadcrumbAlt:m,shouldHighlightDropTargets:i||u&&!p,setUrl:_})},t})(o.PureComponent);t.BrowseTitle=u}),define("modules/clean/react/browse/web_team_sharing_experiment",["require","exports","tslib","external/react","modules/clean/react/file_uploader/constants","modules/clean/react/async_fileops_modals","modules/clean/analytics","external/immutable","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],function(e,t,r,o,s,i,a,n,l,c){"use strict";var d=this;Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),i=r.__importStar(i),n=r.__importStar(n);var u=l.Loadable({loader:function(){return r.__awaiter(d,void 0,void 0,function(){var t;return r.__generator(this,function(o){switch(o.label){case 0:return[4,c.waitForTTI()];case 1:return o.sent(),[4,new Promise(function(t,r){e(["modules/clean/react/web_team_sharing_modal"],t,r)}).then(r.__importStar)];case 2:return t=o.sent().WebTeamSharingModal,[2,t]}})})}}),p=(function(t){function l(e){var r=t.call(this,e)||this;return r.removeUploadListener=function(){window.removeEventListener(s.ALL_UPLOADS_COMPLETE_EVENT,r.handleUploadsComplete)},r.closeTeamSharingModal=function(){return r.setState({isWebTeamSharingModalOpen:!1})},r.openFileMoveDialog=function(){r.closeTeamSharingModal(),a.TeamsWebActionsLogger.log("post_m1_sharing_modal_clicked"),i.showMove({files:r.props.selectedFiles.toArray(),path:r.props.context.currentFQPath,user:r.props.user})},r.state={isWebTeamSharingModalOpen:!1,uploadedFiles:[],expWebSharingActive:!1},r}return r.__extends(l,t),l.prototype.componentWillReceiveProps=function(t){return r.__awaiter(this,void 0,void 0,function(){var o,i,a,n=this;return r.__generator(this,function(l){switch(l.label){case 0:return!t.browsePostTTIExperiments.expBizAddFilesTeamFolderRwls||this.handleUploadsComplete?[3,2]:[4,new Promise(function(t,r){e(["modules/clean/growth/experiments/web_sharing_helper"],t,r)}).then(r.__importStar)];case 1:o=l.sent(),i=o.logExposure,a=o.shouldShowModal,this.handleUploadsComplete=function(e){if(a(n.props.user,n.props.path)){i();var t=e.detail.files;n.setState({isWebTeamSharingModalOpen:!0,uploadedFiles:t,expWebSharingActive:!0})}},window.addEventListener(s.ALL_UPLOADS_COMPLETE_EVENT,this.handleUploadsComplete),l.label=2;case 2:return[2]}})})},l.prototype.componentWillUnmount=function(){this.handleUploadsComplete&&this.removeUploadListener()},l.prototype.render=function(){return this.state.expWebSharingActive?o.createElement(u,{context:this.props.context,files:this.state.uploadedFiles,handleModalClose:this.closeTeamSharingModal,handleAction:this.openFileMoveDialog,open:this.state.isWebTeamSharingModalOpen,user:this.props.user}):null},l.defaultProps={selectedFiles:n.OrderedMap()},l})(o.PureComponent);t.WebTeamSharingModalExperiment=p}),define("modules/clean/react/file_uploader/action_logger",["require","exports","tslib","modules/clean/filepath","modules/clean/web_upload_action_logger","modules/clean/web_user_action_logger","modules/clean/web_user_action_events"],function(e,t,r,o,s,i,a){"use strict";function n(e){return e&&!!e.uploadId}function l(e){return e&&!!e.batchId}function c(e){return e===a.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK||e===a.WebUserActionLogEvent.ADD_MORE_FILES_CLICK||e===a.WebUserActionLogEvent.VIEW_DETAILS_CLICK||e===a.WebUserActionLogEvent.CLOSE_MODAL_CLICK||e===a.WebUserActionLogEvent.DISMISS_INLINE_STATUS||e===a.WebUserActionLogEvent.UPLOAD_CLICK||e===a.WebUserActionLogEvent.UPLOAD_FILES_CLICK||e===a.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK||e===a.WebUserActionLogEvent.CANCEL_UPLOAD_CLICK}function d(e,t,a,d,u,p,h){var _={num_files:p,num_dirs:h,chooser_type:d,upload_method:u};if(n(a)){var f=a;_=r.__assign({},_,{upload_id:f.uploadId,file_size:f.size,file_extension:o.file_extension(f.name),failure_reason:f.errorType,batch_id:f.batchId})}else if(l(a)){var f=a;_=r.__assign({},_,{file_size:f.size,file_extension:o.file_extension(f.name),batch_id:f.batchId})}c(t)?i.WebUserActionLog.log(e,t,_):(t=t,_.client_timestamp=Math.round(Date.now()/1e3),s.WebUploadActionLog.log(e,t,_))}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.logUploadAction=d}),define("modules/clean/react/file_uploader/constants",["require","exports","tslib","external/immutable"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);(function(e){e.SET_PATH="UPLOADER_SET_PATH",e.SET_FOLDER_NS_ID="UPLOADER_SET_FOLDER_NS_ID",e.SET_USER="UPLOADER_SET_USER",e.SET_NUM_DRAGGING_FILES="SET_NUM_DRAGGING_FILES",e.QUEUE_UPLOADS="QUEUE_UPLOADS",e.START_UPLOAD="START_UPLOAD",e.COMPLETE_UPLOAD="COMPLETE_UPLOAD",e.CANCEL_UPLOADS="CANCEL_UPLOADS",e.SET_CURRENT_UPLOAD_PROGRESS="SET_CURRENT_UPLOAD_PROGRESS",e.UPLOAD_ERROR="UPLOAD_ERROR",e.SET_IS_UPLOAD_MODAL_OPEN="SET_IS_UPLOAD_MODAL_OPEN",e.SET_INLINE_STATUS_SHOULD_BE_DISMISSED="SET_INLINE_STATUS_SHOULD_BE_DISMISSED",e.ADD_NEW_FAILED_FILE="ADD_NEW_FAILED_FILE",e.CONFIRM_FSW="CONFIRM_FSW",e.ADD_FILES_TO_PLU="ADD_FILES_TO_PLU",e.ADD_DIRECTORIES_TO_PLU="ADD_DIRECTORIES_TO_PLU",e.REMOVE_FILES="REMOVE_FILES"})(t.UploaderActionType||(t.UploaderActionType={}));var s;(function(e){e.PENDING="PENDING",e.UPLOADING="UPLOADING",e.COMPLETE="COMPLETE",e.CANCELLED="CANCELLED",e.FAILED="FAILED"})(s=t.FileStatusType||(t.FileStatusType={}));var i;(function(e){e.FILE_SIZE_ERROR="FILE_SIZE_ERROR",e.HTTP_ERROR="HTTP_ERROR",e.CONNECTION_ERROR="CONNECTION_ERROR",e.OVER_QUOTA_ERROR="OVER_QUOTA_ERROR",e.LOCKED_TEAM_ERROR="LOCKED_TEAM_ERROR",e.IGNORED="IGNORED",e.EMPTY_OR_FOLDER="EMPTY_OR_FOLDER",e.FOLDER_SAFARI="FOLDER_SAFARI",e.PACKAGE_FILE="PACKAGE_FILE",e.GENERIC="GENERIC",e.BLOCKS_MISSING_ERROR="BLOCKS_MISSING_ERROR",e.COMMIT_HTTP_ERROR="COMMIT_HTTP_ERROR",e.UPLOAD_BLOCK_ERROR="UPLOAD_BLOCK_ERROR",e.CHUNKS_NOT_ENABLED_ERROR="CHUNKS_NOT_ENABLED_ERROR",e.SERVER_RESPONSE_ERROR="SERVER_RESPONSE_ERROR",e.SERVER_TOKEN_EMPTY_ERROR="SERVER_TOKEN_EMPTY_ERROR",e.SERVER_TOKENS_MISSING_ERROR="SERVER_TOKENS_MISSING_ERROR",e.SERVER_HASH_RESPONSE_ERROR="SERVER_HASH_RESPONSE_ERROR",e.BLOCK_RUNTIME_ID_MISSING_ERROR="BLOCK_RUNTIME_ID_MISSING",e.CLIENT_HASH_EMPTY_ERROR="CLIENT_HASH_EMPTY_ERROR",e.SERVER_HASH_EMPTY_ERROR="SERVER_HASH_EMPTY_ERROR",e.HASHES_NOT_EQUAL_ERROR="HASHES_NOT_EQUAL_ERROR",e.BLOCK_INDEX_ERROR="BLOCK_INDEX_ERROR",e.BLOCK_EMPTY_ERROR="BLOCK_EMPTY_ERROR",e.BLOB_EMPTY_ERROR="BLOB_EMPTY_ERROR",e.BLOB_MISSING_ERROR="BLOB_MISSING_ERROR",e.CLIENT_HASH_DIGEST_ERROR="CLIENT_HASH_DIGEST_ERROR",e.FILE_READER_NULL_RESULT_ERROR="FILE_READER_NULL_RESULT_ERROR",e.COMMIT_READINESS_ERROR="COMMIT_READINESS_ERROR",e.UPLOAD_PRECHECK_ERROR="UPLOAD_PRECHECK_ERROR"})(i=t.UploadErrorType||(t.UploadErrorType={}));(function(e){e.NONE="NONE",e.BASIC_OVER_QUOTA="BASIC_OVER_QUOTA",e.BASIC_NEAR_QUOTA="BASIC_NEAR_QUOTA",e.LIMITED_TEAM_USER_OVER_QUOTA="LIMITED_TEAM_USER_OVER_QUOTA",e.LIMITED_TEAM_TSD_OVER_QUOTA="LIMITED_TEAM_TSD_OVER_QUOTA",e.LOCKED_TEAM_USER_OVER_QUOTA="LOCKED_TEAM_USER_OVER_QUOTA"})(t.OverQuotaStatusType||(t.OverQuotaStatusType={}));var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t})(o.Record({uploadId:void 0,dest:"",ns_id:null,ns_path:null,userId:null,name:"",size:0,percentUploaded:0,status:s.PENDING,errorType:i.GENERIC,errorMessage:"",batchId:void 0},"FileUpload"));t.FileUpload=a,t.UPLOAD_BEGIN_EVENT="dbxUploadBegin",t.UPLOAD_CANCEL_EVENT="dbxUploadCancel",t.UPLOAD_COMPLETE_EVENT="dbxUploadComplete",t.ALL_UPLOADS_COMPLETE_EVENT="dbxAllUploadsComplete",t.UPLOAD_ERROR_EVENT="dbxUploadError";(function(e){e[e["4mb"]=0]="4mb",e[e["8mb"]=1]="8mb"})(t.ValidChunkSizeStrings||(t.ValidChunkSizeStrings={}))}),define("modules/clean/react/file_uploader/store",["require","exports","tslib","external/immutable","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/utils","modules/core/exception"],function(e,t,r,o,s,i,a,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._init=function(){this._path="/",this._hasPermissionToUploadToFolder=!0,this._folderNsId=null,this._user=null,this._fileList=o.OrderedMap(),this._currentUploadId=null,this._numDraggingFiles=0,this._isInternalTransfer=!1,this._isUploadModalOpen=!1,this._inlineStatusShouldBeDismissed=!1,this._numSecondsLeft=0,this._confirmedFSWs=[],this._confirmedFSWBatchIds=[]},t.prototype.fileList=function(){return this._fileList},t.prototype.currentUpload=function(){var e=this._currentUploadId;if(!e)return null;var t=this._fileList.get(e);return t?t:null},t.prototype.numSecondsLeft=function(){return this._numSecondsLeft},t.prototype.isUploadCancelled=function(e){var t=this._fileList.get(e);return!!t&&t.status===a.FileStatusType.CANCELLED},t.prototype.inlineStatusShouldBeDismissed=function(){return this._inlineStatusShouldBeDismissed},t.prototype.path=function(){return this._path},t.prototype.folderNsId=function(){return this._folderNsId},t.prototype.hasPermissionToUploadToFolder=function(){return this._hasPermissionToUploadToFolder},t.prototype.user=function(){return this._user},t.prototype.nextUpload=function(){return this._fileList.find(function(e){return e.status===a.FileStatusType.PENDING})},t.prototype.numDraggingFiles=function(){return this._numDraggingFiles},t.prototype.isInternalTransfer=function(){return this._isInternalTransfer},t.prototype.isUploadModalOpen=function(){return this._isUploadModalOpen},t.prototype.confirmedFSWs=function(){return this._confirmedFSWs},t.prototype.confirmedFSWBatchIds=function(){return this._confirmedFSWBatchIds},t.prototype.setUser=function(e){var t=e.user;this._user=t,this.emit_change()},t.prototype.setPathData=function(e){var t=e.path,r=e.context;this._path=t,this._hasPermissionToUploadToFolder=r.isCurrentPathWriteable(),this.emit_change()},t.prototype.setPath=function(e){var t=e.path,r=e.hasPermissionToUploadToFolder,o=void 0===r||r;this._path=t,this._hasPermissionToUploadToFolder=o,this._confirmedFSWs=[],this.emit_change()},t.prototype.setFolderNsId=function(e){var t=e.folderNsId;this._folderNsId=t},t.prototype.initializeEverything=function(e){var t=e.path,r=e.context;this._path=t,this._hasPermissionToUploadToFolder=r.isCurrentPathWriteable(),this.emit_change()},t.prototype.queueUploads=function(e){for(var t=e.files,r={},o=0,s=t;o<s.length;o++){var i=s[o];r[i.uploadId]=i}this._fileList=this._fileList.merge(r),this.emit_change()},t.prototype.startUpload=function(e){var t=e.file;l.assert(null==this.currentUpload(),"can't start an unload while one is ongoing"),l.assert(null!=t,"missing file to upload"),l.assert(this._fileList.get(t.uploadId)===t,"failed to find file in file list"),this._fileList.get(t.uploadId)&&(this._fileList=this._fileList.update(t.uploadId,function(e){return e.set("status",a.FileStatusType.UPLOADING)}),this._currentUploadId=t.uploadId),this.emit_change()},t.prototype.completeUpload=function(e){var t=e.uploadId,r=this._fileList.get(t);r&&(t===this._currentUploadId&&r.status===a.FileStatusType.UPLOADING||l.reportStack("Tried to mark a file upload that is not currently uploading as complete",{exc_extra:{file:r.toString(),fileListLength:this._fileList.count(),uploadId:t,currentUploadId:this._currentUploadId}}),this._fileList=this._fileList.update(t,function(e){return e.set("status",a.FileStatusType.COMPLETE)})),this._currentUploadId=null,this.emit_change()},t.prototype.cancelUploads=function(e){for(var t=e.files,r=0,o=t;r<o.length;r++){var s=o[r];this._fileList=this._fileList.update(s.uploadId,function(e){return e.status===a.FileStatusType.PENDING||e.status===a.FileStatusType.UPLOADING?e.set("status",a.FileStatusType.CANCELLED):e}),s.uploadId===this._currentUploadId&&(this._currentUploadId=null)}this.emit_change()},t.prototype.setCurrentUploadProgress=function(e){var t=e.percentComplete,r=e.numSecondsLeft,o=this._currentUploadId;o&&(this._fileList=this._fileList.update(o,function(e){return e.set("percentUploaded",t)}),this._numSecondsLeft=r),this.emit_change()},t.prototype.handleUploadError=function(e){var t=e.uploadId,r=e.errorType,o=e.errorMessage,s=this._fileList.get(t);s&&(s.uploadId!==this._currentUploadId&&l.reportStack("Error reported for file upload that is not the current upload",{exc_extra:{file:s.toString(),fileListLength:this._fileList.count(),errorType:r,errorMessage:o}}),this._fileList=this._fileList.update(s.uploadId,function(e){return e.set("status",a.FileStatusType.FAILED).set("errorType",r).set("errorMessage",o)})),this._currentUploadId=null,this.emit_change()},t.prototype.setNumDraggingFiles=function(e){var t=e.numDraggingFiles,r=e.isInternalTransfer,o=void 0!==r&&r;this._numDraggingFiles=t,this._isInternalTransfer=o,this.emit_change()},t.prototype.setIsUploadModalOpen=function(e){var t=e.isUploadModalOpen;this._isUploadModalOpen=t,this.emit_change()},t.prototype.setInlineStatusShouldBeDismissed=function(e){var t=e.inlineStatusShouldBeDismissed;this._inlineStatusShouldBeDismissed=t,this.emit_change()},t.prototype.addNewFailedFile=function(e){var t=e.file,r=e.errorType,o=e.errorMessage;null==t.uploadId&&(t=t.set("uploadId",n.generateUploadId())),t=t.set("status",a.FileStatusType.FAILED).set("errorType",r).set("errorMessage",o),this._fileList=this._fileList.set(t.uploadId,t),this.emit_change()},t.prototype.confirmFSW=function(e){var t=this,r=e.fswIds,o=e.batchId;r.forEach(function(e){t._confirmedFSWs.includes(e)||t._confirmedFSWs.push(e)}),this._confirmedFSWBatchIds.includes(o)||this._confirmedFSWBatchIds.push(o)},t.prototype._new_payload=function(e){var t=e.action;switch(t.type){case i.DEPRECATED__BrowseActionType.INITIALIZE_EVERYTHING:this.initializeEverything(t.data);break;case i.DEPRECATED__BrowseActionType.APP_INIT:case a.UploaderActionType.SET_USER:this.setUser(t.data);break;case i.DEPRECATED__BrowseActionType.LOAD_PATH:this.setPathData(t.data);break;case a.UploaderActionType.SET_PATH:this.setPath(t.data);break;case a.UploaderActionType.SET_FOLDER_NS_ID:this.setFolderNsId(t.data);break;case a.UploaderActionType.QUEUE_UPLOADS:this.queueUploads(t.data);break;case a.UploaderActionType.START_UPLOAD:this.startUpload(t.data);break;case a.UploaderActionType.COMPLETE_UPLOAD:this.completeUpload(t.data);break;case a.UploaderActionType.CANCEL_UPLOADS:this.cancelUploads(t.data);break;case a.UploaderActionType.SET_CURRENT_UPLOAD_PROGRESS:this.setCurrentUploadProgress(t.data);break;case a.UploaderActionType.UPLOAD_ERROR:this.handleUploadError(t.data);break;case a.UploaderActionType.SET_NUM_DRAGGING_FILES:this.setNumDraggingFiles(t.data);break;case a.UploaderActionType.SET_IS_UPLOAD_MODAL_OPEN:this.setIsUploadModalOpen(t.data);break;case a.UploaderActionType.SET_INLINE_STATUS_SHOULD_BE_DISMISSED:this.setInlineStatusShouldBeDismissed(t.data);break;case a.UploaderActionType.ADD_NEW_FAILED_FILE:this.addNewFailedFile(t.data);break;case a.UploaderActionType.CONFIRM_FSW:this.confirmFSW(t.data)}},t})(s.Store);t.UploaderStoreClass=c,t.uploaderStore=new c}),define("modules/clean/react/file_uploader/utils",["require","exports","tslib","modules/clean/base64","modules/core/browser"],function(e,t,r,o,s){"use strict";function i(){return n()}function a(){return"batch-"+n()}function n(){for(var e="",t=0;t<16;++t)e+=String.fromCharCode(Math.floor(256*Math.random()));var r=o.encode(e);return r=r.replace(/\+/g,"-"),r=r.replace(/\//g,"_"),r=r.replace(/\=*$/,"")}function l(e,t){var r=0;return e.forEach(function(e){t.indexOf(e.status)!==-1&&(r+=e.size)}),r}function c(e,t,r){var o=t,s=0;return e.forEach(function(e,t){for(var i=0,a=e.split("/"),n=r.split("/");i<a.length&&i<n.length&&a[i]===n[i];)i++;i===a.length&&i>1&&i>s&&(s=i,o=Number(t))}),o}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),t.generateUploadId=i,t.generateBatchId=a,t.calculateSizeOfUploads=l,t.getNsId=c,t.getOQmodalOQALocationCode=function(e){return"/h"===(e||s.get_uri().path)?"ho":"fb"}}),define("modules/clean/react/fileops_actions",["require","exports","tslib","external/react","modules/core/notify","modules/core/i18n","modules/clean/em_string","modules/clean/filepath","modules/clean/react/async_file_modal_controller","modules/clean/file_operations/notifications","modules/clean/react/browse/api","modules/clean/react/browse/nav_actions","modules/clean/react_format","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/react/browse/models","modules/clean/viewer"],function(e,t,r,o,s,i,a,n,l,c,d,u,p,h,_,f,m){"use strict";function S(e,t,r){var o=m.Viewer.get_viewer().team_name,a=T(e,t,o,r);if(null!=a){s.Notify.clear();var n=1===r.length,c=E(e,o,r.length),d=r[0]instanceof f.File&&n?i._("See owner"):void 0,p=function(){r[0]instanceof f.File&&h.asyncShowShareModal(e.id,r[0],{origin:_.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS},u.browseNavActions.setPath,u.browseNavActions.setUrl)};l.showMoveErrorModal({title:c,content:a,learnMoreLink:"/help/business/shared-folder-differences#owner_move_shared_folder",buttonString:d,onClick:p})}}function E(e,t,r){return"is_cdm_member"in e&&e.is_cdm_member?i.ungettext("Can’t move shared folder to the %(team_name)s team space","Can’t move shared folders to the %(team_name)s team space",r).format({team_name:a.Emstring.em_snippet(t,_.SNIPPET_SIZES.DISPLAY_NAME)}):i.ungettext("Can’t move shared folder to a team folder","Can’t move shared folders to a team folder",r)}function T(e,t,r,s){var l={VIEW_ONLY_ACCESS_ERROR:"view_only_access_error",OFF_TEAM_OWNER_ERROR:"off_team_owner_error",OWNER_ONLY_MANAGE_MEMBERSHIP_ERROR:"owner_only_manage_membership_error"},c=null;return t===l.OFF_TEAM_OWNER_ERROR?c=1===s.length?p.reactFormat(i._("The owner of <strong>%(file_name)s</strong> isn’t a member of %(team_name)s.").format({team_name:r,file_name:a.Emstring.em_snippet(n.filename(s[0].fq_path),_.SNIPPET_SIZES.FILENAME)}),{strong:o.createElement("strong",{style:{fontWeight:500}})}):i._("The owner of some of these shared folders isn’t a member of %(team_name)s.").format({team_name:r}):t===l.OWNER_ONLY_MANAGE_MEMBERSHIP_ERROR?c=1===s.length?"is_cdm_member"in e&&e.is_cdm_member?p.reactFormat(i._("Only the owner of <strong>%(file_name)s</strong> can move it to the %(team_name)s team space.").format({team_name:r,file_name:a.Emstring.em_snippet(n.filename(s[0].fq_path),_.SNIPPET_SIZES.FILENAME)}),{strong:o.createElement("strong",{style:{fontWeight:500}})}):p.reactFormat(i._("Only the owner of <strong>%(file_name)s</strong> can move it to a team folder.").format({file_name:a.Emstring.em_snippet(n.filename(s[0].fq_path),_.SNIPPET_SIZES.FILENAME)}),{strong:o.createElement("strong",{style:{fontWeight:500}})}):"is_cdm_member"in e&&e.is_cdm_member?i._("Only the owner can move some of these folders to the %(team_name)s team space.").format({team_name:r}):i._("Only the owner can move some of these folders to a team folder."):t===l.VIEW_ONLY_ACCESS_ERROR&&(c=1===s.length?p.reactFormat(i._("You can only view <strong>%(file_name)s</strong>. Ask an owner or editor of the folder for access to edit it.").format({file_name:a.Emstring.em_snippet(n.filename(s[0].fq_path),_.SNIPPET_SIZES.FILENAME)}),{strong:o.createElement("strong",{style:{fontWeight:500}})}):i._("You can’t edit some of these folders. Ask an owner or editor of the folders for access to edit them.")),c}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importStar(n),l=r.__importStar(l),c=r.__importStar(c),d=r.__importStar(d),t.copyFiles=function(e){var o=e.files,s=e.newPath,a=e.checkFSWs,n=e.onSuccess,u=e.onRequestNotSent,p=e.onUndo,h=e.user,_=e.dataApi;!(void 0===_?d:_).copyFiles({files:o,newPath:s,checkFSWs:a,userId:h.id,onSuccess:function(a){var d=a.newFiles,u=a.changesets,_=a.rollbackHints,f=a.failureDetails;if(f){var m=function(){t.copyFiles(r.__assign({},e,{checkFSWs:!1}))};l.showFileSystemWarningsModal({fsws:f,onFinalAccept:m,confirmText:i._("Copy")})}else n&&n(d),c.notifyCopySuccess(o.length,h,u,s,_,function(){p&&p()})}})&&u&&u()},t.moveFiles=function(e){var o=e.path,a=e.files,n=e.newPath,u=e.checkFSWs,p=e.onSuccess,h=e.onRequestNotSent,_=e.onUndo,f=e.user,m=e.dataApi,E=void 0===m?d:m,T=function(o){var s=o.newFiles,d=o.changesets,u=o.rollbackHints,h=o.failureDetails;if(h){var m=function(){t.moveFiles(r.__assign({},e,{checkFSWs:!1}))};l.showFileSystemWarningsModal({fsws:h,onFinalAccept:m,confirmText:i._("Move")})}else c.notifyMoveSuccess(a.length,f,d,n,u,function(){_&&_()}),p&&p(s)},g=function(e){"This will result in losing ownership of these folders."===e?(s.Notify.clear(),l.showConfirmOwnershipTransferModal(function(){E.moveFiles({path:o,files:a,newPath:n,userId:f.id,onSuccess:T,allowOwnershipTransfer:!0})})):S(f,e,a)};!E.moveFiles({path:o,files:a,newPath:n,checkFSWs:u,userId:f.id,onSuccess:T,onError:g,allowOwnershipTransfer:!1})&&h&&h()}}),define("modules/clean/search/api",["require","exports","tslib","modules/clean/ajax","modules/clean/analytics","modules/clean/react/browse/models","modules/clean/search/search_helpers","modules/clean/search/constants","modules/clean/search/types","modules/clean/search/models","modules/clean/search/api_helpers","modules/clean/search/search_helpers","modules/clean/search/search_bar/data/selectors","modules/clean/search/search_bar/data/store"],function(e,t,r,o,s,i,a,n,l,c,d,u,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),a=r.__importStar(a),n=r.__importStar(n);var _=(function(){function e(){this._activeRequest=null}return e.prototype.abortPreviousLoading=function(){null!=this._activeRequest&&this._activeRequest.abort()},e.prototype.loadResults=function(e){var t=e.user,r=e.path,o=e.query,s=e.start,i=e.maxResults,l=e.searchSessionId,c=e.nsid,u=e.fileNameOnly,p=e.loadDeleted,h=e.showPaperResults,_=e.isDropdown,f=e.isAdminConsole,m=e.showSymlinkIcon,S=e.webTimer,E=e.onSuccess,T=e.onError,g=e.overrideUrl,F=d.getCurrentTimezoneOffset(),w={query:o,search_token:a.getSearchCsrfToken(),fq_path:r,ns_id:c,filename_only:!!u,max_results:i,deleted:!!p,start:s,show_paper_results:!!h,is_dropdown:!!_,is_admin_console:!!f,show_unmounted_results:!0,timezone_offset:F,show_symlink_icon:m,include_browse_context:!0},y=g?g:n.FULLTEXT_SEARCH_ENDPOINT;this._fetchResults({requestData:w,user:t,searchSessionId:l,url:y,onSuccess:E,onError:T,webTimer:S})},e.prototype._extractSearchResultsList=function(e){for(var t=[],r=0,o=e;r<o.length;r++){var s=o[r];switch(s.search_result_type){case l.SearchResultTypes.FILE:t.push(i.File.fromServerObject(s));break;case l.SearchResultTypes.PAPER:t.push(i.Paper.fromServerObject(s));break;case l.SearchResultTypes.PAPER_FOLDER:t.push(i.PaperFolder.fromServerObject(s))}}return t},e.prototype._getSearchType=function(e){return e.is_dropdown?"dropdown":e.deleted?"full_page_deleted":"full_page"},e.prototype.loadPartialResults=function(e){var t=e.user,o=e.maxResults,s=e.start,i=e.path,l=e.query,c=e.fileCategories,d=e.searchSessionId,p=e.showSymlinkIcon,h=e.includeBrowseContext,_=e.webTimer,f=e.onSuccess,m=e.onError,S=c?u.fileCategoriesToString(c):"",E=r.__assign({query:l,search_token:a.getSearchCsrfToken(),fq_path:i,start:s,max_results:o,show_paper_results:!0,show_symlink_icon:p,include_browse_context:h,search_session_id:d},S&&{file_categories:S});this._fetchResults({requestData:E,user:t,searchSessionId:d,url:n.PARTIAL_SEARCH_FRONTEND_SERVICE_ENDPOINT,onSuccess:f,onError:m,webTimer:_})},e.prototype._fetchResults=function(e){var t=this,i=e.requestData,a=e.user,n=e.searchSessionId,l=e.url,d=e.onSuccess,_=e.onError,f=e.webTimer;null!=this._activeRequest&&this._activeRequest.abort();var m=u.fileCategoryStringToLogValue(i.file_categories),S=p.experiments(h.getStoreForSearchBar().getState()),E=r.__assign({path_scoped:"/"!==i.fq_path,search_type:this._getSearchType(i),query_string:i.query,start:i.start,search_session_id:n,timezone_offset:i.timezone_offset},u.isInFileTypeFilterExperiment(S)&&{file_type_filters:m});s.SearchClientActivityLogger.log("query_started",a.id,E);var T=(new Date).getTime();this._activeRequest=o.WebRequest({url:l,data:i,dataType:"json",subject_user:a,success:function(e,r,o){var l;i.include_browse_context&&(l=c.extractBrowseContext(e));var u=e.search_results,p=o.getResponseHeader("x-dropbox-request-id");u.forEach(function(e){return e.request_id=p});var h=t._extractSearchResultsList(u);d({context:l,searchResults:h,deleted:!!i.deleted});var _=s.SearchClientActivityLogger.create_search_log_dict(E,p,T,i.query,h.length,null,n,null);s.SearchClientActivityLogger.log("query_completed",a.id,_),f&&f.end(p?p:void 0)},error:function(e,t,r){"abort"!==t&&"function"==typeof _&&_(r);var o=e.getResponseHeader("x-dropbox-request-id"),l=s.SearchClientActivityLogger.create_search_log_dict(E,o,T,i.query,null,t,n,null);s.SearchClientActivityLogger.log("query_failed",a.id,l),f&&f.abort()},complete:function(){this._activeRequest=null}})},e.prototype.fetchAdditionalFileMetadata=function(e){var t=e.searchResults,r=e.user,s=e.onSuccess,a=e.onError,l=t.filter(function(e){return e instanceof i.File}),c=l.map(function(e){return[e.ns_id,e.sjid,e.fq_path.substr(0,e.fq_path.length-e.ns_path.length)]});c.length>0&&o.WebRequest({url:n.FILE_INFO_ENDPOINT,data:{nsid_sjid_fq_mount_point_tuples:JSON.stringify(c)},dataType:"json",subject_user:r,success:function(e,t,r){for(var o=e.file_results,i=[],a=0,n=o;a<n.length;a++){var l=n[a];i.push(l)}s(i)},error:function(e,t,r){"abort"!==t&&"function"==typeof a&&a(r)}})},e})();t.SearchApiClient=_,t.searchApiClient=new _}),define("modules/clean/search/search_results/actions",["require","exports","tslib","modules/clean/search/constants","modules/core/i18n","modules/clean/search/search_results/dispatcher","modules/clean/search/api","modules/clean/search/search_results/store","modules/clean/search/types","modules/clean/search/constants","modules/clean/search/store_helpers","modules/clean/search/search_helpers"],function(e,t,r,o,s,i,a,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),d=r.__importStar(d);var p=(function(){function e(e,t){void 0===e&&(e=a.searchApiClient),void 0===t&&(t=n.getSearchResultsStore()),this._searchApi=e,this._searchResultsStore=t}return e.prototype.runSearch=function(e){var t=this,r=e.user,s=e.path,a=e.query,n=e.searchSessionId,l=e.webTimer,u=e.logOnceFetchedDataRequiredForTTI,p=e.deletedFiles,h=e.showSymlinkIcon,_=e.expSinglePageSearch,f=e.fileCategories,m=e.deletedFileInCerebro,S=e.isPaperEnabled,E=void 0===S||S,T=d.generateRandomId();_||i.SearchResultsDispatcher.dispatch({type:o.CLEAR_SEARCH_ACTION}),i.SearchResultsDispatcher.dispatch({type:o.START_SEARCH_ACTION,data:{query:a,searchSessionId:n,queryId:T,fileCategories:f}});var g=c.MaxResults.MAX_SEARCH_RESULTS;p!==!0?this._searchApi.loadPartialResults({user:r,path:s,query:a,start:0,searchSessionId:n,showSymlinkIcon:h,includeBrowseContext:!0,webTimer:l,maxResults:g,fileCategories:f,onSuccess:function(e){var o=e.searchResults,i=e.context;u(),t._setSearchResults({searchResults:o,context:i,deletedFiles:!!p,queryId:T}),void 0===p&&t._loadDeletedResults({path:s,user:r,deletedFileInCerebro:m,isPaperEnabled:E}),t._searchApi.fetchAdditionalFileMetadata({searchResults:o,user:r,onSuccess:function(e){t._setFullSearchResults({searchResults:e,queryId:T})}})}}):this._searchApi.loadResults({user:r,path:s,query:a,start:0,maxResults:g,showPaperResults:!0,searchSessionId:n,showSymlinkIcon:h,webTimer:l,loadDeleted:p,overrideUrl:m?o.PARTIAL_SEARCH_FRONTEND_SERVICE_ENDPOINT:"",onSuccess:function(e){var o=e.searchResults,i=e.context;u(),t._setSearchResults({searchResults:o,context:i,deletedFiles:!!p,queryId:T}),void 0===p&&t._loadDeletedResults({path:s,user:r,deletedFileInCerebro:m,isPaperEnabled:E})}})},e.prototype.fetchCompleteSearchResultSRP=function(e){var t=this,r=e.searchResult,o=e.user,i=e.onSuccess,a=e.onError;if(r.isDeleted)return i(r);var l=n.getSearchResultsStore().fullSearchResults().get(r.fq_path,null);if(l){i(this._mergePartialAndCompleteResult({partialResult:r,completeResult:l}))}else this._searchApi.fetchAdditionalFileMetadata({searchResults:[r],user:o,onSuccess:function(e){if(e.length>0){i(t._mergePartialAndCompleteResult({partialResult:r,completeResult:e[0]}))}else if(a){var o=s._("There was a problem completing this request.");a(o)}},onError:a})},e.prototype._mergePartialAndCompleteResult=function(e){var t=e.partialResult,o=e.completeResult;return r.__assign({},t,o)},e.prototype.loadMoreResults=function(e){var t=this,s=e.path,a=e.user,n=e.deletedFiles,d=e.showSymlinkIcon,p=e.deletedFileInCerebro,h=e.isPaperEnabled,_=void 0===h||h,f=!1,m=this._searchResultsStore.latestFileCategories(),S=_?!(u.allCategoriesUnchecked(m)||u.allCategoriesChecked(m)):!(u.allCategoriesUnchecked(r.__assign({},m,(F={},F[l.FileCategory.PAPER]="unchecked",F)))||u.allCategoriesChecked(r.__assign({},m,(w={},w[l.FileCategory.PAPER]="checked",w))));if(this._searchResultsStore.loadingState()===o.SearchLoadingState.LOADED){if(void 0===n)if(this._searchResultsStore.hasMoreResults())f=!1;else{if(!this._searchResultsStore.hasMoreResults(!S))return;f=!0}else{if(!this._searchResultsStore.hasMoreResults(n&&!S))return;f=n&&!S}i.SearchResultsDispatcher.dispatch({type:o.CONTINUE_SEARCH_ACTION,data:{didLoadDeletedResults:f}});var E=f?this._searchResultsStore.numDeletedResults():this._searchResultsStore.searchResults().size,T=this._searchResultsStore.queryId()
;if(f)this._searchApi.loadResults({user:a,path:s,query:this._searchResultsStore.latestQuery(),fileNameOnly:!1,showPaperResults:!0,isDropdown:!1,isAdminConsole:!1,loadDeleted:f,start:E,maxResults:c.MaxResults.MAX_SEARCH_RESULTS,searchSessionId:this._searchResultsStore.searchSessionId(),showSymlinkIcon:d,overrideUrl:p?o.PARTIAL_SEARCH_FRONTEND_SERVICE_ENDPOINT:"",onSuccess:function(e){var r=e.searchResults,o=(e.context,e.deleted);t._appendSearchResults({searchResults:r,deleted:o}),void 0===n&&t._loadDeletedResults({path:s,user:a,deletedFileInCerebro:p,isPaperEnabled:_})}});else{var g=this._searchResultsStore.latestQuery();this._searchApi.loadPartialResults({user:a,path:s,query:g,start:E,showSymlinkIcon:d,includeBrowseContext:!1,searchSessionId:this._searchResultsStore.searchSessionId(),maxResults:c.MaxResults.MAX_SEARCH_RESULTS,fileCategories:m,onSuccess:function(e){var r=e.searchResults;e.context;t._appendSearchResults({searchResults:r,deleted:!1}),t._searchApi.fetchAdditionalFileMetadata({searchResults:r,user:a,onSuccess:function(e){t._setFullSearchResults({searchResults:e,queryId:T})}}),void 0===n&&t._loadDeletedResults({path:s,user:a,deletedFileInCerebro:p,isPaperEnabled:_})}})}var F,w}},e.prototype._setSearchResults=function(e){var t=e.searchResults,r=e.context,s=e.deletedFiles,a=e.queryId;i.SearchResultsDispatcher.dispatch({type:o.SET_SEARCH_RESULTS_ACTION,data:{searchResults:t,context:r,deletedFiles:s,queryId:a}})},e.prototype._setFullSearchResults=function(e){var t=e.searchResults,r=e.queryId;i.SearchResultsDispatcher.dispatch({type:o.SET_FULL_SEARCH_RESULTS_ACTION,data:{searchResults:t,queryId:r}})},e.prototype._appendSearchResults=function(e){var t=e.searchResults,r=e.deleted;i.SearchResultsDispatcher.dispatch({type:o.APPEND_SEARCH_RESULTS_ACTION,data:{searchResults:t,deleted:r}})},e.prototype._loadDeletedResults=function(e){var t=e.path,r=e.user,o=e.deletedFileInCerebro,s=e.isPaperEnabled;this._searchResultsStore.hasMoreResults()||this._searchResultsStore.didLoadDeletedResults()||this.loadMoreResults({path:t,user:r,deletedFileInCerebro:o,isPaperEnabled:s})},e.prototype.setSearchSelection=function(e){var t=e.selection;i.SearchResultsDispatcher.dispatch({type:o.SET_SEARCH_SELECTION_ACTION,data:{selection:t}})},e.prototype.clearSearch=function(){i.SearchResultsDispatcher.dispatch({type:o.CLEAR_SEARCH_ACTION})},e.prototype.setFileTypeFilter=function(e){var t=e.fileCategories;i.SearchResultsDispatcher.dispatch({type:o.SET_FILE_TYPE_FILTER_ACTION,data:{fileCategories:t}})},e.prototype.selectFirstFile=function(){i.SearchResultsDispatcher.dispatch({type:o.SELECT_FIRST_FILE_ACTION,data:{}})},e})();t.SearchResultsActions=p,t.searchResultsActions=new p}),define("modules/clean/search/search_results/controller",["require","exports","tslib","external/lodash","external/react","external/react-dom","modules/clean/filepath","modules/clean/react/browse/models","modules/clean/react/css","modules/clean/search/constants","modules/clean/search/search_results/actions","modules/clean/search/search_results/log_helper","modules/clean/search/search_results/store","modules/clean/search/search_results/view","modules/clean/web_user_action_events"],function(e,t,r,o,s,i,a,n,l,c,d,u,p,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),i=r.__importStar(i),a=r.__importStar(a),c=r.__importStar(c);var f=(function(t){function l(){var e=null!==t&&t.apply(this,arguments)||this;return e._onSearchResultsStoreChanged=function(){e.setState(e._getStateFromSearchResultsStore()),e.deferredCheckForMissingStarredData&&e.deferredCheckForMissingStarredData()},e._handleScroll=function(){if(i.findDOMNode(e).getBoundingClientRect().bottom<=window.innerHeight){var t=e.props,r=t.path,o=t.user,s=t.shouldShowDeletedFiles,a=t.searchResultsExperiments,n=t.isPaperEnabled,l=a.expShowSymlinkIcon,c=a.expDeletedFileInCerebro;d.searchResultsActions.loadMoreResults({path:r,user:o,showSymlinkIcon:!!l,deletedFiles:s,deletedFileInCerebro:!!c,isPaperEnabled:n})}},e._handleSelectionChange=function(e){d.searchResultsActions.setSearchSelection({selection:e})},e._handleLocationLinkClick=function(t,r){var o=e.props,s=o.user,i=o.viewType;if(u.recordSearchResultsAction({result:t,user:s,action_type:_.WebUserActionLogEvent.CLICK_PATH_LINK,view_type:i}),!r){var n=a.parent_dir(t.fq_path);e.props.onNavigateToPath(n)}},e._handleFilesViewShowShare=function(t,r){var o=e.props,s=o.user,i=o.filesViewActionHandlers,a=o.viewType;u.recordSearchResultsAction({result:t,user:s,action_type:_.WebUserActionLogEvent.SHARE,view_type:a}),i.onShowShare(t,r)},e}return r.__extends(l,t),l.prototype.componentWillMount=function(){this.state=this._getStateFromSearchResultsStore()},l.prototype.componentWillReceiveProps=function(e){e.arePostTTIModulesLoaded&&!this.props.arePostTTIModulesLoaded&&this.enableStarring()},l.prototype.componentDidMount=function(){p.getSearchResultsStore().add_change_listener(this._onSearchResultsStoreChanged),this.props.arePostTTIModulesLoaded&&this.enableStarring(),this.setState(this._getStateFromSearchResultsStore()),window.scrollTo(0,0)},l.prototype.componentWillUnmount=function(){p.getSearchResultsStore().remove_change_listener(this._onSearchResultsStoreChanged)},l.prototype.enableStarring=function(){var t=this,r=e("modules/clean/react/starred/browse_exports").checkForMissingStarredData;this.deferredCheckForMissingStarredData=function(){o.defer(function(){var e=[];p.getSearchResultsStore().searchResults().forEach(function(t){t instanceof n.File&&e.push(t),(t instanceof n.Paper||t instanceof n.PaperFolder)&&e.push(t)}),r({items:e,user:t.props.user})})},this.deferredCheckForMissingStarredData()},l.prototype._getStateFromSearchResultsStore=function(){var e=p.getSearchResultsStore(),t=e.latestQuery(),r=e.loadingState(),o=this.state?this.state.loadingState!==r&&this.state.loadingState===c.SearchLoadingState.LOADING_FIRST_PAGE?t:this.state.queryForResultsTitle:"";return{context:e.browseContext(),hasMoreResults:e.hasMoreResults(),loadingState:r,latestQuery:t,queryForResultsTitle:o,searchSessionId:e.searchSessionId(),fullSearchResults:e.fullSearchResults(),searchResults:e.searchResults(),selection:e.selection(),selectedFiles:e.selectedFiles()}},l.prototype.render=function(){var e=this.props,t=e.actionHandlers,i=e.searchResultsExperiments,a=e.searchBarExperiments,n=e.maestroSearchBarProps,l=e.onFocusSearchBar,c=e.onSearch,d=e.onNavigateToFileOrFolder,u=e.setFileUploaderPath,p=e.path,_=e.user,f=e.handleComponentTTI,m=e.ensureFileViewerClosedIfNotPreviewing,S=e.getIsFileJumping,E=e.isFileViewerShown,T=e.fileRename,g=e.arePostTTIModulesLoaded,F=e.getOverflowMenuActions,w=e.filesViewActionHandlers,y=e.onNavigateToParentFolder,v=e.shouldShowDeletedFiles,A=e.browseExperiments,R=e.onOpenPaper,b=e.renderSharedWithController,I=e.hrefForFile,P=e.responsive,C=e.onSearchFiltersChanged,D=e.starredState,O=e.fileCategories,N=e.viewType,L=e.pageHeaderHeight,x=this.state,M=x.context,B=x.hasMoreResults,U=x.loadingState,q=x.latestQuery,k=x.queryForResultsTitle,V=x.searchSessionId,W=x.searchResults,H=x.selection,G=x.selectedFiles,z=r.__assign({},w,{onShowShare:this._handleFilesViewShowShare});return s.createElement(h.SearchResultsView,{filesViewActionHandlers:z,searchResultsExperiments:i,searchBarExperiments:a,browseExperiments:A,maestroSearchBarProps:n,onFocusSearchBar:l,onSearch:c,onScroll:o.throttle(this._handleScroll,200),setFileUploaderPath:u,onSelectionChange:this._handleSelectionChange,path:p,user:_,actionHandlers:t,handleComponentTTI:f,ensureFileViewerClosedIfNotPreviewing:m,getIsFileJumping:S,isFileViewerShown:E,fileRename:T,arePostTTIModulesLoaded:g,getOverflowMenuActions:F,onLocationLinkClick:this._handleLocationLinkClick,onNavigateToFileOrFolder:d,onNavigateToParentFolder:y,onOpenPaper:R,context:M,hasMoreResults:B,loadingState:U,latestQuery:q,queryForResultsTitle:k,searchSessionId:V,searchResults:W,selection:H,selectedFiles:G,viewType:N,shouldShowDeletedFiles:v,renderSharedWithController:b,hrefForFile:I,responsive:P,onSearchFiltersChanged:C,starredState:D,fileCategories:O,pageHeaderHeight:L})},l})(s.Component);t.SearchResultsController=l.requireCssWithComponent(f,["/static/css/browse/browse-vflSv_45j.css","/static/css/search/search_results-vflT65vb7.css","/static/css/scooter/scooter-scoped-vflrM1SRf.css"])}),define("modules/clean/search/search_results/dispatcher",["require","exports","tslib","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/search/search_results/store"],function(e,t,r,o,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.SearchResultsDispatcher={dispatch:function(e){o.assert(i.searchResultsStoreInstantiated(),"Must call getSearchResultsStore() before a dispatch"),s.Dispatcher.dispatch(e)}}}),define("modules/clean/search/search_results/log_helper",["require","exports","tslib","modules/clean/search/logger","modules/clean/search/search_results/store","modules/clean/search/search_bar/data/store","modules/clean/search/search_bar/data/action_creators"],function(e,t,r,o,s,i,a){"use strict";function n(e){var t=e.result,r=e.user,n=e.action_type,l=e.view_type,c=s.getSearchResultsStore().searchSessionId(),d=s.getSearchResultsStore().latestQuery(),u={rawQuery:d,normalizedQuery:d};i.getStoreForSearchBar().dispatch(a.addQueryToHistory({user:r,query:u,searchSessionId:c,requestId:t.request_id||""})),o.logSearchAction({searchSessionId:c,result:t,user:r,action_type:n,search_type:"full_page",viewport:"full-view",view_type:l})}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.recordSearchResultsAction=n}),define("modules/clean/search/search_results/search_filters",["require","exports","tslib","external/react","modules/core/i18n","spectrum/tertiary_link","spectrum/label","spectrum/radio_button","spectrum/checkbox","modules/clean/filepath","modules/clean/react/async_folder_selector_modal","modules/clean/react/path_filter_button","modules/clean/search/types","modules/clean/search/search_helpers","modules/clean/search/search_bar/experiments","spectrum/icon_arrow","modules/clean/search/constants","external/classnames","spectrum/icon_content","spectrum/tooltip","modules/clean/search/constants","spectrum/button"],function(e,t,r,o,s,i,a,n,l,c,d,u,p,h,_,f,m,S,E,T,g,F){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),c=r.__importStar(c),d=r.__importStar(d),S=r.__importDefault(S);var w=(function(e){function t(w){var y=e.call(this,w)||this;y.showFolderFilterModal=function(){var e=y.props,t=e.user,r=e.path,o=e.onFiltersChanged,i=e.deletedFiles,a=e.searchBarExperiments,n=void 0===a?{}:a;d.show({primaryAction:s._("Select"),secondaryAction:s._("Cancel"),title:s._("Select a folder"),ariaLabel:s._("Folder selector"),user:t,initialFolderSelection:r,forceRootSelectable:!0,onFolderSelected:function(e){o({path:e,deletedFiles:i})},showFolderPicker:!!n.expUseNewFolderPicker})},y.resetFilters=function(){var e=y.props,t=e.searchBarExperiments,o=e.onFiltersChanged,s={};_.isInDeletedFilterRightRailExperiment(t)&&(s.deletedFiles=!1),s.path="/",h.isInFileTypeFilterExperiment(t)&&(s.fileCategories=h.isInFileTypeFilterExperimentAllChecked(t)?r.__assign({},g.FILE_CATEGORIES_CHECKED):r.__assign({},g.FILE_CATEGORIES_UNCHECKED)),o(s)},y.shouldRenderResetButton=function(){var e=y.props,t=e.path,r=e.deletedFiles,o=e.fileCategories,s=e.searchBarExperiments,i=h.fileCategoriesSet(o,s,y.props.isPaperEnabled);return!c.paths_are_equal(t,"/")||!!r||i},y.renderResetButton=function(){return o.createElement(i.TertiaryLink,{onClick:y.resetFilters,className:"search-filters__reset"},s._("Reset filters"))},y.renderPathFilter=function(){var e=y.props.path;return o.createElement("div",{className:"filter-item__row"},o.createElement("div",{className:"filter-item__column"},o.createElement("div",{className:"filter-item__desc"},s._("By folder")),o.createElement(u.PathFilterButton,{path:e,defaultText:s._("Any folder"),dropdownClasses:"filter-item__filter",onClick:y.showFolderFilterModal})))},y.handleDeletedFilesAll=function(){y.props.onFiltersChanged({deletedFiles:!1})},y.handleDeletedFilesDeleted=function(){y.props.onFiltersChanged({deletedFiles:!0})},y.handleFileTypeChanged=function(e,t,o){var s=o.target.name;y.props.onFiltersChanged({fileCategories:r.__assign({},y.props.fileCategories,(i={},i[s]=e,i))});var i},y.handleChangeFileTypeFiltersView=function(){y.setState({showAllFilters:!y.state.showAllFilters})},y.handleClearOrSelectAll=function(){h.allCategoriesChecked(y.props.fileCategories,y.props.isPaperEnabled)?y.props.onFiltersChanged({fileCategories:r.__assign({},g.FILE_CATEGORIES_UNCHECKED)}):(y.props.onFiltersChanged({fileCategories:r.__assign({},g.FILE_CATEGORIES_CHECKED)}),y.setState({showAllFilters:!0}))},y.handleOnlyButtonClicked=function(e){return function(){y.props.onFiltersChanged({fileCategories:r.__assign({},g.FILE_CATEGORIES_UNCHECKED,(t={},t[e]="checked",t))});var t}},y.renderDeletedFilter=function(){var e=y.props.deletedFiles;return o.createElement("div",{className:"filter-item__row"},o.createElement("div",{className:"filter-item__column"},o.createElement("div",{className:"filter-item__desc"},s._("By status")),o.createElement("div",null,o.createElement(a.Label,{htmlFor:"filter-type-all"},o.createElement(n.RadioButton,{"aria-checked":!0,checked:!e,id:"filter-type-all",value:"all",onChange:y.handleDeletedFilesAll}),s._("Available"))),o.createElement("div",null,o.createElement(a.Label,{htmlFor:"filter-type-deleted"},o.createElement(n.RadioButton,{"aria-checked":!0,checked:e,id:"filter-type-deleted",value:"deleted",onChange:y.handleDeletedFilesDeleted}),s._("Deleted")))))},y.renderFileTypeFilter=function(){var e=y.renderFileTypeFilterCheckboxes(),t=y.state.showAllFilters?"up":"down",r=y.state.showAllFilters?s._("Show Less"):s._("Show More"),a=h.allCategoriesChecked(y.props.fileCategories,y.props.isPaperEnabled),n=a?s._("Clear all"):s._("Select all");return o.createElement("div",{className:"filter-item__row"},o.createElement("div",{className:"filter-item__column"},o.createElement("div",{className:"filter-item__desc"},s._("By type"),o.createElement(i.TertiaryLink,{onClick:y.handleClearOrSelectAll,className:"filter-type-file-select-or-clear-all-button"},n)),e,o.createElement("button",{className:"show-more-filters",onClick:y.handleChangeFileTypeFiltersView},o.createElement("div",{className:"show-more-filters__arrow show-more-filters__arrow-"+t},o.createElement(f.IconArrow,{name:"right"})),r)))},y.renderFileTypeFilterCheckboxes=function(){var e=[],r=0;return Object.keys(t.FileCategoryData).forEach(function(t){(y.props.isPaperEnabled||t!==p.FileCategory.PAPER)&&(e.push(y.createCheckBox(t,r>=m.NUMBER_FILE_TYPE_CHECKBOXES_ALWAYS_SHOWN)),r++)}),e},y.createCheckBox=function(e,r){var i=y.props.searchBarExperiments,n=h.isInFileTypeFilterExperimentAllChecked(i),c=t.FileCategoryData[e].label,d=t.FileCategoryData[e].icon,u=t.FileCategoryData[e].tooltip,p="filter-type-file-"+e,_="filter-type-file-only-"+e,f="filter-type-file-label filter-type-file-label__"+(n?"partial-width":"full-width"),m=y.state.showAllFilters?"":S.default({"filter-type-file-checkbox__hidden":r}),g=o.createElement("div",{className:"filter-type-file-icon-wrapper"},o.createElement(T.Tooltip,{tooltipContent:u,positioning:"left"},o.createElement(E.IconContent,{className:"filter-type-file-icon",name:d}))),w=n?o.createElement(a.Label,{htmlFor:_,className:"filter-type-file-only-button-label"},o.createElement(F.Button,{className:"filter-type-file-only-button",onClick:y.handleOnlyButtonClicked(e),variant:"styleless"},s._("Only",{comment:"This string is used on the file type filters as a button that selects only that filter from the list of them. It is displayed when a user hovers over a checkbox in the filters."})),g):g;return o.createElement("div",{key:p,className:"filter-type-file-checkbox-wrapper "+m},o.createElement(a.Label,{htmlFor:p,className:f},o.createElement(l.Checkbox,{name:e,"aria-checked":!0,checked:y.props.fileCategories[e],id:p,onChange:y.handleFileTypeChanged,className:"filter-type-file-checkbox"}),c,n?null:w),n?w:null)},y.handleClick=function(e){e.stopPropagation()};var v=y.props.searchBarExperiments,A=h.fileCategoriesToString(y.props.fileCategories);return!h.isInFileTypeFilterExperimentAllChecked(v)&&_.isInDeletedFilterRightRailExperiment(v)?y.state={showAllFilters:!!A}:y.state={showAllFilters:!0},y.props.fileTypeFilterEnabled&&h.isInFileTypeFilterExperiment(v)&&void 0===t.FileCategoryData&&(t.FileCategoryData=(R={},R[p.FileCategory.IMAGE]={label:s._("Images"),tooltip:s._("JPG, PNG, GIF, and more",{comment:"Intended to represent 3 of the most common file formats for images."}),icon:"image-small"},R[p.FileCategory.DOCUMENT]={label:s._("Documents"),tooltip:s._("DOC, DOCX, TXT, and more",{comment:"Intended to represent 3 of the most common file formats for documents."}),icon:"docx-small"},R[p.FileCategory.PDF]={label:s._("PDFs"),tooltip:s._("PDF"),icon:"pdf-small"},R[p.FileCategory.SPREADSHEET]={label:s._("Spreadsheets"),tooltip:s._("XLSX, XLS, CSV, and more",{comment:"Intended to represent 3 of the most common file formats for spreadsheets."}),icon:"xls-small"},R[p.FileCategory.PRESENTATION]={label:s._("Presentations"),tooltip:s._("PPT, PPTX, KEY, and more",{comment:"Intended to represent 3 of the most common file formats for presentations."}),icon:"ppt-small"},R[p.FileCategory.AUDIO]={label:s._("Audio"),tooltip:s._("MP3, WAV, MID, and more",{comment:"Intended to represent 3 of the most common file formats for audio."}),icon:"audio-small"},R[p.FileCategory.VIDEO]={label:s._("Video"),tooltip:s._("MOV, WMV, MP4, and more",{comment:"Intended to represent 3 of the most common file formats for videos."}),icon:"video-small"},R[p.FileCategory.FOLDER]={label:s._("Folders"),tooltip:s._("Dropbox folders"),icon:"folder-small"},R[p.FileCategory.PAPER]={label:s._("Paper docs"),tooltip:s._("Dropbox Paper docs"),icon:"paper-small"},R[p.FileCategory.OTHER]={label:s._("Other"),tooltip:s._("Other filetypes"),icon:"unknown-small"},R)),y;var R}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.searchBarExperiments,o=e.fileCategories;e.fileTypeFilterEnabled?h.isInFileTypeFilterExperimentAllChecked(t)&&h.allCategoriesUnchecked(o)&&this.props.onFiltersChanged({fileCategories:r.__assign({},g.FILE_CATEGORIES_CHECKED)}):h.allCategoriesUnchecked(o)||this.props.onFiltersChanged({fileCategories:r.__assign({},g.FILE_CATEGORIES_UNCHECKED)})},t.prototype.render=function(){var e=this.props.searchBarExperiments;return o.createElement("div",{onClick:this.handleClick},o.createElement("div",{className:"filter-header"},o.createElement("h3",null,s._("Filter")),this.shouldRenderResetButton()&&this.renderResetButton()),o.createElement("div",{className:"filter-item"},this.renderPathFilter()),o.createElement("div",{className:"filter-item"},this.props.fileTypeFilterEnabled&&h.isInFileTypeFilterExperiment(e)&&this.renderFileTypeFilter()),o.createElement("div",{className:"filter-item"},_.isInDeletedFilterRightRailExperiment(e)&&this.renderDeletedFilter()))},t})(o.Component);t.SearchFilters=w}),define("modules/clean/search/search_results/sidebar_view",["require","exports","tslib","external/react","modules/core/exception","modules/clean/react/browse/util","modules/core/i18n","modules/clean/search/search_results/search_filters","modules/clean/react/app_actions_view"],function(e,t,r,o,s,i,a,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);var c=(function(t){function c(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(c,t),c.prototype.render=function(){var t=this.props,r=t.context,c=t.selectedFiles,d=t.arePostTTIModulesLoaded,u=t.user,p=t.path,h=t.actionHandlers,_=t.searchBarExperiments,f=t.shouldShowDeletedFiles,m=t.viewType,S=t.responsive,E=t.onSearchFiltersChanged,T=t.fileCategories,g=t.isNautilusEnabled,F=t.isPaperEnabled;if(c.size){var w=[];if(d){w=e("modules/clean/react/browse/file_actions").getActionsForFileCollection({files:c,context:r,user:u,viewType:m,actionHandlers:h,isSearchMode:!0,responsive:S,showNewMoveDialog:!0})}if(w.length){s.assert("function"!=typeof w[0],"The primary menu item for AppActionsView must be a BrowseAppActionLink");var y=w[0],v={displayName:y.label,handleClick:y.performAction,iconName:y.iconName,className:y.className,disabled:y.disabled},A=w.slice(1).map(function(e){return"function"==typeof e?e:{displayName:e.label,handleClick:e.performAction,iconName:e.iconName,className:e.className,disabled:e.disabled}}),R=i.getSelectedFilesText(c,r);return o.createElement(l.AppActionsView,{headerText:R,popoverTriggerLabel:a._("Actions"),primaryMenuItem:v,secondaryMenuItems:A,responsive:S})}}return o.createElement(n.SearchFilters,{user:u,searchBarExperiments:_,path:p,onFiltersChanged:E,deletedFiles:f,fileCategories:T,fileTypeFilterEnabled:g,isPaperEnabled:F})},c})(o.PureComponent);t.SearchResultsSidebarView=c}),define("modules/clean/search/search_results/store",["require","exports","tslib","external/immutable","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/react/selection","modules/clean/search/constants","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/search/store_helpers"],function(e,t,r,o,s,i,a,n,l,c,d){"use strict";function u(){return null===_&&(_=new h),_}function p(){return null!==_}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),n=r.__importStar(n),d=r.__importStar(d);var h=(function(e){function t(t){var r=e.call(this,t)||this;return r._resetSearchResults(),r}return r.__extends(t,e),t.prototype._resetSearchResults=function(){this._browseContext=void 0,this._rawQuery="",this._latestQuery="",this._loadingState=n.SearchLoadingState.LOADED,this._fullSearchResults=o.OrderedMap(),this._searchResults=o.List(),this._selection=void 0,this._hasMoreLiveResults=!0,this._numDeletedResults=0,this._hasMoreDeletedResults=!0,this._didLoadDeletedResults=!1,this._latestFileCategories=n.FILE_CATEGORIES_UNCHECKED},t.prototype.rawQuery=function(){return this._rawQuery},t.prototype.searchSessionId=function(){return this._searchSessionId},t.prototype.queryId=function(){return this._queryId},t.prototype.browseContext=function(){return this._browseContext||(this._browseContext=new c.BrowseContext)},t.prototype.latestQuery=function(){return this._latestQuery},t.prototype.loadingState=function(){return this._loadingState},t.prototype.searchResults=function(){return this._searchResults},t.prototype.fullSearchResults=function(){return this._fullSearchResults},t.prototype.hasMoreResults=function(e){return void 0===e&&(e=!1),this._hasMoreLiveResults||e&&this._hasMoreDeletedResults},t.prototype.numDeletedResults=function(){return this._numDeletedResults},t.prototype.didLoadDeletedResults=function(){return this._didLoadDeletedResults},t.prototype.selection=function(){return this._selection||(this._selection=a.createSelection())},t.prototype.selectedFiles=function(){var e=this,t=this._searchResults.filter(function(t){return t instanceof c.File&&e.selection().selected.has(t.fq_path)});return o.OrderedMap(t.map(function(e){return[e.fq_path,e]}))},t.prototype.latestFileCategories=function(){return this._latestFileCategories},t.prototype._setRawQuery=function(e,t){t?this._searchSessionId=t:d.shouldStartNewSearchSession(this._rawQuery,e)&&(this._searchSessionId=d.generateRandomId()),this._rawQuery=e},t.prototype._setSearchQuery=function(e){var t=e.query;this._setRawQuery(t),this.emit_change()},t.prototype._startSearch=function(e){var t=e.query,r=e.searchSessionId,o=e.queryId,s=e.fileCategories;this._setRawQuery(t,r),this._latestQuery=d.normalize(t),this._loadingState=n.SearchLoadingState.LOADING_FIRST_PAGE,this._hasMoreLiveResults=!0,this._numDeletedResults=0,this._hasMoreDeletedResults=!0,this._didLoadDeletedResults=!1,this._queryId=o,this._latestFileCategories=s?s:n.FILE_CATEGORIES_UNCHECKED,this.emit_change()},t.prototype._setSearchResults=function(e){var t=e.searchResults,r=e.context,o=e.deletedFiles;e.queryId===this.queryId()&&(this._setSearchResultsInternal(t,o),this._loadingState=n.SearchLoadingState.LOADED,r&&(this._browseContext=r),this._updateMoreResults(t),this.emit_change())},t.prototype._setFullSearchResults=function(e){var t=e.searchResults;if(e.queryId===this._queryId){for(var r=0,o=t;r<o.length;r++){var s=o[r];this._fullSearchResults=this._fullSearchResults.set(s.fq_path,s)}this._loadingState=n.SearchLoadingState.LOADED,this.emit_change()}},t.prototype._setSearchResultsInternal=function(e,t){this._searchResults=o.List(e),t&&(this._numDeletedResults=e.length)},t.prototype._continueSearch=function(e){e.didLoadDeletedResults&&(this._didLoadDeletedResults=!0),this._loadingState=n.SearchLoadingState.LOADING_ADDITIONAL_PAGE,this.emit_change()},t.prototype._appendSearchResults=function(e){var t=e.deleted,r=e.searchResults;t&&(this._numDeletedResults+=r.length),this._searchResults=this._searchResults.concat(r),this._loadingState=n.SearchLoadingState.LOADED,this._updateMoreResults(r),this.emit_change()},t.prototype._clearSearch=function(){this._resetSearchResults(),this.emit_change()},t.prototype._updateMoreResults=function(e){var t=e.length===n.MaxResults.MAX_SEARCH_RESULTS;this._hasMoreLiveResults?this._hasMoreLiveResults=t:this._hasMoreDeletedResults&&(this._hasMoreDeletedResults=t)},t.prototype._setSearchSelection=function(e){var t=e.selection;this._selection=t,this.emit_change()},t.prototype._selectFirstFile=function(){var e=this._searchResults.find(function(e){return e instanceof c.File});e&&this._setSearchSelection({selection:a.createSelection([e.fq_path])})},t.prototype._applyFileDeltas=function(e){var t=e.fileDeltas;if(t){for(var r=function(e,t){var r=void 0;!e&&t?o._searchResults=o._searchResults.push(t):e&&!t?(r=o._searchResults.findIndex(function(t){return t instanceof c.File&&s.paths_are_equal(t.fq_path,e)}),o._searchResults=o._searchResults.delete(r)):e&&t&&(r=o._searchResults.findIndex(function(t){return t instanceof c.File&&s.paths_are_equal(t.fq_path,e)}),o._searchResults=r>-1?o._searchResults.set(r,t):o._searchResults.push(t))},o=this,i=0,a=t;i<a.length;i++){var n=a[i];r(n.before,n.after)}this.emit_change()}},t.prototype._updateContext=function(e){this._browseContext=e.context},t.prototype._new_payload=function(e){switch(e.action.type){case n.START_SEARCH_ACTION:this._startSearch(e.action.data);break;case n.SET_SEARCH_RESULTS_ACTION:this._setSearchResults(e.action.data);break;case n.CONTINUE_SEARCH_ACTION:this._continueSearch(e.action.data);break;case n.APPEND_SEARCH_RESULTS_ACTION:this._appendSearchResults(e.action.data);break;case n.SET_FULL_SEARCH_RESULTS_ACTION:this._setFullSearchResults(e.action.data);break;case n.SET_SEARCH_SELECTION_ACTION:this._setSearchSelection(e.action.data);break;case n.CHANGE_FILES_ACTION:this._applyFileDeltas(e.action.data);break;case n.CLEAR_SEARCH_ACTION:this._clearSearch();break;case l.DEPRECATED__BrowseActionType.LOAD_PATH:this._updateContext(e.action.data);break;case n.SELECT_FIRST_FILE_ACTION:this._selectFirstFile()}},t})(i.Store);t.SearchResultsStore=h;var _=null;t.getSearchResultsStore=u,t.searchResultsStoreInstantiated=p}),define("modules/clean/search/search_results/view",["require","exports","tslib","external/lodash","external/react","spectrum/table","spectrum/tip_card","modules/clean/em_string","modules/clean/filepath","modules/clean/history","modules/clean/illustration_helper","modules/clean/react_format","modules/clean/react/files_view/constants","modules/clean/react/files_view/controller","modules/clean/react/files_view/file_list_empty_folder_table","modules/clean/react/files_view/fixed_table_head","modules/clean/react/files_view/types","modules/clean/react/image","modules/clean/search/constants","modules/clean/search/search_bar/experiments","modules/clean/search/search_helpers","modules/core/i18n","modules/core/uri"],function(e,t,r,o,s,i,a,n,l,c,d,u,p,h,_,f,m,S,E,T,g,F,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),l=r.__importStar(l),c=r.__importDefault(c),E=r.__importStar(E),g=r.__importStar(g);var y=(function(e){function t(t){var o=e.call(this,t)||this;return o._handleScroll=function(){o.props.onScroll()},o._ensureFileViewerClosedIfNotPreviewing=function(){var e=c.default.deconstruct_url().qargs;o.props.ensureFileViewerClosedIfNotPreviewing(e)},o._handleFullSearchOnClick=function(e){e.preventDefault(),o.props.onSearch(o.props.latestQuery,"/")},o._handleEmptyFolderViewTTI=function(){o.props.handleComponentTTI("FilesViewController")},o._handleSearchAllFiles=function(e){e.preventDefault();var t=o.props.path;o.props.onSearchFiltersChanged({path:t,deletedFiles:!1})},o._handleSearchDeletedFiles=function(e){e.preventDefault();var t=o.props.path;o.props.onSearchFiltersChanged({path:t,deletedFiles:!0})},o._handleRemoveAllFilters=function(e){e.preventDefault();var t=o.props,s=t.shouldShowDeletedFiles,i=t.searchBarExperiments;o.props.onSearchFiltersChanged({path:"/",deletedFiles:s,fileCategories:g.isInFileTypeFilterExperimentAllChecked(i)?r.__assign({},E.FILE_CATEGORIES_CHECKED):r.__assign({},E.FILE_CATEGORIES_UNCHECKED)})},o._getEmptyFolderViewUrl=function(e,t){var r=o.props,s=r.user,i=r.latestQuery,a=r.searchSessionId;return g.buildSearchURL({user:s,searchPath:e,normalizedQuery:i,searchSessionId:a,searchToken:g.getSearchCsrfToken(),qargs:{d:t?"1":void 0}}).toString()},o._getRemoveAllFiltersViewUrl=function(e){var t=o.props,r=t.user,s=t.latestQuery,i=t.searchSessionId,a=t.searchBarExperiments;return g.buildSearchURL({user:r,searchPath:"/",normalizedQuery:s,searchSessionId:i,searchToken:g.getSearchCsrfToken(),qargs:{d:e?"1":void 0,file_categories:g.isInFileTypeFilterExperimentAllChecked(a)?g.fileCategoriesToString(E.FILE_CATEGORIES_CHECKED):void 0}}).toString()},o._renderEmptyFolderSubtitle=function(){var e=o.props,t=e.path,r=e.shouldShowDeletedFiles,i=e.searchBarExperiments,a=e.fileCategories;return l.paths_are_equal(t,"/")&&!g.fileCategoriesSet(a,i)?r?u.reactFormat(F._("Try different keywords or <Link>search files that aren’t deleted</Link>"),{Link:s.createElement("a",{href:o._getEmptyFolderViewUrl(t,!1),onClick:o._handleSearchAllFiles})}):T.isInDeletedFilterRightRailExperiment(i)?u.reactFormat(F._("Try different keywords or <Link>search deleted files</Link>"),{Link:s.createElement("a",{href:o._getEmptyFolderViewUrl(t,!0),onClick:o._handleSearchDeletedFiles})}):F._("Try different keywords"):r?u.reactFormat(F._("<LinkScope>Search all folders</LinkScope> or <LinkDeleted>files that aren’t deleted</LinkDeleted>"),{LinkScope:s.createElement("a",{href:o._getEmptyFolderViewUrl("/",r),onClick:o._handleRemoveAllFilters}),LinkDeleted:s.createElement("a",{href:o._getEmptyFolderViewUrl(t,!1),onClick:o._handleSearchAllFiles})}):T.isInDeletedFilterRightRailExperiment(i)?u.reactFormat(F._("<LinkScope>Search all folders</LinkScope> or <LinkDeleted>deleted files</LinkDeleted>"),{LinkScope:s.createElement("a",{href:o._getEmptyFolderViewUrl("/",r),onClick:o._handleRemoveAllFilters}),LinkDeleted:s.createElement("a",{href:o._getEmptyFolderViewUrl(t,!0),onClick:o._handleSearchDeletedFiles})}):u.reactFormat(F._("Try <LinkScope>resetting all filters</LinkScope>"),{LinkScope:s.createElement("a",{href:o._getRemoveAllFiltersViewUrl(),onClick:o._handleRemoveAllFilters})})},o._renderEmptyFolderView=function(e){var t=o.props.path,r=l.paths_are_equal(t,"/"),a=F._("No results found");if(o.shouldRenderNewEmptyState())return s.createElement("div",null,s.createElement(i.Table,{columnFlex:[p.CHECKBOX_CELL_FLEX,1]},s.createElement(f.FixedTableHead,{offsetHeight:p.DEFAULT_COLUMN_HEADER_HEIGHT},s.createElement(i.TableHeadCell,{className:"brws-column-header-table-cell brws-checkbox-cell",key:"checkbox-cell",role:"columnheader",scope:"col"},s.createElement("div",{className:"brws-vertically-center"})),s.createElement(i.TableHeadCell,{role:"columnheader",scope:"col",
className:"brws-column-header-table-cell"},s.createElement("div",{className:"normal brws-column-header-menu"},s.createElement("span",{className:"brws-column-header-menu-trigger-disabled"},o._searchResultsTitle(e))))),s.createElement("tbody",null,s.createElement("tr",null,s.createElement("td",null),s.createElement("td",null)))),s.createElement("div",{className:"u-font-center u-pad-top-xl"},s.createElement(S.Image,{src:d.empty_state_url("search"),srcHiRes:d.empty_state_url("search@2x"),alt:""}),s.createElement("h2",{className:"u-font-strong empty-folder-table-title"},a),s.createElement("span",null,o._renderEmptyFolderSubtitle())));var n=r?F._("Please update your search and try again"):F._("Search all of my Dropbox instead"),c=r?void 0:o._getFullSearchLink(),u=r?void 0:o._handleFullSearchOnClick;return s.createElement(_.EmptyFolderTable,{title:a,subtitle:n,subtitleLink:c,subtitleOnClick:u,onTTI:o._handleEmptyFolderViewTTI})},o._renderDeletedFilesTipcard=function(){return T.isInDeletedFilterRightRailExperiment(o.props.searchBarExperiments)&&o.props.shouldShowDeletedFiles&&o.props.loadingState===E.SearchLoadingState.LOADED&&o.props.searchResults.count()>0?s.createElement(a.TipCard,{className:"mc-tip-card--deleted-files"},u.reactFormat(F._("Can’t find what you’re looking for? <a>View all deleted files</a>"),{a:s.createElement("a",{href:"/deleted_files"})})):null},o.state={},o}return r.__extends(t,e),t.prototype.componentWillMount=function(){c.default.add_callback("/search",this._ensureFileViewerClosedIfNotPreviewing)},t.prototype.componentDidMount=function(){window.addEventListener("scroll",this._handleScroll)},t.prototype.componentWillUnmount=function(){window.removeEventListener("scroll",this._handleScroll),c.default.remove_callback("/search",this._ensureFileViewerClosedIfNotPreviewing)},t.prototype._getFullSearchLink=function(){var e=this.props,t=e.latestQuery,r=e.searchSessionId,o=e.user;return w.URI.parse("/search/"+o.role).setQuery({path:"/",query:t,searchSessionId:r}).toString()},t.prototype.shouldRenderNewEmptyState=function(){var e=this.props.searchBarExperiments;return g.isInFileTypeFilterExperiment(e)||T.isInDeletedFilterRightRailExperiment(e)||T.isInSinglePageSearchExperiment(e)},t.prototype._searchResultsTitle=function(e){var t=T.isInSinglePageSearchExperiment(this.props.searchBarExperiments)&&this.props.loadingState===E.SearchLoadingState.LOADING_FIRST_PAGE?this.props.queryForResultsTitle:this.props.latestQuery,r=this.props,o=r.searchResults,i=r.path,a=r.viewType,c=r.shouldShowDeletedFiles,d=o.size,p=l.paths_are_equal(i,"/");if(!this.shouldRenderNewEmptyState()&&0===d)return"";var h,_=e.isMatchedMedium?e.isMatchedLarge?30:20:10;a===m.ViewType.List&&(_/=2);if(p){var f=n.Emstring.em_snippet(t,_,.6);h=c?F.ungettext("%(size)d deleted result for “%(query)s”","%(size)d deleted results for “%(query)s”",d).format({size:d,query:f}):F.ungettext("%(size)d result for “%(query)s”","%(size)d results for “%(query)s”",d).format({size:d,query:f})}else{var S=n.Emstring.em_snippet(l.filename(i),_/2,.6),f=n.Emstring.em_snippet(t,_/2,.6);h=c?u.reactFormat(F.ungettext("%(size)d deleted result for “%(query)s” in <strong>%(path)s</strong>","%(size)d deleted results for “%(query)s” in <strong>%(path)s</strong>",d).format({size:d,query:f,path:S}),{strong:s.createElement("strong",null)}):u.reactFormat(F.ungettext("%(size)d result for “%(query)s” in <strong>%(path)s</strong>","%(size)d results for “%(query)s” in <strong>%(path)s</strong>",d).format({size:d,query:f,path:S}),{strong:s.createElement("strong",null)})}return h},t.prototype._getLoadingState=function(){var e=this.props,t=e.searchResults,r=e.searchBarExperiments,o=e.loadingState;return T.isInSinglePageSearchExperiment(r)&&!t.isEmpty()?m.LoadingState.LOADED:o===E.SearchLoadingState.LOADING_FIRST_PAGE?m.LoadingState.LOADING_FIRST_PAGE:o===E.SearchLoadingState.LOADING_ADDITIONAL_PAGE?m.LoadingState.LOADING_REMAINING_PAGES:m.LoadingState.LOADED},t.prototype._renderSearchResultItems=function(e){var t=this.props,i=t.getOverflowMenuActions,a=t.onFocusSearchBar,n=t.onLocationLinkClick,l=t.onNavigateToFileOrFolder,c=t.onNavigateToParentFolder,d=t.onOpenPaper,u=t.context,_=t.fileRename,f=t.searchResults,S=t.getIsFileJumping,E=t.isFileViewerShown,T=t.arePostTTIModulesLoaded,g=t.handleComponentTTI,F=t.onSelectionChange,w=t.selectedFiles,y=t.selection,v=t.setFileUploaderPath,A=t.viewType,R=t.user,b=t.path,I=t.filesViewActionHandlers,P=t.renderSharedWithController,C=t.hrefForFile,D=t.starredState,O=t.pageHeaderHeight;return s.createElement(h.FilesViewController,r.__assign({},I,{getOverflowMenuActions:i,onLocationLinkClick:n,onNavigateToFileOrFolder:l,onNavigateToParentFolder:c,onOpenPaper:d,context:u,customEmptyFolderView:this._renderEmptyFolderView,createNewFolderState:m.NewFolderCreationState.CREATE_FOLDER_INACTIVE,fileRename:_,items:f,getIsFileJumping:S,isFileViewerShown:E,isSearchMode:!0,arePostTTIModulesLoaded:T,isTextSelectable:!1,loadingState:this._getLoadingState(),onComponentTTI:g,onSelectionChange:F,onSortChange:o.noop,onFocusSearchBar:a,path:b,selectedFiles:w,selection:y,setFileUploaderPath:v,showFileUploaderModal:o.noop,user:R,viewType:A,totalNumFiles:f.size,responsive:e,columns:this._generateColumns(e),renderSharedWithController:P,hrefForFile:C,viewTypes:p.AllViewTypes,viewTypeLabels:p.ViewTypeLabels,starredState:D,pageHeaderHeight:O}))},t.prototype._generateColumns=function(e){var t=this;return(this.props.shouldShowDeletedFiles?p.SEARCH_LIST_VIEW_COLUMNS_DELETED:p.SEARCH_LIST_VIEW_COLUMNS).map(function(o,s){return r.__assign({},o,{label:0===s?t._searchResultsTitle(e):o.label})})},t.prototype.render=function(){var e=this.props.responsive;return s.createElement("div",{className:"search-results"},this._renderSearchResultItems(e),this._renderDeletedFilesTipcard())},t})(s.Component);t.SearchResultsView=y}),define("modules/clean/web_upload_action_logger",["require","exports","tslib","modules/clean/ajax"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.MAX_ERRORS=3;var s=(function(){function e(){this.errorCount=0,this.lastError=Date.now(),this.shouldReport=!0}return e.prototype.log=function(e,r,s){var i=this;return this.shouldReport&&(this.errorCount<t.MAX_ERRORS||Date.now()-this.lastError>6e5)?new Promise(function(a,n){o.SilentBackgroundRequest({url:"/log/web_upload_action",data:{_subject_uid:e,event_type:r,extra_params:JSON.stringify(s)},error:function(e){429===e.status?i.errorCount=t.MAX_ERRORS:i.errorCount++,i.lastError=Date.now(),n(e)},success:function(e){try{var t=JSON.parse(e);t&&!t.continue_sending&&(i.shouldReport=!1),i.errorCount=0,a(e)}catch(e){throw i.errorCount++,i.lastError=Date.now(),n(e),e}}})}):Promise.resolve({})},e})();t.WebUploadActionLog=new s,t.WebUploadActionLogClass=s});
//# sourceMappingURL=pkg-browse.min.js-vflwjnyJI.map