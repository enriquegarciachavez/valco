define(["require","exports","tslib","react","classnames","spectrum/tertiary_link","spectrum_comments/comment","spectrum_comments/thread/thread_editor","prop-types"],function(e,t,n,o,r,i,s,a,c){"use strict";function d(e,t){var n=t.localization,r=e.count,i=n.threadCollapsedCommentsText(r);return o.createElement("div",{className:"sc-thread-comment-number"},i)}function l(e,t){return{onDeleted:function(){return t.onCommentDeleted(e.id)},onEdited:function(n){return t.onCommentEdited(e.id,n)},onMentionsQueryUpdated:t.onMentionsQueryUpdated,onClickTimeCode:t.onClickTimeCode}}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){};d.contextTypes={localization:c.object};var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isEditorEmpty:!0,shouldFocus:!1},t._isMounted=!1,t.onEditorCancel=t.props.onCancel,t.clickInactive=function(){t.props.onActivated()},t.onEditorContentChange=function(e){e.isFocused&&t.props.actions.onEditorFocused(),t.props.actions.onEditorContentChange(e),t.setState({isEditorEmpty:e.isEmpty})},t.onEditorPost=t.props.actions.onReply,t.onMentionsQueryUpdated=t.props.actions.onMentionsQueryUpdated,t.setRef=function(e){t.ref=e},t}return n.__extends(t,e),Object.defineProperty(t.prototype,"localization",{get:function(){return this.context.localization},enumerable:!0,configurable:!0}),t.prototype.componentDidMount=function(){this._isMounted=!0,this.props.active&&(this.scrollToThread(),this.props.onActivated())},t.prototype.componentDidUpdate=function(e){this.props.active&&!e.active?this.scrollToThread():!this.props.active&&e.active&&this.setState({shouldFocus:!1})},t.prototype.componentWillUnmount=function(){this._isMounted=!1},t.prototype.scrollToThread=function(){var e=this,t=this.props.scrollToElem,n=this.ref;n&&t&&t(n).then(function(){e._isMounted&&e.setState({shouldFocus:!0})})},Object.defineProperty(t.prototype,"active",{get:function(){return this.props.active||!this.state.isEditorEmpty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){var e=this.props,t=e.className,n=void 0===t?"":t,o=e.thread,i=e.isMobile;return r(n,{"sc-thread":!0,"sc-thread-active":this.active,"sc-thread-inactive":!this.active,"sc-thread-read":o.read,"sc-thread-unread":!o.read,"sc-thread-resolved":o.resolved,"sc-thread-unresolved":!o.resolved,"sc-thread-mobile":i})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filteredReplies",{get:function(){var e=this.props.thread.comments;e[0];return e.slice(1).filter(function(e){return!e.deleted})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includeEditor",{get:function(){var e=this.props,t=e.user,n=e.isMobile;return t&&!n},enumerable:!0,configurable:!0}),t.prototype.truncateComment=function(e){var t=e.content.text;if(t.length>100){var o=e.content.metadata;return n.__assign({},e,{content:{metadata:o.reduce(function(e,t){if("sticker"===t.type)return e.concat([t]);var o=t.location;return o.start<100?e.concat([n.__assign({},t,{location:n.__assign({},o,{end:Math.min(o.end,100)})})]):e},[]),text:t.substr(0,100)+"…"}})}return e},t.prototype.renderComment=function(e,t,n,r){void 0===n&&(n=s.Comment);var i=this.props,a=i.actions,c=i.editedComment,d=i.mentionsMatches,u=i.onStartEdit,m=i.onEndEdit,h=i.isMobile,p=!!c&&e.id===c.id;return t||(e=this.truncateComment(e)),o.createElement(n,{actions:l(e,a),active:t,annotation:r,comment:e,key:e.id,isEditing:p,onStartEdit:u,onEndEdit:m,mentionsMatches:d,isMobile:h})},t.prototype.renderReadToggle=function(){var e=this.localization,t=this.props,n=t.actions,r=t.thread,s=r.read?n.onMarkAsUnread:n.onMarkAsRead,a=r.read?e.markAsUnreadLabel:e.markAsReadLabel;return o.createElement(i.TertiaryLink,{className:"sc-thread-toggle sc-thread-controls-left",onClick:s},a)},t.prototype.renderToplineControls=function(){var e=this.localization,t=this.props,n=t.user,r=t.isMobile,s=t.actions,a=t.thread;if(!n||r)return null;var c=this.active;return a.resolved?o.createElement("div",{className:"sc-thread-controls"},o.createElement("div",{className:"sc-thread-controls-resolved-note sc-thread-controls-left"},e.markAsResolvedLabel),c&&o.createElement(i.TertiaryLink,{className:"sc-thread-toggle sc-thread-controls-right",onClick:s.onUnresolve},e.threadRestoreLabel)):c?o.createElement("div",{className:"sc-thread-controls"},this.renderReadToggle(),o.createElement(i.TertiaryLink,{className:"sc-thread-toggle sc-thread-controls-right",onClick:s.onResolve},e.threadResolveLabel)):null},t.prototype.renderActive=function(){var e=this,t=this.props,n=t.actions,r=n.onMouseEnter,i=n.onMouseLeave,c=t.commentComponent,d=t.mentionsMatches,l=t.thread,u=t.user,m=(t.isMobile,this.filteredReplies);return o.createElement("li",{onMouseEnter:r,onMouseLeave:i,className:this.className,ref:this.setRef},this.renderToplineControls(),o.createElement("ul",{className:"sc-thread-comments"},this.renderComment(l.comments[0],this.active,c,l.annotation),m.map(function(t){return e.renderComment(t,!0,s.Comment)})),this.includeEditor&&o.createElement(a.ThreadEditor,{author:u,shouldFocus:this.state.shouldFocus,mentionsMatches:d,onCancel:this.onEditorCancel,onContentChange:this.onEditorContentChange,onMentionsQueryUpdated:this.onMentionsQueryUpdated,onPost:this.onEditorPost}))},t.prototype.renderInactive=function(){var e=this.props,t=e.actions,n=t.onMouseEnter,r=t.onMouseLeave,i=e.active,a=e.commentComponent,c=void 0===a?s.Comment:a,l=e.mentionsMatches,m=(e.onActivated,e.thread),h=e.isMobile,p=(e.user,this.filteredReplies);return o.createElement("li",{className:this.className,tabIndex:0,onClick:this.clickInactive,onMouseEnter:n,onMouseLeave:r,ref:this.setRef},this.renderToplineControls(),o.createElement("ul",{className:"sc-thread-comments"},this.renderComment(m.comments[0],i,c,m.annotation),p.length>1&&o.createElement(d,{count:p.length-1}),p.length>0&&o.createElement(s.Comment,{active:!1,comment:this.truncateComment(p[p.length-1]),actions:{onClickTimeCode:u,onDeleted:u,onEdited:u,onMentionsQueryUpdated:u},mentionsMatches:l,onEndEdit:u,onStartEdit:u,isEditing:!1,isMobile:h})),this.includeEditor&&o.createElement("div",{className:"sc-thread-reply-hint"},"Reply…"))},t.prototype.render=function(){return this.props.thread.comments.every(function(e){return!!e.deleted})?null:this.active?this.renderActive():this.renderInactive()},t.contextTypes={localization:c.object},t})(o.PureComponent);t.Thread=m});
//# sourceMappingURL=thread.min.js-vflYovQ5g.map