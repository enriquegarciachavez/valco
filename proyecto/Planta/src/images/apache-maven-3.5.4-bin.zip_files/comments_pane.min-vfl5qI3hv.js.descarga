define(["require","exports","tslib","external/react","external/react-redux","modules/clean/react/css","spectrum_comments/comment_stream","modules/clean/react/comments2/actions_adapters/index","modules/clean/react/comments2/util","modules/clean/react/comments2/util","modules/clean/react/comments2/transforms","modules/clean/react/comments2/data/selectors","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/mentions_api","modules/clean/react/file_viewer/coach_mark","modules/clean/react/file_viewer/more_dropdown/more_option_registry","modules/clean/react/file_action_button","modules/clean/react/file_viewer/more_dropdown/models","modules/clean/previews/constants","spectrum_comments/comment/time_coded_comment","spectrum_comments/comment_editor/comment_editor","spectrum_comments/comment_editor/time_coded_comment_editor","modules/clean/react/comments2/video_annotations/constants","modules/clean/react/comments2/video_annotations/video_preview_event_emitter","modules/core/i18n","modules/clean/react/comments2/components/comments_translations"],function(e,t,o,n,i,s,r,a,m,c,d,p,l,u,h,v,_,b,g,w,C,O,E,y,f,A){"use strict";function M(e){var t,i=e.playerCurrentTime,s=e.previewType,r=e.showOnboarding,a=e.onCoachmarkClose;return s===g.PreviewType.Audio?t=O.AudioCommentEditor:s===g.PreviewType.Video&&(t=O.VideoCommentEditor),t?n.createElement(t,o.__assign({},e,{currentTime:i||0,showCoachmark:r,createCoachmark:function(){return n.createElement(h.CoachMark,{title:f._("Target your feedback"),arrowPosition:"top-right",showClose:!0,onCloseButtonClick:a},f._("Adding time codes to comments keeps feedback simple, organized, and all in one place."))}})):n.createElement(C.CommentEditor,o.__assign({},e))}Object.defineProperty(t,"__esModule",{value:!0}),n=o.__importStar(n),i=o.__importStar(i),p=o.__importStar(p);var T=(function(e){function t(t){var i=e.call(this,t)||this;return i.updateMentionsMatches=function(e){i.setState({mentionsMatches:e})},i.onMentionsQueryUpdated=function(e){i.mentionsApi.query(e,i.updateMentionsMatches)},i.videoPreviewOnboardingDismissed=function(){i.props.dispatch(l.Actions.suppressOnboardingForSession("video_first_paused"))},i.toggleShowResolved=function(){var e=i.props,t=e.dispatch,o=e.showResolved,n=o?"hide_resolved_threads":"show_resolved_threads";t(l.Actions.toggleShowResolved()),t(l.Actions.logEvent(n))},i.setCommentsEnabled=function(){i.props.dispatch(l.Actions.enableCommenting())},i.setCommentsDisabled=function(){i.props.dispatch(l.Actions.disableCommenting())},i.createEditor=function(e){var t=i.props,s=t.playerCurrentTime,r=t.showOnboarding,a=t.stream.previewType;return n.createElement(M,o.__assign({},e,{playerCurrentTime:s,previewType:a,showOnboarding:r,onCoachmarkClose:i.onCoachmarkClose}))},i.onCoachmarkClose=function(){i.props.dispatch(l.Actions.suppressOnboardingForSession("initial_video_land")),c.markBrowserHasDismissedOnboardingPopup()},i.mentionsApi=u.mentionsApi(t.viewer),i.state={mentionsMatches:i.mentionsApi.cache},i}return o.__extends(t,e),t.prototype.buildResolveOption=function(){var e=this.props.showResolved?_.FileActionButtonType.HIDE_RESOLVED_COMMENTS:_.FileActionButtonType.SHOW_RESOLVED_COMMENTS;return new b.MoreOption({className:"comments-options-item__show-resolved",fileActionButtonType:e,component:function(e){return n.createElement("span",null,e.buttonText)},handler:this.toggleShowResolved})},t.prototype.buildEnableOption=function(){var e,t;return this.props.isEnabled?(e=_.FileActionButtonType.DISABLE_COMMENTS,t=this.setCommentsDisabled):(e=_.FileActionButtonType.ENABLE_COMMENTS,t=this.setCommentsEnabled),new b.MoreOption({className:"comments-options-item__disable",fileActionButtonType:e,component:function(e){return n.createElement("span",null,e.buttonText)},handler:t})},t.prototype.updateCommentsMoreOptionGroup=function(){var e=[];m.canComments2EnableDisable(this.props.viewer)&&this.props.canEnable&&e.push(this.buildEnableOption()),e.push(this.buildResolveOption());var t=new b.MoreOptionGroup({fileActionButtonGroup:_.FileActionButtonGroup.COMMENTS,options:e});void 0===this.moreOptionGroup?v.moreOptionRegistry.addOption(t):v.moreOptionRegistry.replaceOption(this.moreOptionGroup,t),this.moreOptionGroup=t},t.prototype.componentDidMount=function(){this.updateCommentsMoreOptionGroup(),y.videoPreviewEventEmitter.addListener(E.EventTypes.ONBOARDING_DISMISSED,this.videoPreviewOnboardingDismissed);var e=this.props,t=e.dispatch,o=e.showOnboarding;t(l.Actions.logEvent("show_comments"));var n=c.hasBrowserDismissedOnboardingPopup()&&Math.random()<.8;t(l.Actions.setSoftHideCommentsPaneOnboarding(n)),o&&!n&&t(l.Actions.logEvent("sidebar_onboarding_shown"))},t.prototype.componentDidUpdate=function(e){var t=this.props,o=t.showOnboarding,n=t.dispatch;this.updateCommentsMoreOptionGroup(),!e.showOnboarding&&o&&n(l.Actions.logEvent("sidebar_onboarding_shown"))},t.prototype.componentWillUnmount=function(){this.moreOptionGroup&&v.moreOptionRegistry.removeOption(this.moreOptionGroup),y.videoPreviewEventEmitter.removeListener(E.EventTypes.ONBOARDING_DISMISSED,this.videoPreviewOnboardingDismissed)},Object.defineProperty(t.prototype,"actionsAdapter",{get:function(){var e=this.props,t=e.dispatch,o=e.onboardingKeysNotYetMarked,n=e.stream,i=e.viewer;return a.createActionsAdapter(t,n,o,this.onMentionsQueryUpdated,i)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"commentComponent",{get:function(){return this.props.stream.previewType===g.PreviewType.Audio||this.props.stream.previewType===g.PreviewType.Video?w.TimeCodedComment:void 0},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e,t=this.props,o=t.showResolved,i=t.isMobile,s=t.stream,a=t.viewer,c=t.activeThreadId,p=this.props.threads.filter(function(e){return o||!e.resolved});return a&&(e=d.dbxUserToIUser(a)),n.createElement("div",{className:"comments-pane-wrapper"},n.createElement(r.CommentStream,{id:s.id,actionsAdapter:this.actionsAdapter,commentComponent:this.commentComponent,editorComponent:this.createEditor,enabled:!0,isMobile:!!i,mentionsMatches:this.state.mentionsMatches,settings:{canAnnotate:!0,canComment:!0,canRead:!0},userPermissions:{canAnnotate:!0,canComment:!0,canRead:!0},threads:p,user:e,activeThreadID:c,renderWithOldComponents:!m.isComments2ReadonlyEditor(a),localization:A.commentsMasterLocalization}))},t})(n.Component);t.CommentsPaneComponent=T;var S=i.connect(function(e){var t=p.getContext(e),o=t.stream,n=t.viewer;return{activeThreadId:p.getActivatedThreadId(e),playerCurrentTime:p.getPlayerCurrentTime(e),onboardingKeysNotYetMarked:p.getOnboardingKeysNotYetMarked(e),showOnboarding:p.getShowOnboardingOnCommentsPane(e),showResolved:p.getShowResolved(e),canEnable:p.getCanEnable(e),isEnabled:p.getIsEnabled(e),stream:o,threads:p.getThreads(e),viewer:n}})(T);t.CommentsPane=s.requireCssWithComponent(S,["/static/js/spectrum_comments/index.web-vflf5d9bR.css","/static/css/comments2-sidebar-vflu2ROdS.css"])});
//# sourceMappingURL=comments_pane.min.js-vflT6UrWo.map