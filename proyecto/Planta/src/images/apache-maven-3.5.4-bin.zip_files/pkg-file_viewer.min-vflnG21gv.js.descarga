define("esignature_prototype/components/create_signature_modal",["require","exports","tslib","esignature_prototype/constants","external/react","modules/clean/react/modal","spectrum_signatures_prototype/signature_creation_modal"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var s=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setCanvasRef=function(e){t.canvas=e},t.handleSubmitSignature=function(e){r.Modal.close();var n=t.canvas.getContext("2d");if(n){n.font=o.SIGNATURE_FONT;var i=n.measureText(e).width;t.canvas.style.width=i+"px",t.canvas.width=3*i,t.canvas.style.height=o.SIGNATURE_HEIGHT+"px",t.canvas.height=3*o.SIGNATURE_HEIGHT,n.scale(3,3),n.font=o.SIGNATURE_FONT,n.fillText(e,0,30);var a=t.canvas.toDataURL();t.props.onSubmit({dataUri:a,width:t.canvas.width,height:t.canvas.height})}},t.handleDismissSignatureModal=function(){t.props.onSubmit(),r.Modal.close()},t}return n.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){!this.props.open&&e.open&&this.showSignatureCreationModal()},t.prototype.showSignatureCreationModal=function(){r.Modal.showInstance(i.createElement(a.SignatureCreationModal,{open:!0,onSubmit:this.handleSubmitSignature,onClose:this.handleDismissSignatureModal}))},t.prototype.render=function(){return i.createElement("canvas",{className:"signature-canvas",ref:this.setCanvasRef})},t})(i.Component);t.CreateSignatureModal=s}),define("esignature_prototype/components/creating_esignature_field",["require","exports","tslib","external/react","external/classnames"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),i=n.__importDefault(i),t.CreatingEsignatureField=function(e){var t=e.field,r=e.colorScheme,a={left:t.rect.left,bottom:t.rect.bottom,width:t.rect.width,height:t.rect.height};return o.createElement("div",{className:i.default("esignature-field-placer","creaitng-esignature-field","esignature-field-placer-"+r),style:n.__assign({},a)})}}),define("esignature_prototype/components/esignature_confirmation_page",["require","exports","tslib","external/react","modules/clean/react/maestro_nav/shared_code/constants","modules/clean/react/maestro_nav/shared_code/dropbox_logo","modules/clean/react/maestro_nav/shared_code/nested-nav","modules/clean/react/maestro_nav/shared_code/strings","modules/clean/react/css"],function(e,t,n,o,i,r,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var c=function(e){var t=e.children;return o.createElement("div",{className:"esignature-confirmation-page"},o.createElement("div",{className:"esignature-confirmation-page-back-button"},o.createElement("a",{className:"maestro-nav__home-button",href:"https://"+i.WWW_HOST+"/"},o.createElement(a.LeftArrowSVGIcon,{className:"maestro-nav__caret"}),o.createElement(r.DropboxLogo,{className:"maestro-nav__logo","aria-label":s.homeAriaLabel()}))),o.createElement("div",{className:"esignature-confirmation-page-body"},o.createElement("div",{className:"esignature-confirmation-page-title"},"Document Submitted"),o.createElement("div",{className:"esignature-confirmation-page-document"},o.createElement("div",{className:"esignature-confirmation-page-document-overlay"}),t),o.createElement("div",{className:"esignature-confirmation-page-description"},"We'll email you a copy of the completed document.")))},u=l.requireCssWithComponent(c,["/static/css/esignature_prototype/confirmation_page-vflvygT75.css"]);t.EsignatureConfirmationPage=u}),define("esignature_prototype/components/esignature_field",["require","exports","tslib","esignature_prototype/data/types","esignature_prototype/components/utils/text_measurer","esignature_prototype/utils","external/prop-types","external/classnames","external/lodash","external/react","spectrum/datepicker","spectrum/icon_form","spectrum/input","spectrum/icon_global"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f){"use strict";function m(e,t,o,i,r){return void 0===t&&(t=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===r&&(r=0),n.__assign({},e,{width:e.width-t-o,height:e.height-i-r,left:e.left+t,bottom:e.bottom+r})}function h(e,t,n){return e<t?t:e>n?n:e}function v(e){var t,n=e.date,o=e.isForCurrentUser,i=e.onClick,r=e.scaleFactor;return null!=n&&(t=new Date(n.year,n.month-1,n.day)),o?c.createElement(E,{scaleFactor:r},c.createElement(u.DatepickerInput,{customInput:A,style:{transform:"scale("+1/r+")"},selectedDay:t,placeholder:"Date",onDayClick:i})):c.createElement("span",null,null!=t?t.toLocaleDateString():"Date")}function _(){return c.createElement("div",{className:"esignature-check-mark"},c.createElement(d.IconForm,{name:"check"}))}function g(e){return e.hasBeenFocused&&!r.isFieldCompleted(e)}Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importStar(a),s=n.__importDefault(s),l=n.__importStar(l),c=n.__importStar(c);var y=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setFieldRef=function(e){t.fieldRef=e},t}return n.__extends(t,e),t.prototype.componentDidUpdate=function(e){this.props.focusedFieldId!==e.focusedFieldId&&this.props.focusedFieldId===this.props.field.id&&this.fieldRef.focus()},t.prototype.render=function(){var e=this.props,t=e.field,n=e.onClickDateField,i=e.onClickSignatureField,a=e.onInputChange,s=e.color,l=e.focusField,u=e.scaleFactor,d={left:t.rect.left,bottom:t.rect.bottom,width:t.rect.width,height:t.rect.height};return t.isForCurrentUser||r.isFieldCompleted(t)?c.createElement("div",null,t[".tag"]===o.FieldType.Text?c.createElement(b,{field:t,onInputChange:a,rectCoords:d,color:s,focusField:l,setFieldRef:this.setFieldRef}):null,t[".tag"]===o.FieldType.Date?c.createElement(S,{field:t,onClick:n,rectCoords:d,color:s,setFieldRef:this.setFieldRef,scaleFactor:u,focusField:l,fieldIsFocused:this.props.focusedFieldId===this.props.field.id}):null,t[".tag"]===o.FieldType.Signature?c.createElement(w,{field:t,onClick:i,rectCoords:d,color:s,focusField:l,setFieldRef:this.setFieldRef}):null,!r.isFieldCompleted(t)&&t.isForCurrentUser?c.createElement("div",{className:"esignature-red-star",style:{left:d.left+d.width-15,bottom:d.bottom+d.height-17}},"*"):null):c.createElement(C,{field:t,rectCoords:d,color:s})},t})(c.Component);t.EsignatureField=y;var b=(function(e){function t(n){var o=e.call(this,n)||this;return o.onTextValueOrSizeChange=function(){o.props.onInputChange&&o.props.onInputChange(o.state.text,o.state.fontSize,m(o.props.field.rect,t.PADDING_LEADING,t.PADDING_TRAILING,t.PADDING_VERTICAL,t.PADDING_VERTICAL))},o.handleChange=function(e){(!o.state.isOverflowing||e.currentTarget.value.length<o.state.text.length)&&o.setState({text:e.currentTarget.value},o.onTextValueOrSizeChange)},o.textMeasureCallback=function(e,n){var i=o.props.rectCoords.width-t.PADDING_LEADING-t.PADDING_TRAILING,r=h(Math.floor(o.state.fontSize/e*i),6,o.maxFontSize()),a=e>i;Math.abs(r-o.state.fontSize)>t.FONT_SIZE_TOLERANCE?o.setState({fontSize:r,isOverflowing:a},o.onTextValueOrSizeChange):o.setState({isOverflowing:a})},o.state={text:o.props.field.text||"",fontSize:o.props.field.fontSize||o.maxFontSize(),isOverflowing:!1},o}return n.__extends(t,e),t.prototype.maxFontSize=function(){return Math.max(6,Math.min(18,this.props.field.rect.height-2*t.PADDING_VERTICAL))},t.prototype.render=function(){var e=this.props,t=e.field,o=e.rectCoords,a=e.color,u=e.focusField,d=e.setFieldRef;return c.createElement("div",{style:n.__assign({position:"absolute"},o)},c.createElement("input",{ref:d,className:s.default({"esignature-field":!0,"esignature-field-for-other-user":!t.isForCurrentUser,"esignature-field-red-border":g(t)}),"aria-label":"esignature-text-field-input",type:"text",style:{backgroundColor:a,height:o.height,width:o.width,fontSize:this.state.fontSize},placeholder:"Enter text",value:this.state.text,onChange:this.handleChange,disabled:!t.isForCurrentUser,onFocus:l.partial(u,t.id)}),r.isFieldCompleted(t)&&t.isForCurrentUser?c.createElement(_,null):null,c.createElement(i.TextMeasurer,{text:this.state.text,fontSize:this.state.fontSize,callback:this.textMeasureCallback}))},t.PADDING_LEADING=4,t.PADDING_TRAILING=22,t.PADDING_VERTICAL=4,t.FONT_SIZE_TOLERANCE=.1,t})(c.PureComponent),w=function(e){var t=e.field,o=e.onClick,i=e.rectCoords,a=e.color,u=e.focusField,d=e.setFieldRef,p=function(e,t){if(!e)return{};var n=r.placeRectInPdfRect(e.width/e.height,t);return{width:n.width,height:n.height,marginBottom:n.bottom-t.bottom}};return c.createElement("button",{ref:d,className:s.default({"esignature-field":!0,"esignature-field-for-other-user":!t.isForCurrentUser,"esignature-field-red-border":g(t)}),"aria-label":"esignature-signature-field",style:n.__assign({backgroundColor:a},i),onClick:o,disabled:!t.isForCurrentUser,onFocus:l.partial(u,t.id)},t.signatureImage?c.createElement("div",{className:"esignature-field-image-container",style:n.__assign({},i)},c.createElement("img",{className:"esignature-field-image",src:t.signatureImage.dataUri,alt:"",style:p(t.signatureImage,t.rect)}),t.isForCurrentUser?c.createElement(_,null):null):c.createElement("div",{className:"esignature-field-placeholder",style:{fontSize:h(i.height-16,6,18)}},"Click to sign"))},S=function(e){var t=e.field,o=e.onClick,i=e.rectCoords,a=e.color,u=e.scaleFactor,d=e.setFieldRef,p=e.focusField,f=e.fieldIsFocused,m=t.date,h=t.isForCurrentUser;return c.createElement("div",{ref:d,tabIndex:0,className:s.default({"esignature-field":!0,"esignature-field-for-other-user":!h,"esignature-field-red-border":g(t)}),style:n.__assign({backgroundColor:a,zIndex:f?2:1},i),onFocus:l.partial(p,t.id)},c.createElement(v,{date:m,isForCurrentUser:h,scaleFactor:u,onClick:o}),r.isFieldCompleted(t)&&t.isForCurrentUser?c.createElement(_,null):null)},C=function(e){var t=e.field,i=e.rectCoords,r=e.color;return c.createElement("div",{className:s.default({"esignature-field":!0,"esignature-field-for-other-user":!0}),style:n.__assign({backgroundColor:r},i)},c.createElement("div",{className:"esignature-field-placeholder",style:{fontSize:h(i.height-16,6,18)}},t[".tag"]===o.FieldType.Date?"Sender to date":null,t[".tag"]===o.FieldType.Text?"Sender to fill":null,t[".tag"]===o.FieldType.Signature?"Sender to sign":null))},E=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getChildContext=function(){var e=this;return{getScaleFactor:function(){return e.props.scaleFactor}}},t.prototype.render=function(){return c.Children.only(this.props.children)},t.childContextTypes={getScaleFactor:a.func},t})(c.Component),A=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.focus=function(){return t.input&&t.input.focus()},t}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props,o=t.id,i=t.displayValue,r=(t.value,n.__rest(t,["id","displayValue","value"])),a=this.context.getScaleFactor();return c.createElement("div",{className:"mc-datepicker-input-customInputWrapper",style:{transform:"scale("+a+")"}},c.createElement(p.Input,n.__assign({readOnly:!0,id:o,value:i},r,{ref:function(t){return e.input=t}})),c.createElement("div",{className:"mc-datepicker-input-icon"},c.createElement(f.IconGlobal,{name:"calendar"})))},t.contextTypes={getScaleFactor:a.func},t})(c.Component)}),define("esignature_prototype/components/esignature_field_creation_layer",["require","exports","tslib","esignature_prototype/constants","esignature_prototype/components/creating_esignature_field","esignature_prototype/data/types","esignature_prototype/utils","external/lodash","external/react","modules/clean/react/css","spectrum_signatures_prototype/field_placer","spectrum/icon_document"],function(e,t,n,o,i,r,a,s,l,c,u,d){"use strict";function p(e){var t=e.tag;return"signature"===t?l.createElement(d.IconDocument,{name:"signature-small"}):"date"===t?l.createElement(d.IconDocument,{name:"date-small"}):l.createElement(d.IconDocument,{name:"text-small"})}Object.defineProperty(t,"__esModule",{value:!0}),s=n.__importStar(s),l=n.__importStar(l);var f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={creatingField:!1,mouseDownPosition:{x:0,y:0},currentMousePosition:{x:0,y:0}},t.handleFieldCreationMouseDown=function(e){e.preventDefault(),t.setState({creatingField:!0,mouseDownPosition:t.getPositionRelativeToPage(e),currentMousePosition:t.getPositionRelativeToPage(e)})},t.handleFieldCreationMouseMove=function(e){e.preventDefault(),t.state.creatingField&&t.setState({currentMousePosition:t.getPositionRelativeToPage(e)})},t.handleFieldCreationMouseUp=function(e){e.preventDefault(),t.setState({creatingField:!1,currentMousePosition:t.getPositionRelativeToPage(e)}),t.props.createField&&t.props.createField(t.getFieldForCreation())},t.handleDrag=function(e,n,o){if(t.props.updateField){var i=t.props.fields.find(function(t){return t.id===e}),r=t.props.height*t.props.scaleFactor,s=a.updateFieldPosition(i,r,t.props.scaleFactor,n,o);t.props.updateField(s)}},t.handleResize=function(e,n,o,i,r){if(t.props.updateField){var s=t.props.fields.find(function(t){return t.id===e}),l=t.props.height*t.props.scaleFactor,c=a.updateFieldPosition(s,l,t.props.scaleFactor,i,r,n,o);t.props.updateField(c)}},t}return n.__extends(t,e),t.prototype.getPositionRelativeToPage=function(e){return{x:e.pageX-this.props.offset.left,y:e.pageY-this.props.offset.top}},t.prototype.getFieldForCreation=function(){var e=this.getField();return e.rect.height=Math.max(e.rect.height,Math.round(o.MIN_FIELD_SIZE/this.props.scaleFactor)),this.props.fieldCreationType===r.FieldType.Date?e.rect.width=Math.max(e.rect.width,Math.round(o.MIN_DATE_FIELD_WIDTH/this.props.scaleFactor)):e.rect.width=Math.max(e.rect.width,Math.round(o.MIN_FIELD_SIZE/this.props.scaleFactor)),e},t.prototype.getField=function(){return a.transformPositionsToField(this.state.mouseDownPosition,this.state.currentMousePosition,this.props.height*this.props.scaleFactor,this.props.scaleFactor,this.props.pageNumber,this.props.nextFieldId)},t.prototype.render=function(){var e=this,t=this.props,o=t.fields,r=t.width,c=t.height,d=t.scaleFactor,f=t.isFieldCreationMode,m=t.isCreatingFieldForRecipient,h=c*d,v={width:r,height:c,transform:"scale("+d+")",transformOrigin:"top left"},_=f?{onMouseDown:this.handleFieldCreationMouseDown,onMouseMove:this.handleFieldCreationMouseMove,onMouseUp:this.handleFieldCreationMouseUp}:null;return l.createElement("div",{className:"esignature-field-view-layer",style:{width:r*d,height:c*d}},o.map(function(t){return l.createElement(u.FieldPlacer,n.__assign({key:"unsaved-field-"+t.id,colorScheme:t.isForCurrentUser?"sender":"receiver",icon:l.createElement(p,{tag:t[".tag"]}),onCancel:s.partial(e.props.cancelField,t.id),onDrag:s.partial(e.handleDrag,t.id),onResize:s.partial(e.handleResize,t.id)},a.transformFieldToCoords(t,h,d)),(t.isForCurrentUser?"Your":"Recipient")+" "+t[".tag"])}),f?l.createElement("div",n.__assign({className:"esignature-field-creation-layer",style:v},_),this.state.creatingField?l.createElement(i.CreatingEsignatureField,{field:this.getField(),colorScheme:m?"receiver":"sender"}):null):null)},t.defaultProps={offset:{left:0,top:0,right:0,bottom:0}},t})(l.PureComponent);t.EsignatureFieldCreationLayerWithoutCSS=f,t.EsignatureFieldCreationLayer=c.requireCssWithComponent(f,["/static/css/esignature_prototype/field_layer-vfloHe1he.css"])}),define("esignature_prototype/components/esignature_field_view_layer",["require","exports","tslib","esignature_prototype/components/create_signature_modal","esignature_prototype/components/esignature_field","esignature_prototype/constants","esignature_prototype/data/types","external/lodash","external/react","modules/clean/react/css"],function(e,t,n,o,i,r,a,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=n.__importStar(s),l=n.__importStar(l);var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={modalOpen:!1,clickedFieldId:0},t.handleSubmit=function(e){t.setState({modalOpen:!1}),e&&t.props.createSignature&&t.props.signField&&(t.props.createSignature(e),t.props.signField(t.state.clickedFieldId,e))},t.handleClickSignatureField=function(e){!t.props.signatureImage||t.isSignatureFieldSigned(e)?t.setState({modalOpen:!0,clickedFieldId:e}):t.props.signField&&t.props.signField(e,t.props.signatureImage)},t.handleClickDateField=function(e,n){t.props.selectFieldDate&&n&&t.props.selectFieldDate(e,{year:n.getFullYear(),month:n.getMonth()+1,day:n.getDate()})},t}return n.__extends(t,e),t.prototype.isSignatureFieldSigned=function(e){return void 0!==this.props.fields.find(function(t){return t.id===e}).signatureImage},t.prototype.render=function(){var e=this,t=this.props,n=t.width,c=t.height,u=t.scaleFactor,d=t.fields;if(!d)return null;var p=d.map(function(t){return l.createElement(i.EsignatureField,{key:t.id,displayMarker:t.isForCurrentUser,field:t,color:t.isForCurrentUser?r.CURRENT_USER_VIEW_FIELD_COLOR:r.OTHER_USER_FIELD_COLOR,onClickSignatureField:t.isForCurrentUser?s.partial(e.handleClickSignatureField,t.id):void 0,onClickDateField:t.isForCurrentUser?s.partial(e.handleClickDateField,t.id):void 0,onInputChange:t[".tag"]===a.FieldType.Text?s.partial(e.props.enterFieldText,t.id):void 0,focusField:e.props.focusField,focusedFieldId:e.props.focusedFieldId,scaleFactor:u})}),f={width:n,height:c,transform:"scale("+u+")",transformOrigin:"top left"};return l.createElement("div",{className:"esignature-field-view-layer",style:f},p,l.createElement(o.CreateSignatureModal,{open:this.state.modalOpen,onSubmit:this.handleSubmit}))},t})(l.PureComponent);t.EsignatureFieldViewLayer=c.requireCssWithComponent(u,["/static/css/esignature_prototype/field_layer-vfloHe1he.css"])}),define("esignature_prototype/components/esignature_utility_modals",["require","exports","tslib","external/react","modules/clean/react/modal","spectrum/modal"],function(e,t,n,o,i,r){"use strict";function a(){return o.createElement(h,{title:"No recipient fields created",body:"To send this document for signature, you’ll need to create fields for the recipient to fill out."})}function s(){return o.createElement(h,{title:"Cannot send to yourself",body:"To request a signature from someone else, add their email address instead. If you created additional fields for yourself, you'll still be able to complete them after sending."})}function l(e){var t=o.createElement("div",null,"We'll update you on the status via email. If ",o.createElement("b",null,e.email)," does not sign in 2 days, we'll send them a reminder.");return o.createElement(h,{title:"Sent for signature",body:t})}function c(){return o.createElement(h,{title:"Sorry, the document was not sent",body:"Please check your connection and try again."})}function u(){return o.createElement(h,{title:"Sorry, the document was not submitted",body:"Please check your connection and try again."})}function d(e){return o.createElement(h,{title:"Signature request expired",body:e.sender+" asked you to sign this file on "+e.date+". Because you did not complete the request within 30 days, it's now expired."})}function p(e){return o.createElement(h,{title:"Signature request expired",body:"You asked "+e.recipient+" to sign this file on "+e.date+". Because they did not complete the request within 30 days, it's now expired."})}function f(e){return o.createElement(h,{title:"Signature request corrupted",body:"The file sent for signature is corrupted. Please ask the sender to send it again."})}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleDiscard=function(){i.Modal.close(),t.props.onDiscard()},t}return n.__extends(t,e),t.prototype.render=function(){return o.createElement(r.UtilityModal,{className:"esignature-unsaved-data-modal",overlayClassName:"esignature-modal-overlay",title:"Exit without saving?",ariaLabel:"Exit without saving?",open:!0,displayCloseButton:!1,primaryAction:"Continue preparing form",onPrimaryAction:i.Modal.close,secondaryAction:"Exit and discard",onSecondaryAction:this.handleDiscard,onRequestClose:i.Modal.close},"Your changes will be lost.")},t})(o.Component);t.EsignatureUnsavedDataModal=m;var h=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return o.createElement(r.UtilityModal,{className:"esignature-basic-modal",overlayClassName:"esignature-modal-overlay",title:this.props.title,ariaLabel:this.props.title,open:!0,displayCloseButton:!1,primaryAction:"Close",onPrimaryAction:i.Modal.close,onRequestClose:i.Modal.close},this.props.body)},t})(o.Component);t.EsignatureNoFieldsForRecipientModal=a,t.EsignatureCannotSendToYourselfModal=s,t.EsignatureSentForSignatureModal=l,t.EsignatureSendForSignatureFailedModal=c,t.EsignatureSignFailedModal=u,t.EsignatureExpiredModalRecipient=d,t.EsignatureExpiredModalSender=p,t.EsignatureCorruptedModal=f}),define("esignature_prototype/components/utils/text_measurer",["require","exports","tslib","external/react"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var i=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ref=function(e){return t.element=e},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.cache={}},t.prototype.componentWillUnmount=function(){this.cache={}},t.prototype.componentDidUpdate=function(){if(this.element){var e=Math.round(10*this.props.fontSize);if(this.cache[e]||(this.cache[e]={}),!this.cache[e][this.props.text]){var t=this.element.offsetWidth,n=this.element.offsetHeight;this.cache[e][this.props.text]=[t,n]}var o=this.cache[e][this.props.text],i=o[0],r=o[1];this.props.callback(i,r)}},t.prototype.shouldComponentUpdate=function(e,t){return e.fontSize!==this.props.fontSize||e.text!==this.props.text},t.prototype.render=function(){return o.createElement("span",{ref:this.ref,style:{visibility:"hidden",position:"absolute",fontSize:this.props.fontSize,whiteSpace:"nowrap"}},this.props.text)},t})(o.PureComponent);t.TextMeasurer=i}),define("esignature_prototype/data/store",["require","exports","tslib","esignature_prototype/constants","esignature_prototype/data/actions","external/lodash","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/constants"],function(e,t,n,o,i,r,a,s){"use strict";function l(e,t){if(t&&t.esig_token){var l=r.flatMap(t.recipients,function(e,o){return e.fields.map(function(i){var a=r.get(e,"field_data."+i.id,{}),s=a.year,l=a.month,c=a.day,u=a.text,d=a.image,p=null!=s?{year:s,month:l,day:c}:void 0;return n.__assign({},i,{text:u,date:p,signatureImage:d,isForCurrentUser:o===t.me_gid})})}),c=t.recipients[t.me_gid].status===o.EsignatureStatus.Complete,u=t.status===o.EsignatureDocumentStatus.Complete;e.dispatch(i.enterSigningMode(l,t.esig_token,c,u)),e.dispatch(a.openSidebar(s.DocType.pdf))}}Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r),t.hydrateEsignatureNamespace=l}),define("modules/clean/activity/activity_user",["require","exports","tslib","modules/core/i18n","modules/core/user_i18n","modules/clean/em_string"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var a=(function(){function e(e){var t=void 0===e?{}:e,n=t.id,o=void 0===n?null:n,i=t.fname,r=void 0===i?null:i,a=t.lname,s=void 0===a?null:a,l=t.display_name,c=void 0===l?null:l,u=t.email,d=void 0===u?null:u,p=t.photo_url,f=void 0===p?null:p,m=t.photo_circle_url,h=void 0===m?null:m,v=t.initials,_=void 0===v?null:v,g=t.is_email_verified,y=void 0!==g&&g,b=t.is_signed_in,w=void 0!==b&&b;this.id=o,this.fname=r,this.lname=s,this.display_name=c,this.email=d,this.photo_url=f,this.photo_circle_url=h,this.initials=_,this.is_email_verified=y,this.is_signed_in=w}return e.fromDict=function(t){return new e(n.__assign({},t,{initials:i.getInitials(t.display_name||""),is_signed_in:!!t.id}))},e.fromUser=function(t){return new e(n.__assign({},t,{initials:i.getInitials(t.display_name||""),is_signed_in:!0}))},e.fromEmail=function(t){return new e({email:t})},Object.defineProperty(e,"anonymous",{get:function(){return e.__anonymous},enumerable:!0,configurable:!0}),e.prototype.getDisplayIdentity=function(){return null!=this.display_name?r.Emstring.em_snippet(this.display_name,22):null!=this.email?r.Emstring.em_snippet(this.email,22):o._("Anonymous user")},e.__anonymous=new e,e})();t.ActivityUser=a}),define("modules/clean/activity/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.SHARED_LINK_VIEW=1]="SHARED_LINK_VIEW",e[e.BROWSE_FILE_VIEWER=3]="BROWSE_FILE_VIEWER",e[e.SHARED_CONTENT_LINK_VIEW=7]="SHARED_CONTENT_LINK_VIEW"})(t.ActivityContext||(t.ActivityContext={}))}),define("modules/clean/annotations/annotation",["require","exports"],function(e,t){"use strict";function n(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0});var o={MARKER:0,HIGHLIGHT:1,REGION:2};t.AnnotationTypes=o;var i={MARKER:{CIRCLE:0},REGION:{RECTANGLE:0},HIGHLIGHT:{HIGHLIGHT:0}};t.AnnotationSubtypes=i;var r=(function(){function e(e,t,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),this.type=e,this.subtype=t,this.pdf_coordinates=null,this.image_coordinates=null,this.text_highlight=null,this.viewportCoordinates=[],this.BUBBLE_WIDTH=320,this.annotationSize=n}return e.createAnnotationFromDict=function(t){var n=new e;return n.revision=t.revision,n.zoom=t.zoom,n.type=t.type,n.subtype=t.subtype,n.pdf_coordinates=t.pdf_coordinates,n.image_coordinates=t.image_coordinates,n.text_highlight=t.text_highlight,n.viewportCoordinates=null!=t.viewportCoordinates?t.viewportCoordinates:[],n.thumbnail_url=t.thumbnail_url,n.annotationSize=28,n},e.prototype.toMetadataDict=function(){var e={type:this.type,subtype:this.subtype};return this.pdf_coordinates?e.pdf_coordinates=this.pdf_coordinates:this.image_coordinates&&(e.image_coordinates=this.image_coordinates),this.type===o.HIGHLIGHT&&(e.text_highlight=this.text_highlight),e},e.getCenterPosition=function(e){return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}},e.prototype.getBoundingBox=function(){switch(this.type){case o.MARKER:var e=this.getFirstViewportCoordinates();return{top:e.y-this.annotationSize/2,right:e.x+this.annotationSize/2,bottom:e.y+this.annotationSize/2,left:e.x-this.annotationSize/2};case o.HIGHLIGHT:return this._getViewportBoundingRectangle();case o.REGION:return this._getViewportBoundingRectangle()}},e.prototype.getClampedBoundingBox=function(e,t,n,o){void 0===n&&(n=0),void 0===o&&(o=0);var i=this.getBoundingBox();return i.left=i.left-n,i.right=i.right-n,i.top=i.top-o,i.bottom=i.bottom-o,i.top=Math.min(Math.max(i.top,0),t-1),i.right=Math.min(Math.max(i.right,0),e-1),i.bottom=Math.min(Math.max(i.bottom,0),t-1),i.left=Math.min(Math.max(i.left,0),e-1),i},e.prototype._getViewportBoundingRectangle=function(){for(var e,t,n=e=this.getFirstViewportCoordinates().x,o=t=this.getFirstViewportCoordinates().y,i=0,r=Array.from(this.viewportCoordinates);i<r.length;i++)for(var a=r[i],s=0,l=Array.from(a);s<l.length;s++){var c=l[s];n=Math.min(n,c.x),e=Math.max(e,c.x),o=Math.min(o,c.y),t=Math.max(t,c.y)}return{top:o,right:e,bottom:t,left:n}},e.prototype.isPdfAnnotation=function(){return null!=this.pdf_coordinates},e.prototype.isImageAnnotation=function(){return null!=this.image_coordinates},e.prototype.getFirstCoordindates=function(){return this.isPdfAnnotation()?this.getFirstPdfCoordinates():this.isImageAnnotation()?this.getFirstImageCoordinates():void 0},e.prototype.getFirstViewportCoordinates=function(){return this.viewportCoordinates[0][0]},e.prototype.getFirstImageCoordinates=function(){return n(null!=this.image_coordinates?this.image_coordinates[0].coordinates:void 0,function(e){return e[0]})},e.prototype.getFirstPdfCoordinates=function(){return this.isOldCoordinatesFormat()?this.pdf_coordinates:null!=this.pdf_coordinates[0].coordinates?this.pdf_coordinates[0].coordinates[0]:void 0},e.prototype.getFirstPdfPage=function(){return this.isOldCoordinatesFormat()?null!=this.pdf_coordinates?this.pdf_coordinates.page:void 0:this.pdf_coordinates[0].page},e.prototype.isOldCoordinatesFormat=function(){return!(null!=this.pdf_coordinates&&null!=this.pdf_coordinates[0])},e.prototype.getSize=function(){return this.type===o.MARKER?this.annotationSize:null},e})();t.Annotation=r}),define("modules/clean/annotations/annotation_controller",["require","exports","tslib","external/create-react-class","external/react","external/react-dom","external/react-dom-factories","external/prop-types","jquery","modules/clean/annotations/annotation","modules/clean/annotations/annotation_highlight","modules/clean/annotations/annotation_marker","modules/clean/annotations/annotation_region"],function(e,t,n,o,i,r,a,s,l,c,u,d,p){"use strict";function f(e,t,n){return void 0!==e&&null!==e&&"function"==typeof e[t]?n(e,t):void 0}o=n.__importDefault(o),i=n.__importStar(i),r=n.__importStar(r),a=n.__importStar(a),s=n.__importStar(s),l=n.__importDefault(l),u=n.__importDefault(u),d=n.__importDefault(d),p=n.__importDefault(p);return o.default({displayName:"AnnotationController",propTypes:{controllerEventHandlers:s.object,onAnnotationPlacedCallback:s.func,onAnnotationHiddenCallback:s.func,onAnnotationStartDragCallback:s.func,onAnnotationEndDragCallback:s.func,onAnnotationScrollCallback:s.func,onAnnotationScaleChangeCallback:s.func,onAnnotationEnterCallback:s.func,onAnnotationLeaveCallback:s.func,isAnnotationMarkerEnabled:s.bool,isAnnotationHighlightEnabled:s.bool,isAnnotationRegionEnabled:s.bool,isAnnotationCreationEnabled:s.bool,parentContainerOffset:s.object,draftAnnotationVersion:s.number},getInitialState:function(){return{activeAnnotationType:null}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},hasVisibleActiveAnnotation:function(){return null!=this.refs.activeAnnotation},componentWillMount:function(){return this.allowAnnotationTypeSwitch=!0,this.isMouseDown=!1,this.positionAtLastMouseDown={}},componentDidMount:function(){return null!=this.props.controllerEventHandlers&&(this.props.controllerEventHandlers.onHideAnnotation=this.onHideAnnotation),null!=this.props.controllerEventHandlers&&(this.props.controllerEventHandlers.onMouseMoveCallback=this.onMouseMoveCallback),null!=this.props.controllerEventHandlers&&(this.props.controllerEventHandlers.onMouseDownCallback=this.onMouseDownCallback),null!=this.props.controllerEventHandlers&&(this.props.controllerEventHandlers.onMouseUpCallback=this.onMouseUpCallback),null!=this.props.controllerEventHandlers&&(this.props.controllerEventHandlers.onScrollCallback=this.onScrollCallback),null!=this.props.controllerEventHandlers?this.props.controllerEventHandlers.onScaleChangeCallback=this.onScaleChangeCallback:void 0},componentDidUpdate:function(e,t){if(this.props.draftAnnotationVersion>e.draftAnnotationVersion)return this._allowAnnotationTypeSwitch(),this.setState(this.getInitialState())},_getViewerX:function(){return(null!=this.state.currentMouseEvent?this.state.currentMouseEvent.pageX:void 0)||0},_getViewerY:function(){return(null!=this.state.currentMouseEvent?this.state.currentMouseEvent.pageY:void 0)||0},_getEventPosition:function(e){return{x:e.pageX,y:e.pageY}},_allowAnnotationTypeSwitch:function(){return this.allowAnnotationTypeSwitch=!0},_disallowAnnotationTypeSwitch:function(){return this.allowAnnotationTypeSwitch=!1},_trySetActiveAnnotationType:function(e,t){return e!==this.state.activeAnnotationType&&this._isAnnotationTypeCreationEnabled(e)?(this.setState({activeAnnotationType:e},function(){return"function"==typeof t?t():void 0}),!0):("function"==typeof t&&t(),!1)},_isOnRegion:function(e){var t=r.findDOMNode(this.refs.activeAnnotation);return null!=t&&(e.target===t||l.default.contains(t,e.target))},_isAnnotationTypeCreationEnabled:function(e){if(!this.props.isAnnotationCreationEnabled)return!1;switch(e){case c.AnnotationTypes.MARKER:return this.props.isAnnotationMarkerEnabled;case c.AnnotationTypes.HIGHLIGHT:
return this.props.isAnnotationHighlightEnabled;case c.AnnotationTypes.REGION:return this.props.isAnnotationRegionEnabled;default:return!1}},_isOnText:function(e){var t,n=l.default(e.target),o=n.contents(),i=(null!=(t=n.css("cursor"))?t:"").split(",");if(i=i[i.length-1].trim(),"text"===i||"vertical-text"===i||n.is("a")&&0===o.length)return!0;if("auto"!==i)return!1;for(var r=!1,a=0,s=Array.from(o);a<s.length;a++){s[a].nodeType===Node.TEXT_NODE&&(r=!0)}return r},_deselectAllText:function(){return f(window.getSelection(),"removeAllRanges",function(e){return e.removeAllRanges()})},onHideAnnotation:function(){return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.hideAnnotation():void 0},onMouseDownCallback:function(e){var t=this;if(!this.isMouseDown){if(this.isMouseDown=!0,this.positionAtLastMouseDown={x:e.pageX,y:e.pageY},!this.allowAnnotationTypeSwitch)return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.onMouseDownCallback(e):void 0;var n=this.state.activeAnnotationType;return!this._isOnRegion(e)&&this._isOnText(e)?(n=c.AnnotationTypes.HIGHLIGHT,this._trySetActiveAnnotationType(n,function(){return null!=t.refs.activeAnnotation?t.refs.activeAnnotation.onMouseDownCallback(e):void 0})):void 0}},onMouseMoveCallback:function(e){var t=this;if(this.isMouseDown){if(null===this.state.activeAnnotationType&&this.props.isAnnotationCreationEnabled&&this._deselectAllText(),this.allowAnnotationTypeSwitch){var n=this.state.activeAnnotationType;return this.isMouseDown&&null===n&&(n=c.AnnotationTypes.REGION),this._trySetActiveAnnotationType(n,function(){return null!=t.refs.activeAnnotation?t.refs.activeAnnotation.onMouseMoveCallback(e):void 0})}return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.onMouseMoveCallback(e):void 0}},onMouseUpCallback:function(e){var t=this;if(this.isMouseDown){if(this.isMouseDown=!1,this.allowAnnotationTypeSwitch){var n=this.state.activeAnnotationType;if(null===n){if(this._isAnnotationTypeCreationEnabled(c.AnnotationTypes.MARKER))n=c.AnnotationTypes.MARKER;else if(this._isAnnotationTypeCreationEnabled(c.AnnotationTypes.REGION))return void this._trySetActiveAnnotationType(c.AnnotationTypes.REGION,function(){return f(t.refs.activeAnnotation,"createDefaultRegion",function(t){return t.createDefaultRegion(e)})})}else if(n===c.AnnotationTypes.REGION&&this._isAnnotationTypeCreationEnabled(c.AnnotationTypes.MARKER)){var o={x:e.pageX,y:e.pageY},i=o.x-this.positionAtLastMouseDown.x,r=o.y-this.positionAtLastMouseDown.y,a=Math.sqrt(i*i+r*r);a<=34&&(n=c.AnnotationTypes.MARKER)}return this._trySetActiveAnnotationType(n,function(){return null!=t.refs.activeAnnotation?t.refs.activeAnnotation.onMouseUpCallback(e):void 0})}return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.onMouseUpCallback(e):void 0}},onScrollCallback:function(e){return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.onScrollCallback(e):void 0},onScaleChangeCallback:function(e){return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.onScaleChangeCallback(e):void 0},onAnnotationHiddenCallback:function(){return this.setState({activeAnnotationType:null}),this._allowAnnotationTypeSwitch(),"function"==typeof this.props.onAnnotationHiddenCallback?this.props.onAnnotationHiddenCallback():void 0},onAnnotationPlacedCallback:function(e){return this._disallowAnnotationTypeSwitch(),"function"==typeof this.props.onAnnotationPlacedCallback?this.props.onAnnotationPlacedCallback(e):void 0},onAnnotationStartDragCallback:function(e){return"function"==typeof this.props.onAnnotationStartDragCallback?this.props.onAnnotationStartDragCallback(e):void 0},onAnnotationEndDragCallback:function(e){return"function"==typeof this.props.onAnnotationEndDragCallback?this.props.onAnnotationEndDragCallback(e):void 0},onAnnotationScrollCallback:function(e){return"function"==typeof this.props.onAnnotationScrollCallback?this.props.onAnnotationScrollCallback(e):void 0},onAnnotationScaleChangeCallback:function(e){return"function"==typeof this.props.onAnnotationScaleChangeCallback?this.props.onAnnotationScaleChangeCallback(e):void 0},onAnnotationEnterCallback:function(e){return"function"==typeof this.props.onAnnotationEnterCallback?this.props.onAnnotationEnterCallback(e):void 0},onAnnotationLeaveCallback:function(e){return"function"==typeof this.props.onAnnotationLeaveCallback?this.props.onAnnotationLeaveCallback(e):void 0},_renderActiveAnnotation:function(){if(null!=this.state.activeAnnotationType&&this._isAnnotationTypeCreationEnabled(this.state.activeAnnotationType))switch(this.state.activeAnnotationType){case c.AnnotationTypes.MARKER:return i.createElement(d.default,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case c.AnnotationTypes.HIGHLIGHT:return i.createElement(u.default,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case c.AnnotationTypes.REGION:return i.createElement(p.default,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback})}return""},render:function(){return a.div({className:"ephemeral-annotation-container"},this._renderActiveAnnotation())}})}),define("modules/clean/annotations/annotation_highlight",["require","exports","tslib","external/react","external/react-dom-factories","external/prop-types","jquery","modules/clean/annotations/annotation"],function(e,t,n,o,i,r,a,s){"use strict";return o=n.__importStar(o),i=n.__importStar(i),r=n.__importStar(r),a=n.__importDefault(a),(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isShown:!1},t.hideAnnotation=function(){return t._hideAnnotation()},t._updateViewportBoundaries=function(){var e=window.getSelection();if(e.rangeCount>0){var n=void 0;n=t._isBrowserIE()?t._extractViewportClientRectanglesIEHack(e.getRangeAt(0)):t._extractViewportClientRectangles(e.getRangeAt(0));var o=t._consolidateClientRectangles(n);return t._setViewportCoordinatesFromRectangles(o)}},t._extractViewportClientRectangles=function(e){for(var t=[],n=e.endContainer,o=e.endOffset,i=e.cloneRange();n!==e.commonAncestorContainer;)i.setStart(n,0),i.setEnd(n,o),Array.prototype.push.apply(t,i.getClientRects()),o=Array.prototype.indexOf.call(n.parentNode.childNodes,n),n=n.parentNode;return i=e.cloneRange(),i.setEnd(n,o),Array.prototype.push.apply(t,i.getClientRects()),t},t._extractViewportClientRectanglesIEHack=function(e){if("canvasWrapper"===e.startContainer.className&&e.setStart(e.startContainer.nextSibling.children[0].childNodes[0],0),e.startContainer===e.commonAncestorContainer)return e.getClientRects();var t=[],n=e.cloneRange();n.setEnd(e.startContainer,e.startContainer.length),Array.prototype.push.apply(t,n.getClientRects());for(var o=e.startContainer.parentNode.nextSibling;o!==e.endContainer.parentNode;)Array.prototype.push.apply(t,o.getClientRects()),o=o.nextSibling;return n.setStart(e.endContainer,0),n.setEnd(e.endContainer,e.endOffset),Array.prototype.push.apply(t,n.getClientRects()),t},t._isBrowserIE=function(){var e=window.navigator.userAgent,t=e.indexOf("Trident/"),n=e.indexOf("Edge/");return t>0||n>0},t._consolidateClientRectangles=function(e){for(var n=[],o=0,i=Array.from(e);o<i.length;o++){var r=i[o];if(0!==r.width&&0!==r.height){if(n.length>0){var a=n[n.length-1];if(t._isWithinConsolidationVerticalBuffer(a,r)&&t._isWithinConsolidationHorizontalBuffer(a,r)){var s=t._calculateBoundingBox(a,r);a.top=s.top,a.right=s.right,a.bottom=s.bottom,a.left=s.left;continue}}n.push({top:r.top,right:r.right,bottom:r.bottom,left:r.left})}}return n},t._isWithinConsolidationVerticalBuffer=function(e,n){return Math.abs(e.top-n.top)<t.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER&&Math.abs(e.bottom-n.bottom)<t.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER},t._isWithinConsolidationHorizontalBuffer=function(e,n){var o=t._calculateBoundingBox(e,n);return o.right-o.left-(n.width+(e.right-e.left))<t.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER},t._calculateBoundingBox=function(e,t){return{top:Math.min(e.top,t.top),right:Math.max(e.right,t.right),bottom:Math.max(e.bottom,t.bottom),left:Math.min(e.left,t.left)}},t._setViewportCoordinatesFromRectangles=function(e){var n=t.annotation.viewportCoordinates,o=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;if(e=Array.from(e),0!==e.length){var r=e.map(function(e){return[{x:e.left+o,y:e.top+i},{x:e.right+o,y:e.bottom+i}]});n.splice.apply(n,[0,n.length].concat(r))}},t._getPositionRelativeToParentContainer=function(e){return{x:e.x-t.props.parentContainerOffset.left,y:e.y-t.props.parentContainerOffset.top}},t._updateHighlightedText=function(){return t.annotation.text_highlight={snippet_before:t._getTextBeforeHighlight(),text:t._getHighlightedText(),snippet_after:t._getTextAfterHighlight()}},t._generateAnnotation=function(){return t.annotation=new s.Annotation(t.type,t.subtype),t._updateViewportBoundaries(),t._updateHighlightedText()},t._hideAnnotation=function(){return t._isBrowserIE()&&t.state.isShown&&t.setState({isShown:!1,viewportCoordinates:null}),t.annotation=null,t.props.onAnnotationHiddenCallback()},t._updateViewportCoordinatesFromUI=function(){if(t.state.isShown){for(var e=[],n=t.annotation.viewportCoordinates,o=0,i=Array.from(a.default(".annotation-highlight"));o<i.length;o++){var r=i[o],s=[],l=a.default(r),c=l.offset();s.push({x:c.left,y:c.top}),s.push({x:c.left+l.width(),y:c.top+l.height()}),e.push(s)}n.splice.apply(n,[0,n.length].concat(e))}},t._getHighlightedText=function(){var e=window.getSelection().toString().trim();return e=e.replace(/\s+/g," ")},t._getTextBeforeHighlight=function(){return""},t._getTextAfterHighlight=function(){return""},t._isTextSelected=function(){return""!==t._getHighlightedText()},t.onMouseDownCallback=function(e){return{}},t.onMouseMoveCallback=function(e){return{}},t.onMouseUpCallback=function(e){return setTimeout(function(){if(!t._isTextSelected())return t._hideAnnotation();if(t._generateAnnotation(),t.props.onAnnotationPlacedCallback(t.annotation),t._isBrowserIE()){for(var e=[],n=0,o=Array.from(t.annotation.viewportCoordinates);n<o.length;n++){var i=o[n],r=[],a=t._getPositionRelativeToParentContainer(i[0]),s=t._getPositionRelativeToParentContainer(i[1]);r.push({x:a.x,y:a.y}),r.push({x:s.x,y:s.y}),e.push(r)}return t.setState({isShown:!0,viewportCoordinates:e})}},0)},t.onScrollCallback=function(){if(null!=t.annotation)return t._isBrowserIE()?t._updateViewportCoordinatesFromUI():t._updateViewportBoundaries(),"function"==typeof t.props.onAnnotationScrollCallback?t.props.onAnnotationScrollCallback(t.annotation):void 0},t.onScaleChangeCallback=function(){if(null!=t.annotation)return t._updateViewportBoundaries(),"function"==typeof t.props.onAnnotationScaleChangeCallback?t.props.onAnnotationScaleChangeCallback(t.annotation):void 0},t._onMarkerMouseDown=function(e){return{}},t._onMarkerMouseOver=function(e){return{}},t._onMarkerMouseUp=function(e){return{}},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){return this.type=s.AnnotationTypes.HIGHLIGHT,this.subtype=s.AnnotationSubtypes.HIGHLIGHT.HIGHLIGHT,this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER=8,this.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER=30},t.prototype.render=function(){var e=this;return i.div({className:"annotation-highlight-container",ref:"highlightContainer"},(function(){if(e.state.isShown){for(var t=[],n=0,o=Array.from(e.state.viewportCoordinates);n<o.length;n++){var r=o[n],a=r[0].x,s=r[0].y,l=r[1].x,c=r[1].y,u={left:a,top:s,width:l-a,height:c-s};t.push(i.div({className:"annotation-highlight",style:u}))}return t}})())},t.displayName="AnnotationHighlight",t.propTypes={onAnnotationPlacedCallback:r.func,onAnnotationHiddenCallback:r.func,onAnnotationStartDragCallback:r.func,onAnnotationEndDragCallback:r.func,onAnnotationOverCallback:r.func,onAnnotationScrollCallback:r.func,onAnnotationScaleChangeCallback:r.func,onAnnotationEnterCallback:r.func,onAnnotationLeaveCallback:r.func,parentContainerOffset:r.object},t.defaultProps={parentContainerOffset:{left:0,top:0}},t})(o.Component)}),define("modules/clean/annotations/annotation_highlight_ui",["require","exports","tslib","external/classnames","external/react","external/react-dom","external/react-dom-factories","external/prop-types","jquery","modules/clean/annotations/annotation"],function(e,t,n,o,i,r,a,s,l,c){"use strict";function u(e,t){return void 0!==e&&null!==e?t(e):void 0}o=n.__importDefault(o),i=n.__importStar(i),r=n.__importStar(r),a=n.__importStar(a),s=n.__importStar(s),l=n.__importDefault(l);return(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isHover:!1},t._isGhostAnnotation=function(){return t.props.options.isGhostAnnotation||!1},t._onHighlightClick=function(e){return"function"==typeof t.props.onAnnotationClickCallback?t.props.onAnnotationClickCallback({commentActivity:t.props.commentActivity}):void 0},t._onHighlightMouseEnter=function(e){return t.setState({isHover:!0}),clearTimeout(t.mouseLeaveTimeout),t._updateViewportCoordinates(),"function"==typeof t.props.onAnnotationEnterCallback?t.props.onAnnotationEnterCallback({annotation:t.annotation,commentActivity:t.props.commentActivity}):void 0},t._onHighlightMouseOver=function(e){return{}},t._onHighlightMouseLeave=function(e){return"function"==typeof t.props.onAnnotationLeaveCallback&&t.props.onAnnotationLeaveCallback({annotation:t.annotation,commentActivity:t.props.commentActivity}),t.mouseLeaveTimeout=setTimeout(function(){return t.setState({isHover:!1})},100)},t._updateViewportCoordinates=function(){for(var e=l.default(r.findDOMNode(t.refs.highlightContainer)),n=[],o=e.children(),i=0,a=Array.from(o);i<a.length;i++){var s=a[i],c=[],u=l.default(s).offset();c.push({x:u.left,y:u.top}),c.push({x:u.left+l.default(s).width(),y:u.top+l.default(s).height()}),n.push(c)}return t.annotation.viewportCoordinates=n},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){return this.initialViewport=this.props.annotation.viewportCoordinates,this.annotation=c.Annotation.createAnnotationFromDict(this.props.annotation)},t.prototype.render=function(){for(var e,t,n,i=this,r=[],s=u(null!=this.props.commentActivity?this.props.commentActivity.comment:void 0,function(e){return e.resolved}),l=o.default({"annotation-highlight":!0,"annotation-highlight--ui":!0,"annotation-highlight--resolved":s,"highlight-hover":this.state.isHover,"annotation-highlight--ghost":this._isGhostAnnotation()}),c=-1,d=0,p=Array.from(this.initialViewport);d<p.length;d++){var f=p[d];t=f[0].x,n=f[0].y;var m=f[1].x,h=f[1].y;(c===-1||n<c)&&(e=t,c=n);var v={left:t*this.props.scaleFactor,top:n*this.props.scaleFactor,width:m-t,height:h-n,transform:"scale("+this.props.scaleFactor+")",transformOrigin:"top left"};r.push(a.div({className:l,style:v,onClick:this._onHighlightClick,onMouseEnter:this._onHighlightMouseEnter,onMouseOver:this._onHighlightMouseOver,onMouseLeave:this._onHighlightMouseLeave}))}return a.div({className:"annotation-highlight-container",ref:"highlightContainer"},r,(function(){if(i.props.options.isAnnotationNumberingEnabled){var t={left:e*i.props.scaleFactor-9,top:c*i.props.scaleFactor-9},n=o.default({"annotation-number":!0,"annotation-number--resolved":s,"annotation-number--hover":i.state.isHover});return a.div({className:n,style:t},i.props.options.annotationNumber)}})())},t.displayName="AnnotationHighlightUI",t.propTypes={annotation:s.object,commentActivity:s.object,scaleFactor:s.number,options:s.shape({isGhostAnnotation:s.bool,isAnnotationNumberingEnabled:s.bool,annotationNumber:s.number}),onAnnotationEnterCallback:s.func,onAnnotationOverCallback:s.func,onAnnotationLeaveCallback:s.func,onAnnotationClickCallback:s.func},t.defaultProps={scaleFactor:1},t})(i.Component)}),define("modules/clean/annotations/annotation_marker",["require","exports","tslib","external/react","external/react-dom","external/react-dom-factories","external/prop-types","jquery","modules/clean/annotations/annotation"],function(e,t,n,o,i,r,a,s,l){"use strict";function c(e,t){return void 0!==e&&null!==e?t(e):void 0}return o=n.__importStar(o),i=n.__importStar(i),r=n.__importStar(r),a=n.__importStar(a),s=n.__importDefault(s),(function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.hideAnnotation=function(){return o._hideAnnotation()},o._getSelectionText=function(){var e="";return window.getSelection&&(e=window.getSelection().toString()),e},o._hasSelectedText=function(){return""!==o._getSelectionText()},o._resetPositionDelta=function(){return o.positionDelta={x:0,y:0}},o._getOffsetPosition=function(e){var t=e.offsetX||(null!=e.nativeEvent?e.nativeEvent.offsetX:void 0)||c(null!=e.nativeEvent?e.nativeEvent.originalEvent:void 0,function(e){return e.layerX}),n=e.offsetY||(null!=e.nativeEvent?e.nativeEvent.offsetY:void 0)||c(null!=e.nativeEvent?e.nativeEvent.originalEvent:void 0,function(e){return e.layerY});return{x:t-o.annotation.getSize()/2,y:n-o.annotation.getSize()/2}},o._getPositionRelativeToParentContainer=function(e){return{x:e.pageX-o.props.parentContainerOffset.left,y:e.pageY-o.props.parentContainerOffset.top}},o._calculateMarkerPos=function(e){var t=o._getPositionRelativeToParentContainer(e),n=o.size/2;return{x:t.x-n-o.positionDelta.x,y:t.y-n-o.positionDelta.y}},o._generateAnnotation=function(e){return o.annotation=new l.Annotation(o.type,o.subtype,o.size),o._updateViewportCoordinatesFromEvent(e),o.annotation},o._updateViewportCoordinatesFromEvent=function(e){var t={x:e.clientX-o.positionDelta.x,y:e.clientY-o.positionDelta.y};return o.annotation.viewportCoordinates[0]=[t]},o._hideAnnotation=function(e){return o.annotation=null,o.setState({isToolVisible:!1,viewerX:null!=e?e.pageX:void 0,viewerY:null!=e?e.pageY:void 0}),"function"==typeof o.props.onAnnotationHiddenCallback?o.props.onAnnotationHiddenCallback():void 0},o._placeAnnotation=function(e){return o.setState({isToolVisible:!0,viewerX:o._calculateMarkerPos(e).x,viewerY:o._calculateMarkerPos(e).y},function(){return o._generateAnnotation(e),"function"==typeof o.props.onAnnotationPlacedCallback?o.props.onAnnotationPlacedCallback(o.annotation):void 0})},o.updateViewportCoordinatesFromMarker=function(){if(o.state.isToolVisible){var e=i.findDOMNode(o.refs.annotationMarker);if(e){var t=s.default(e),n=t.offset(),r={x:n.left+o.annotation.getSize()/2,y:n.top+o.annotation.getSize()/2};o.annotation.viewportCoordinates[0]=[r]}}return null},o._startAnnotationDrag=function(e){return e.preventDefault(),o.isInDragMode=!0,o.positionDelta=o._getOffsetPosition(e),o._updateViewportCoordinatesFromEvent(e),"function"==typeof o.props.onAnnotationStartDragCallback?o.props.onAnnotationStartDragCallback(o.annotation):void 0},o._endAnnotationDrag=function(e){return e.preventDefault(),o.isInDragMode=!1,o._updateViewportCoordinatesFromEvent(e),o._resetPositionDelta(),"function"==typeof o.props.onAnnotationEndDragCallback?o.props.onAnnotationEndDragCallback(o.annotation):void 0},o._isOnMarker=function(e){if(o.state.isToolVisible){var t=i.findDOMNode(o.refs.annotationMarker);return null!=t&&(e.target===t||s.default.contains(t,e.target))}},o.onMouseDownCallback=function(e){if(o.state.isToolVisible&&o._isOnMarker(e))return o._startAnnotationDrag(e),e.preventDefault()},o.onMouseMoveCallback=function(e){if(o.isInDragMode&&o.state.isToolVisible)return o.setState({viewerX:o._calculateMarkerPos(e).x,viewerY:o._calculateMarkerPos(e).y}),e.preventDefault()},o.onMouseUpCallback=function(e){return o.state.isToolVisible?o.isInDragMode?o._endAnnotationDrag(e):o._hideAnnotation(e):o._hasSelectedText()?void 0:(o._placeAnnotation(e),e.preventDefault())},o.onScrollCallback=function(){if(o.state.isToolVisible)return o.updateViewportCoordinatesFromMarker(),"function"==typeof o.props.onAnnotationScrollCallback?o.props.onAnnotationScrollCallback(o.annotation):void 0},o.onScaleChangeCallback=function(){return o.updateViewportCoordinatesFromMarker(),"function"==typeof o.props.onAnnotationScaleChangeCallback?o.props.onAnnotationScaleChangeCallback(o.annotation):void 0},o._onMarkerMouseDown=function(e){return{}},o._onMarkerMouseOver=function(e){return"function"==typeof o.props.onAnnotationOverCallback?o.props.onAnnotationOverCallback(o.annotation):void 0},o._onMarkerMouseUp=function(e){return{}},o._onMarkerMouseEnter=function(e){return"function"==typeof o.props.onAnnotationEnterCallback?o.props.onAnnotationEnterCallback(o.annotation):void 0},o._onMarkerMouseLeave=function(e){return"function"==typeof o.props.onAnnotationLeaveCallback?o.props.onAnnotationLeaveCallback(o.annotation):void 0},o.type=l.AnnotationTypes.MARKER,o.subtype=l.AnnotationSubtypes.MARKER.CIRCLE,o.size=28,o.isInDragMode=!1,o._resetPositionDelta(),o.state={isToolVisible:!1,viewerX:0,viewerY:0},o}return n.__extends(t,e),t.prototype.componentWillMount=function(){return{}},t.prototype.render=function(){var e=[];return this.state.isToolVisible&&(e=[r.div({key:"annotationMarker",ref:"annotationMarker",className:"annotation-marker annotation-marker--blue",onMouseDown:this._onMarkerMouseDown,onMouseUp:this._onMarkerMouseUp,onMouseOver:this._onMarkerMouseOver,onMouseEnter:this._onMarkerMouseEnter,onMouseLeave:this._onMarkerMouseLeave,style:{left:this.state.viewerX,top:this.state.viewerY}},r.div({className:"annotation-maker-inner"}))]),r.div({className:"annotation-marker-container"},this.state.isToolVisible?e:void 0)},t.displayName="AnnotationMarker",t.propTypes={onAnnotationPlacedCallback:a.func,onAnnotationHiddenCallback:a.func,onAnnotationStartDragCallback:a.func,onAnnotationEndDragCallback:a.func,onAnnotationOverCallback:a.func,onAnnotationScrollCallback:a.func,onAnnotationScaleChangeCallback:a.func,onAnnotationEnterCallback:a.func,onAnnotationLeaveCallback:a.func,parentContainerOffset:a.object},t.defaultProps={parentContainerOffset:{left:0,top:0}},t})(o.Component)}),define("modules/clean/annotations/annotation_marker_ui",["require","exports","tslib","external/classnames","external/react","external/react-dom","external/react-dom-factories","external/prop-types","jquery"],function(e,t,n,o,i,r,a,s,l){"use strict";function c(e,t){return void 0!==e&&null!==e?t(e):void 0}return o=n.__importDefault(o),i=n.__importStar(i),r=n.__importStar(r),a=n.__importStar(a),s=n.__importStar(s),l=n.__importDefault(l),(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t._isGhostAnnotation=function(){return t.props.options.isGhostAnnotation||!1},t._onMarkerClick=function(e){return"function"==typeof t.props.onAnnotationClickCallback?t.props.onAnnotationClickCallback({commentActivity:t.props.commentActivity}):void 0},t._onMarkerMouseEnter=function(e){var n=l.default(r.findDOMNode(t.refs.annotationMarker)),o=t.props.annotation;return null==o.viewportCoordinates&&(o.viewportCoordinates=[]),o.viewportCoordinates[0]=[{x:n.offset().left+o.annotationSize/2,y:n.offset().top+o.annotationSize/2}],"function"==typeof t.props.onAnnotationEnterCallback?t.props.onAnnotationEnterCallback({annotation:o,commentActivity:t.props.commentActivity}):void 0},t._onMarkerMouseOver=function(e){return{}},t._onMarkerMouseLeave=function(e){return"function"==typeof t.props.onAnnotationLeaveCallback?t.props.onAnnotationLeaveCallback({annotation:t.props.annotation,commentActivity:t.props.commentActivity}):void 0},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){return this.initialViewport=this.props.annotation.getFirstViewportCoordinates()},t.prototype.render=function(){var e=c(null!=this.props.commentActivity?this.props.commentActivity.comment:void 0,function(e){return e.resolved}),t=o.default({"annotation-marker":!0,"annotation-marker--ui":!0,"annotation-marker--blue":!e,"annotation-marker--resolved":e,"annotation-marker--ghost":this._isGhostAnnotation()});return a.div({className:"annotation-marker-container",ref:"markerContainer"},a.div({key:"annotationMarker",ref:"annotationMarker",style:{left:this.initialViewport.x-this.props.annotation.annotationSize/2,top:this.initialViewport.y-this.props.annotation.annotationSize/2},className:t,onClick:this._onMarkerClick,onMouseEnter:this._onMarkerMouseEnter,onMouseOver:this._onMarkerMouseOver,onMouseLeave:this._onMarkerMouseLeave},a.div({className:"annotation-maker-inner"})))},t.displayName="AnnotationMarkerUI",t.propTypes={annotation:s.object,commentActivity:s.object,options:s.shape({isGhostAnnotation:s.bool}),onAnnotationEnterCallback:s.func,onAnnotationOverCallback:s.func,onAnnotationLeaveCallback:s.func,onAnnotationClickCallback:s.func},t.defaultProps={options:{}},t})(i.Component)}),define("modules/clean/annotations/annotation_region",["require","exports","tslib","external/classnames","external/create-react-class","external/react-dom","external/react-dom-factories","external/prop-types","external/lodash","jquery","modules/clean/annotations/annotation"],function(e,t,n,o,i,r,a,s,l,c,u){"use strict";return o=n.__importDefault(o),i=n.__importDefault(i),r=n.__importStar(r),a=n.__importStar(a),s=n.__importStar(s),l=n.__importStar(l),c=n.__importDefault(c),i.default({displayName:"AnnotationRegion",propTypes:{onAnnotationPlacedCallback:s.func,onAnnotationHiddenCallback:s.func,onAnnotationStartDragCallback:s.func,onAnnotationEndDragCallback:s.func,onAnnotationOverCallback:s.func,onAnnotationScrollCallback:s.func,onAnnotationScaleChangeCallback:s.func,onAnnotationEnterCallback:s.func,onAnnotationLeaveCallback:s.func,parentContainerOffset:s.object},TYPE:u.AnnotationTypes.REGION,SUBTYPE:u.AnnotationSubtypes.REGION.RECTANGLE,DEFAULT_REGION_SIZE:60,Directions:{TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},isResizing:!1,getInitialState:function(){return{isInDragMode:!1,resizeDirections:[],isToolVisible:!1,isInitialCreation:!1,rectangle:{top:0,right:0,bottom:0,left:0},anchorRectangle:{top:0,right:0,bottom:0,left:0},anchorMouse:{x:0,y:0}}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},_getPositionRelativeToParentContainer:function(e){return{x:e.pageX-this.props.parentContainerOffset.left,y:e.pageY-this.props.parentContainerOffset.top}},_updateAnnotationFromState:function(){var e=this.state.rectangle.top+this.props.parentContainerOffset.top,t=this.state.rectangle.right+this.props.parentContainerOffset.left,n=this.state.rectangle.bottom+this.props.parentContainerOffset.top,o=this.state.rectangle.left+this.props.parentContainerOffset.left;return this.annotation.viewportCoordinates[0]=[{x:o,y:e},{x:o,y:n},{x:t,y:n},{x:t,y:e}]},_isOnRegion:function(e){if(this.state.isToolVisible){var t=r.findDOMNode(this.refs.annotationRegion);if(null!=t)return e.target===t||c.default.contains(t,e.target)}return!1},_isModifying:function(){return this.state.isInDragMode||this.isResizing},_showNewRectangle:function(e){return this.isResizing=!0,this.setState({isInDragMode:!1,resizeDirections:[this.Directions.TOP,this.Directions.LEFT],isToolVisible:!0,isInitialCreation:!0,rectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorRectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorMouse:e})},_startDragging:function(e){return this.isResizing=!1,this.setState({isInDragMode:!0,resizeDirections:[],anchorRectangle:l.clone(this.state.rectangle),anchorMouse:e})},_startResizing:function(e,t){return this.isResizing=!0,this.setState({isInDragMode:!1,resizeDirections:l.clone(t),anchorRectangle:l.clone(this.state.rectangle),anchorMouse:e})},componentWillMount:function(){return this.annotation=new u.Annotation(this.TYPE,this.SUBTYPE)},hideAnnotation:function(){return this.setState({isToolVisible:!1,isInDragMode:!1,resizeDirections:[]}),"function"==typeof this.props.onAnnotationHiddenCallback?this.props.onAnnotationHiddenCallback(this.annotation):void 0},getDimensions:function(){return{width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},createDefaultRegion:function(e){var t=this;e.preventDefault();var n=this._getPositionRelativeToParentContainer(e),o=n.x,i=n.y,r=this.DEFAULT_REGION_SIZE/2;return this.isResizing=!1,this.setState({isHovering:!0,isToolVisible:!0,isInDragMode:!1,resizeDirections:[],isInitialCreation:!1,rectangle:{top:i-r,right:o+r,bottom:i+r,left:o-r}},function(){return t._updateAnnotationFromState(),"function"==typeof t.props.onAnnotationPlacedCallback?t.props.onAnnotationPlacedCallback(t.annotation):void 0})},onMouseDownCallback:function(e){e.preventDefault();var t=this._getPositionRelativeToParentContainer(e);return this.state.isToolVisible?this._isOnRegion(e)&&!this.isResizing?(this._updateAnnotationFromState(),"function"==typeof this.props.onAnnotationStartDragCallback&&this.props.onAnnotationStartDragCallback(this.annotation),this._startDragging(t)):void 0:this._showNewRectangle(t)},onMouseMoveCallback:function(e){var t;if(e.preventDefault(),!this.state.isToolVisible)return t=this._getPositionRelativeToParentContainer(e),void this._showNewRectangle(t);if(this._isModifying()){t=this._getPositionRelativeToParentContainer(e);var n={x:t.x-this.state.anchorMouse.x,y:t.y-this.state.anchorMouse.y},o=l.clone(this.state.anchorRectangle);return this.state.isInDragMode?o={top:this.state.anchorRectangle.top+n.y,right:this.state.anchorRectangle.right+n.x,bottom:this.state.anchorRectangle.bottom+n.y,left:this.state.anchorRectangle.left+n.x}:this.isResizing&&(this.state.resizeDirections.indexOf(this.Directions.TOP)>=0?o.top=this.state.anchorRectangle.top+n.y:this.state.resizeDirections.indexOf(this.Directions.BOTTOM)>=0&&(o.bottom=this.state.anchorRectangle.bottom+n.y),this.state.resizeDirections.indexOf(this.Directions.LEFT)>=0?o.left=this.state.anchorRectangle.left+n.x:this.state.resizeDirections.indexOf(this.Directions.RIGHT)>=0&&(o.right=this.state.anchorRectangle.right+n.x)),o={top:Math.min(o.top,o.bottom),right:Math.max(o.left,o.right),bottom:Math.max(o.top,o.bottom),left:Math.min(o.left,o.right)},this.setState({rectangle:o})}},onMouseUpCallback:function(e){if(e.preventDefault(),this.state.isToolVisible)return this._isModifying()?(this._updateAnnotationFromState(),this.state.isInitialCreation?"function"==typeof this.props.onAnnotationPlacedCallback&&this.props.onAnnotationPlacedCallback(this.annotation):"function"==typeof this.props.onAnnotationEndDragCallback&&this.props.onAnnotationEndDragCallback(this.annotation),this.isResizing=!1,this.setState({isInDragMode:!1,resizeDirections:[],isInitialCreation:!1})):this.hideAnnotation(e)},onScrollCallback:function(){if(this.state.isToolVisible)return this._updateAnnotationFromState(),
"function"==typeof this.props.onAnnotationScrollCallback?this.props.onAnnotationScrollCallback(this.annotation):void 0},onScaleChangeCallback:function(){return this._updateAnnotationFromState(),"function"==typeof this.props.onAnnotationScaleChangeCallback?this.props.onAnnotationScaleChangeCallback(this.annotation):void 0},_onRegionMouseDown:function(e){},_onRegionMouseOver:function(e){return"function"==typeof this.props.onAnnotationOverCallback?this.props.onAnnotationOverCallback(this.annotation):void 0},_onRegionMouseUp:function(e){},_onRegionMouseEnter:function(e){return this.setState({isHovering:!0}),"function"==typeof this.props.onAnnotationEnterCallback?this.props.onAnnotationEnterCallback(this.annotation):void 0},_onRegionMouseLeave:function(e){return this.setState({isHovering:!1}),"function"==typeof this.props.onAnnotationLeaveCallback?this.props.onAnnotationLeaveCallback(this.annotation):void 0},_onHandleMouseDown:function(e,t){e.preventDefault(),this.isResizing=!0;var n=this._getPositionRelativeToParentContainer(e);return this._updateAnnotationFromState(),"function"==typeof this.props.onAnnotationStartDragCallback&&this.props.onAnnotationStartDragCallback(this.annotation),this._startResizing(n,t)},_renderSideHandles:function(){var e=this;return a.div({ref:"side-handle-wrapper",className:"annotation-region-side-handle--wrapper"},Array.from(l.values(this.Directions)).map(function(t){return(function(t){return a.div({ref:"side-handle-"+t,className:"annotation-region-side-handle annotation-region-side-handle--"+t,onMouseDown:function(n){return e._onHandleMouseDown(n,[t])}})})(t)}))},_renderCornerHandles:function(){var e=this;return[this.Directions.TOP,this.Directions.BOTTOM].map(function(t){return[e.Directions.LEFT,e.Directions.RIGHT].map(function(n){return(function(t,n){return a.div({ref:"corner-handle-"+t+"-"+n,className:"annotation-region-corner-handle annotation-region-corner-handle--"+t+"-"+n,onMouseDown:function(o){return e._onHandleMouseDown(o,[t,n])}},a.div({ref:"corner-handle-"+t+"-"+n+"-dot",className:"annotation-region-corner-handle--dot annotation-region-corner-handle--dot--"+t+"-"+n}))})(t,n)})})},render:function(){var e=[];if(this.state.isToolVisible){var t={"annotation-region":!0,"annotation-region--blue":!0,"is-modifying":this._isModifying(),hover:this.state.isHovering};e=[a.div({key:"annotationRegion",ref:"annotationRegion",className:o.default(t),onMouseDown:this._onRegionMouseDown,onMouseUp:this._onRegionMouseUp,onMouseOver:this._onRegionMouseOver,onMouseOut:this._onRegionMouseOut,onMouseEnter:this._onRegionMouseEnter,onMouseLeave:this._onRegionMouseLeave,style:{left:this.state.rectangle.left,top:this.state.rectangle.top,width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},this._renderSideHandles(),this._renderCornerHandles())]}return a.div({className:"annotation-region-container"},this.state.isToolVisible?e:void 0)}})}),define("modules/clean/annotations/annotation_region_ui",["require","exports","tslib","external/classnames","external/react","external/react-dom","external/react-dom-factories","external/prop-types","jquery"],function(e,t,n,o,i,r,a,s,l){"use strict";function c(e,t){return void 0!==e&&null!==e?t(e):void 0}return o=n.__importDefault(o),i=n.__importStar(i),r=n.__importStar(r),a=n.__importStar(a),s=n.__importStar(s),l=n.__importDefault(l),(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t._isGhostAnnotation=function(){return t.props.options.isGhostAnnotation||!1},t._onRegionClick=function(e){return"function"==typeof t.props.onAnnotationClickCallback?t.props.onAnnotationClickCallback({annotation:t.props.annotation,commentActivity:t.props.commentActivity}):void 0},t._onRegionMouseEnter=function(e){var n=l.default(r.findDOMNode(t.refs.annotationRegion)),o=t.props.annotation;null==o.viewportCoordinates&&(o.viewportCoordinates=[]);var i=n.offset().top,a=n.offset().left,s=i+n.height(),c=a+n.width();return o.viewportCoordinates[0]=[{x:a,y:i},{x:a,y:s},{x:c,y:s},{x:c,y:i}],"function"==typeof t.props.onAnnotationEnterCallback?t.props.onAnnotationEnterCallback({annotation:o,commentActivity:t.props.commentActivity}):void 0},t._onRegionMouseOver=function(e){return{}},t._onRegionMouseLeave=function(e){return"function"==typeof t.props.onAnnotationLeaveCallback?t.props.onAnnotationLeaveCallback({annotation:t.props.annotation,commentActivity:t.props.commentActivity}):void 0},t}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=c(null!=this.props.commentActivity?this.props.commentActivity.comment:void 0,function(e){return e.resolved}),n=this.props.annotation.getBoundingBox(),i=o.default({"annotation-region":!0,"annotation-region--ui":!0,"annotation-region--resolved":t,"annotation-region--ui--resolved":t,"annotation-region--ghost":this._isGhostAnnotation()});return a.div({className:"annotation-region-container"},a.div({key:"annotationRegion",ref:"annotationRegion",className:i,onClick:this._onRegionClick,onMouseEnter:this._onRegionMouseEnter,onMouseOver:this._onRegionMouseOver,onMouseLeave:this._onRegionMouseLeave,style:{left:n.left*this.props.scaleFactor,top:n.top*this.props.scaleFactor,width:(n.right-n.left)*this.props.scaleFactor,height:(n.bottom-n.top)*this.props.scaleFactor}},a.div({className:"annotation-region-inner"}),(function(){if(e.props.options.isAnnotationNumberingEnabled){var n=o.default({"annotation-number":!0,"annotation-number--resolved":t});return a.div({className:n},e.props.options.annotationNumber)}})()))},t.displayName="AnnotationRegionUI",t.propTypes={annotation:s.object,scaleFactor:s.number,commentActivity:s.object,options:s.shape({isGhostAnnotation:s.bool,isAnnotationNumberingEnabled:s.bool,annotationNumber:s.number}),onAnnotationEnterCallback:s.func,onAnnotationOverCallback:s.func,onAnnotationLeaveCallback:s.func,onAnnotationClickCallback:s.func},t.defaultProps={scaleFactor:1},t})(i.Component)}),define("modules/clean/annotations/annotation_renderer_utils",["require","exports","tslib","external/lodash","modules/clean/annotations/annotation","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_marker_ui","modules/clean/annotations/annotation_region_ui"],function(e,t,n,o,i,r,a,s){"use strict";function l(e,t){return void 0!==e&&null!==e?t(e):void 0}return o=n.__importStar(o),r=n.__importDefault(r),a=n.__importDefault(a),s=n.__importDefault(s),(function(){function e(){}return e.prototype.shouldUpdateAnnotations=function(e,t){if((null!=e.annotations?e.annotations.length:void 0)!==l(Object.keys(t),function(e){return e.length}))return!0;for(var n=0,i=Array.from(e.annotations);n<i.length;n++){var r=i[n],a=r.commentActivity.activity_key;if(!o.isEqual(t[a],r))return!0}return!1},e.prototype.renderAnnotation=function(e,t,n){if(null==e.annotation||null==e.commentActivity)return null;var o=i.Annotation.createAnnotationFromDict(e.annotation),l=e.commentActivity;if(null==(null!=o?o.type:void 0)||t(l.activity_key))return null;var c=null;switch(o.type){case i.AnnotationTypes.MARKER:c=a.default;break;case i.AnnotationTypes.HIGHLIGHT:c=r.default;break;case i.AnnotationTypes.REGION:c=s.default}return null==c?null:n(c,o,l,null!=e.options?e.options:{})},e})()}),define("modules/clean/annotations/preview_image_annotations_toolbar",["require","exports","tslib","external/classnames","external/react","external/react-dom","external/lodash","jquery","modules/clean/keycode","modules/clean/react/css_timing","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/dom","modules/core/i18n","modules/clean/react/previews/toolbar_flip_buttons"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,m,h,v,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),i=n.__importStar(i),r=n.__importStar(r),a=n.__importStar(a),s=n.__importDefault(s),h=n.__importStar(h);var g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isToolbarVisible:!0},t.onMouseMove=function(e){if(t.state.isToolbarVisible||t.setState({isToolbarVisible:!0}),t.state.isToolbarVisible)return clearTimeout(t.hideToolbarTimeout),t.hideToolbarTimeout=setTimeout(function(){return t.maybeHideToolbar(e)},3e3)},t.onKeydown=function(e){var n;if(h.focus_in_input()||h.is_input(e.target))return!0;var o=e.keyCode;return[l.KeyCode.EQUALS,l.KeyCode.PLUS_EQUALS_FF,l.KeyCode.PLUS_CHROME,l.KeyCode.PLUS_EQUALS_FF_GERMAN].includes(o)?("function"==typeof t.props.onZoomIn&&t.props.onZoomIn(),n=!0):[l.KeyCode.MINUS_FF_MAC,l.KeyCode.MINUS_FF,l.KeyCode.MINUS_CHROME].includes(o)?("function"==typeof t.props.onZoomOut&&t.props.onZoomOut(),n=!0):o===l.KeyCode.P?(t.props.onPrint&&t.onPrint(d.UserActionContext.Keyboard)(),n=!0):t.props.onKeyPress&&(n=t.props.onKeyPress(e)),n&&null!=e.preventDefault&&e.preventDefault(),!n},t.maybeHideToolbar=function(e){if(0===s.default(e.target).closest(r.findDOMNode(t.refs.previewToolbar)).length)return t.setState({isToolbarVisible:!1})},t.zoomToolTipText=function(){return 1===t.props.zoomPercent?v._("Zoom to fit"):v._("View actual size")},t.getZoomLabel=function(){return t.props.zoomPercent?v.format_percent(Math.round(100*t.props.zoomPercent)):""},t.onZoomMouseDown=function(e,n){return t.isZooming||u.logUserAction(n.action,n.context),t.isZooming=!0,t.keepZooming(e,400)},t.keepZooming=function(e,n){if(t.isZooming)return e(),setTimeout(function(){return t.keepZooming(e,75)},n)},t.onZoomMouseUp=function(){return t.isZooming=!1},t.onZoomMouseLeave=function(){return t.isZooming=!1},t.onClickPrevious=function(){return t.props.onPrevious(),u.logUserAction(d.UserAction.FlipPrevious,d.UserActionContext.Toolbar)},t.onClickNext=function(){return t.props.onNext(),u.logUserAction(d.UserAction.FlipNext,d.UserActionContext.Toolbar)},t.onClickFullscreen=function(){return t.props.onFullscreen(),u.logUserAction(d.UserAction.ToggleFullscreenOn,d.UserActionContext.Toolbar)},t.onPrint=function(e){return function(){return t.props.onPrint(),u.logUserAction(d.UserAction.Print,e)}},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){return window.addEventListener("mousemove",this.onMouseMove)},t.prototype.componentWillUnmount=function(){return window.removeEventListener("mousemove",this.onMouseMove),clearTimeout(this.hideToolbarTimeout)},t.prototype.showFlipButtons=function(){return this.props.count>1&&null!=this.props.onPrevious&&null!=this.props.onNext},t.prototype.showZoomButtons=function(){return null!=this.props.onZoomOut||null!=this.props.onZoomIn},t.prototype.canPrint=function(){return!(this.props.sharePermission&&this.props.sharePermission.canPrintRoles&&0===this.props.sharePermission.canPrintRoles.length)},t.prototype.render=function(){if(!this.state.isToolbarVisible)return null;if(this.props.count<=1&&null==this.props.onZoomOut&&null==this.props.onZoomIn&&null==this.props.onFullscreen)return null;var e={"zoom-out":!0,disabled:null!=this.props.minimumZoomPercent&&null!=this.props.zoomPercent&&this.props.zoomPercent<=this.props.minimumZoomPercent},t={"zoom-in":!0,disabled:null!=this.props.maximumZoomPercent&&null!=this.props.zoomPercent&&this.props.zoomPercent>=this.props.maximumZoomPercent},n={"enable-region-creation":!0,"image-toolbar__item":!0,"item-w-label":!0,disabled:!this.props.canEnableRegionCreation};return i.createElement("div",{className:"preview-toolbar-overlay-container"},i.createElement(p.KeyboardBindingConnector,{allKeyCallback:this.onKeydown}),i.createElement("div",{className:"preview-toolbar-overlay",ref:"previewToolbar"},i.createElement("div",{className:"preview-toolbar-content image-toolbar"},this.showFlipButtons()?i.createElement(_.ToolbarFlipButtons,{index:this.props.index,count:this.props.count,onClickPrevious:this.onClickPrevious,onClickNext:this.onClickNext,className:"image-toolbar__item"}):null,this.showZoomButtons()?i.createElement("span",{className:"zoom-buttons image-toolbar__item"},null!=this.props.onZoomOut?i.createElement(m.TitleBubble,{content:v._("Zoom out"),position:m.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},i.createElement("button",{className:o.default(e),onMouseDown:a.partial(this.onZoomMouseDown,this.props.onZoomOut,{action:d.UserAction.ZoomOut,context:d.UserActionContext.Toolbar}),onMouseUp:this.onZoomMouseUp,onMouseLeave:this.onZoomMouseLeave},i.createElement(f.Sprite,{group:"web",name:"zoomout",alt:v._("Zoom out")}))):null,null!=this.props.onZoomOriginalOrFit?i.createElement(m.TitleBubble,{content:this.zoomToolTipText(),position:m.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},i.createElement("button",{ref:"zoomLabel",className:"zoom-label",onClick:this.props.onZoomOriginalOrFit},this.getZoomLabel())):null,null!=this.props.onZoomIn?i.createElement(m.TitleBubble,{content:v._("Zoom in"),position:m.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},i.createElement("button",{className:o.default(t),onMouseDown:a.partial(this.onZoomMouseDown,this.props.onZoomIn,{action:d.UserAction.ZoomIn,context:d.UserActionContext.Toolbar}),onMouseUp:this.onZoomMouseUp,onMouseLeave:this.onZoomMouseLeave},i.createElement(f.Sprite,{group:"web",name:"zoom",alt:v._("Zoom in")}))):null):null,null!=this.props.onFullscreen?i.createElement(m.TitleBubble,{content:v._("Fullscreen"),position:m.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},i.createElement("button",{className:"fullscreen image-toolbar__item item-w-label",onClick:this.onClickFullscreen},i.createElement(f.Sprite,{group:"web",name:"fullscreen",alt:v._("Fullscreen")}))):null,this.props.onPrint&&this.canPrint()?i.createElement(m.TitleBubble,{content:v._("Print"),position:m.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},i.createElement("button",{className:"print-button",onClick:this.onPrint(d.UserActionContext.Toolbar)},i.createElement(f.Sprite,{group:"web",name:"print",alt:v._("Print")}))):null,i.createElement(m.TitleBubble,{content:v._("Comment"),position:m.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},i.createElement("button",{className:o.default(n),onClick:this.props.canEnableRegionCreation?this.props.onRegionCreationClick:void 0},i.createElement(f.Sprite,{group:"web",name:"ic_comment_area_large",alt:v._("Comment")}))))))},t})(i.Component);t._PreviewImageAnnotationsToolbar=g;var y=c.requireCssWithComponent(g,["/static/css/preview_toolbar-vflxsPO3V.css"]);t.PreviewImageAnnotationsToolbar=y}),define("modules/clean/average_counter",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(){this.average=0,this.count=0}return e.prototype.getAverage=function(){return this.average},e.prototype.add=function(e){this.average=(this.average*this.count+e)/(this.count+1),this.count++},e.prototype.addArray=function(e){var t=e.reduce(function(e,t){return e+t}),n=this.count+e.length;this.average=(this.average*this.count+t)/n,this.count=n},e})();t.AverageCounter=n}),define("modules/clean/callback_chain/callback_chain",["require","exports"],function(e,t){"use strict";function n(e){return void 0!==e.abortCallbackChain}function o(e){var t=e,n=!1;return t.abortCallbackChain=function(){n=!0},Object.defineProperty(t,"callbackChainAborted",{get:function(){return n}}),t}Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(e){this.callbacks=e}return e.prototype.run=function(e){for(var t=n(e)?e:o(e),i=0,r=this.callbacks;i<r.length;i++){var a=r[i];if(t.callbackChainAborted)break;a(t)}},e})();t.CallbackChain=i}),define("modules/clean/comments/actions",["require","exports","tslib","external/reflux","external/lodash"],function(e,t,n,o,i){"use strict";o=n.__importStar(o),i=n.__importStar(i);var r=["stopViewingComments","showResolvedComments","hideResolvedComments","showAnnotationConversation","hideAnnotationConversation","showAnnotationInput","hideAnnotationInput","updateAnnotationText","updateAnnotationReplyText","startAnnotationCreation","stopAnnotationCreation","notifyPreviewReady","switchRevision","startViewingComments","revealAnnotation","receiveFileActivity","showComments","hideComments","switchTabs","setShouldShowOnboarding","updateAnnotationReplyFocused","updateAnnotationConversationHover","updateAnnotationUiHover","setRegionCreationEnabled","setShowTutorial","setCurrentTutorialStep","setExpandedComment","setMentionedContact","addedComment","enableCommenting","disableCommenting","cancelAnnotationComment","receiveRevisions"];return o.createActions(i.zipObject(r,r.map(function(e){return{sync:!0}})))}),define("modules/clean/comments/components/ui_constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_ANNOTATION_COMMENT_INPUT_MAX_HEIGHT=220,t.TUTORIAL_INITIATOR="tutorialInitiator",t.TUTORIAL_CREATE_ANNOTATION="tutorialCreateAnnotation",t.TUTORIAL_CREATE_ANNOTATION_SUCCESS="tutorialCreateAnnotationSuccess",t.TUTORIAL_REPLY="tutorialReply",t.TUTORIAL_REPLY_SUCCESS="tutorialReplySuccess",t.TUTORIAL_MENTION="tutorialMention",t.TUTORIAL_MENTION_SUCCESS="tutorialMentionSuccess"}),define("modules/clean/comments/events",["require","exports","tslib","external/eventemitter3"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),t.CommentsEvents=new o.default,t.CommentsEventsMixin={onCommentsEvent:function(e,n,o){this.__commentsEvents.push([e,n,o]),t.CommentsEvents.on(e,n,o)},componentWillMount:function(){this.__commentsEvents=[]},componentWillUnmount:function(){this.__commentsEvents.forEach(function(e){var n=e[0],o=e[1],i=e[2];t.CommentsEvents.off(n,o,i)}),this.__commentsEvents=null}}}),define("modules/clean/comments/legacy_redux_integration",["require","exports","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/data/actions"],function(e,t,n,o){"use strict";function i(e){s.dispatch(o.switchRevisionAction(e))}function r(){s.dispatch(o.restoreRevisionAction())}function a(e){s.dispatch(o.saveForwardRevision(e))}Object.defineProperty(t,"__esModule",{value:!0});var s=n.getStoreForFileViewer();t.reduxSwitchRevision=i,t.reduxRestoreRevision=r,t.reduxSaveForwardRevision=a}),define("modules/clean/comments/lib/type_check",["require","exports","modules/core/types"],function(e,t,n){"use strict";function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,o,i){i.value=n.takes.apply(void 0,e.concat([i.value]))}}function i(e){return function(t,o,i){i.value=n.returns(e,i.value)}}Object.defineProperty(t,"__esModule",{value:!0}),t.takes=o,t.returns=i}),define("modules/clean/comments/models/comment",["require","exports","tslib","external/lodash","modules/clean/file_activity/models/immutability_helper","modules/clean/activity/activity_user"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var a=(function(){function e(e){var t=void 0===e?{}:e,n=t.revision,o=void 0===n?null:n,i=t.annotation,r=void 0===i?null:i,a=t.sticker_id,s=void 0===a?null:a,l=t.thumbnail_url,c=void 0===l?null:l;this.revision=o,this.annotation=r,this.sticker_id=s,this.thumbnail_url=c}return e.fromDict=function(t){return new e({revision:t.revision,annotation:t.annotation,sticker_id:t.stickers&&t.stickers.id,thumbnail_url:t.thumbnail_url})},e.prototype.toDict=function(){return o.pickBy({revision:this.revision,annotation:this.annotation,stickers:this.sticker_id?{id:this.sticker_id}:null,thumbnail_url:this.thumbnail_url},function(e){return null!=e})},e.prototype.hasRevisionData=function(){return null!=this.revision},e.prototype.hasAnnotationData=function(){return null!=this.annotation},e.prototype.hasStickerData=function(){return null!=this.sticker_id},e.prototype.hasThumbnailUrl=function(){return null!=this.thumbnail_url},e.prototype.getStickerId=function(){return this.sticker_id},e})();t.CommentMetadata=a;var s=(function(){function e(e){var t=void 0===e?{}:e,n=t.comment_gid,o=void 0===n?"":n,i=t.commenter,a=void 0===i?r.ActivityUser.anonymous:i,s=t.comment_text,l=void 0===s?"":s,c=t.raw_comment_text,u=void 0===c?"":c,d=t.when_mses,p=void 0===d?0:d,f=t.resolved,m=void 0!==f&&f,h=t.comment_metadata,v=void 0===h?null:h;this.comment_gid=o,this.commenter=a,this.comment_text=l,this.raw_comment_text=u,this.when_mses=p,this.resolved=m,this.comment_metadata=v}return e.fromDict=function(t){var n=t.comment_meta_json;return new e({comment_gid:t.comment_gid,commenter:r.ActivityUser.fromDict(t.commenter_dict),comment_text:t.comment_text,raw_comment_text:t.raw_comment_text,when_mses:t.when_mses,resolved:t.resolved,comment_metadata:n?a.fromDict(n):null})},e.prototype.hasMetadata=function(){return null!=this.comment_metadata},e.prototype.resolve=function(){return i.set(this,"resolved",!0)},e.prototype.unresolve=function(){return i.set(this,"resolved",!1)},e})();t.Comment=s}),define("modules/clean/comments/models/comment_activity",["require","exports","tslib","external/lodash","modules/clean/file_activity/models/immutability_helper","modules/clean/activity/activity_user","modules/clean/comments/models/comment"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var s=(function(){function e(e){var t=(void 0===e?{}:e).user_ids_who_can_delete,n=void 0===t?[]:t;this.user_ids_who_can_delete=n}return e.fromDict=function(t){return t.user_ids_who_can_delete.forEach(function(e){if(!o.isNumber(e))throw TypeError(e+" in user_ids_who_can_delete is not a number")}),new e(t)},e})();t.CommentActivityPermissions=s;var l=(function(){function e(e){var t=void 0===e?{}:e,n=t.activity_key,o=void 0===n?"":n,i=t.comment_activities,r=void 0===i?[]:i,l=t.users_to_notify,c=void 0===l?[]:l,u=t.is_seen,d=void 0!==u&&u,p=t.highlight_as_unread,f=void 0!==p&&p,m=t.comment,h=void 0===m?new a.Comment:m,v=t.permissions,_=void 0===v?new s:v,g=t.status,y=void 0===g?"POSTED":g;this.activity_key=o,this.comment_activities=r,this.users_to_notify=c,this.is_seen=d,this.highlight_as_unread=f,this.comment=h,this.permissions=_,this.status=y}return e.createLocalInstance=function(t){var n=t.activityKey,i=void 0===n?o.uniqueId("local-comment-activity-"):n,r=t.commenter,s=t.rawCommentText,l=t.metadata,c=void 0===l?null:l,u=t.status,d=void 0===u?"POSTING":u;return new e({activity_key:i,comment:new a.Comment({comment_gid:o.uniqueId("pending-comment-gid-"),commenter:r,comment_text:s,raw_comment_text:s,when_mses:(new Date).getTime(),resolved:!1,comment_metadata:c}),is_seen:!0,highlight_as_unread:!1,status:d})},e.fromDict=function(t){return new e({activity_key:t.activity_key,comment_activities:t.comment_activity_dicts.map(e.fromDict),users_to_notify:(t.users_to_notify||[]).map(r.ActivityUser.fromDict),is_seen:t.is_seen,highlight_as_unread:t.highlight_as_unread,comment:a.Comment.fromDict(t.comment),permissions:s.fromDict(t.permissions)})},Object.defineProperty(e.prototype,"when_mses",{get:function(){return this.comment.when_mses},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_pending",{get:function(){return"POSTED"!==this.status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_resolved",{get:function(){return this.comment.resolved},enumerable:!0,configurable:!0}),e.prototype.shouldHighlightAsUnread=function(){return!!this.highlight_as_unread||this.comment_activities.some(function(e){return e.shouldHighlightAsUnread()})},e.prototype.resolve=function(){return i.set(this,"comment",this.comment.resolve())},e.prototype.unresolve=function(){return i.set(this,"comment",this.comment.unresolve())},e.prototype.setStatus=function(e){return i.set(this,"status",e)},e.prototype.markSeen=function(){return i.merge(this,{is_seen:!0,highlight_as_unread:!1})},e})();t.CommentActivity=l}),define("modules/clean/comments/models/loading_spinner",["require","exports"],function(e,t){"use strict";return function(e,t){return(null==t||t.comment_activities.length>0)&&e}}),define("modules/clean/comments/revisions",["require","exports","tslib","external/lodash","modules/clean/previews/data/api_shims"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var r=function(e,t){var r=o.pick(t,"revision_id","direct_blockserver_link","preview_ssr_image_url_tmpl","preview_ssr_text_url_tmpl","preview_ssr_refresh_url","preview_url","preview");r.preview_url=t.preview_link,r.preview=r.preview||void 0;var a=n.__assign({},e,r);return i.futurizeFile(a)};t.getFileWithRevision=r;var a=function(e,t){return t.when-e.when};t.compareRevision=a;var s=function(e,t){return a(e,t)>0};t.isRevisionOlderThan=s;var l=function(e,t){return a(e,t)<0};t.isRevisionNewerThan=l;var c=function(e,t){return 0===a(e,t)};t.isRevisionEqual=c}),define("modules/clean/comments/store",["require","exports","tslib","external/reflux","external/lodash","modules/clean/comments/actions","modules/clean/comments/components/ui_constants","modules/clean/comments/events","modules/clean/comments/models/loading_spinner","modules/clean/comments/revisions","modules/clean/react/file_comments/logger","modules/constants/comments_panel","modules/core/exception","modules/clean/comments/legacy_redux_integration"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f){"use strict";function m(e,t){return void 0!==e&&null!==e?t(e):void 0}return o=n.__importStar(o),i=n.__importStar(i),r=n.__importDefault(r),l=n.__importDefault(l),c=n.__importStar(c),u=n.__importDefault(u),d=n.__importStar(d),o.createStore({listenables:r.default,init:function(){return this.state=this.getInitialState()},getInitialState:function(){return{actorId:null,viewing:{context:null,contextData:null,revision:null,file:null,showCommentsOverride:null},activity:null,showLoadingSpinner:!0,oref:null,showResolvedComments:!1,isPreviewReady:!1,regionCreationEnabled:!1,viewAnnotation:null,createAnnotation:null,annotationText:null,annotationReplyTextByKey:{},shouldShowOnboarding:void 0,showTutorial:d.SHOW_COMMENTS_TUTORIAL,currentTutorialStep:a.TUTORIAL_INITIATOR,showCommentsPref:d.SHOW_COMMENTS_PANEL,revisions:null}},setState:function(e){return i.assignIn(this.state,e),this.trigger(this.state)},replaceState:function(e){return this.state=e,this.forceUpdate()},forceUpdate:function(){return this.trigger(this.state)},isUserSubscribed:function(e){if(null!=this.state.activity?this.state.activity.users_to_notify:void 0)for(var t=0,n=Array.from(this.state.activity.users_to_notify);t<n.length;t++){var o=n[t];if(o.id===e)return!0}return!1},isCommentingEnabled:function(){return!this.state.activity||!this.state.activity.feedback_off},isFileActivityReady:function(){return null!=this.state.activity},canEnableComments:function(){return null!=this.state.activity?this.state.activity.can_edit_feedback:void 0},isStoreInitialized:function(){return!!this.state.viewing.context},hasUnreadComments:function(){return!!(null!=this.state.activity?this.state.activity.comment_activities.some(function(e){return e.shouldHighlightAsUnread()}):void 0)},areCommentsHidden:function(){return null!=this.state.viewing.showCommentsOverride?!this.state.viewing.showCommentsOverride:this.state.showCommentsPref===!1?!this.hasUnreadComments():!this.isCommentingEnabled()},unreadCommentCount:function(){if(null==this.state.activity)return null;var e=function(e){return e.highlight_as_unread&&!e.comment.resolved},t=function(t,n){return n.comment.resolved?t:(e(n)&&(t+=1),t+=n.comment_activities.filter(e).length)};return this.state.activity.comment_activities.reduce(t,0)},isTutorialShown:function(){return null!=this.state.viewing.showTutorialOverride?this.state.viewing.showTutorialOverride:this.state.showTutorial},onReceiveFileActivity:function(e){return null!=e&&null==this.state.viewing.revision&&(this.state.viewing.revision=e.latest_revision),this.setState({activity:e})},onStartViewingComments:function(e){var t,n=e.actorId,o=e.context,i=e.contextData,r=e.oref,a=e.file,s=(e.previewSelector,e.showCommentsOverride),c=e.showTutorialOverride;return t=null===this.state.contextData||l.default(this.state.showLoadingSpinner,this.state.activity),this.setState({actorId:n,viewing:{context:o,contextData:i,file:a,revision:null,showCommentsOverride:s,showTutorialOverride:c},oref:r,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,showLoadingSpinner:t,annotationText:null,annotationReplyTextByKey:{}})},onStopViewingComments:function(){return this.setState({actorId:null,activity:null,viewing:{context:null,contextData:null,revision:null,file:null,showCommentsOverride:null,showTutorialOverride:null},showLoadingSpinner:!0,oref:null,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,annotationText:null,annotationReplyTextByKey:{},revisions:null})},onShowResolvedComments:function(){return this.setState({showResolvedComments:!0})},onHideResolvedComments:function(){return this.setState({showResolvedComments:!1})},onNotifyPreviewReady:function(){if(this.setState({isPreviewReady:!0}),null!=this.state.activity)return s.CommentsEvents.emit("preview-and-comments-ready")},onUpdateAnnotationConversationHover:function(e){if(null!=this.state.viewAnnotation){var t=i.assignIn({},this.state.viewAnnotation,{conversationHover:e});return this.setState({viewAnnotation:t})}},onUpdateAnnotationUiHover:function(e){if(null!=this.state.viewAnnotation){var t=i.assignIn({},this.state.viewAnnotation,{annotationHover:e});return this.setState({viewAnnotation:t})}},onShowAnnotationConversation:function(e){var t=e.annotation,n=e.activityKey;return p.assert(null!=this.state.activity,"Cannot show annotation when file activity is not ready!"),p.assert(null!=t,"Invalid annotation to show"),p.assert(null!=this.state.activity.findConversationByKey(n),"Invalid inline comment to show: "+n),this.setState({viewAnnotation:{annotation:t,activityKey:n,replyFocused:!1,annotationHover:!0,conversationHover:!1}})},onHideAnnotationConversation:function(){return this.setState({viewAnnotation:null})},onUpdateAnnotationReplyFocused:function(e){if(null!=this.state.viewAnnotation){var t=i.assignIn({},this.state.viewAnnotation,{replyFocused:e});return this.setState({viewAnnotation:t})}},onStartAnnotationCreation:function(e){var t=e.annotation;return this.setState({viewAnnotation:null,createAnnotation:{annotation:t,showBubble:!0}}),this._updateTutorial()},onStopAnnotationCreation:function(){return this.setState({createAnnotation:null})},onUpdateAnnotationText:function(e){return this.setState({annotationText:e})},onUpdateAnnotationReplyText:function(e){var t,n=e.activityKey,o=e.text;return n in this.state.annotationReplyTextByKey&&!o?(t=i.omit(this.state.annotationReplyTextByKey,n),this.setState({annotationReplyTextByKey:t})):(t=i.assignIn({},this.state.annotationReplyTextByKey,(r={},r[n]=o,r)),this.setState({annotationReplyTextByKey:t}));var r},onShowAnnotationInput:function(){if(null!=this.state.createAnnotation)return this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!0}})},onHideAnnotationInput:function(){if(null!=this.state.createAnnotation)return this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!1}})},onSwitchRevision:function(e){var t,n=e.revision,o=e.commentActivity;if(p.assert(null!=n,"Revision to switch to must not be null!"),p.assert(null!=this.state.activity,"Cannot switch revision when file activity is not ready!"),!c.isRevisionEqual(n,this.state.viewing.revision)){if(c.isRevisionEqual(n,this.state.activity.latest_revision))t=d.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_LATEST_REVISION,f.reduxRestoreRevision();else{t=d.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_OLD_REVISION;var r=c.getFileWithRevision(this.state.viewing.file,n);f.reduxSwitchRevision(r)}return this.setState({viewing:i.assignIn({},this.state.viewing,{revision:n}),isPreviewReady:!1}),
s.CommentsEvents.emit("revision-did-change"),u.default.log_annotation_event(t,this.state.activity.activity_key,null!=o?o.activity_key:void 0,this.state.actorId,this.state.viewing.context,m(null!=o?o.comment.comment_metadata:void 0,function(e){return e.annotation}))}},onShowComments:function(){return this.setState({viewing:i.assignIn(this.state.viewing,{showCommentsOverride:!0}),showCommentsPref:!0})},onHideComments:function(){return this.setState({viewing:i.assignIn(this.state.viewing,{showCommentsOverride:!1}),viewAnnotation:null,createAnnotation:null,showCommentsPref:!1})},onSetRegionCreationEnabled:function(e){return this.setState({regionCreationEnabled:e,viewAnnotation:null,createAnnotation:null})},onAddedComment:function(){return this.onShowComments(),this.onCancelAnnotationComment()},onCancelAnnotationComment:function(){if(null!=this.state.createAnnotation)return this.onStopAnnotationCreation(),this.onUpdateAnnotationText(null);if(null!=this.state.viewAnnotation){var e=this.state.viewAnnotation.activityKey;return this.onHideAnnotationConversation(),this.onUpdateAnnotationReplyText({activityKey:e,text:null})}},onEnableCommenting:function(){return this.onShowComments()},onDisableCommenting:function(){},onSetShouldShowOnboarding:function(e){return this.setState({shouldShowOnboarding:e})},onSetShowTutorial:function(e){return d.SHOW_COMMENTS_TUTORIAL=e,this.setState({showTutorial:e,viewing:i.assignIn(this.state.viewing,{showTutorialOverride:null})})},onSetCurrentTutorialStep:function(e){return this.setState({currentTutorialStep:e})},onSetExpandedComment:function(e){return this.setState({expandedComment:e}),this._updateTutorial()},onSetMentionedContact:function(e){return this.setState({mentionedContact:e}),this._updateTutorial()},_updateTutorial:function(){return this.state.currentTutorialStep===a.TUTORIAL_CREATE_ANNOTATION&&null!=this.state.createAnnotation?this.setState({currentTutorialStep:a.TUTORIAL_CREATE_ANNOTATION_SUCCESS}):this.state.currentTutorialStep===a.TUTORIAL_REPLY&&this.state.expandedComment?this.setState({currentTutorialStep:a.TUTORIAL_REPLY_SUCCESS}):this.state.currentTutorialStep===a.TUTORIAL_MENTION&&this.state.mentionedContact?this.setState({currentTutorialStep:a.TUTORIAL_MENTION_SUCCESS}):void 0},onReceiveRevisions:function(e){return this.setState({revisions:e})}})}),define("modules/clean/file_activity/api",["require","exports","tslib","external/lodash","modules/clean/ajax","modules/clean/comments/models/comment_activity","modules/clean/file_activity/models/file_activity","modules/core/types"],function(e,t,n,o,i,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),i=n.__importStar(i);var l={actorId:s.Maybe(Number),oref:s.Maybe(String),isBackgroundRequest:s.Maybe(Boolean)},c=function(e){var t=e.url,n=e.type,r=e.data,a=e.actorId,s=e.oref,l=e.isBackgroundRequest,c=l?i.SilentBackgroundRequestOref:i.WebRequestOref;return new Promise(function(e,i){return c({url:t,type:n,data:o.assignIn({oref:s},r),subject_user:a,success:e,error:function(e,t,n){if("abort"!==t)return i(Error(n))}})}).then(JSON.parse)},u=function(e){if("error"===e.status){var t=null!=e.payload?e.payload.error_text:void 0,n=Error(t);throw n.payload=e.payload,n.error_text=t,n}return e.payload},d=function(e){return[u(e),e.bolt_data]},p=function(e){return a.FileActivity.fromDict(e)},f=o.assignIn({commentActivityKey:s.Maybe(String),context:Number,contextData:String,text:String,metadata:s.Maybe(Object)},l),m=s.takes(f,s.returns(Promise,function(e){var t=e.actorId,n=e.commentActivityKey,o=e.context,i=e.contextData,a=e.text,s=e.metadata,l=e.oref,d=e.isBackgroundRequest;return c({actorId:t,url:"/file_activity/comment",type:"POST",data:{activity_context:o,activity_context_data:i,comment_text:a,comment_metadata_json:JSON.stringify(s),target_comment_activity_key:n},oref:l,isBackgroundRequest:d}).then(u).then(r.CommentActivity.fromDict)}));t.addComment=m;var h=o.assignIn({commentActivityKey:String,context:Number,contextData:String},l),v=s.takes(h,s.returns(Promise,function(e){return c({actorId:e.actorId,url:"/file_activity/comment/delete",type:"POST",data:{comment_key:e.commentActivityKey,activity_context:e.context,activity_context_data:e.contextData},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(u)}));t.deleteComment=v;var _=o.assignIn({enableComment:Boolean,context:Number,contextData:String},l),g=s.takes(_,s.returns(Promise,function(e){var t=e.actorId,n=e.enableComment;return c({actorId:t,url:"/file_activity/feedback_setting",type:"POST",data:{activity_context:e.context,activity_context_data:e.contextData,feedback_off:!n},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(u)}));t.updateCommentSetting=g;var y=o.assignIn({resolved:Boolean,commentActivityKey:String,context:Number,contextData:String},l),b=s.takes(y,s.returns(Promise,function(e){var t=e.actorId,n=e.resolved;return c({actorId:t,url:"/file_activity/comment/resolve",type:"POST",data:{activity_key:e.commentActivityKey,activity_context:e.context,activity_context_data:e.contextData,resolved:n},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(u)}));t.updateResolveComment=b;var w=o.assignIn({commentActivityKeys:Array,context:Number,contextData:String},l),S=s.takes(w,s.returns(Promise,function(e){var t=e.actorId,n=e.commentActivityKeys,o=e.context,i=e.contextData,r=e.oref,a=e.isBackgroundRequest;return c({actorId:t,url:"/file_activity/mark_comment_seen_batch",type:"POST",data:{comment_activity_keys:JSON.stringify(n),activity_context:o,activity_context_data:i},oref:r,isBackgroundRequest:a}).then(u)}));t.markCommentSeenBatch=S;var C=o.assignIn({context:Number,contextData:String},l),E=function(e){return c({actorId:e.actorId,url:"/file_activity/file_activity",type:"GET",data:{activity_context:e.context,activity_context_data:e.contextData},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest})},A=s.takes(C,s.returns(Promise,function(e){return E(e).then(u).then(p)}));t.fetchFileActivity=A;var T=s.takes(C,s.returns(Promise,function(e){return E(e).then(d).then(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Array.from(e[0]),o=n[0],i=n[1];return[p(o),i]})}));t.fetchFileActivityWithBoltData=T;var x=o.assignIn({context:Number,contextDataList:Array},l),P=s.takes(x,s.returns(Promise,function(e){var t=e.actorId,n=e.context,i=e.contextDataList,r=e.oref,a=e.isBackgroundRequest;return c({actorId:t,url:"/file_activity/file_activity_batch",type:"GET",data:{activity_context:n,activity_context_data_batch:JSON.stringify(i)},oref:r,isBackgroundRequest:a}).then(function(e){return o.mapValues(e,p)})}));t.fetchFileActivities=P;var k=o.assignIn({subscribed:Boolean,context:Number,contextData:String},l),O=s.takes(k,s.returns(Promise,function(e){var t=e.actorId,n=e.subscribed;return c({actorId:t,url:"/file_activity/subscribe",type:"POST",data:{activity_context:e.context,activity_context_data:e.contextData,subscribed:n},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(u)}));t.updateFileActivitySubscription=O;var I=o.assignIn({context:Number,contextDataList:Array},l),M=s.takes(I,s.returns(Promise,function(e){var t=e.actorId,n=e.context,i=e.contextDataList,r=e.oref,a=e.isBackgroundRequest;return c({actorId:t,url:"/file_activity/comment_status_batch",type:"POST",data:{activity_context:n,activity_context_data_batch:JSON.stringify(i)},oref:r,isBackgroundRequest:a}).then(u).then(function(e){return o.mapValues(e,function(e){return{feedback_off:e.feedback_off,comment_count:e.comment_count,unresolved_comment_count:e.unresolved_comment_count}})})}));t.fetchCommentStatusBatch=M;var R=o.assignIn({feedbackText:String,context:Number,contextData:String},l),F=s.takes(R,s.returns(Promise,function(e){var t=e.actorId,n=e.feedbackText;return c({actorId:t,url:"/file_activity/product_feedback",type:"POST",data:{activity_context:e.context,activity_context_data:e.contextData,feedback_text:n},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(u)}));t.submitProductFeedback=F;var D=s.takes({actorId:Number},s.returns(Promise,function(e){var t=e.actorId;return new Promise(function(e,n){return i.SilentBackgroundRequestOref({url:"/file_activity/mark_commenting_onboarding_seen",type:"POST",success:e,error:n,subject_user:t})}).then(JSON.parse).then(u)}));t.markCommentingOnboardingSeen=D;var N=s.takes({actorId:Number},s.returns(Promise,function(e){var t=e.actorId;return new Promise(function(e,n){return i.SilentBackgroundRequestOref({url:"/file_activity/should_show_commenting_onboarding",type:"POST",success:e,error:n,subject_user:t})}).then(JSON.parse).then(u)}));t.shouldShowCommentingOnboarding=N;var L=s.takes({actorId:Number,shouldShow:Boolean},s.returns(Promise,function(e){return c({actorId:e.actorId,url:"/file_activity/set_commenting_pane_visibility",type:"POST",data:{show_pane:e.shouldShow}}).then(u)}));t.setCommentingPaneVisibility=L;var U=s.takes({shouldShow:Boolean},s.returns(Promise,function(e){return c({url:"/file_activity/set_commenting_pane_visibility",type:"POST",data:{show_pane:e.shouldShow}}).then(u)}));t.setSessionCommentingPaneVisibility=U;var z=s.takes({actorId:Number,shouldShow:Boolean},s.returns(Promise,function(e){return c({actorId:e.actorId,url:"/file_activity/set_show_comments_tutorial",type:"POST",data:{show_tutorial:e.shouldShow}}).then(u)}));t.setShowCommentsTutorial=z}),define("modules/clean/file_activity/clients/file_activity_bolt_client",["require","exports","tslib","external/eventemitter3","modules/clean/analytics","modules/clean/bolt","modules/clean/file_activity/api","modules/clean/optimistic_update","modules/clean/storage","modules/core/exception","modules/core/types"],function(e,t,n,o,i,r,a,s,l,c,u){"use strict";o=n.__importDefault(o),r=n.__importStar(r),a=n.__importStar(a),c=n.__importStar(c);var d=function(e,t){return new r.SignedChannelState("file_activity",e.activity_key,t.revision,t.token)},p=function(e){return{revision:e.revision,token:e.token}},f=void 0,m=(function(e){function t(){var t=e.call(this)||this;return t._onBoltUpdate=t._onBoltUpdate.bind(t),t._onBoltRefresh=t._onBoltRefresh.bind(t),f.apply(t,arguments)}return n.__extends(t,e),t.initClass=function(){f=u.takes({actorId:u.Maybe(Number),context:Number,contextData:String,oref:u.Maybe(String)},function(e){var t=e.actorId,n=e.context,o=e.contextData,i=e.oref;return this.__requestOptions={actorId:t,context:n,contextData:o,oref:i,isBackgroundRequest:!0},this.__optimist=new s.Optimist(null),this.__isLive=!1,this.__isReady=!1,this.__canInit=!0})},t.prototype.getFileActivity=function(){return this.__optimist.getValue()},t.prototype.isReady=function(){return this.__isReady},t.prototype.isLive=function(){return this.__isLive},t.prototype.rebase=function(e){c.assert(this.__isReady,"Cannot rebase when server data is not ready");var t=this.getFileActivity();return this.__optimist.rebase(e),this.emit("updated",this.getFileActivity(),t)},t.prototype.commitOptimisticUpdate=function(e){c.assert(this.__isReady,"Cannot commit optimistic update when server data is not ready");var t=this.getFileActivity(),n=this.__optimist.commit(e);return this.emit("updated",this.getFileActivity(),t),n},t.prototype.rollbackOptimisticUpdate=function(e){c.assert(this.__isReady,"Cannot rollback optimistic update when server data is not ready");var t=this.getFileActivity();if(this.__optimist.rollback(e))return this.emit("updated",this.getFileActivity(),t)},t.prototype.init=function(){var e=this;c.assert(this.__canInit,"Cannot initialize an already initialized or initialization in-progress client"),this.__canInit=!1,this._pullFromServer().then(function(){if(i.CommentsVortexLogger.log("load-comments-success"),e.__isLive)return e._doStartLiveUpdate()}).catch(function(){return e.__canInit=!0})},t.prototype.startLiveUpdate=function(){return c.assert(!this.__isLive,"Client is already live updating"),this.__isReady&&this._doStartLiveUpdate(),this.__isLive=!0},t.prototype.stopLiveUpdate=function(){return this.__isLive=!1,null!=this.__boltClient?this.__boltClient.unsubscribe():void 0},t.prototype._doStartLiveUpdate=function(){var e=d(this.getFileActivity(),this.__boltData);return this.__boltClient=new r.BoltClient([e],this._onBoltUpdate,this._onBoltRefresh),this.__boltClient.start()},t.prototype._pullFromServer=function(){var e=this;l.SessionStorage.set("reload-timestamp",(new Date).getTime());var t=a.fetchFileActivityWithBoltData(this.__requestOptions);return t.then(function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=Array.from(t[0]),i=o[0],r=o[1];e.__boltData=r;var a=e.__optimist.getValue();return e.__optimist.rebase(function(){return i}),i=e.__optimist.getValue(),e.__isReady?e.emit("updated",i,a):(e.__isReady=!0,e.emit("ready",i))}),t.catch(function(t){return e.emit("error",t)}),t},t.prototype._onBoltUpdate=function(e){var t=this;if(1===(null!=e?e.length:void 0)&&e[0].unique_id===this.getFileActivity().activity_key){var n=e[0];return this.__boltData=p(n),this._pullFromServer().then(function(){if(t.__isLive)return n=d(t.getFileActivity(),t.__boltData),t.__boltClient.update_states([n])})}},t.prototype._onBoltRefresh=function(e){var t=this;return this._pullFromServer().then(function(){if(t.__isLive)return t.stopLiveUpdate(),t.startLiveUpdate()})},t})(o.default);return m.initClass(),m}),define("modules/clean/file_activity/clients/file_activity_data_source",["require","exports","tslib","external/lru","external/lodash","modules/clean/comments/events","modules/clean/comments/store","modules/clean/file_activity/clients/file_activity_bolt_client","modules/core/exception"],function(e,t,n,o,i,r,a,s,l){"use strict";o=n.__importDefault(o),i=n.__importStar(i),a=n.__importDefault(a),s=n.__importDefault(s);var c=function(e,t,n,o){return void 0===o&&(o=""),e=null!=e?e:"",e+":"+t+":"+n+":"+o};return(function(){function e(e){var t=e._cache,n=e._unsubscribeStore,o=e._sendFileActivity,i=e._state;this.onStoreUpdate=this.onStoreUpdate.bind(this),this.onClientUpdated=this.onClientUpdated.bind(this),this._cache=t,this._unsubscribeStore=n,this._sendFileActivity=o,this._state=i}return e.initInstance=function(){var t=e;if(null==t.__instance)return t.__instance=t.create(a.default,function(e){return r.CommentsEvents.emit("file-activity-updated",e)})},e.getInstance=function(){var t=e;return l.assert(null!=t.__instance,"expected singleton to have been initialized"),t.__instance},e.create=function(t,n,i){void 0===i&&(i=10);var r=new o.default(i);r.shift=function(){var e=o.default.prototype.shift.call(this),t=e.value;return null!=t&&t.removeAllListeners(),null!=t&&t.stopLiveUpdate(),e};var a=new e({_cache:r,_state:{},_sendFileActivity:n});return a._unsubscribeStore=t.listen(a.onStoreUpdate),a.onStoreUpdate(t.state),a},e.prototype.dispose=function(){return this._unsubscribeStore()},e.prototype.resetCache=function(){return this._cache.removeAll()},e.prototype.replaceState=function(e){if(this.shouldUpdate(e)){this.willUpdate(e);var t=this._state;return this._state=e,this.didUpdate(t)}},e.prototype.getState=function(){return this._state},e.prototype.onStoreUpdate=function(e){var t=e.actorId,n=e.oref,o=e.viewing,i=o.context,r=o.contextData,a={oref:n,actorId:t,context:i,contextData:r};return this.replaceState(a)},e.prototype.shouldUpdate=function(e){return!i.isEqual(this._state,e)},e.prototype.willUpdate=function(e){var t=this.getCurrentClient();if(null!=t)return this.deactivateClient(t)},e.prototype.didUpdate=function(e){var t=this.getCurrentFetchKey();if(!this.isFetching(t)&&(this.sendActivity(null),!this.isNullState(this._state)))return this.fetchAndSend(this._state)},e.prototype.getFetchKey=function(e){return c(e.actorId,e.context,e.contextData,e.oref)},e.prototype.getCurrentFetchKey=function(){return this.getFetchKey(this._state)},e.prototype.getCurrentClient=function(){var e=this.getCurrentFetchKey();return this._cache.get(e)},e.prototype.isFetching=function(e){var t=this._cache.find(this.getFetchKey(e));return null!=t&&!t.isReady()},e.prototype.isNullState=function(e){return!(null!=e.context&&null!=e.contextData)},e.prototype.activateClient=function(e){if(e.on("ready",this.onClientUpdated),e.on("updated",this.onClientUpdated),e.on("error",this.onClientError),e.startLiveUpdate(),e.isReady())return this.onClientUpdated(e.getFileActivity())},e.prototype.deactivateClient=function(e){return e.off("ready",this.onClientUpdated),e.off("updated",this.onClientUpdated),e.off("error",this.onClientError),e.stopLiveUpdate()},e.prototype.deactivateCurrentClient=function(){var e=this.getCurrentClient();if(null!=e)return this.deactivateClient(e)},e.prototype.fetchAndSend=function(e){var t=e.actorId,n=e.context,o=e.contextData,i=e.oref,r=c(t,n,o,i),a=this._cache.get(r);if(null!=a)return this.activateClient(a);var s=this.createFileActivityBoltClient({actorId:t,context:n,contextData:o,oref:i});return s.init(),this._cache.set(r,s),this.activateClient(s)},e.prototype.onClientUpdated=function(e){return this.sendActivity(e)},e.prototype.onClientError=function(e){throw e},e.prototype.sendActivity=function(e){return this._sendFileActivity(e)},e.prototype.createFileActivityBoltClient=function(e){return new s.default(e)},e.prototype.rebase=function(e){var t=this.getCurrentClient();return null!=t&&t.rebase(e)},e.prototype.commitOptimisticUpdate=function(e){var t=this.getCurrentClient();return null!=t?t.commitOptimisticUpdate(e):null},e.prototype.rollbackOptimisticUpdate=function(e){var t=this.getCurrentClient();return null!=t&&t.rollbackOptimisticUpdate(e)},e})()}),define("modules/clean/file_activity/models/file_activity",["require","exports","tslib","external/lodash","modules/core/types","modules/clean/file_activity/models/immutability_helper","modules/clean/activity/activity_user","modules/clean/comments/lib/type_check","modules/clean/comments/models/comment_activity","modules/clean/file_activity/models/revision"],function(e,t,n,o,i,r,a,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var u=(function(){function e(e){var t=void 0===e?{}:e,n=t.activity_key,o=void 0===n?"":n,i=t.feedback_off,r=void 0!==i&&i,a=t.can_edit_feedback,s=void 0===a||a,l=t.comment_activities,c=void 0===l?[]:l,u=t.users_to_notify,d=void 0===u?[]:u,p=t.latest_revision,f=void 0===p?null:p;this.activity_key=o,this.feedback_off=r,this.can_edit_feedback=s,this.comment_activities=c,this.users_to_notify=d,this.latest_revision=f}return e.fromDict=function(t){return new e({activity_key:t.activity_key,feedback_off:t.feedback_off,can_edit_feedback:t.can_edit_feedback,comment_activities:t.comment_activity_dicts.map(l.CommentActivity.fromDict),users_to_notify:(t.users_to_notify||[]).map(a.ActivityUser.fromDict),latest_revision:t.latest_revision})},e.prototype.enableCommenting=function(){return r.set(this,"feedback_off",!1)},e.prototype.disableCommenting=function(){return r.set(this,"feedback_off",!0)},e.prototype._withMutations=function(e){var t=r.thaw(this);return e(t),t},e.prototype._reapComments=function(e){var t=this.comment_activities.slice();return this.comment_activities.forEach(function(e){t.push.apply(t,e.comment_activities)}),e?t.filter(e):t},e.prototype._findCommentPath=function(e,t){void 0===t&&(t=!1);for(var n=function(t){return t.activity_key===e},o=0;o<this.comment_activities.length;o++){var i=this.comment_activities[o];if(n(i))return["comment_activities",o];if(!t)for(var r=0;r<i.comment_activities.length;r++)if(n(i.comment_activities[r]))return["comment_activities",o,"comment_activities",r]}return null},e.prototype._updateComment=function(e,t){return e?r.updateIn(this,e,t):this},e.prototype._updateConversations=function(e){return r.update(this,"comment_activities",e)},e.prototype._updateReplies=function(e,t){var n=this._findCommentPath(e,!0);return n?(n.push("comment_activities"),r.updateIn(this,n,t)):this},e.prototype.findCommentByKey=function(e){for(var t=function(t){return t.activity_key===e},n=0;n<this.comment_activities.length;n++){var o=this.comment_activities[n];if(t(o))return o;for(var i=0;i<o.comment_activities.length;i++){var r=o.comment_activities[i];if(t(r))return r}}return null},e.prototype.findConversationByKey=function(e){return o.find(this.comment_activities,{activity_key:e})},e.prototype.purgeCommentByKey=function(e){var t=this._findCommentPath(e);if(t){var n=t.pop();return r.updateIn(this,t,function(e){return r.splice(e,n,1)})}return this},e.prototype.appendComment=function(e,t){var n=function(e){return r.push(e,t)};return this.activity_key===e?this._updateConversations(n):this._updateReplies(e,n)},e.prototype.resolveCommentByKey=function(e){var t=this._findCommentPath(e);return this._updateComment(t,function(e){return e.resolve()})},e.prototype.unresolveCommentByKey=function(e){var t=this._findCommentPath(e);return this._updateComment(t,function(e){return e.unresolve()})},e.prototype.setCommentStatusByKey=function(e,t){var n=this._findCommentPath(e);return this._updateComment(n,function(e){return e.setStatus(t)})},e.prototype.markCommentSeenByKeyBatch=function(e){return 0===e.length?this:this._withMutations(function(t){t._reapComments(function(t){return e.includes(t.activity_key)}).forEach(function(e){e.is_seen=!0,e.highlight_as_unread=!1})})},n.__decorate([s.takes({activity_key:String,feedback_off:Boolean,can_edit_feedback:Boolean,comment_activity_dicts:Array,users_to_notify:i.Maybe(Array),latest_revision:c.RevisionShape})],e,"fromDict",null),e})();t.FileActivity=u}),define("modules/clean/file_activity/models/immutability_helper",["require","exports"],function(e,t){"use strict";function n(e){if(null==e)throw new TypeError("Cannot thaw null/undefined object");if(Array.isArray(e))return m.call(e);for(var t=Object.create(Object.getPrototypeOf(e)),n=Object.getOwnPropertyNames(e),o=0,i=n;o<i.length;o++){var r=i[o],a=Object.getOwnPropertyDescriptor(e,r);a&&(a.get||a.set)?(a.configurable=!0,Object.defineProperty(t,r,a)):t[r]=e[r]}return t}function o(e,t){var o=n(e);return t(o),o}function i(e,t){if(!t||0===t.length)throw new TypeError("Invalid key path: "+JSON.stringify(t));return t.reduce(function(e,t){return null==e?null:e[t]},e)}function r(e,t,o){if(null==e)throw new TypeError("Object to `set` cannot be null");if(e[t]===o)return e;var i=n(e);return i[t]=o,i}function a(e,t,n){return r(e,t,n(e[t]))}function s(e,t,n){if(!t||0===t.length)throw new TypeError("Invalid key path: "+JSON.stringify(t));if(null==e)throw new TypeError("Target object cannot be null");var o=t[0];return 1===t.length?a(e,o,n):r(e,o,s(e[o],t.slice(1),n))}function l(e,t,n){if(!t||0===t.length)throw new TypeError("Invalid key path: "+JSON.stringify(t));if(null==e)throw new TypeError("Target object cannot be null");var o=t[0];switch(t.length){case 1:return r(e,o,n);default:return r(e,o,l(e[o]||{},t.slice(1),n))}}function c(e,t){if(null==e||null==t)throw new TypeError("Both target and source cannot be null");var o=Object.keys(t).reduce(function(n,o){return t[o]!==e[o]&&n.push(o),n},[]);if(o.length){for(var i=n(e),r=0,a=o;r<a.length;r++){var s=a[r],l=Object.getOwnPropertyDescriptor(t,s);void 0!==l&&Object.defineProperty(i,s,l)}return i}return e}function u(e,t,n){if(null==e||null==n)throw new TypeError("Both target and source cannot be null");return s(e,t,function(e){return c(e,n)})}function d(e,t,n){for(var o=[],i=3;i<arguments.length;i++)o[i-3]=arguments[i];var r=m.call(e);return r.splice.apply(r,[t,n].concat(o)),r}function p(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=m.call(e);return o.unshift.apply(o,t),o}function f(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=m.call(e);return o.push.apply(o,t),o}Object.defineProperty(t,"__esModule",{value:!0});var m=Array.prototype.slice;t.thaw=n,t.withMutations=o,t.getIn=i,t.set=r,t.update=a,t.updateIn=s,t.setIn=l,t.merge=c,t.mergeIn=u,t.splice=d,t.unshift=p,t.push=f}),define("modules/clean/file_activity/models/revision",["require","exports","modules/core/types"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RevisionShape=Object.freeze({revision_id:String,when:Number,preview_link:n.Maybe(String),direct_blockserver_link:n.Maybe(String)})}),define("modules/clean/frame_messenger/frame_messenger_base",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e){var t=this;this._window=window,this.handleUntrustedMessage=function(e){if(t.isOriginAllowed(e.origin)){var n;try{n=JSON.parse(e.data)}catch(e){return}n.action&&t.dispatchMessage(e,n)}},this.allowedOrigins=e}return e.prototype.getWindow=function(){return this._window},e.prototype.setWindow=function(e){this._window=e},e.prototype.startListening=function(){this.getWindow().addEventListener("message",this.handleUntrustedMessage)},e.prototype.stopListening=function(){this.getWindow().removeEventListener("message",this.handleUntrustedMessage)},e.prototype.regexIn=function(e,t){if(t.indexOf(e)>-1)return!0;for(var n=0,o=t;n<o.length;n++){var i=o[n];if(i instanceof RegExp&&e.match(i))return!0}return!1},e.stripStandardPort=function(e){return"http://"===e.substr(0,7)?e.replace(/:80/,""):"https://"===e.substr(0,8)?e.replace(/:443$/,""):e},e.prototype.isOriginAllowed=function(t){return this.regexIn(e.stripStandardPort(t),this.allowedOrigins)},e.prototype.packagePostMessage=function(e,t){var n={action:e,parameters:t};return JSON.stringify(n)},e})();t.FrameMessengerBase=n}),define("modules/clean/frame_messenger/frame_messenger_host",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_base"],function(e,t,n,o){"use strict";function i(e,t){return t.indexOf(e)>=0}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._trustedChildOriginForPosting=null,t._validActionsFromChild=[],t.getChildIframes=function(){return[]},t}return n.__extends(t,e),t.prototype.configureChildMessaging=function(e,t,n){if("string"==typeof e){var o=e;this.getChildIframes=function(){return[].slice.call(document.querySelectorAll(o),0)}}else this.getChildIframes=e;this._trustedChildOriginForPosting=null,this._validActionsFromChild=n,this._trustedMessageFromChildHandler=t},t.prototype.startListening=function(){e.prototype.startListening.call(this),this.postMessageToChildren("parent-ready")},t.prototype.getTrustedChildOriginForPosting=function(){if(null!=this._trustedChildOriginForPosting)return this._trustedChildOriginForPosting;for(var e=this.getChildIframes(),t=0,n=e;t<n.length;t++){var o=n[t],i=""+o.getAttribute("src"),r=this.getOriginFromUrl(i);if(this.isOriginAllowed(r)){this.updateChildOrigin(r);break}}return this._trustedChildOriginForPosting},t.prototype.childIsValidated=function(){return null!=this._trustedChildOriginForPosting},t.prototype._isNumber=function(e){return!isNaN(parseInt(e,10))},t.prototype.getOriginFromUrl=function(e){var t=document.createElement("a");t.href=e;var n=t.origin;if(n)return"null"===n?"*":n;var o=this._isNumber(t.port)?":"+t.port:"";return t.protocol+"//"+t.hostname+o},t.prototype.postMessageToChildren=function(e,t){void 0===t&&(t={});var n=this.getChildIframes();this.postMessageToChildElements(n,e,t)},t.prototype.resetOriginsForPosting=function(){this._trustedChildOriginForPosting=null},t.prototype.updateChildOrigin=function(e){"null"===e&&(e="*"),this._trustedChildOriginForPosting=e},t.prototype.dispatchMessage=function(e,t){this.updateChildOrigin(e.origin),"child-requesting-parent-origin"===t.action&&this.postMessageToChildren("parent-ready"),i(t.action,this._validActionsFromChild)&&null!=this._trustedMessageFromChildHandler&&this._trustedMessageFromChildHandler(t)},t.prototype.postMessageToChildElements=function(e,t,n){void 0===n&&(n={});var o=this.getTrustedChildOriginForPosting();if(null!==o){var i=this.packagePostMessage(t,n);e.forEach(function(e){e.contentWindow&&e.contentWindow.postMessage(i,o)})}},t})(o.FrameMessengerBase);t.FrameMessengerHost=r}),define("modules/clean/growth/showcase_upsell/preview_loader",["require","exports","tslib","external/react","modules/clean/react/size_class/constants","modules/clean/react/async/loadable"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var a=r.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/growth/showcase_upsell/preview_gate"],t,n)}).then(n.__importStar).then(function(e){return e.ShowcaseUpsellPreviewGate})}}),s=[".jpg",".jpeg",".pdf",".ppt",".pptx",".png",".tif"],l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.shouldRender=function(){var e=this.props,t=e.user,n=e.currentFile,o=e.sharedLinkInfo,r=e.variant,a=e.sizeClass,l=e.isFullscreen,c=e.hidePageChrome,u="V1"===r||"CONTROL"===r,d=t&&!t.is_team&&!t.paid,p=!o,f=n.fq_path,m=n.ext?n.ext:f?"."+f.substr(f.lastIndexOf(".")+1):"",h=s.indexOf(m)>=0,v=a===i.SizeClass.Large;return u&&d&&p&&h&&!l&&!c&&v},t.prototype.render=function(){var e=this.props,t=e.user,n=e.currentFile,i=e.variant;return t&&n&&"OFF"!==i&&this.shouldRender()?o.createElement(a,{user:t,currentFile:n,variant:i}):null},t})(o.Component);t.ShowcaseUpsellPreviewLoader=l}),define("modules/clean/image_annotations",["require","exports","tslib","jquery","modules/clean/image_preview_util","modules/clean/image_viewer_annotation_interface","modules/clean/image_viewer_annotation_renderer"],function(e,t,n,o,i,r,a){"use strict";function s(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),i=n.__importStar(i),r=n.__importDefault(r),a=n.__importDefault(a);var l=(function(){function e(){var e=this;this.onTransitionEnd=function(){e.forceResizeAndUpdateOffsets()},this.forceResizeAndUpdateOffsets=function(){e._resizeAnnotationContainer(),null!=e.annotationInterface&&e.annotationInterface.onScaleChangeCallback()},this._handleMessage=this._handleMessage.bind(this),this._onScroll=this._onScroll.bind(this),this.onResize=this.onResize.bind(this)}return e.prototype.onImageLoad=function(e){return void 0===e&&(e=null),this.reset(),this.resizeImageCallback=e,this._prepareAnnotations()},e.prototype._prepareAnnotations=function(){return this._prepareAnnotationInterface(),this.annotationRenderer=new a.default,window.addEventListener("resize",this.onResize),i.getPreviewImageWrapper().on("scroll",this._onScroll),window.addEventListener("transitionend",this.onTransitionEnd),window.addEventListener("message",this._handleMessage),this._postPageRendered()},e.prototype._prepareAnnotationInterface=function(){if(0===i.getAnnotationContainer().length){var e=i.getPreviewImageWrapper(),t=o.default("<div class='"+i.ANNOTATION_CONTAINER+"' />");this.$annotationContainer=t.appendTo(e)}return this._resizeAnnotationContainer(),this.annotationInterface=new r.default,i.getAnnotationContainer().on("mouseup.image",this.annotationInterface.onMouseUpCallback).on("mousedown.image",this.annotationInterface.onMouseDownCallback).on("mousemove.image",this.annotationInterface.onMouseMoveCallback).on("keydown.image",this.annotationInterface.onKeyDownCallback),setTimeout(this.forceResizeAndUpdateOffsets,0)},e.prototype._handleMessage=function(e){var t;try{t=JSON.parse(e.data)}catch(e){return}switch(t.action){case"update-annotations":return this._resizeAnnotationContainer(),null!=this.annotationInterface&&this.annotationInterface._updateOffset(),null!=this.annotationRenderer?this.annotationRenderer.updateAnnotations(t.parameters):void 0;case"remove-annotation":var n=t.parameters.commentActivity;return null!=this.annotationRenderer?this.annotationRenderer.removeAnnotation(n):void 0;case"remove-all-annotations":return null!=this.annotationRenderer&&this.annotationRenderer.removeAllAnnotations(),this._resizeAnnotationContainer(),null!=this.annotationInterface?this.annotationInterface._updateOffset():void 0;case"enable-annotation-creation":return null!=this.annotationInterface?this.annotationInterface.enableAnnotationCreation():void 0
;case"disable-annotation-creation":return null!=this.annotationInterface?this.annotationInterface.disableAnnotationCreation():void 0;case"enable-region-creation":return this._setRegionCreationEnabled(!0);case"disable-region-creation":return this._setRegionCreationEnabled(!1);case"hide-annotation":return null!=this.annotationInterface?this.annotationInterface.onHideAnnotation():void 0;case"scroll-to-annotation":return n=t.parameters.commentActivity,null!=this.annotationRenderer?this.annotationRenderer.highlightAnnotation(n):void 0;case"file-feedback-ui-ready":return this._postPageRendered()}},e.prototype._postPageRendered=function(){return this._postMessage("page-rendered")},e.prototype._postMessage=function(e,t){return void 0===t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},e.prototype._setRegionCreationEnabled=function(e){return e?null!=this.annotationInterface&&this.annotationInterface.enableRegionCreation():null!=this.annotationInterface&&this.annotationInterface.disableRegionCreation(),this._resizeAnnotationContainer(),null!=this.annotationInterface?this.annotationInterface._updateOffset():void 0},e.prototype._onScroll=function(){return null!=this.annotationInterface?this.annotationInterface.onScrollCallback():void 0},e.prototype.onResize=function(e){var t=this;void 0===e&&(e=!0),null!=this.annotationRenderer&&this.annotationRenderer.removeAllAnnotations(),this._postMessage("scale-change");var n=function(){return t._resizeAnnotationContainer(),t._postPageRendered(),null!=t.annotationInterface&&t.annotationInterface.onScaleChangeCallback(),"function"==typeof t.resizeImageCallback?t.resizeImageCallback():void 0};return clearTimeout(this.scaleChangeTimer),e?this.scaleChangeTimer=setTimeout(n,100):n()},e.prototype._resizeAnnotationContainer=function(){var e=i.getPreviewImage();if(null!=e&&null!=e.offset()&&null!=s(e.offsetParent(),function(e){return e.offset()})){var t=e.offset().top-e.offsetParent().offset().top,n=e.offset().left-e.offsetParent().offset().left;return t<0&&(t=0),n<0&&(n=0),null!=this.$annotationContainer&&this.$annotationContainer.css("margin-top",t),null!=this.$annotationContainer&&this.$annotationContainer.css("margin-bottom",t),null!=this.$annotationContainer&&this.$annotationContainer.css("margin-left",n),null!=this.$annotationContainer&&this.$annotationContainer.css("margin-right",n),(null!=this.annotationInterface?this.annotationInterface.isAnnotationRegionEnabled:void 0)?(null!=this.$annotationContainer&&this.$annotationContainer.height(e.height()),null!=this.$annotationContainer?this.$annotationContainer.width(e.width()):void 0):(null!=this.$annotationContainer&&this.$annotationContainer.height(0),null!=this.$annotationContainer?this.$annotationContainer.width(0):void 0)}},e.prototype.removeAnnotations=function(){return null!=this.annotationRenderer?this.annotationRenderer.removeAllAnnotations():void 0},e.prototype.reset=function(){return null!=this.annotationRenderer&&this.annotationRenderer.reset(),null!=this.annotationInterface&&this.annotationInterface.reset(),i.getAnnotationContainer().off("mouseup.image").off("mousedown.image").off("mousemove.image").off("keydown.image"),i.getPreviewImageWrapper().off("scroll",this._onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("message",this._handleMessage),window.removeEventListener("transitionend",this.onTransitionEnd),this._postMessage("reset-file-feedback-ui")},e})();t.ImageAnnotations=l}),define("modules/clean/image_preview_util",["require","exports","tslib","jquery","modules/clean/react/size_class/constants","modules/clean/react/previews/image/constants"],function(e,t,n,o,i,r){"use strict";o=n.__importDefault(o),r=n.__importStar(r);return{PREVIEW_IMAGE_CONTAINER:"preview-image-container",PREVIEW_IMAGE_WRAPPER:"preview-image-wrapper",PREVIEW_IMAGE:"preview-image",ANNOTATION_CONTAINER:"db-annotation-container",ANNOTATION_LAYER_CSS:"db-annotation-layer",ANNOTATION_CANVAS_LAYER_CSS:"db-annotation-canvas-layer",getPreviewImageContainer:function(){return o.default("."+this.PREVIEW_IMAGE_CONTAINER)},getPreviewImageWrapper:function(){return o.default("."+this.PREVIEW_IMAGE_WRAPPER)},getPreviewImage:function(){return this.getPreviewImageContainer().find("."+this.PREVIEW_IMAGE)},getPreviewImageElement:function(){return this.getPreviewImage()[0]},getAnnotationContainer:function(){return o.default("."+this.ANNOTATION_CONTAINER)},getAnnotationLayers:function(){return o.default("."+this.ANNOTATION_LAYER_CSS)},getAnnotationLCanvasLayer:function(){return o.default("."+this.ANNOTATION_CANVAS_LAYER_CSS)},convertAnnotationImagePointsToViewportCoordinates:function(e){for(var t=[],n=this.getPreviewImageElement(),o=n.clientWidth,i=n.clientHeight,r=0,a=Array.from(e.image_coordinates);r<a.length;r++){for(var s=a[r],l=[],c=0,u=Array.from(s.coordinates);c<u.length;c++){var d=u[c],p=d.x*o,f=d.y*i;l.push({x:p,y:f})}t.push(l)}return t},convertAnnotationViewportCoordinatesToImagePoints:function(e,t,n){for(var o=[],i=this.getPreviewImageElement(),r=i.clientWidth,a=i.clientHeight,s=0,l=Array.from(e.viewportCoordinates);s<l.length;s++){for(var c=l[s],u=[],d=0,p=Array.from(c);d<p.length;d++){var f=p[d],m=(f.x-t)/r,h=(f.y-n)/a;u.push({x:m,y:h})}o.push({coordinates:u})}return o},getImagePadding:function(e){return e===i.SizeClass.Large?{height:r.IMAGE_LARGE_PADDING_HEIGHT,width:r.IMAGE_LARGE_PADDING_WIDTH}:{height:r.IMAGE_PADDING_HEIGHT,width:r.IMAGE_PADDING_WIDTH}},getMinimumZoomPercent:function(e){var t=e.windowDimensions,n=e.imagePadding,o=e.imageDimensions,i=(t.height-n.height)/o.height,r=(t.width-n.width)/o.width;return Math.min(i,r,1)}}}),define("modules/clean/image_size",["require","exports"],function(e,t){"use strict";function n(e,t){for(var n=0,i=o;n<i.length;n++){var r=i[n],a=r[0],s=r[1],l=r[2];if(s>=e||l>=t)return a}return o[o.length-1][0]}Object.defineProperty(t,"__esModule",{value:!0});var o=[["480x320",480,320],["640x480",640,480],["800x600",800,600],["1024x768",1024,768],["1280x960",1280,960],["1600x1200",1600,1200],["2048x1536",2048,1536]];t.imageBestFitSize=n}),define("modules/clean/image_viewer_annotation_interface",["require","exports","tslib","external/react","external/react-dom","jquery","modules/clean/annotations/annotation_controller","modules/clean/image_preview_util"],function(e,t,n,o,i,r,a,s){"use strict";return o=n.__importStar(o),i=n.__importStar(i),r=n.__importDefault(r),a=n.__importDefault(a),s=n.__importStar(s),(function(){function e(){this._prepareAnnotationController=this._prepareAnnotationController.bind(this),this._refreshAnnotationController=this._refreshAnnotationController.bind(this),this._prepareAnnotationCoords=this._prepareAnnotationCoords.bind(this),this.onHideAnnotation=this.onHideAnnotation.bind(this),this.onMouseDownCallback=this.onMouseDownCallback.bind(this),this.onMouseMoveCallback=this.onMouseMoveCallback.bind(this),this.onMouseUpCallback=this.onMouseUpCallback.bind(this),this.onKeyDownCallback=this.onKeyDownCallback.bind(this),this.onScrollCallback=this.onScrollCallback.bind(this),this.onScaleChangeCallback=this.onScaleChangeCallback.bind(this),this.onAnnotationHiddenCallback=this.onAnnotationHiddenCallback.bind(this),this.onAnnotationPlacedCallback=this.onAnnotationPlacedCallback.bind(this),this.onAnnotationStartDragCallback=this.onAnnotationStartDragCallback.bind(this),this.onAnnotationEndDragCallback=this.onAnnotationEndDragCallback.bind(this),this.onAnnotationScrollCallback=this.onAnnotationScrollCallback.bind(this),this.onAnnotationScaleChangeCallback=this.onAnnotationScaleChangeCallback.bind(this),this.onAnnotationEnterCallback=this.onAnnotationEnterCallback.bind(this),this.onAnnotationLeaveCallback=this.onAnnotationLeaveCallback.bind(this),this.controllerEventHandlers={onMouseMoveCallback:r.default.noop,onMouseDownCallback:r.default.noop,onMouseUpCallback:r.default.noop,onHideAnnotation:r.default.noop,onScrollCallback:r.default.noop,onScaleChangeCallback:r.default.noop,onKeyDownCallback:r.default.noop},this.isAnnotationRegionEnabled=!1,this.isAnnotationCreationEnabled=!1,this._prepareAnnotationController()}return e.prototype._sendToParent=function(e,t){return void 0===t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},e.prototype._isOnAnnotationUI=function(e){return r.default(e.target).parents(".db-annotation-layer").length>0},e.prototype._isOnAnnotationOverlay=function(e){return r.default(e.target).parents("#annotation-overlay").length>0},e.prototype._destroyAnnotationController=function(){var e=s.getAnnotationLCanvasLayer();if((null!=e?e.length:void 0)>0)return i.unmountComponentAtNode(e[0]),e.remove()},e.prototype._prepareAnnotationController=function(){var e=s.getAnnotationContainer();if(0===e.find("."+s.ANNOTATION_CANVAS_LAYER_CSS).length){var t=r.default("<div class='"+s.ANNOTATION_CANVAS_LAYER_CSS+"' />");return this.$parentContainerEl=t.appendTo(e),this.parentContainerOffset=this.$parentContainerEl.offset(),this._refreshAnnotationController()}},e.prototype._refreshAnnotationController=function(e){if(null!=this.$parentContainerEl?this.$parentContainerEl.get(0):void 0)return this.annotationController=i.render(o.createElement(a.default,{parentContainerOffset:this.parentContainerOffset,controllerEventHandlers:this.controllerEventHandlers,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback,isAnnotationMarkerEnabled:!1,isAnnotationHighlightEnabled:!1,isAnnotationRegionEnabled:this.isAnnotationRegionEnabled,isAnnotationCreationEnabled:this.isAnnotationCreationEnabled}),this.$parentContainerEl.get(0),e)},e.prototype._prepareAnnotationCoords=function(e){return null!=e&&(e=this._addTranslatedImagePoints(e)),e},e.prototype._addTranslatedImagePoints=function(e){return e.image_coordinates=s.convertAnnotationViewportCoordinatesToImagePoints(e,this.parentContainerOffset.left,this.parentContainerOffset.top),e},e.prototype._updateOffset=function(e){if(this.$parentContainerEl)return this.parentContainerOffset=this.$parentContainerEl.offset(),this._refreshAnnotationController(e)},e.prototype.enableAnnotationCreation=function(){return this.isAnnotationCreationEnabled=!0,this._refreshAnnotationController()},e.prototype.disableAnnotationCreation=function(){return this.isAnnotationCreationEnabled=!1,this._refreshAnnotationController()},e.prototype.enableRegionCreation=function(){return r.default("html").addClass("region-creation"),this.isAnnotationRegionEnabled=!0,this._refreshAnnotationController()},e.prototype.disableRegionCreation=function(){return r.default("html").removeClass("region-creation"),this.isAnnotationRegionEnabled=!1,this._refreshAnnotationController()},e.prototype.reset=function(){return this.disableRegionCreation(),this._destroyAnnotationController(),s.getAnnotationContainer().remove()},e.prototype.onHideAnnotation=function(){return null!=this.controllerEventHandlers?this.controllerEventHandlers.onHideAnnotation():void 0},e.prototype.onMouseDownCallback=function(e){if(!this._isOnAnnotationUI(e)&&!this._isOnAnnotationOverlay(e))return null!=this.controllerEventHandlers?this.controllerEventHandlers.onMouseDownCallback(e):void 0},e.prototype.onMouseMoveCallback=function(e){return null!=this.controllerEventHandlers?this.controllerEventHandlers.onMouseMoveCallback(e):void 0},e.prototype.onMouseUpCallback=function(e){return null!=this.controllerEventHandlers?this.controllerEventHandlers.onMouseUpCallback(e):void 0},e.prototype.onKeyDownCallback=function(e){var t=e.keyCode||e.which||e.charCode;return this._sendToParent("on-keydown",{keyCode:t})},e.prototype.onScrollCallback=function(e){if(this._updateOffset(null!=this.controllerEventHandlers?this.controllerEventHandlers.onScrollCallback():void 0),!(null!=this.annotationController?this.annotationController.hasVisibleActiveAnnotation():void 0))return this._sendToParent("scroll")},e.prototype.onScaleChangeCallback=function(e){return this._updateOffset(null!=this.controllerEventHandlers?this.controllerEventHandlers.onHideAnnotation:void 0),this._sendToParent("scale-change",e)},e.prototype.onAnnotationHiddenCallback=function(){return this._sendToParent("annotation-hidden")},e.prototype.onAnnotationPlacedCallback=function(e){return this._sendToParent("annotation-placed",{annotation:this._prepareAnnotationCoords(e)})},e.prototype.onAnnotationStartDragCallback=function(e){return this._sendToParent("annotation-start-drag")},e.prototype.onAnnotationEndDragCallback=function(e){return this._sendToParent("annotation-end-drag",{annotation:this._prepareAnnotationCoords(e)})},e.prototype.onAnnotationScrollCallback=function(e){return this._sendToParent("scroll",{annotation:this._prepareAnnotationCoords(e)})},e.prototype.onAnnotationScaleChangeCallback=function(e){return this._sendToParent("scale-change",{annotation:this._prepareAnnotationCoords(e)})},e.prototype.onAnnotationEnterCallback=function(){return this._sendToParent("annotation-enter",{annotation:this._prepareAnnotationCoords()})},e.prototype.onAnnotationLeaveCallback=function(){return this._sendToParent("annotation-leave",{annotation:this._prepareAnnotationCoords()})},e})()}),define("modules/clean/image_viewer_annotation_renderer",["require","exports","tslib","external/react","external/react-dom","jquery","modules/clean/annotations/annotation_renderer_utils","modules/clean/image_preview_util"],function(e,t,n,o,i,r,a,s){"use strict";o=n.__importStar(o),i=n.__importStar(i),r=n.__importDefault(r),a=n.__importDefault(a),s=n.__importStar(s);var l=new a.default;return(function(){function e(){this.removeAnnotation=this.removeAnnotation.bind(this),this.updateAnnotations=this.updateAnnotations.bind(this),this._renderAnnotation=this._renderAnnotation.bind(this),this.onAnnotationClickCallback=this.onAnnotationClickCallback.bind(this),this.onAnnotationEnterCallback=this.onAnnotationEnterCallback.bind(this),this.onAnnotationLeaveCallback=this.onAnnotationLeaveCallback.bind(this),this._annotationsByActivityKey={}}return e.prototype._isAnnotationAlreadyRendered=function(e){return r.default("."+s.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e+"']").length>0},e.prototype.removeAnnotation=function(e){if(this._isAnnotationAlreadyRendered(e.activity_key)){var t=r.default("."+s.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e.activity_key+"']").get(0);return i.unmountComponentAtNode(t),t.remove()}},e.prototype.removeAllAnnotations=function(){return this.reset()},e.prototype.reset=function(){for(var e=s.getAnnotationLayers(),t=0,n=Array.from(e);t<n.length;t++){var o=n[t];i.unmountComponentAtNode(o)}return e.remove(),this._annotationsByActivityKey={}},e.prototype.highlightAnnotation=function(e){if(this._isAnnotationAlreadyRendered(e.activity_key)){var t=r.default("."+s.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e.activity_key+"']");return t.removeClass("start-highlight-animation"),t.width(t.width()),t.addClass("start-highlight-animation")}},e.prototype.updateAnnotations=function(e){var t=this;if(l.shouldUpdateAnnotations(e,this._annotationsByActivityKey))return this.removeAllAnnotations(),(function(){for(var n=[],o=0,i=Array.from(e.annotations);o<i.length;o++){var r=i[o];l.renderAnnotation(r,t._isAnnotationAlreadyRendered,t._renderAnnotation);var a=r.commentActivity.activity_key;n.push(t._annotationsByActivityKey[a]=r)}return n})()},e.prototype._renderAnnotation=function(e,t,n,a){var l=s.getAnnotationContainer();if((null!=l?l.length:void 0)>0){t.viewportCoordinates=s.convertAnnotationImagePointsToViewportCoordinates(t);var c=r.default("<div class='"+s.ANNOTATION_LAYER_CSS+"' />");c.attr({"data-comment-activity-key":n.activity_key});var u=c.appendTo(l).get(0);return i.render(o.createElement(e,{annotation:t,commentActivity:n,options:a,onAnnotationClickCallback:this.onAnnotationClickCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationOverCallback:this.onAnnotationOverCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback}),u)}},e.prototype._sendToParent=function(e,t){return void 0===t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},e.prototype.onAnnotationClickCallback=function(e){return this._sendToParent("annotation-ui-click",e)},e.prototype.onAnnotationEnterCallback=function(e){return this._sendToParent("annotation-ui-enter",e)},e.prototype.onAnnotationOverCallback=function(e){return{}},e.prototype.onAnnotationLeaveCallback=function(e){return this._sendToParent("annotation-ui-leave",e)},e})()}),define("modules/clean/loggers/file_preview_logger",["require","exports","tslib","external/lodash","modules/clean/ajax","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/react/previews/quality_popup/constants","modules/clean/react/previews/quality_popup/questions","modules/clean/web_timing_logger","modules/constants/request","modules/core/browser"],function(e,t,n,o,i,r,a,s,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),i=n.__importStar(i),c=n.__importStar(c),u=n.__importStar(u),d=n.__importStar(d);var p={};p[r.EventType.FilePreviewSessionEnded]="preview_session_ended",p[r.EventType.FilePreviewAttemptStarted]="preview_attempted",p[r.EventType.FilePreviewSupportConfirmed]="support_confirmed",p[r.EventType.FilePreviewSupportDenied]="support_denied",p[r.EventType.FilePreviewDownloadAttempted]="download_attempted",p[r.EventType.FilePreviewDownloadSucceeded]="download_succeeded",p[r.EventType.FilePreviewDownloadFailed]="download_failed",p[r.EventType.FilePreviewRenderSucceeded]="render_succeeded",p[r.EventType.FilePreviewRenderFailed]="render_failed",p[r.EventType.FilePreviewQualityPopupAsked]="quality_popup_asked",p[r.EventType.FilePreviewQualityPopupAnswered]="quality_popup_answered",p[r.EventType.FilePreviewQualityPopupDismissed]="quality_popup_dismissed",p[r.EventType.FilePreviewUserAction]="user_action",p[r.EventType.ArchivePreviewContentsScanned]="archive_contents_scanned";var f=(function(){function e(){this._eventHandlers={}}return e.prototype._getSerializedTimeline=function(e){return null},e.prototype.addEventHandlers=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,o=e;n<o.length;n++){var i=o[n],r=i[0],a=i[1];this._eventHandlers[r]=a}},e.prototype._log=function(e,t,n){void 0===n&&(n={});var o=this._getSerializedTimeline(t),r={device_type:t.fileViewerSession.deviceType,event_name:p[e],extra:JSON.stringify(n),file_viewer_session_id:t.fileViewerSession.id,file_preview_session_id:t.id,file_ns_id:t.file.ns_id,file_sjid:t.file.sjid,file_preview_timeline:o?JSON.stringify(o):null,file_preview_size:t.previewSize};i.SilentBackgroundBeaconRequest({url:"/log/file_preview",data:r})},e.prototype.listenTo=function(e){for(var t in this._eventHandlers)if(this._eventHandlers.hasOwnProperty(t)){var n=this._eventHandlers[t];e.addListener(t,n)}},e.prototype.unlistenTo=function(e){for(var t in this._eventHandlers)if(this._eventHandlers.hasOwnProperty(t)){var n=this._eventHandlers[t];e.removeListener(t,n)}},e})(),m=(function(e){function t(){var t=e.call(this)||this;return t._logAnswers=function(e,n,o){void 0===o&&(o={}),Object.keys(n).forEach(function(e){var t=parseInt(e,10);o[l.getQuestionLoggerKey(t)]=n[t]}),t._log(r.EventType.FilePreviewQualityPopupAnswered,e,o)},t._logQuestion=function(e,n){for(var o={},i=0,a=n;i<a.length;i++){var s=a[i];o[l.getQuestionLoggerKey(s)]="1"}t._log(r.EventType.FilePreviewQualityPopupAsked,e,o)},t._logDismissed=function(e,n){var o={stage:s.getPopupStageLoggerKey(n)};t._log(r.EventType.FilePreviewQualityPopupDismissed,e,o)},t.addEventHandlers([r.EventType.FilePreviewQualityPopupAsked,t._logQuestion],[r.EventType.FilePreviewQualityPopupAnswered,t._logAnswers],[r.EventType.FilePreviewQualityPopupDismissed,t._logDismissed]),t}return n.__extends(t,e),t.prototype._log=function(t,n,o){void 0===o&&(o={}),o._client_time=+Date.now();var i=n.sourceContext,r=n.sourceAction;i&&(o._source_context=i),r&&(o._source_action=r),e.prototype._log.call(this,t,n,o)},t})(f);t.FilePreviewQualityPopupLogger=m;var h=(function(e){function t(t){var n=e.call(this)||this;return n._handleFilePreviewAttemptStarted=function(e,t){n._handleEvent(r.EventType.FilePreviewAttemptStarted,e,t)},n._handleFilePreviewSupportConfirmed=function(e,t){n._handleEvent(r.EventType.FilePreviewSupportConfirmed,e,t)},n._handleFilePreviewSupportDenied=function(e,t){n._handleEvent(r.EventType.FilePreviewSupportDenied,e,t)},n._handleFilePreviewDownloadAttempted=function(e,t){n._handleEvent(r.EventType.FilePreviewDownloadAttempted,e,t)},n._handleFilePreviewDownloadSucceeded=function(e,t){n._handleEvent(r.EventType.FilePreviewDownloadSucceeded,e,t)},n._handleFilePreviewDownloadFailed=function(e,t){n._handleEvent(r.EventType.FilePreviewDownloadFailed,e,t)},n._handleFilePreviewRenderSucceeded=function(e,t){n._handleEvent(r.EventType.FilePreviewRenderSucceeded,e,t)},n._handleFilePreviewRenderFailed=function(e,t){n._handleEvent(r.EventType.FilePreviewRenderFailed,e,t)},n._handleFilePreviewSessionEnded=function(e,t){n._handleEvent(r.EventType.FilePreviewSessionEnded,e,t)},n._filePreviewSessionId=t,n.addEventHandlers([r.EventType.FilePreviewAttemptStarted,n._handleFilePreviewAttemptStarted],[r.EventType.FilePreviewSupportConfirmed,n._handleFilePreviewSupportConfirmed],[r.EventType.FilePreviewSupportDenied,n._handleFilePreviewSupportDenied],[r.EventType.FilePreviewDownloadAttempted,n._handleFilePreviewDownloadAttempted],[r.EventType.FilePreviewDownloadSucceeded,n._handleFilePreviewDownloadSucceeded],[r.EventType.FilePreviewDownloadFailed,n._handleFilePreviewDownloadFailed],[r.EventType.FilePreviewRenderSucceeded,n._handleFilePreviewRenderSucceeded],[r.EventType.FilePreviewRenderFailed,n._handleFilePreviewRenderFailed],[r.EventType.FilePreviewSessionEnded,n._handleFilePreviewSessionEnded]),n}return n.__extends(t,e),t.prototype._handleEvent=function(e,t,n){if(void 0===n&&(n={}),this._filePreviewSessionId===t.id){n.preview_type=t.file.preview_type,n.file_preview_timeline=JSON.stringify(this._getSerializedTimeline(t)),n.web_timing_logger_req_id=u.REQUEST_ID,n.source_context=t.sourceContext,n.source_action=t.sourceAction,n.is_mounted=t.isMounted,null!=t.primaryMarkTs&&(n.primary_mark_ts=t.primaryMarkTs,n.time_to_primary_mark=t.timeToPrimaryMark());var i=c.start_time();void 0!==i&&(n.navigation_start=i),null!=t.pageCount&&(n.page_count=t.pageCount),null!=t.firstPageRendered&&(n.first_page_rendered=t.firstPageRendered),null!=t.previewThumbnailInfo&&(n.preview_thumbnail_info=JSON.stringify(t.previewThumbnailInfo)),t.isSSR&&(n.is_ssr="1"),null!=t.lastEvent&&(n.last_event=p[t.lastEvent]),o.isEmpty(t.ssrTimestamps)||(n.ssr_timestamps=JSON.stringify(t.ssrTimestamps)),o.isEmpty(t.ssrTiming)||(n.ssr_timing=JSON.stringify(t.ssrTiming));var s=t.previewTimeline[r.EventType.FilePreviewRenderSucceeded];if(s&&(n.time_to_render=t.timeToMark(s.timestamp)),t.sourceAction===a.PreviewSourceAction.Visit){var l=c.time_since_start();if(null!=l&&(n.time_to_event=l),e===r.EventType.FilePreviewRenderSucceeded){var f=c.time_to_view();null!=f&&null!=i&&(n.ttv_ts=f);var m=c.time_to_interactive();null!=m&&null!=i&&(n.time_to_interactive=m-i);var h=d.performance();if(null!=h){var v=h.timing;null!=v&&null!=i&&(n.time_to_first_byte=v.responseStart-i,n.web_timing_data=JSON.stringify(v))}window._timingData&&window._timingData.img&&(delete window._timingData.img.dl_error_finish,n.img_timing_data=JSON.stringify(window._timingData.img))}}e===r.EventType.FilePreviewSessionEnded&&(n.pages_rendered=JSON.stringify(t.pagesRendered),n.images_fetched=JSON.stringify(t.fileViewerSession.imagesFetched),n.zoom_scales=JSON.stringify(t.zoomScales),n.password_needed=t.passwordNeeded),this._log(e,t,n)}},t.prototype._getSerializedTimeline=function(e){var t={};for(var n in e.previewTimeline)if(e.previewTimeline.hasOwnProperty(n)){var o=e.previewTimeline[n],i=this._timelineKey(n);t[i]=o.timestamp}return t},t.prototype._timelineKey=function(e){return p[e]+"_ts"},t})(f);t.FilePreviewTimelineLogger=h;var v=(function(e){function t(){var t=e.call(this)||this;return t.logContentsScanned=function(e,n){t._log(r.EventType.ArchivePreviewContentsScanned,e,n)},t.addEventHandlers([r.EventType.ArchivePreviewContentsScanned,t.logContentsScanned]),t}return n.__extends(t,e),t})(f);t.FilePreviewArchiveLogger=v;var _=(function(e){function t(){var t=e.call(this)||this;return t._logUserAction=function(e,n,o,i){i.action=n,i.context=o,t._log(r.EventType.FilePreviewUserAction,e,i)},t.addEventHandlers([r.EventType.FilePreviewUserAction,t._logUserAction]),t}return n.__extends(t,e),t})(f);t.FilePreviewUserActionLogger=_}),define("modules/clean/loggers/file_viewer_logger",["require","exports","tslib","modules/clean/analytics","modules/clean/file_store/utils","modules/constants/python"],function(e,t,n,o,i,r){"use strict";function a(){return o.UserActivityLogger.start("web","file_view_first_page_rendered"),o.PreviewActivityLogger.start("file_view_first_page_rendered"),o.FileViewLogger.start()}function s(e,t){e=e;for(var r=i.getExtension(e),a=n.__assign({},t.attributes,{total_time:-1,file_ext:r,source:"file-viewer",originalSize:null!=e.bytes?e.bytes:0}),s=0,l=t.stats;s<l.length;s++){var u=l[s];a[c[u.name]]=u.end-u.start}return o.UserActivityLogger.stop("web","file_view_first_page_rendered",a),o.PreviewActivityLogger.stop("file_view_first_page_rendered",{file_ext:r,extra:JSON.stringify(a)})}function l(e,t,n,a,s,l,c){void 0===c&&(c=!1);var u={user_id:null!=t?t.id:void 0,target:n,platform:r.FileViewPlatformType.WEB,ns_id:e.ns_id,sjid:e.sjid,ns_path:e.ns_path,origin:a,action:s,shared_link_url:l,extra:{file_ext:i.getExtension(e),file_bytes:e.bytes,file_mtime:e.ts,preview_type:e.preview_type,time_taken:-1,is_team:1===(null!=t?t.is_team:void 0),paid:1===(null!=t?t.paid:void 0),is_ndsl:c}};return o.FileViewLogger.stop(u)}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var c={Overall:"viewer_overall_time","Page Request":"viewer_page_request_time",Rendering:"viewer_rendering_time"};t.start=a,t.logPageRendered=s,t.logView=l}),define("modules/clean/loggers/video_preview_logger",["require","exports","tslib","modules/clean/ajax","modules/clean/perf_tools/web_timing_utils"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var r=(function(){function e(e,t){this.videoTruncated=!1,this.filePreviewSessionId=t?t.id:"",this.videoFormat=e}return e.prototype.populateVideoDuration=function(e){this.videoDuration=Math.round(e)},e.prototype.setVideoTruncated=function(){this.videoTruncated=!0},e.prototype.logEvent=function(e,t){var n=i.WebTimingUtil.getNow(),r={event_name:e,client_timestamp_ms:n,file_preview_session_id:this.filePreviewSessionId,video_format:this.videoFormat,video_duration_seconds:this.videoDuration,video_truncated:this.videoTruncated,extra:t?JSON.stringify(t):void 0};o.SilentBackgroundBeaconRequest({url:"/log/video_preview",data:r})},e})();t.VideoPreviewLogger=r}),define("modules/clean/open_with",["require","exports","tslib","external/lodash","modules/clean/filepath","modules/core/uri"],function(e,t,n,o,i,r){"use strict";o=n.__importStar(o),i=n.__importStar(i);var a=void 0,s=void 0,l=void 0,c=(function(){function e(){}return e.initClass=function(){this.PRELOAD_URLS={},this.MAX_SUPPORTED_FILE_SIZE_B=157286400,a=["com.adobe.Reader","Acrord32.exe","com.adobe.Acrobat","Acrobat.exe"],s=[{id:"excel",ext:["ods","xlsb","xlsm","xlsx"],icon:"excel",name:"Microsoft Excel Online"},{id:"google_dss_docs",ext:["gdoc"],icon:"google_dss_docs",name:"Google Docs Online Editor"},{id:"google_dss_sheets",ext:["gsheet"],icon:"google_dss_sheets",name:"Google Sheets Online Editor"},{id:"google_dss_slides",ext:["gslides"],icon:"google_dss_slides",name:"Google Slides Online Editor"},{id:"paper",ext:["paper"],icon:"paper",name:"Dropbox Paper"},{id:"powerpoint",ext:["odp","ppsx","pptx"],icon:"powerpoint",name:"Microsoft PowerPoint Online"},{id:"word",ext:["odt","docm","docx"],icon:"word",name:"Microsoft Word Online"},{id:"wopitest",ext:["wopitest"],icon:"word",name:"WopiTest"}],l=function(e){var t=i.filename(e),n=i.file_extension(t);return o.find(s,function(e){return Array.from(e.ext).includes(n)})}},e.get_open_handler_for=function(t,n){var o=l(t.fq_path);if(!o||!e.is_app_supported_for_file(o.id,t))return null;var i=r.URI.encode_parts(t.fq_path),a=e.uri_path_base(o.id),s="personal"===n.role?"/personal":"/work";return{icon:o.icon,name:o.name,uri:""+a+s+i}},e.uri_path_base=function(e){switch(e){case"google_dss_docs":return"/google_dss/docs/edit/path";case"google_dss_sheets":return"/google_dss/sheets/edit/path";case"google_dss_slides":return"/google_dss/slides/edit/path";default:return"/ow/msft/edit"}},e.file_supported=function(e){return!!l(e.fq_path)},e.is_adobe_app=function(e){return Array.from(a).includes(e)},e.is_app_supported_for_file=function(e,t){switch(e){case"google_dss_docs":return t.is_cloud_doc;case"google_dss_sheets":return t.is_cloud_doc;case"google_dss_slides":return t.is_cloud_doc;case"paper":return t.is_cloud_doc;case"word":case"excel":case"powerpoint":return!0;case"wopitest":return!1;case"wopitest-unsupported":return!1;default:return!1}},e})();return c.initClass(),c}),define("modules/clean/optimistic_update",["require","exports","tslib","external/lodash"],function(e,t,n,o){"use strict";function i(e){return o.isString(e)}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var r={},a=(function(){function e(e){this._base=e,this._journal=[],this._head=r}return e.prototype.getValue=function(){return this._head===r&&(this._head=this._journal.reduce(function(e,t){return t.patch(e,t.id)},this._base)),this._head},e.prototype.commit=function(e){var t=o.uniqueId("optimist-patch-");return this._head=r,this._journal.push({id:t,patch:e}),t},e.prototype.rollback=function(e){return null!==this._removeJournalEntry(e)},e.prototype.rebase=function(e){if(i(e)){var t=this._removeJournalEntry(e);return!!t&&(this._head=r,this._base=t.patch(this._base,e),!0)}return this._head=r,this._base=e(this._base),!0},e.prototype._removeJournalEntry=function(e){var t=o.findIndex(this._journal,function(t){return t.id===e});return t<0?null:(this._head=r,this._journal.splice(t,1)[0])},e})();t.Optimist=a}),define("modules/clean/previews/actions",["require","exports","tslib","modules/clean/previews/file_view_rams_common","modules/core/i18n","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/core/uri"],function(e,t,n,o,i,r,a,s){"use strict";function l(e,t){var n=o.getNativePrintUrl(e,t);return null!=n&&(window.open(n,"_blank"),!0)}function c(e,t,n,o){return!!(e&&null!=n?u(n,t):d(t))&&(r.logUserAction(a.UserAction.Print,o),!0)}function u(e,t){return l(s.URI.parse(e).setQuery({preview:"1"}),s.URI.parse(t).getAuthority())}function d(e){return l(s.URI.parse(e),s.URI.parse(e).getAuthority())}function p(e){var t=window.open("about:blank");if(!t)throw new Error(i._("Could not open new window"));window.setTimeout(function(){var n=t.document.createElement("style");n.innerHTML="\n      @page { margin: 0;}\n      img { max-width: 100%; max-height: 100%}\n    ",t.document.head.appendChild(n);var o=function(){t.print()},i=function(){t.close()},r=t.document.createElement("img");r.src=e,r.onload=o,r.onerror=i,t.document.body.appendChild(r)},50)}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.nativePrint=c,t.imagePrint=p}),
define("modules/clean/previews/cookie_preview_tracer",["require","exports","tslib","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/models","modules/core/cookies","modules/constants/file_viewer"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importStar(a);var s=(function(){function e(e,t){var n=this;this.sessionId=e,this.onPreviewAttempt=function(){r.Cookies.create(a.FILE_PREVIEW_SESSION_ID_COOKIE,n.sessionId,null,a.FILE_PREVIEW_SESSION_ID_COOKIE_DOMAIN)},this.onPreviewCompleted=function(){r.Cookies.delete(a.FILE_PREVIEW_SESSION_ID_COOKIE)},this.previewEventEmitter=t,t.addListener(o.EventType.FilePreviewAttemptStarted,this.onPreviewAttempt);for(var s=0,l=i.FilePreviewSessionEndEvents;s<l.length;s++){var c=l[s];t.addListener(c,this.onPreviewCompleted)}}return e.prototype.teardown=function(){this.previewEventEmitter.removeListener(o.EventType.FilePreviewAttemptStarted,this.onPreviewAttempt);for(var e=0,t=i.FilePreviewSessionEndEvents;e<t.length;e++){var n=t[e];this.previewEventEmitter.removeListener(n,this.onPreviewCompleted)}this.onPreviewCompleted()},e})();t.CookiePreviewTracer=s}),define("modules/clean/previews/file_view_rams_common",["require","exports","tslib","modules/core/browser","modules/core/uri"],function(e,t,n,o,i){"use strict";function r(e){return e=e.toLowerCase(),l.indexOf(e)>-1||e.endsWith("dl.dropboxusercontent.com")||e.endsWith("previews.dropboxusercontent.com")}function a(){return o.chrome||o.safari||o.edge}function s(e,t){if(!a())return null;if(!r(t))return null;var n=e.clone();n.updateQuery({disable_range:"1",from_native_print:"1"});var o=i.URI.parse("https://"+t+"/nativeprint");return o.updateQuery({file:n.toString()}),o.toString()}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var l=["dl-web.dropbox.com","previews.dropbox.com","previews.dropboxusercontent.com","dl.dropboxusercontent.com"];t.getNativePrintUrl=s}),define("modules/clean/previews/pending_upload_watcher",["require","exports","tslib","modules/clean/ajax","modules/clean/react/file_viewer/data/actions","modules/core/browser","modules/core/uri"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),r=n.__importStar(r);var s=(function(){function e(e,t,n){void 0===n&&(n=""),this.pollUrl=new a.URI({path:"/sp/"}).updateQuery({link_type:e,link_key:t,secure_hash:n}).toString()}return e.prototype.startPolling=function(){this.pollPending()},e.prototype.pollSuccess=function(e){var t=JSON.parse(e);if(t.hasOwnProperty("upload_status")&&"complete"===t.upload_status)return void i.pendingFileUploaded();setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollFailure=function(e){e.status<400||e.status>=500?this.retryPoll():r.reload(!0)},e.prototype.retryPoll=function(){setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollPending=function(){var e=this;o.SilentBackgroundRequest({url:this.pollUrl,success:function(t){e.pollSuccess(t)},error:function(t){e.pollFailure(t)}})},e})();t.PendingUploadWatcher=s}),define("modules/clean/previews/util",["require","exports","tslib","modules/core/browser","modules/clean/analytics","modules/clean/datetime","modules/clean/filepath","modules/clean/previews/constants","modules/clean/file_store/utils","modules/clean/react/previews/constants","modules/constants/file_viewer","modules/core/uri"],function(e,t,n,o,i,r,a,s,l,c,u,d){"use strict";function p(){return".react-file-viewer__preview iframe"}function f(){return u.PASS_PLATFORM_INFO}function m(e){return["xls","csv","ods"].indexOf(e.substring(0,3))>-1}function h(e){var t=a.file_extension(e);return u.LOGGING_WHITELISTED_EXTS.includes("."+t)?t:u.LOGGING_EXT_PLACEHOLDER}function v(e){if("indd"===e)return e;var t=e.substring(0,3);switch(t){case"rtf":case"odt":case"wpd":return"doc";case"pps":case"odp":return"ppt";case"csv":case"ods":return"xls";default:return t}}function _(e){if(e.ts)return r.getActingTime(1e3*e.ts)}function g(e){return e=e.updateQuery({annotation_highlight:"1"}),e=e.updateQuery({annotation_region:"1"})}function y(e,t){var n={};return n._subject_uid=String(t),e.updateQuery(n)}function b(e,t){return y(new d.URI({path:"/history"+e.fq_path}),t.id)}function w(e,t){i.UserActivityLogger.log("web","view_version_history");var n=b(e,t);o.redirect(n.toString())}function S(e){return u.PRESENTATION_EXTS.map(function(e){return e.slice(1)}).includes(e)}function C(e){return["doc","docm","docx"].includes(e)}function E(e){return["odp","odt","rtf","wpd"].includes(e)}function A(e){return t.VALID_PREVIEW_TYPES.indexOf(e.preview_type)>-1}function T(e){var t=l.getExtension(e),n=e.bytes;if(void 0===n)return!0;var o=Number.MAX_VALUE;return"pdf"===t?o=Number(524288e3):C(t)||E(t)?o=s.MAX_WORD_DOC_FILE_SIZE_B:S(t)?o=s.MAX_PPT_FILE_SIZE_B:e.preview_type===s.PreviewType.Archive?o=s.MAX_ARCHIVE_FILE_SIZE_B:e.preview_type===s.PreviewType.Text?o=Number(8388608):e.preview_type===s.PreviewType.Linkfile?o=Number(10240):n=0,n<=o}function x(e){return 0===e.bytes}function P(e){return A(e)&&T(e)}function k(e){var t=l.getExtension(e);return P(e)&&O(t)}function O(e){var t=v(e);return["doc","ppt","xls","key","eps","ai"].indexOf(t)>-1}function I(e){var t=c.ErrorType.LoadError;return e===c.RivieraConvertResponseType.TooBig?t=c.ErrorType.FileSizeError:e===c.RivieraConvertResponseType.PasswordProtected&&(t=c.ErrorType.PasswordProtectedError),t}function M(){return{overflow:"auto","-webkit-overflow-scrolling":"touch"}}function R(e,t){return e&&t?d.URI.parse(e).updateQuery({psid:t.id}).toString():e}function F(e){return s.IworkExtensions.includes(l.getExtension(e))&&!e.is_dir}function D(e){return s.IworkExtensions.includes(l.getExtension(e))}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),a=n.__importStar(a),u=n.__importStar(u),t.getIframeQuery=p,t.shouldShowPlatformInfo=f,t.is_excel2_file=m,t.getWhitelistedExtension=h,t.normalize_extension=v,t.getModifierString=_,t.update_url_for_annotation=g,t.update_url_with_user_id=y,t.getVersionHistoryUrl=b,t.redirectToVersionHistory=w,t.VALID_PREVIEW_TYPES=[s.PreviewType.Archive,s.PreviewType.Audio,s.PreviewType.CloudDoc,s.PreviewType.Doc,s.PreviewType.Excel,s.PreviewType.HTML,s.PreviewType.Linkfile,s.PreviewType.Photo,s.PreviewType.Text,s.PreviewType.Video],t.isPptExtension=S,t.isWordDocExtension=C,t.isLibreOfficeExtension=E,t.extensionSupported=A,t.filesizeSupported=T,t.isEmptyFile=x,t.isPreviewable=P,t.canGeneratePreview=k,t.extCanGeneratePreview=O,t.mapRivieraStatusToErrorType=I,t.iOSIframeScrollStyles=M,t.tagCriticalPathContentRequest=R,t.isLimitedPreview=F,t.isSupportedBundleFile=D}),define("modules/clean/react/comments2/components/annotation_pane",["require","exports","tslib","external/react","external/react-redux","modules/clean/react/comments2/components/region_select/RegionSelect","modules/clean/react/comments2/components/region_select/style"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var s=(function(e){function t(t){var n=e.call(this,t)||this;return n.onChange=function(e){n.setState({regions:e})},n.state={regions:[{x:5,y:5,width:70,height:10},{x:10,y:25,width:70,height:15}]},n}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=e.childWidth;return o.createElement("div",{style:a.style.RegionSelectParent},o.createElement("div",{style:a.style.RegionSelectSiblingSpacer}),o.createElement(r.RegionSelect,{regions:this.state.regions,constraint:!0,onChange:this.onChange,className:t,style:n&&{width:n}},this.props.children),o.createElement("div",{style:a.style.RegionSelectSiblingSpacer}))},t})(o.Component),l=i.connect(function(e){return{}})(s);t.AnnotationPane=l}),define("modules/clean/react/comments2/components/mobile_web_comments",["require","exports","tslib","external/react","modules/clean/web_timing_logger","modules/clean/react/async/loadable","modules/clean/react/file_sidebar/base_comments_tab","modules/clean/react/comments2/util","modules/clean/react/size_class/constants"],function(e,t,n,o,i,r,a,s,l){"use strict";function c(e){var i=e.currentFile,r=e.sharedLinkInfo,c=e.sizeClass,u=e.user,d={previewType:i.preview_type||void 0,viewer:u};if(s.shouldUseComments2(d)&&c!==l.SizeClass.Large||s.shouldUseComments2MobileWeb(d)&&null!=i.ns_id){var p={currentFile:i,sharedLinkInfo:r,user:u,isMobile:!0};return o.createElement(a.BaseCommentsTab,n.__assign({},p,{commentsDisabledOnFile:!1,shouldInitiallyFocusInput:!0,content:function(){return o.createElement(t.AsyncMobileWebComments,n.__assign({},p))}}))}return null}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.AsyncMobileWebComments=r.Loadable({loader:function(){return i.waitForTTI().then(function(){return new Promise(function(t,n){e(["modules/clean/react/comments2/components/comments_pane"],t,n)}).then(n.__importStar).then(function(e){return e.CommentsPane})})}}),t.MobileWebComments=c}),define("modules/clean/react/comments2/components/region_select/Region",["require","exports","tslib","external/react","modules/clean/react/comments2/components/region_select/style"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderHandles=function(){return o.createElement("div",null,o.createElement("div",{"data-dir":"se",style:i.style.RegionHandleSE}),o.createElement("div",{"data-dir":"sw",style:i.style.RegionHandleSW}),o.createElement("div",{"data-dir":"nw",style:i.style.RegionHandleNW}),o.createElement("div",{"data-dir":"ne",style:i.style.RegionHandleNE}))},t.prototype.render=function(){var e={width:this.props.width+"%",height:this.props.height+"%",left:this.props.x+"%",top:this.props.y+"%"},t={data:this.props.data,isChanging:this.props.changing,index:this.props.index};return o.createElement("div",{style:n.__assign({},i.style.Region,e,this.props.customStyle,this.props.data.regionStyle),onMouseDown:this.props.onCropStart,onTouchStart:this.props.onCropStart,"data-wrapper":"wrapper"},this.props.handles?this.renderHandles():null,this.props.dataRenderer?this.props.dataRenderer(t):null)},t})(o.Component);t.Region=r}),define("modules/clean/react/comments2/components/region_select/RegionSelect",["require","exports","tslib","external/react","external/react-dom","modules/clean/react/comments2/components/region_select/Region","modules/clean/react/comments2/components/region_select/style"],function(e,t,n,o,i,r,a){"use strict";function s(e,t){return null!==e&&(!!t(e)||s(e.parentElement,t))}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),i=n.__importStar(i);var l=(function(e){function t(t){var a=e.call(this,t)||this;return a.onDocMouseTouchEnd=function(){var e=a.regionChangeIndex;if(a.isChanging&&null!==e){a.isChanging=!1;var t=a.props.regions[e],o={new:!1,isChanging:!1};a.regionChangeIndex=null,a.regionChangeData=null,a.props.onChange(a.props.regions.slice(0,e).concat([n.__assign({},t,o)],a.props.regions.slice(e+1)))}},a.onComponentMouseTouchDown=function(e){var t=e.target;if(!(t.dataset.wrapper||t.dataset.dir||s(t,function(e){return!(!e.dataset||!e.dataset.wrapper)}))){var n=i.findDOMNode(a.refs.image);e.preventDefault();var o=a.getClientPos(e),r=a.getElementOffset(n),l=(o.x-r.left)/n.offsetWidth*100,c=(o.y-r.top)/n.offsetHeight*100;a.isChanging=!0;var u={x:l,y:c,width:0,height:0,new:!0,data:{index:a.regionCounter,regionStyle:a.props.regionStyle||{}},isChanging:!0};a.regionCounter+=1,a.regionChangeData={imageOffsetLeft:r.left,imageOffsetTop:r.top,clientPosXStart:o.x,clientPosYStart:o.y,imageWidth:n.offsetWidth,imageHeight:n.offsetHeight,isMove:!1},a.regions.length<a.maxRegions?(a.props.onChange(a.regions.concat(u)),a.regionChangeIndex=a.regions.length):(a.props.onChange(a.regions.slice(0,a.maxRegions-1).concat([u])),a.regionChangeIndex=a.maxRegions-1)}},a.renderRect=function(e,t){return o.createElement(r.Region,{x:e.x,y:e.y,width:e.width,height:e.height,handles:!e.new,data:e.data||{index:-1,regionStyle:{}},key:t,index:t,customStyle:a.props.regionStyle,dataRenderer:a.props.regionRenderer,onCropStart:function(e){return a.onRegionMoveStart(e,t)},changing:t===a.regionChangeIndex})},a.onComponentMouseTouchDown=a.onComponentMouseTouchDown.bind(a),a.onDocMouseTouchMove=a.onDocMouseTouchMove.bind(a),a.onDocMouseTouchEnd=a.onDocMouseTouchEnd.bind(a),a.onRegionMoveStart=a.onRegionMoveStart.bind(a),a.regionCounter=0,a}return n.__extends(t,e),Object.defineProperty(t.prototype,"regions",{get:function(){return this.props.regions||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxRegions",{get:function(){return this.props.maxRegions||1/0},enumerable:!0,configurable:!0}),t.prototype.componentDidMount=function(){document.addEventListener("mousemove",this.onDocMouseTouchMove),document.addEventListener("touchmove",this.onDocMouseTouchMove),document.addEventListener("mouseup",this.onDocMouseTouchEnd),document.addEventListener("touchend",this.onDocMouseTouchEnd),document.addEventListener("touchcancel",this.onDocMouseTouchEnd)},t.prototype.componentWillUnmount=function(){document.removeEventListener("mousemove",this.onDocMouseTouchMove),document.removeEventListener("touchmove",this.onDocMouseTouchMove),document.removeEventListener("mouseup",this.onDocMouseTouchEnd),document.removeEventListener("touchend",this.onDocMouseTouchEnd),document.removeEventListener("touchcancel",this.onDocMouseTouchEnd)},t.prototype.getClientPos=function(e){var t,n;return"touches"in e?(t=e.touches[0].pageX,n=e.touches[0].pageY):(t=e.pageX,n=e.pageY),{x:t,y:n}},t.prototype.onDocMouseTouchMove=function(e){var t=this.regionChangeIndex;if(this.isChanging&&null!==t){var o,i,r,a,s=this.regions[t],l=this.getClientPos(e),c=this.regionChangeData;if(c.isMove)o=(l.x+c.clientPosXOffset-c.imageOffsetLeft)/c.imageWidth*100,i=(l.y+c.clientPosYOffset-c.imageOffsetTop)/c.imageHeight*100,r=s.width,a=s.height,this.props.constraint&&(o+r>=100&&(o=Math.round(100-r)),i+a>=100&&(i=Math.round(100-a)),o<=0&&(o=0),i<=0&&(i=0));else{var u=void 0,d=void 0,p=void 0,f=void 0;u=(c.clientPosXStart-c.imageOffsetLeft)/c.imageWidth*100,d=(c.clientPosYStart-c.imageOffsetTop)/c.imageHeight*100,p=(l.x-c.imageOffsetLeft)/c.imageWidth*100,f=(l.y-c.imageOffsetTop)/c.imageHeight*100,o=Math.min(u,p),i=Math.min(d,f),r=Math.abs(u-p),a=Math.abs(d-f),this.props.constraint&&(p>=100&&(o=u,r=100-u),f>=100&&(i=d,a=100-d),p<=0&&(o=0,r=u),f<=0&&(i=0,a=d))}var m={x:o,y:i,width:r,height:a,isChanging:!0};this.props.onChange(this.props.regions.slice(0,t).concat([n.__assign({},s,m)],this.props.regions.slice(t+1)))}},t.prototype.getElementOffset=function(e){var t=e.getBoundingClientRect(),n=document.documentElement;return{top:t.top+window.pageYOffset-n.clientTop,left:t.left+window.pageXOffset-n.clientLeft}},t.prototype.onRegionMoveStart=function(e,t){var n=e.target.dataset;if(n.wrapper||n.dir){e.preventDefault();var o,r,a=i.findDOMNode(this.refs.image),s=this.getClientPos(e),l=this.getElementOffset(a),c=this.props.regions[t],u=c.x/100*a.offsetWidth+l.left,d=c.y/100*a.offsetHeight+l.top,p=c.width/100*a.offsetWidth,f=c.height/100*a.offsetHeight,m=u-s.x,h=d-s.y,v=n.dir;v?"se"===v?(o=u,r=d):"sw"===v?(o=u+p,r=d):"nw"===v?(o=u+p,r=d+f):"ne"===v&&(o=u,r=d+f):(o=s.x,r=s.y),this.isChanging=!0,this.regionChangeData={imageOffsetLeft:l.left,imageOffsetTop:l.top,clientPosXStart:o,clientPosYStart:r,clientPosXOffset:m,clientPosYOffset:h,imageWidth:a.offsetWidth,imageHeight:a.offsetHeight,isMove:!v,resizeDir:v},this.regionChangeIndex=t}},t.prototype.render=function(){var e=this.props.regions||[];return o.createElement("div",{ref:"image",style:n.__assign({},a.style.RegionSelect,this.props.style,{flex:"0 0 auto"}),className:this.props.className,onTouchStart:this.onComponentMouseTouchDown,onMouseDown:this.onComponentMouseTouchDown},this.props.children,e.map(this.renderRect),this.props.debug?o.createElement("table",{style:{position:"absolute",right:0,top:0}},o.createElement("tbody",null,e.map(function(e,t){return o.createElement("tr",{key:t},o.createElement("td",null,"x: ",Math.round(e.x)),o.createElement("td",null,"y: ",Math.round(e.y)),o.createElement("td",null,"width: ",Math.round(e.width)),o.createElement("td",null,"height: ",Math.round(e.height)))}))):null)},t.defaultProps={constraint:!1,debug:!1,maxRegions:1/0,regions:[],regionRenderer:function(e){},regionStyle:{},style:{}},t})(o.Component);t.RegionSelect=l}),define("modules/clean/react/comments2/components/region_select/style",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.style={Region:{position:"absolute",border:"1px dashed rgba(0,0,0,0.5)",outline:"1px dashed rgba(255,255,255,0.5)",cursor:"move"},RegionHandleSE:{position:"absolute",bottom:-4,right:-4,width:8,height:8,outline:"1px solid rgba(0,0,0,0.5)",border:"1px solid rgba(255,255,255,0.5)",cursor:"se-resize"},RegionHandleSW:{position:"absolute",bottom:-4,left:-4,width:8,height:8,outline:"1px solid rgba(0,0,0,0.5)",border:"1px solid rgba(255,255,255,0.5)",cursor:"sw-resize"},RegionHandleNW:{position:"absolute",top:-4,left:-4,width:8,height:8,outline:"1px solid rgba(0,0,0,0.5)",border:"1px solid rgba(255,255,255,0.5)",cursor:"nw-resize"},RegionHandleNE:{position:"absolute",top:-4,right:-4,width:8,height:8,outline:"1px solid rgba(0,0,0,0.5)",border:"1px solid rgba(255,255,255,0.5)",cursor:"ne-resize"},RegionSelect:{flex:"0 1 auto",position:"relative"},RegionSelectParent:{display:"flex","flex-direction":"row",width:"100%"},RegionSelectSiblingSpacer:{flex:"1"}}}),define("modules/clean/react/comments2/data/action_helper",["require","exports","tslib"],function(e,t,n){"use strict";function o(e,t){return e.zero?{type:e.actionType}:{type:e.actionType,payload:t}}function i(e,t){return{type:e.actionTypes.request,payload:t,meta:{args:t}}}function r(e,t,n){return{type:e.actionTypes.success,payload:n,meta:{args:t}}}function a(e,t,n){return{type:e.actionTypes.error,error:n,meta:{args:t}}}function s(e){return{error:e+".Error",request:e+".Request",success:e+".Success"}}function l(e){return{actionTypes:s(e),name:e,type:"async"}}function c(e){return{actionType:e,name:e,type:"sync",zero:!1}}function u(e){return{actionType:e,name:e,type:"sync",zero:!0}}function d(e){return{asyncAction:function(t){return l(e+"/"+t)},syncAction:function(t){return c(e+"/"+t)},syncAction0:function(t){return u(e+"/"+t)}}}function p(e){return e.zero?function(){return{type:e.name}}:function(t){return{payload:t,type:e.name}}}function f(){var e=this;return function(t,o){return n.__awaiter(e,void 0,void 0,function(){var e,i,r,a,s;return n.__generator(this,function(n){switch(n.label){case 0:e=o.action,i=o.args,r=o.dispatch,r({type:e.actionTypes.request,payload:i,meta:{args:i}}),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,t(o)];case 2:return a=n.sent(),r({type:e.actionTypes.success,payload:a,meta:{args:i}}),[2,a];case 3:throw s=n.sent(),r({type:e.actionTypes.error,error:s,meta:{args:i}}),s;case 4:return[2]}})})}}var m=this;Object.defineProperty(t,"__esModule",{value:!0}),t.syncReduxAction=o,t.requestReduxAction=i,t.successReduxAction=r,t.errorReduxAction=a,t.asyncActionConstants=s,t.asyncAction=l,t.syncAction=c,t.syncAction0=u,t.namespacedActions=d,t.syncHandler=p,t.createAsyncHandler=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,o){return function(i){return function(r,a){return n.__awaiter(m,void 0,void 0,function(){var s,l,c;return n.__generator(this,function(n){switch(n.label){case 0:s=0,l=function(t){var n=e[s++];return n?n(l,t):o(i,t)},n.label=1;case 1:return n.trys.push([1,3,,4]),[4,l({action:t,args:i,dispatch:r,state:a()})];case 2:return[2,n.sent()];case 3:return c=n.sent(),[3,4];case 4:return[2]}})})}}}},t.dispatchMiddleware=f,t.thunkHandler=t.createAsyncHandler(),t.asyncHandler=t.createAsyncHandler(f())}),define("modules/clean/react/comments2/data/actions",["require","exports","tslib","external/lodash","modules/core/browser","modules/clean/redux/types","modules/clean/react/comments2/data/api","modules/clean/react/file_sidebar/store/instance","modules/clean/react/comments2/transforms","modules/clean/react/comments2/data/types","modules/clean/react/comments2/enable_disable_option","modules/clean/react/comments2/util","modules/clean/react/comments2/data/selectors","modules/clean/bolt","modules/clean/react/comments2/data/action_helper","modules/clean/react/file_sidebar/store/sidebar/actions"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,m,h){"use strict";function v(e){var t=this,o=e.startAction,r=e.successAction,s=e.clientFn,l=e.errorAction,c=e.loggingFn,u=e.loggingData;return function(e,d){return n.__awaiter(t,void 0,void 0,function(){var t,f,m,h,v,_,g,y,b;return n.__generator(this,function(w){switch(w.label){case 0:if(t=p.getContext(d()),!t||!t.viewer)throw new Error;e(o()),f=new a.Comments2Api(t.viewer.id,t.stream),m=i.get_uri().getQuery().oref,w.label=1;case 1:return w.trys.push([1,3,,4]),[4,s(f,t)];case 2:return h=w.sent(),e(r(h)),c&&u&&(v=n.__assign({},c(t.viewer.id,u,h),{oref:m}),f.logEvent(u.event,v)),[3,4];case 3:return _=w.sent(),e(l(_)),u&&(g=u.event,y=u.threadId,b=u.commentId,f.logErrorEvent("error trying to execute client event "+g,{commentId:b,threadId:y,oref:m})),[3,4];case 4:return[2]}})})}}function _(e){var t=this,o=e.clientFn,r=e.successCallback,s=e.eventToLog;return function(e,l){return n.__awaiter(t,void 0,void 0,function(){var t,c,u,d,f;return n.__generator(this,function(n){switch(n.label){case 0:if(t=p.getContext(l()),!t||!t.viewer)throw new Error;c=new a.Comments2Api(t.viewer.id,t.stream),u=i.get_uri().getQuery().oref,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,o(c)];case 2:return d=n.sent(),c.logEvent(s,{oref:u}),r(e,l,d),[3,4];case 3:return f=n.sent(),c.logErrorEvent("error trying to execute client event "+s,{oref:u}),[3,4];case 4:return[2]}})})}}function g(e,t,n){return{commentId:n.id,threadId:t.threadId}}function y(){return{type:c.ActionType.ListCommentsRequest,payload:{}}}function b(){return{type:c.ActionType.ListCommentsError,payload:{}}}function w(e,t,n,o){return{type:c.ActionType.ListCommentsSuccess,payload:{threads:e,authors:t,activeCommentId:n,cursor:o}}}function S(e,t,n,o,i){return{type:c.ActionType.AddCommentRequest,payload:{author:e,content:t,annotation:o,threadId:i,guid:n}}}function C(e,t){return{type:c.ActionType.AddCommentError,payload:{guid:e,threadId:t}}}function E(e,t,n){return{type:c.ActionType.AddCommentSuccess,payload:{guid:e,id:t,threadId:n}}}function A(e,t,n){return{type:c.ActionType.EditCommentRequest,payload:{commentId:e,content:t,threadId:n}}}function T(e,t,n){return{type:c.ActionType.EditCommentError,payload:{commentId:e,error:t,threadId:n}}}function x(e,t){return{type:c.ActionType.EditCommentSuccess,payload:{commentId:e,threadId:t}}}function P(e){return{type:c.ActionType.ActivateThread,payload:{thread:e}}}function k(e){return function(n){n(P(e)),e.read||n(t.Actions.markThreadRead({threadId:e.id,origin:c.MarkThreadReadOrigin.ThreadActivated}))}}function O(){return{type:c.ActionType.DeactivateAllThreads,payload:{}}}function I(e,t){return{type:c.ActionType.DeleteCommentRequest,payload:{commentId:e,threadId:t}}}function M(e,t,n){return{type:c.ActionType.DeleteCommentError,payload:{commentId:e,error:t,threadId:n}}}function R(e,t){return{type:c.ActionType.DeleteCommentSuccess,payload:{commentId:e,threadId:t}}}function F(e){var t=e.author,n=e.comment,o=e.content,i=e.annotation,r=e.threadId,a=e.guid;return v({startAction:function(){return S(t,o,a,i,r)},clientFn:function(e){return r?e.replyToThread(n,r):e.addComment(n)},successAction:function(e){return E(a,e.id,r)},errorAction:function(e){return C(a,r)},loggingFn:g,loggingData:{event:r?"reply_to_comment":"new_comment",threadId:r}})}function D(e,t){return v({startAction:function(){return I(e,t)},clientFn:function(t){return t.deleteComment(e)},successAction:function(n){return R(e,t)},errorAction:function(n){return M(e,n,t)},loggingFn:g,loggingData:{event:"delete_comment",commentId:e}})}function N(e,t,n){return v({startAction:function(){return A(e,n,t)},clientFn:function(t,o){var i=o.stream,r=l.iCommentContentToUserSubmittedComment({content:n,stream:i});return t.editComment(e,r)},successAction:function(n){return x(e,t)},errorAction:function(n){return T(e,n,t)},loggingFn:g,loggingData:{event:"edit_comment",commentId:e}})}function L(){var e=/comment_id=(.*)/.exec(i.get_uri().getFragment());return e?e[1]:void 0}function U(e,t,n){var o="enabled"===t[".tag"]||"readonly"===t[".tag"],i={isEnabled:o};null!=n&&(i.canEnable=n.can_enable_commenting),i.isEnabled=o,e(_e(i))}function z(){return _({clientFn:function(e){return e.enableCommenting()},successCallback:H,eventToLog:"enable_comments"})}function H(e,t,o){return n.__awaiter(this,void 0,void 0,function(){var i;return n.__generator(this,function(n){return i=p.getStreamId(t()),i!=="id:"+o.id?[2]:(u.removeEnableCommentingFromOverflow(),e(j(!0,!1)),[2])})})}function B(){return _({clientFn:function(e){return e.disableCommenting()},successCallback:V,eventToLog:"disable_comments"})}function V(e,t,o){return n.__awaiter(this,void 0,void 0,function(){var i,r;return n.__generator(this,function(n){return i=p.getStreamId(t()),i!=="id:"+o.id?[2]:(r=p.getContext(t()),q(e,r,!0),[2])})})}function q(e,t,o){return n.__awaiter(this,void 0,void 0,function(){var i;return n.__generator(this,function(n){switch(n.label){case 0:return i=t.viewer,e(_e({isEnabled:!1})),[4,e(oe(c.Comments2ContextStatus.Disabled))];case 1:return n.sent(),d.canComments2EnableDisable(i)&&o&&u.addEnableCommentingToOverflow(e,z),[4,s.store.dispatch(h.setComments2DisabledState())];case 2:return n.sent(),e(te(t)),[2]}})})}function j(e,t){var o=this;return void 0===e&&(e=!1),void 0===t&&(t=!0),function(i,r){return n.__awaiter(o,void 0,void 0,function(){var o,l,u,d,f,m,v,_,g,S,C,E,A,T,x;return n.__generator(this,function(n){switch(n.label){case 0:if(o=r(),l=p.getContext(o),!l)return[2];i(y()),u=l.stream,d=l.viewer,f=d?new a.Comments2Api(d.id,u):new a.Comments2LoggedOutApi(u),n.label=1;case 1:return n.trys.push([1,6,,7]),[4,f.listComments(e,p.getCursor(o))];case 2:if(m=n.sent(),v=m.bolt_info,_=m.cursor,g=m.status,S=m.threads,C=m.users,E=m.permissions,U(i,g,E),A=p.getContextStatus(o),A===c.Comments2ContextStatus.Pending)switch(g[".tag"]){case"disabled":T=null!=E&&E.can_enable_commenting,q(i,l,T);break;case"enabled":case"readonly":i(oe(c.Comments2ContextStatus.Comments2)),s.store.dispatch(h.setComments2ShownState({commentCount:S.filter(function(e){return!e.resolved}).length}));break;case"comments1":i(oe(c.Comments2ContextStatus.Comments1))}return A!==c.Comments2ContextStatus.Comments2&&(A!==c.Comments2ContextStatus.Pending||"enabled"!==g[".tag"]&&"readonly"!==g[".tag"])?[3,5]:[4,i(W(v))];case 3:return n.sent(),[4,i(w(S,C,t?L():void 0,_))];case 4:n.sent(),n.label=5;case 5:return[3,7];case 6:return x=n.sent(),x instanceof a.Comments2Error&&("file_not_found"===x.code?i(oe(c.Comments2ContextStatus.Disabled)):d&&f instanceof a.Comments2Api&&f.logErrorEvent((x.message,": "+x.message))),i(b()),[3,7];case 7:return[2]}})})}}function W(e){var n=e.revision,o=e.token;return function(e,i){var r=p.getContext(i());d.useBolt()&&r&&t.bolt.subscribe({id:r.stream.id,revision:n,token:o},function(){return e(j(!1,!1))})}}function K(e){var o=this;return function(i,r){return n.__awaiter(o,void 0,void 0,function(){var o,a;return n.__generator(this,function(n){switch(n.label){case 0:return o=r(),a=p.getContext(o),d.isContextSame(a,e)?[3,3]:(t.bolt.unsubscribe(),i(te(e)),e?d.shouldUseComments2({previewType:e.stream.previewType,viewer:e.viewer})?(d.isUserSame(a&&a.viewer,e.viewer)||i(re(void 0)),[4,i(j(!0))]):[3,2]:[3,3]);case 1:return n.sent(),[3,3];case 2:i(oe(c.Comments2ContextStatus.Comments1)),n.label=3;case 3:return[2]}})})}}function G(){return function(e,t){var n=p.getContext(t.state);if(!n||!n.viewer)throw new Error("Bad state");var i=new a.Comments2Api(n.viewer.id,n.stream);return e(o.merge({},t,{api:i,context:n}))}}function Y(e){var t=this;return function(i,a){return n.__awaiter(t,void 0,void 0,function(){var t,s;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,i(a)];case 1:return t=n.sent(),e(o.merge({},a,{payload:t,status:r.ApiClientStatus.Success})),[2,t];case 2:throw s=n.sent(),e(o.merge({},a,{error:s,status:r.ApiClientStatus.Error})),s;case 3:return[2]}})})}}function Z(e,t){var o=this;return void 0===t&&(t={}),function(i,r){return n.__awaiter(o,void 0,void 0,function(){var o,i,s;return n.__generator(this,function(n){return o=r(),i=p.getContext(o),i&&i.viewer&&(s=new a.Comments2Api(i.viewer.id,i.stream),s.logEvent(e,t)),[2]})})}}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),i=n.__importStar(i),d=n.__importStar(d),p=n.__importStar(p),h=n.__importStar(h);t.listCommentsRequest=y,t.listCommentsError=b,t.listCommentsSuccess=w,t.addCommentRequest=S,t.addCommentError=C,t.addCommentSuccess=E,t.editCommentRequest=A,t.editCommentError=T,t.editCommentSuccess=x,t.activateThread=P,t.activateThreadAndMarkAsRead=k,t.deactivateAllThreads=O,t.deleteCommentRequest=I,t.deleteCommentError=M,t.deleteCommentSuccess=R,t.addComment=F,t.deleteComment=D,t.editComment=N,t.enableCommenting=z,t.disableCommenting=B,t.listComments=j,t.bolt={client:null,subscribe:function(e,n){var o=e.id,i=e.revision,r=e.token;if(null===t.bolt.client){var a=new f.SignedChannelState("comments2",o,i,r),s=function(){t.bolt.client=new f.BoltClient([a],n,l),t.bolt.client.start()},l=function(e){t.bolt.unsubscribe(),s()};s()}},unsubscribe:function(){t.bolt.client&&(t.bolt.client.unsubscribe(),t.bolt.client=null)}},t.setFileContext=K;var Q=m.namespacedActions("Comments2"),X=Q.asyncAction,J=Q.syncAction,$=m.createAsyncHandler(m.dispatchMiddleware(),G(),Y(function(e){var t=i.get_uri().getQuery().oref;if(e.status===r.ApiClientStatus.Error)e.api.logErrorEvent("encountered an error with async api call "+e.action.name,{oref:t});else if(e.status===r.ApiClientStatus.Success)switch(e.action.name){case pe.name:e.api.logEvent("resolve_thread",{threadId:e.payload.id,oref:t});break;case me.name:e.api.logEvent("unresolve_thread",{threadId:e.payload.id,oref:t});break;case le.name:var n=e.args.origin===c.MarkThreadReadOrigin.ThreadActivated?"read_thread":"mark_thread_as_read";e.api.logEvent(n,{threadId:e.payload.id,oref:t});break;case ue.name:e.api.logEvent("mark_thread_as_unread",{threadId:e.payload.id,oref:t})}})),ee=J("SetContext"),te=m.syncHandler(ee),ne=J("SetContextStatus"),oe=m.syncHandler(ne),ie=X("CheckOnboardingStatus"),re=$(ie,function(e,t){return t.api.checkOnboardingStatus()}),ae=X("MarkOnboarded"),se=$(ae,function(e,t){return t.api.markHasOnboarded(e)}),le=X("MarkThreadRead"),ce=$(le,function(e,t){var n=(e.origin,e.threadId);return t.api.markThreadRead(n)}),ue=X("MarkThreadUnread"),de=$(ue,function(e,t){return t.api.markThreadUnread(e)}),pe=X("MarkThreadResolved"),fe=$(pe,function(e,t){return t.api.markThreadResolved(e)}),me=X("MarkThreadUnresolved"),he=$(me,function(e,t){return t.api.markThreadUnresolved(e)}),ve=J("RecordEnabledStatus"),_e=m.syncHandler(ve),ge=J("SetSoftHideCommentsPaneOnboarding"),ye=m.syncHandler(ge),be=J("SuppressOnboardingForSession"),we=m.syncHandler(be),Se=function(){return we("video_first_paused")},Ce=m.syncAction0("ToggleShowResolved"),Ee=m.syncHandler(Ce),Ae=J("UpdatePlayerCurrentTime"),Te=m.syncHandler(Ae),xe=J("ResetStore"),Pe=m.syncHandler(xe);t.ActionTypes={SetContext:ee,SetContextStatus:ne,CheckOnboardingStatus:ie,MarkOnboarded:ae,MarkThreadRead:le,MarkThreadUnread:ue,MarkThreadResolved:pe,MarkThreadUnresolved:me,RecordEnabledStatus:ve,SetSoftHideCommentsPaneOnboarding:ge,SuppressOnboardingForSession:be,ToggleShowResolved:Ce,UpdatePlayerCurrentTime:Ae,ResetStore:xe},t.Actions={setContextStatus:oe,setFileContext:K,checkOnboardingStatus:re,disableCommenting:B,enableCommenting:z,markOnboarded:se,markThreadRead:ce,markThreadUnread:de,markThreadResolved:fe,
markThreadUnresolved:he,recordEnabledStatus:_e,setSoftHideCommentsPaneOnboarding:ye,suppressOnboardingForSession:we,suppressVideoOnboardingForSession:Se,toggleShowResolved:Ee,updatePlayerCurrentTime:Te,logEvent:Z,resetStore:Pe}}),define("modules/clean/react/comments2/data/api",["require","exports","tslib","modules/clean/api_v2/error","modules/clean/api_v2/client","modules/clean/api_v2/root_aware_client","modules/core/exception"],function(e,t,n,o,i,r,a){"use strict";function s(e,t){if(e instanceof o.ApiError){var n=t;return e.message&&(n+=". Detailed message: "+e.message.toString()),new c(e.error[".tag"],n,e)}return e}function l(e){var t={".tag":e.type};return e.linkUrl?{type:t,identifier:{".tag":"shared_link_details",url:e.linkUrl}}:{type:t,identifier:{".tag":"file_path_or_id",file_path_or_id:e.id}}}Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importStar(a);var c=(function(){function e(e,t,n){this.code=e,this.message=t,this.apiError=n}return e})();t.Comments2Error=c;var u=(function(){function e(e){this.routes=(new i.ApiV2Client).ns("comments2"),this.params={subjectUserId:null},this.stream=l(e)}return e.prototype.listComments=function(e,t){return void 0===e&&(e=!1),this.routes.rpc("logged_out/list_comments",{stream:this.stream,cursor:t,include_permissions:e},this.params).catch(function(e){throw s(e,"/logged_out/list_comments did not complete successfully")})},e})();t.Comments2LoggedOutApi=u;var d=(function(){function e(e){this.routes=(new r.ApiV2RootAwareClient).ns("comments2"),this.params={subjectUserId:e}}return e.prototype.enrollInBeta=function(){return this.routes.rpc("enroll_in_beta",void 0,this.params).catch(function(e){throw s(e,"/enroll_in_beta did not complete successfully")})},e})();t.Comments2NonStreamApi=d;var p=(function(){function e(e,t){this.routes=(new r.ApiV2RootAwareClient).ns("comments2"),this.params={subjectUserId:e},this.stream=l(t)}return e.prototype.addComment=function(e){return this.routes.rpc("add_comment",{stream:this.stream,comment:e},this.params).catch(function(e){throw s(e,"/add_comment (new comment) did not complete successfully")})},e.prototype.checkOnboardingStatus=function(){return this.routes.rpc("check_onboarding_status",void 0,this.params).catch(function(e){throw s(e,"/check_onboarding_status did not complete successfully")})},e.prototype.deleteComment=function(e){return this.routes.rpc("delete_comment",{stream:this.stream,id:e},this.params).catch(function(e){throw s(e,"/delete_comment did not complete successfully")})},e.prototype.disableCommenting=function(){return this.routes.rpc("disable_commenting",{stream:this.stream},this.params).catch(function(e){throw s(e,"/disable_commenting did not complete successfully")})},e.prototype.editComment=function(e,t){return this.routes.rpc("edit_comment",{stream:this.stream,id:e,comment:t},this.params).catch(function(e){throw s(e,"/edit_comment did not complete successfully")})},e.prototype.enableCommenting=function(){return this.routes.rpc("enable_commenting",{stream:this.stream},this.params).catch(function(e){throw s(e,"/enable_commenting did not complete successfully")})},e.prototype.listComments=function(e,t){return void 0===e&&(e=!1),this.routes.rpc("list_comments",{stream:this.stream,cursor:t,include_permissions:e},this.params).catch(function(e){throw s(e,"/list_comments did not complete successfully")})},e.prototype.logEvent=function(e,t){return void 0===t&&(t={}),this.logEventImpl(e,t)},e.prototype.logErrorEvent=function(e,t){return void 0===t&&(t={}),this.logEventImpl("comment_error",n.__assign({},t,{errorMessage:e}))},e.prototype.logEventImpl=function(e,t){var n=t.threadId,o=t.commentId,i=t.oref,r=t.errorMessage,l={event:{".tag":e},stream:this.stream,thread_id:n,comment_id:o,error_message:r,oref:i};return this.routes.rpc("log_event",l,this.params).catch(function(e){throw a.reportStack("comments2 logging failed",{severity:a.SEVERITY.NONCRITICAL,tags:["comments2_logging"],exc_extra:l}),s(e,"/log_event did not complete successfully")})},e.prototype.markHasOnboarded=function(e){var t={".tag":e};return this.routes.rpc("mark_has_onboarded",{type:t},this.params).catch(function(e){throw s(e,"/mark_has_onboarded did not complete successfully")})},e.prototype.markThreadRead=function(e){return this.routes.rpc("mark_thread_read",{stream:this.stream,id:e},this.params).catch(function(e){throw s(e,"/mark_thread_read did not complete successfully")})},e.prototype.markThreadUnread=function(e){return this.routes.rpc("mark_thread_unread",{stream:this.stream,id:e},this.params).catch(function(e){throw s(e,"/mark_thread_unread did not complete successfully")})},e.prototype.markThreadResolved=function(e){return this.routes.rpc("resolve_thread",{stream:this.stream,id:e},this.params).catch(function(e){throw s(e,"/resolve_thread did not complete successfully")})},e.prototype.markThreadUnresolved=function(e){return this.routes.rpc("unresolve_thread",{stream:this.stream,id:e},this.params).catch(function(e){throw s(e,"/unresolve_thread did not complete successfully")})},e.prototype.replyToThread=function(e,t){return this.routes.rpc("add_comment",{stream:this.stream,comment:e,thread_id:t},this.params).catch(function(e){throw s(e,"/add_comment (reply comment) did not complete successfully")})},e})();t.Comments2Api=p}),define("modules/clean/react/comments2/data/initial_state",["require","exports","modules/clean/react/comments2/data/types"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INITIAL_STATE={context:void 0,data:{threads:{},authors:{},activatedThreadId:void 0,cursor:void 0,onboardingInfo:{initial_video_land:n.OnboardingStatus.Unknown,video_first_paused:n.OnboardingStatus.Unknown,initial_non_annotation_land:n.OnboardingStatus.Unknown},softHideCommentsPaneOnboarding:!1,playerCurrentTime:0,showResolved:!1,sort:n.SortType.Chronological,lastRequestStatuses:{},enabledStatus:{canEnable:!1,isEnabled:!1}},statuses:{}}}),define("modules/clean/react/comments2/data/reducer",["require","exports","tslib","external/lodash","modules/clean/redux/types","modules/clean/react/comments2/data/types","modules/clean/previews/constants","modules/clean/react/comments2/transforms","modules/clean/react/comments2/util","modules/clean/react/comments2/data/initial_state","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/reducer_helper"],function(e,t,n,o,i,r,a,s,l,c,u,d){"use strict";function p(e,t){var o,a=new Date,s=e.threadId&&t.threads[e.threadId],l={id:e.guid,threadId:s?s.id:e.guid,timestamp:a,author:e.author,content:e.content,userPermissions:{canDelete:!1,canEdit:!1}};o=s?n.__assign({},s,{comments:s.comments.concat([l])}):{id:e.guid,timestamp:a,read:!0,resolved:!1,comments:[l],annotation:e.annotation};var c=n.__assign({},o,{pending:{action:r.ActionType.AddCommentRequest,originalValue:s,pendingValue:o}});return n.__assign({},t,{lastRequestStatuses:n.__assign({},t.lastRequestStatuses,(u={},u[r.RequestType.AddComment]=i.ApiClientStatus.Fetch,u)),activatedThreadId:c.id,threads:n.__assign({},t.threads,(d={},d[c.id]=c,d))});var u,d}function f(e,t){var o=e.threadId||e.guid,a=t.threads,s=o,l=a[s],c=n.__rest(a,["symbol"==typeof s?s:s+""]),u=l.comments.map(function(t){return t.id===e.guid?n.__assign({},t,{id:e.id,userPermissions:{canDelete:!0,canEdit:!0}}):t}),d=n.__assign({},l,{pending:void 0,comments:u,id:e.threadId||e.id});return n.__assign({},t,{lastRequestStatuses:n.__assign({},t.lastRequestStatuses,(p={},p[r.RequestType.AddComment]=i.ApiClientStatus.Success,p)),activatedThreadId:d.id,threads:n.__assign({},c,(f={},f[d.id]=d,f))});var p,f}function m(e,t){var o,a=e.threadId||e.guid,s=t.threads,l=a,c=s[l],u=n.__rest(s,["symbol"==typeof l?l:l+""]);if(e.threadId){var d=c.comments.filter(function(t){return t.id!==e.guid});o=n.__assign({},u,(p={},p[e.threadId]=n.__assign({},c,{pending:void 0,comments:d}),p))}else o=u;return n.__assign({},t,{lastRequestStatuses:n.__assign({},t.lastRequestStatuses,(f={},f[r.RequestType.AddComment]=i.ApiClientStatus.Error,f)),threads:o});var p,f}function h(e){function t(e){return e?r.OnboardingStatus.HasCompletedOnboarding:r.OnboardingStatus.NotOnboarded}return{initial_video_land:t(e.initial_video_land),video_first_paused:t(e.video_first_paused),initial_non_annotation_land:t(e.initial_non_annotation_land)}}function v(e,t,n){return e.map(function(e){return e.id===t?n(e):e})}function _(e,t){switch(t.type){case r.ActionType.ActivateThread:return n.__assign({},e,{activatedThreadId:t.payload.thread.id});case r.ActionType.DeactivateAllThreads:return n.__assign({},e,{activatedThreadId:void 0});case r.ActionType.ListCommentsRequest:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(k={},k[r.RequestType.ListComments]=i.ApiClientStatus.Fetch,k))});case r.ActionType.ListCommentsSuccess:var o=n.__assign({},e.authors,s.usersToIUserMap(t.payload.authors)),a=n.__assign({},e.threads,s.threadsToIThreadMap(t.payload.threads,o)),c=Object.keys(a).find(function(e){return a[e].comments.some(function(e){return e.id===t.payload.activeCommentId})}),u=e.playerCurrentTime;if(c)if(a[c]){var d=a[c].annotation;l.isTimecodeAnnotation(d)&&(u=d.time)}else c=void 0;return n.__assign({},e,{threads:a,authors:o,cursor:t.payload.cursor,lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(O={},O[r.RequestType.ListComments]=i.ApiClientStatus.Success,O)),activatedThreadId:c||e.activatedThreadId,playerCurrentTime:u});case r.ActionType.ListCommentsError:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(I={},I[r.RequestType.ListComments]=i.ApiClientStatus.Error,I))});case r.ActionType.AddCommentRequest:return p(t.payload,e);case r.ActionType.AddCommentSuccess:return f(t.payload,e);case r.ActionType.AddCommentError:return m(t.payload,e);case r.ActionType.EditCommentRequest:var h=t.payload,_=h.commentId,g=h.content,y=h.threadId,b=e.threads[y],w=v(b.comments,_,function(e){return n.__assign({},e,{content:g,pending:{action:r.ActionType.EditCommentRequest,originalValue:e.content,pendingValue:g}})});return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(M={},M[r.RequestType.EditComment]=i.ApiClientStatus.Fetch,M)),threads:n.__assign({},e.threads,(R={},R[b.id]=n.__assign({},b,{comments:w}),R))});case r.ActionType.EditCommentSuccess:var S=t.payload,_=S.commentId,y=S.threadId,b=e.threads[y],w=v(b.comments,_,function(e){return n.__assign({},e,{pending:void 0})});return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(F={},F[r.RequestType.EditComment]=i.ApiClientStatus.Success,F)),threads:n.__assign({},e.threads,(D={},D[b.id]=n.__assign({},b,{comments:w}),D))});case r.ActionType.EditCommentError:var C=t.payload,_=C.commentId,E=C.error,y=C.threadId,b=e.threads[y],w=v(b.comments,_,function(e){return n.__assign({},e,{content:e.pending.originalValue,pending:n.__assign({},e.pending,{error:E})})});return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(N={},N[r.RequestType.EditComment]=i.ApiClientStatus.Error,N)),threads:n.__assign({},e.threads,(L={},L[b.id]=n.__assign({},b,{comments:w}),L))});case r.ActionType.DeleteCommentRequest:var A=t.payload,_=A.commentId,y=A.threadId,b=e.threads[y],w=v(b.comments,_,function(e){return n.__assign({},e,{deleted:!0,pending:{action:r.ActionType.DeleteCommentRequest,originalValue:e.deleted,pendingValue:!0}})});return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(U={},U[r.RequestType.DeleteComment]=i.ApiClientStatus.Fetch,U)),threads:n.__assign({},e.threads,(z={},z[b.id]=n.__assign({},b,{comments:w}),z))});case r.ActionType.DeleteCommentSuccess:var T=t.payload,_=T.commentId,y=T.threadId,b=e.threads[y],w=v(b.comments,_,function(e){return n.__assign({},e,{pending:void 0})});return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(H={},H[r.RequestType.DeleteComment]=i.ApiClientStatus.Success,H)),threads:n.__assign({},e.threads,(B={},B[b.id]=n.__assign({},b,{comments:w}),B))});case r.ActionType.DeleteCommentError:var x=t.payload,_=x.commentId,P=x.error,y=x.threadId,b=e.threads[y],w=v(b.comments,_,function(e){return n.__assign({},e,{deleted:e.pending.originalValue,pending:n.__assign({},e.pending,{error:P})})});return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(V={},V[r.RequestType.DeleteComment]=i.ApiClientStatus.Error,V)),threads:n.__assign({},e.threads,(q={},q[b.id]=n.__assign({},b,{comments:w}),q))})}return e;var k,O,I,M,R,F,D,N,L,U,z,H,B,V,q}function g(e,t){return n.__assign({},e,{threads:n.__assign({},e.threads,(o={},o[t.id]=t,o))});var o}function y(e){var t=r.SortType.Chronological;return e!==a.PreviewType.Audio&&e!==a.PreviewType.Video||(t=r.SortType.VideoTimeCode),t}function b(e,t,n){var i=e.threads[t];return g(e,o.assignIn({},i,n))}function w(e,t){void 0===e&&(e=c.INITIAL_STATE);var n=E(e.context,t),o=T(_(e.data,t),t),i=S(e.statuses,t);return n!==e.context||o!==e.data||i!==e.statuses?{context:n,data:o,statuses:i}:e}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),s=n.__importStar(s);var S=d.createStatusReducer(u.ActionTypes),C=d.createActionReducer(),E=d.createReducerFrom(C(u.ActionTypes.SetContext,function(e,t){return t?n.__assign({},t,{status:r.Comments2ContextStatus.Pending}):void 0}),C(u.ActionTypes.SetContextStatus,function(e,t){return n.__assign({},e,{status:t})})),A=d.createActionReducer(),T=d.createReducerFrom(A(u.ActionTypes.CheckOnboardingStatus,function(e,t){return n.__assign({},e,{onboardingInfo:h(t)})}),A(u.ActionTypes.MarkOnboarded,function(e,t,o){return n.__assign({},e,{onboardingInfo:n.__assign({},e.onboardingInfo,(i={},i[o]=r.OnboardingStatus.HasCompletedOnboarding,i))});var i}),A(u.ActionTypes.MarkThreadRead,{Request:function(e,t,n){return b(e,n.threadId,{read:!0,pending:{action:u.ActionTypes.MarkThreadRead.name,originalValue:e.threads[n.threadId].read,pendingValue:!0}})},Success:function(e,t,n){return b(e,n.threadId,{pending:void 0})},Error:function(e,t,o){return b(e,o.threadId,{read:e.threads[o.threadId].pending.originalValue,pending:n.__assign({},e.threads[o.threadId].pending,{error:t})})}}),A(u.ActionTypes.MarkThreadUnread,{Request:function(e,t,n){return b(e,n,{read:!1,pending:{action:u.ActionTypes.MarkThreadUnread.name,originalValue:e.threads[n].read,pendingValue:!1}})},Success:function(e,t,n){return b(e,n,{pending:void 0})},Error:function(e,t,o){return b(e,o,{read:e.threads[o].pending.originalValue,pending:n.__assign({},e.threads[o].pending,{error:t})})}}),A(u.ActionTypes.MarkThreadResolved,{Request:function(e,t,n){return b(e,n,{resolved:!0,pending:{action:u.ActionTypes.MarkThreadResolved.name,originalValue:e.threads[n].resolved,pendingValue:!0}})},Success:function(e,t,n){return b(e,n,{pending:void 0})},Error:function(e,t,o){return b(e,o,{resolved:e.threads[o].pending.originalValue,pending:n.__assign({},e.threads[o].pending,{error:t})})}}),A(u.ActionTypes.MarkThreadUnresolved,{Request:function(e,t,n){return b(e,n,{resolved:!1,pending:{action:u.ActionTypes.MarkThreadUnresolved.name,originalValue:e.threads[n].resolved,pendingValue:!1}})},Success:function(e,t,n){return b(e,n,{pending:void 0})},Error:function(e,t,o){return b(e,o,{resolved:e.threads[o].pending.originalValue,pending:n.__assign({},e.threads[o].pending,{error:t})})}}),A(u.ActionTypes.SetContext,function(e,t){return n.__assign({},e,o.pick(c.INITIAL_STATE.data,"activatedThreadId","authors","cursor","enabledStatus","playerCurrentTime","threads"),{sort:y(t&&t.stream.previewType)})}),A(u.ActionTypes.SetSoftHideCommentsPaneOnboarding,function(e,t){return n.__assign({},e,{softHideCommentsPaneOnboarding:t})}),A(u.ActionTypes.SuppressOnboardingForSession,function(e,t){return n.__assign({},e,{onboardingInfo:n.__assign({},e.onboardingInfo,(o={},o[t]=r.OnboardingStatus.SuppressOnboardingForSession,o))});var o}),A(u.ActionTypes.ToggleShowResolved,function(e){return n.__assign({},e,{showResolved:!e.showResolved})}),A(u.ActionTypes.UpdatePlayerCurrentTime,function(e,t){return n.__assign({},e,{playerCurrentTime:t})}),A(u.ActionTypes.ResetStore,function(e,t){return n.__assign({},c.INITIAL_STATE.data)}),A(u.ActionTypes.RecordEnabledStatus,function(e,t){return n.__assign({},e,{enabledStatus:o.merge({},e.enabledStatus,t)})}));t.reducer=w}),define("modules/clean/react/comments2/data/reducer_helper",["require","exports","tslib","modules/clean/redux/types"],function(e,t,n,o){"use strict";function i(e){for(var t={},i=0,r=Object.keys(e).map(function(t){return e[t]});i<r.length;i++){var a=r[i];"async"===a.type&&(t[a.actionTypes.request]={name:a.name,status:o.ApiClientStatus.Request},t[a.actionTypes.error]={name:a.name,status:o.ApiClientStatus.Error})}return function(e,o){var i=t[o.type];return i&&(e=n.__assign({},e,(r={},r[i.name]=i.status,r))),e;var r}}function r(){function e(e,t){switch(e.type){case"async":return"function"==typeof t?[[e.actionTypes.success,t]]:[t.Error&&[e.actionTypes.error,t.Error],t.Request&&[e.actionTypes.request,t.Request],t.Success&&[e.actionTypes.success,t.Success]].filter(function(e){return e});case"sync":if("function"==typeof t)return[[e.actionType,t]]}throw new Error}return e}function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n={},o=0,i=e;o<i.length;o++)for(var r=i[o],a=0,s=r;a<s.length;a++){var l=s[a],c=l[0],u=l[1];n[c]||(n[c]=[]),n[c].push(u)}return function(e,t){for(var o=n[t.type],i=0,r=o||[];i<r.length;i++){var a=r[i],s=t.meta&&t.meta.args;e=a(e,t.payload||t.error,s)}return e}}Object.defineProperty(t,"__esModule",{value:!0}),t.createStatusReducer=i,t.createActionReducer=r,t.createReducerFrom=a}),define("modules/clean/react/comments2/data/selectors",["require","exports","tslib","external/lodash","modules/clean/redux/selectors","modules/clean/redux/types","modules/constants/comments2","modules/clean/react/comments2/data/types","modules/clean/react/comments2/util","modules/clean/react/file_viewer/data/selectors"],function(e,t,n,o,i,r,a,s,l,c){"use strict";function u(){throw new Error("Missing an onboarding key from switch statement")}function d(e){for(var n=[],o=t.getData(e).onboardingInfo,i=0,r=Object.keys(o);i<r.length;i++){var a=r[i],l=o[a];switch(a){case"initial_video_land":case"video_first_paused":l!==s.OnboardingStatus.NotOnboarded&&l!==s.OnboardingStatus.SuppressOnboardingForSession||n.push(a);break;case"initial_non_annotation_land":break;default:return u()}}return n}function p(e){var n=t.getData(e).onboardingInfo,o=!c.getIsMediaPlaying(e),i=c.getPauseCount(e);return t.getContextStatus(e)===s.Comments2ContextStatus.Comments2&&!l.isComments2Mobile()&&o&&!f(e)&&n.video_first_paused===s.OnboardingStatus.NotOnboarded&&i%a.COMMENTS2_VIDEO_ONBOARDING_FREQUENCY===1&&i<a.COMMENTS2_VIDEO_ONBOARDING_FREQUENCY*a.COMMENTS2_VIDEO_ONBOARDING_COUNT}function f(e){var n=t.getData(e),o=n.onboardingInfo,i=n.softHideCommentsPaneOnboarding;return t.getContextStatus(e)===s.Comments2ContextStatus.Comments2&&!l.isComments2Mobile()&&o.initial_video_land===s.OnboardingStatus.NotOnboarded&&!i}function m(e){return t.getData(e).activatedThreadId}function h(e){return t.getThreads(e).filter(function(e){return!e.resolved&&void 0!==e.annotation})}function v(e){return t.getData(e).enabledStatus.canEnable}function _(e){return t.getData(e).enabledStatus.isEnabled}function g(e){var n=t.getContext(e);return n&&n.stream.id}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.getState=function(e){return i.getStateAtNamespace(e,r.COMMENTS2_NAMESPACE_KEY)};var y=o.memoize(function(e,t){switch(t){case s.SortType.Chronological:return o.sortBy(e,[function(e){return e.timestamp.getTime()}]);case s.SortType.VideoTimeCode:var n=o.groupBy(e,function(e){return e.annotation?"video":"global"}),i=n.video,r=n.global;return o.sortBy(i,[function(e){return e.annotation.time},function(e){return e.timestamp.getTime()}]).concat(o.sortBy(r,[function(e){return e.timestamp.getTime()}]))}});t.getContext=function(e){var n=t.getState(e).context;return n?{stream:n.stream,viewer:n.viewer}:void 0},t.getContextStatus=function(e){var n=t.getState(e).context;return n?n.status:void 0},t.getData=function(e){return t.getState(e).data},t.getSort=function(e){return t.getData(e).sort},t.getThreads=function(e){return y(o.values(t.getData(e).threads)||[],t.getSort(e))},t.getCursor=function(e){return t.getData(e).cursor},t.getOnboardingKeysNotYetMarked=d,t.getShowOnboardingOnVideo=p,t.getShowOnboardingOnCommentsPane=f,t.getActivatedThreadId=m,t.getUnresolvedThreads=h,t.getShowResolved=function(e){return t.getData(e).showResolved},t.getPlayerCurrentTime=function(e){return t.getData(e).playerCurrentTime},t.getStatuses=function(e){return t.getState(e).statuses},t.getCanEnable=v,t.getIsEnabled=_,t.getStreamId=g}),define("modules/clean/react/comments2/data/store",["require","exports","tslib","external/lodash","modules/clean/redux/types","modules/clean/react/comments2/data/reducer","modules/clean/redux/store"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.getStoreForComments2=o.once(function(){return a.getStoreAndRegisterReducers((e={},e[i.COMMENTS2_NAMESPACE_KEY]=r.reducer,e));var e})}),define("modules/clean/react/comments2/data/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.Disabled=0]="Disabled",e[e.Pending=1]="Pending",e[e.Comments1=2]="Comments1",e[e.Comments2=3]="Comments2"})(t.Comments2ContextStatus||(t.Comments2ContextStatus={}));(function(e){e.ListCommentsRequest="COMMENTS2__LIST_COMMENTS_REQUEST",e.ListCommentsSuccess="COMMENTS2__LIST_COMMENTS_RECEIVED",e.ListCommentsError="COMMENTS2__LIST_COMMENTS_ERROR",e.AddCommentRequest="COMMENTS2__ADD_COMMENT_REQUEST",e.AddCommentSuccess="COMMENTS2__ADD_COMMENT_SUCCESS",e.AddCommentError="COMMENTS2__ADD_COMMENT_ERROR",e.EditCommentRequest="COMMENTS2__EDIT_COMMENT_REQUEST",e.EditCommentSuccess="COMMENTS2__EDIT_COMMENT_SUCCESS",e.EditCommentError="COMMENTS2__EDIT_COMMENT_ERROR",e.ActivateThread="COMMENTS2__ACTIVATE_THREAD",e.DeactivateAllThreads="COMMENTS2__DEACTIVATE_ALL_THREADS",e.DeleteCommentRequest="COMMENTS2__DELETE_COMMENT_REQUEST",e.DeleteCommentSuccess="COMMENTS2__DELETE_COMMENT_SUCCESS",e.DeleteCommentError="COMMENTS2__DELETE_COMMENT_ERROR"})(t.ActionType||(t.ActionType={}));(function(e){e[e.Unknown=0]="Unknown",e[e.NotOnboarded=1]="NotOnboarded",e[e.SuppressOnboardingForSession=2]="SuppressOnboardingForSession",e[e.HasCompletedOnboarding=3]="HasCompletedOnboarding"})(t.OnboardingStatus||(t.OnboardingStatus={}));(function(e){e.ListComments="LIST_COMMENTS",e.AddComment="ADD_COMMENT",e.EditComment="EDIT_COMMENT",e.DeleteComment="DELETE_COMMENT"})(t.RequestType||(t.RequestType={}));(function(e){e.Chronological="CHRONOLOGICAL",e.VideoTimeCode="VIDEO_TIME_CODE"})(t.SortType||(t.SortType={}));(function(e){e[e.ThreadActivated=0]="ThreadActivated",e[e.UIButtonClicked=1]="UIButtonClicked"})(t.MarkThreadReadOrigin||(t.MarkThreadReadOrigin={}))}),define("modules/clean/react/comments2/enable_disable_option",["require","exports","tslib","react","modules/clean/react/file_action_button","modules/clean/react/file_viewer/more_dropdown/models","modules/clean/react/file_viewer/more_dropdown/more_option_registry"],function(e,t,n,o,i,r,a){"use strict";function s(e,t){var n=function(){e(t())},s=[new r.MoreOption({className:"comments-options-item__disable",fileActionButtonType:i.FileActionButtonType.ENABLE_COMMENTS,component:function(e){return o.createElement("span",null,e.buttonText)},handler:n})];c=new r.MoreOptionGroup({fileActionButtonGroup:i.FileActionButtonGroup.COMMENTS,options:s}),a.moreOptionRegistry.addOption(c)}function l(){c&&(a.moreOptionRegistry.removeOption(c),c=null)}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var c=null;t.addEnableCommentingToOverflow=s,t.removeEnableCommentingFromOverflow=l}),define("modules/clean/react/comments2/transforms",["require","exports","tslib","external/lodash","modules/core/exception","modules/core/user_i18n"],function(e,t,n,o,i,r){"use strict";function a(e,t){return e[".tag"]===t}function s(e){if(a(e,"video"))return{type:"video",time:e.time};if(a(e,"audio"))return{type:"audio",time:e.time};if(a(e,"document"))return{type:"document",regionType:e.region_type[".tag"],label:e.label,page:e.page,regions:e.regions};if(a(e,"image"))return{type:"image",region:e.region,label:e.label};throw new Error("Attempted to convert an annotation type that does not yet exist.")}function l(e,t,n){return{author:n[e.author_id],content:{metadata:v(e.metadata),text:e.content},deleted:e.deleted,id:e.id,threadId:t,timestamp:new Date(e.timestamp),userPermissions:{canDelete:e.permissions.can_delete,canEdit:e.permissions.can_edit}}}function c(e){return{id:e.dbx_account_id,email:e.email,name:{display:e.name,initials:r.getInitials(e.name),public:r.getShortName(e.name)},photoUrl:e.photo_url||e.avatar_url}}function u(e){return{id:e.account_id,name:{display:e.display_name,initials:r.getInitials(e.display_name),public:r.getShortName(e.display_name)},photoUrl:e.photo_circle_url}}function d(e){var t=e.format[".tag"];if("other"===t)throw new Error('"other" is not a valid format block');return{location:e.location,style:t,type:"style"}}function p(e){return"video"===e.type?{".tag":"video",time:e.time}:"audio"===e.type?{".tag":"audio",time:e.time}:"document"===e.type?{".tag":"document",page:e.page,regions:e.regions,region_type:{".tag":e.regionType}}:{".tag":"image",region:e.region}}function f(e){var t=e.annotation,n=e.content,o=e.stream;return{annotation_data:t?p(t):void 0,content:n.text,metadata:m(n.metadata),revision:g(o)}}function m(e){return{formatting:e.filter(function(e){return"style"===e.type}).map(function(e){return{format:{".tag":e.style},location:e.location}}),mentions:e.filter(function(e){return"mention"===e.type}).map(function(e){return{user:{type:{".tag":e.user.type},identifier:e.user.identifier},location:e.location}})}}function h(e){var t=e.user.type[".tag"];if("other"===t)throw new Error('"other" is not a valid user type');var n={identifier:e.user.identifier,type:t};return{location:e.location,type:"mention",user:n}}function v(e){var t=e.formatting.map(d).concat(e.mentions.map(h));if(e.sticker){var n=_(e.sticker);n?t.push(n):i.reportStack("received comment sticker metadata without the sticker url filled in. Dropping sticker metadata from this comment")}return t}function _(e){if(e.url)return{type:"sticker",id:e.id,url:e.url}}function g(e){return"file"===e.type?{ns_id:e.ns_id,sjid:e.sjid}:void 0}function y(e,t){var n=e.comments.map(function(n){return l(n,e.id,t)});return{annotation:e.annotation_data?s(e.annotation_data):void 0,comments:n,id:e.id,read:e.read,resolved:e.resolved,timestamp:n[0].timestamp}}function b(e,t){var n=e.map(function(e){return y(e,t)});return o.keyBy(n,"id")}function w(e){return{id:e.id,name:{display:e.display_name,initials:e.initials,public:e.public_name},photoUrl:e.photo_url}}function S(e){var t=e.map(w);return o.keyBy(t,"id")}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),i=n.__importStar(i),r=n.__importStar(r),t.annotationToIAnnotation=s,t.commentToIComment=l,t.contactToIMentionUser=c,t.dbxUserToIUser=u,t.iAnnotationToAnnotation=p,t.iCommentContentToUserSubmittedComment=f,t.iCommentMetadataToUserSubmittedMetadata=m,t.metadataToIMetadata=v,t.streamToRevision=g,t.threadToIThread=y,t.threadsToIThreadMap=b,t.userToIUser=w,t.usersToIUserMap=S}),define("modules/clean/react/comments2/util",["require","exports","tslib","modules/core/browser","modules/clean/previews/constants","modules/constants/comments2","modules/core/cookies"],function(e,t,n,o,i,r,a){"use strict";function s(e,t){var n=e.PERSONAL,o=e.WORK;return e.SESSION||null!=t&&("personal"===t.role?n:o)}function l(e,t){return void 0!==e&&void 0!==t?e.id===t.id:e===t}function c(e,t){return void 0!==e&&void 0!==t?e.type===t.type&&e.id===t.id:e===t}function u(e,t){return void 0!==e&&void 0!==t?c(e.stream,t.stream)&&l(e.viewer,t.viewer):e===t}function d(e){var t=e.previewType,n=e.viewer;return s(r.COMMENTS2_FRONTEND,n)&&(t===i.PreviewType.Video||t===i.PreviewType.Audio||t!==i.PreviewType.Doc&&t!==i.PreviewType.Photo&&s(r.COMMENTS2_NON_ANNOTATION,n))}function p(e){var t=e.previewType,n=e.viewer;return f()&&d({previewType:t,viewer:n})}function f(){return o.is_mobile_or_tablet()}function m(e){return s(r.COMMENTS2_READONLY_EDITOR,e)}function h(e){return s(r.COMMENTS2_CAN_ENABLE_DISABLE,e)}function v(e){return s(r.COMMENTS2_IMAGE_ANNOTATIONS,e)}function _(e){return void 0!==e&&("audio"===e.type||"video"===e.type)}function g(){return!r.COMMENTS2_DISABLE_BOLT}function y(){return null!==a.Cookies.read("comments2_onboarding_dismissed")}function b(){return a.Cookies.create("comments2_onboarding_dismissed","marked",30)}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.isUserSame=l,t.isStreamSame=c,t.isContextSame=u,t.shouldUseComments2=d,t.shouldUseComments2MobileWeb=p,t.isComments2Mobile=f,t.isComments2ReadonlyEditor=m,t.canComments2EnableDisable=h,t.isComments2ImageAnnotationsEnabled=v,t.isTimecodeAnnotation=_,t.useBolt=g;t.hasBrowserDismissedOnboardingPopup=y,t.markBrowserHasDismissedOnboardingPopup=b}),define("modules/clean/react/css_timing",["require","exports","modules/clean/react/css","modules/clean/js_client_stopwatch"],function(e,t,n,o){"use strict";function i(e,t,i){void 0===i&&(i=[]);var r=e.displayName||"UnnamedComponent",a=function(){return o.JSStopwatch.startSpan("requireCssWithComponent_"+r)},s=function(){return o.JSStopwatch.endSpan("requireCssWithComponent_"+r)};return n.requireCssWithComponent(e,t,i,{onWillLoadCss:a,onCssResponse:s})}Object.defineProperty(t,"__esModule",{value:!0}),t.requireCssWithComponent=i}),define("modules/clean/react/file_action_button",["require","exports","tslib","external/react","external/prop-types","modules/clean/react/bubble_menu","modules/clean/react/file_action_button_type","modules/clean/react/file_action_button_group"],function(e,t,n,o,i,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),i=n.__importStar(i),t.FileActionButtonType=a.FileActionButtonType,t.FileActionButtonGroup=s.FileActionButtonGroup;var l=o.createElement,c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return l(r.BubbleMenuItem,{onClick:this.props.callback,closeFunc:this.props.closeFunc,className:this.props.className},a.getFileActionButtonText(this.props.type))},t.displayName="FileActionButton",t.propTypes={type:i.string.isRequired,callback:i.func.isRequired,closeFunc:i.func,className:i.string},t.defaultProps={closeFunc:null},t})(o.Component);t.FileActionButton=c}),define("modules/clean/react/file_action_button_group",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.COMMENTS="COMMENTS",e.SHOWCASE_UPSELL="SHOWCASE_UPSELL"})(t.FileActionButtonGroup||(t.FileActionButtonGroup={}))}),define("modules/clean/react/file_action_button_type",["require","exports","modules/core/i18n"],function(e,t,n){"use strict";function o(e){return e&&r[e]?r[e]:null}Object.defineProperty(t,"__esModule",{value:!0}),t.FileActionButtonType={COMMENT:"COMMENT",COPY:"COPY",DELETE:"DELETE",DOWNLOAD:"DOWNLOAD",MOVE:"MOVE",OPEN:"OPEN",PREVIOUS_VERSIONS:"PREVIOUS_VERSIONS",REMOVE_LINK:"REMOVE_LINK",RENAME:"RENAME",SHARE:"SHARE",ENABLE_COMMENTS:"ENABLE_COMMENTS",DISABLE_COMMENTS:"DISABLE_COMMENTS",SHOW_RESOLVED_COMMENTS:"SHOW_RESOLVED_COMMENTS",HIDE_RESOLVED_COMMENTS:"HIDE_RESOLVED_COMMENTS",SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE",SHOWCASE_UPSELL:"SHOWCASE_UPSELL"};var i=function(){return{comment:"BUTTON"}},r=(a={},a[t.FileActionButtonType.COMMENT]=n._("Comment",i()),a[t.FileActionButtonType.COPY]=n._("Copy…",i()),a[t.FileActionButtonType.DELETE]=n._("Delete…",i()),a[t.FileActionButtonType.DOWNLOAD]=n._("Download",i()),a[t.FileActionButtonType.MOVE]=n._("Move…",i()),a[t.FileActionButtonType.OPEN]=n._("Open",i()),
a[t.FileActionButtonType.PREVIOUS_VERSIONS]=n._("Version history",i()),a[t.FileActionButtonType.REMOVE_LINK]=n._("Remove link",i()),a[t.FileActionButtonType.RENAME]=n._("Rename",i()),a[t.FileActionButtonType.SHARE]=n._("Share",i()),a[t.FileActionButtonType.ENABLE_COMMENTS]=n._("Enable comments",i()),a[t.FileActionButtonType.DISABLE_COMMENTS]=n._("Disable comments",i()),a[t.FileActionButtonType.SHOW_RESOLVED_COMMENTS]=n._("Show resolved comments",i()),a[t.FileActionButtonType.HIDE_RESOLVED_COMMENTS]=n._("Hide resolved comments",i()),a[t.FileActionButtonType.SUBSCRIBE]=n._("Subscribe to notifications",i()),a[t.FileActionButtonType.UNSUBSCRIBE]=n._("Unsubscribe from notifications",i()),a[t.FileActionButtonType.SHOWCASE_UPSELL]=n._("Share in Showcase",i()),a);t.getFileActionButtonText=o;var a}),define("modules/clean/react/file_comments/logger",["require","exports","tslib","modules/clean/ajax","modules/clean/annotations/annotation","modules/core/exception"],function(e,t,n,o,i,r){"use strict";return o=n.__importStar(o),r=n.__importStar(r),new((function(){function e(){this.disabled=!1}return e.prototype.set_disabled=function(e){return this.disabled=e},e.prototype.log_event=function(e,t,n,i,a,s,l,c,u){if(void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=null),!this.disabled)return r.assert(e,"event_type not provided"),r.assert(t,"file_activity_key not provided"),o.SilentBackgroundRequest({url:"/file_activity/client_log",type:"POST",data:{event_type:e,file_activity_key:t,comment_activity_key:n,client_origin_type:i,activity_context:s,annotation_type:l,annotation_subtype:c,annotation_page:u},subject_user:a})},e.prototype.log_annotation_event=function(e,t,n,o,r,a){void 0===a&&(a=null);var s,l,c;if(null!=a){var u=i.Annotation.createAnnotationFromDict(a);c=u.type,l=u.subtype,s=u.getFirstPdfPage()}return this.log_event(e,t,n,null,o,r,c,l,s)},e})())}),define("modules/clean/react/file_sidebar/base_comments_tab",["require","exports","tslib","external/react","external/react-redux","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/store"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),r=n.__importStar(r);var s=function(e){var t=e.currentFile,n=t.file_id,o=t.ns_id,i=t.preview_type,r=t.sjid,a=e.sharedLinkInfo;return{id:n,linkUrl:a?a.url:void 0,ns_id:o,sjid:r,type:"file",previewType:i||void 0}},l=(function(e){function t(t){var n=e.call(this,t)||this;return n.clearContext=function(){n.store.dispatch(r.setFileContext())},n.setContext=function(e){n.store.dispatch(r.setFileContext({stream:s(e),viewer:e.user}))},n.store=a.getStoreForComments2(),n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.setContext(this.props)},t.prototype.componentWillUnmount=function(){this.clearContext()},t.prototype.componentWillUpdate=function(e){this.setContext(e)},t.prototype.render=function(){return this.store?o.createElement(i.Provider,{store:this.store},this.props.content()):null},t})(o.Component);t.BaseCommentsTab=l}),define("modules/clean/react/file_sidebar/constants",["require","exports","tslib","external/prop-types"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.STORE_KEY="fileSidebarStore",t.STORE_SHAPE=o.shape({dispatch:o.func.isRequired,getState:o.func.isRequired,subscribe:o.func.isRequired})}),define("modules/clean/react/file_sidebar/file_sidebar",["require","exports","tslib","external/react","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.FileSidebar=i.Loadable({loader:function(){return r.waitForTTI().then(function(){return new Promise(function(t,n){e(["modules/clean/react/file_sidebar/file_sidebar_component"],t,n)}).then(n.__importStar).then(function(e){return e.FileSidebar})})},loading:o.createElement("div",{className:"file-sidebar"})})}),define("modules/clean/react/file_sidebar/file_sidebar_connect",["require","exports","tslib","external/react","external/react-redux","modules/clean/react/file_sidebar/constants","hoist-non-react-statics"],function(e,t,n,o,i,r,a){"use strict";function s(e,t){var s=t?i.connect(e,t):i.connect(e);return function(e){var t=s(e),i=(function(e){function i(t,n){var o=e.call(this,t,n)||this;return o.state={store:n.fileSidebarStore},o}return n.__extends(i,e),i.prototype.componentWillReceiveProps=function(e,t){this.setState({store:t.fileSidebarStore})},i.prototype.render=function(){if(!this.state.store)return null;var e=n.__assign({},this.props,{store:this.state.store});return o.createElement(t,n.__assign({},e))},i.displayName="FileSidebar"+t.displayName,i.WrappedComponent=t,i.contextTypes=(l={},l[r.STORE_KEY]=r.STORE_SHAPE,l),i})(o.Component);return a.default(i,t);var l}}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),i=n.__importStar(i),a=n.__importDefault(a),t.fileSidebarConnect=s}),define("modules/clean/react/file_sidebar/file_sidebar_logger",["require","exports","tslib","modules/clean/ajax","modules/clean/viewer","modules/clean/api_v2/client","modules/clean/react/file_viewer/models"],function(e,t,n,o,i,r,a){"use strict";function s(e,t){var n=a.FileViewerSession.currentSession,i=a.FilePreviewSession.currentSession;if(i&&n){var r={event_name:e,file_viewer_session_id:n.id,file_preview_session_id:i.id,file_ns_id:i.file.ns_id,file_sjid:i.file.sjid,extra:JSON.stringify(t)};o.SilentBackgroundRequest({url:"/log/file_sidebar",data:r})}}function l(e){s("sidebar_tab_selected",e)}function c(e){s("sidebar_opened",e)}function u(e){s("sidebar_closed",e)}function d(e){s("file_view_activity_expanded",e)}function p(e,t){m({event:"get_stream_timing",int_value:e,bool_value:t})}function f(e){m({event:"load_sidebar_timing",int_value:e})}function m(e){var t=i.Viewer.get_viewer().get_user_ids(),n=t.length?t[0]:null,o=new r.ApiV2Client;n?o.ns("file_activity_stream").rpc("log_event",e,{subjectUserId:n}):o.ns("file_activity_stream").rpc("logged_out/log_event",e,{subjectUserId:n})}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.logSidebarTabSelected=l,t.logSidebarOpened=c,t.logSidebarClosed=u,t.logFileViewActivityCardExpanded=d,t.logGetActivityStreamTiming=p,t.logLoadSidebarTiming=f}),define("modules/clean/react/file_sidebar/file_sidebar_provider",["require","exports","tslib","external/react","external/prop-types","modules/clean/react/file_sidebar/constants","modules/constants/file_activity_stream"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),i=n.__importStar(i),a=n.__importStar(a);var s=(function(t){function s(n){var o=t.call(this,n)||this,i=e.defined("modules/clean/react/file_sidebar/store/instance"),r=i?e("modules/clean/react/file_sidebar/store/instance").store:void 0;return o.state={loaded:i,store:r},o}return n.__extends(s,t),s.prototype.getChildContext=function(){return e={},e[r.STORE_KEY]=this.state.store,e;var e},s.prototype.componentWillMount=function(){var t=this;a.IS_ON&&!this.state.loaded&&new Promise(function(t,n){e(["modules/clean/react/file_sidebar/store/instance"],t,n)}).then(n.__importStar).then(function(e){var n=e.store;t.setState({loaded:!0,store:n})})},s.prototype.componentWillUnmount=function(){var e=this.state.store;e&&e.dispatch({type:"::RESET"})},s.prototype.render=function(){return o.Children.only(this.props.children)},s.propTypes={children:i.element.isRequired},s.childContextTypes=(l={},l[r.STORE_KEY]=r.STORE_SHAPE,l),s})(o.Component);t.FileSidebarProvider=s;var l}),define("modules/clean/react/file_sidebar/store/app/reducer",["require","exports","tslib"],function(e,t,n){"use strict";function o(e,o){switch(void 0===e&&(e=t.INITIAL_STATE),o.type){case"APP_SET_STATE":var i=o.hideComments,r=o.hidePageChrome;return n.__assign({},e,{hideComments:i,hidePageChrome:r})}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.INITIAL_STATE={hideComments:!1,hidePageChrome:!1},t.reducer=o}),define("modules/clean/react/file_sidebar/store/comments_adapter",["require","exports","tslib","modules/clean/comments/store"],function(e,t,n,o){"use strict";function i(){var e=o.default.state;return{enabled:o.default.isCommentingEnabled(),canEnable:o.default.canEnableComments(),commentCount:e.activity&&e.activity.comment_activities&&e.activity.comment_activities.length||0,initialized:o.default.isStoreInitialized(),ready:o.default.isFileActivityReady(),unreadCommentCount:o.default.unreadCommentCount()}}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),t.getCommentingState=i}),define("modules/clean/react/file_sidebar/store/file_activity/activity_sorted_set",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/sorted_set"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(n){return void 0===n&&(n=[]),e.call(this,n,t.compare,t.equals)||this}return n.__extends(t,e),t.compare=function(e,t){return e.id===t.id?0:t.timestamp.getTime()-e.timestamp.getTime()},t.equals=function(e,t){return e.id===t.id},t})(o.SortedSet);t.ActivitySortedSet=i}),define("modules/clean/react/file_sidebar/store/file_activity/reducer",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/activity_sorted_set","modules/constants/file_activity_stream"],function(e,t,n,o,i){"use strict";function r(e){return e.filter(function(e){switch(e.type){case"file_settings_change":return i.IS_FILE_SETTINGS_CHANGE_CARD_ON;case"shared_link_change":return i.IS_SHARED_LINK_CHANGE_CARD_ON;case"view":return i.IS_VIEW_CARD_ON;default:return!0}})}function a(e){return r(e).map(function(e){return e.isGroup?n.__assign({},e,{groupActivities:r(e.groupActivities)}):e})}function s(e){return e.map(function(e){return e.isGroup&&1===e.groupActivities.length?e.groupActivities[0]:e})}function l(e,i){switch(void 0===e&&(e=t.INITIAL_STATE),i.type){case"FILE_ACTIVITY|RESET":return n.__assign({},t.INITIAL_STATE,{feedback:e.feedback});case"FILE_ACTIVITY|RESET_FILE_STATE":return n.__assign({},e,{activities:t.INITIAL_STATE.activities});case"FILE_ACTIVITY|LOADING_START":return n.__assign({},e,{activities:n.__assign({},e.activities,{error:void 0,loading:!0}),userId:i.userId,file:i.file});case"FILE_ACTIVITY|LOADING_END":return n.__assign({},e,{activities:n.__assign({},e.activities,{loaded:!0,loading:!1}),feedback:n.__assign({},e.feedback,{shouldShow:e.activities.value.length>0&&!e.feedback.responded&&Math.random()<.1})});case"FILE_ACTIVITY|RECEIVE_FILE_ACTIVITY":var r=a(i.activities);r=s(r);var l=i.enabled,c=l?new o.ActivitySortedSet(e.activities.value.concat(r)).toArray():[];return n.__assign({},e,{activities:n.__assign({},e.activities,{value:c}),enabled:i.enabled});case"FILE_ACTIVITY|RECEIVE_STREAM_ERROR":return n.__assign({},e,{activities:n.__assign({},e.activities,{error:i.error})});case"FILE_ACTIVITY|FEEDBACK_SENT":return n.__assign({},e,{feedback:n.__assign({},e.feedback,{responded:!0})});case"FILE_ACTIVITY|HIDE_FEEDBACK":return n.__assign({},e,{feedback:n.__assign({},e.feedback,{shouldShow:!1})})}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.INITIAL_STATE={activities:{error:void 0,loaded:!1,loading:!1,value:[]},enabled:!1,userId:-1,feedback:{shouldShow:!1,responded:i.FEEDBACK_RECEIVED}},t.filterActivitiesBasedOnStormcrows=r,t.filterGroupActivitiesBasedOnStormcrows=a,t.ungroupSingleActivityGroups=s,t.reducer=l}),define("modules/clean/react/file_sidebar/store/file_activity/selectors",["require","exports"],function(e,t){"use strict";function n(e){return e.fileActivity}function o(e){return n(e).activities.value}function i(e){return n(e).activities}function r(e){return n(e).feedback}function a(e){return r(e).responded}function s(e){return o(e).length}function l(e){return n(e).file}function c(e){return n(e).userId}function u(e){return{file:l(e),userId:c(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.getState=n,t.getActivities=o,t.getActivitiesMetadata=i,t.getFeedbackState=r,t.didRespondToFeedback=a,t.getVisibleActivityCount=s,t.getFile=l,t.getUserId=c,t.getContext=u}),define("modules/clean/react/file_sidebar/store/file_activity/sorted_set",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e,t,n){void 0===e&&(e=[]),this.items=[],this.compare=t,this.equals=n,this.add(e)}return e.prototype.add=function(e){var t=this;Array.isArray(e)||(e=[e]);var n=this.items.concat(e);return n.sort(this.compare),this.items=n.filter(function(e,n,o){return 0===n||!t.equals(e,o[n-1])}),this},e.prototype.toArray=function(){return Array.prototype.slice.call(this.items)},e})();t.SortedSet=n}),define("modules/clean/react/file_sidebar/store/instance",["require","exports","tslib","external/redux","modules/clean/react/file_sidebar/store/app/reducer","modules/clean/react/file_sidebar/store/file_activity/reducer","modules/clean/react/file_sidebar/store/sidebar/reducer","modules/clean/comments/events","modules/clean/comments/store","modules/clean/react/file_sidebar/store/sidebar/actions","modules/clean/react/file_sidebar/store/comments_adapter","modules/clean/react/file_sidebar/store/middleware/thunk","modules/clean/react/file_sidebar/store/middleware/reactor","modules/clean/react/file_sidebar/store/sidebar/reactors"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f){"use strict";function m(e,t){return"::RESET"===t.type&&(e=void 0),_(e,t)}function h(){return o.createStore(m,o.applyMiddleware(d.thunk(),p.reactor(f.reactors)))}function v(){t.store.dispatch(c.setCommentingState(u.getCommentingState()))}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),l=n.__importDefault(l),c=n.__importStar(c);var _=o.combineReducers({app:i.reducer,fileActivity:r.reducer,sidebar:a.reducer});t.store=h(),l.default.listen(v),v(),s.CommentsEvents.on("reveal-comment-in-pane",function(){t.store.dispatch(c.open("annotation_select")),t.store.dispatch(c.selectTab("comments"))})}),define("modules/clean/react/file_sidebar/store/middleware/reactor",["require","exports","modules/clean/shallow_equal"],function(e,t,n){"use strict";function o(e){return"function"==typeof e.changes}function i(e){return"function"==typeof e.changesIn}function r(e){return"function"==typeof e.changesFrom&&"function"==typeof e.changesTo}function a(){function e(e,t,n){void 0===n&&(n=s);var l;if(o(e))l=function(t,n){return{changed:e.changes(t,n)}};else if(i(e))l=function(t,o){var i=e.changesIn(t),r=e.changesIn(o);return{prevValue:i,nextValue:r,changed:!n(i,r)}};else{if(!r(e))throw new Error;l=function(t,n){var o=e.changesFrom(t),i=e.changesTo(n);return{changed:o&&i}}}a.push({checkForChange:l,onChange:t})}for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var a=[],l=0,c=t;l<c.length;l++){(0,c[l])(e)}return function(e){var t=e.getState;return function(e){return function(n){for(var o=t(),i=e(n),r=t(),s=0,l=a;s<l.length;s++){var c=l[s],u=c.checkForChange(o,r),d=u.prevValue,p=u.nextValue;u.changed&&c.onChange({nextValue:p,prevValue:d,nextState:r,prevState:o})}return i}}}}Object.defineProperty(t,"__esModule",{value:!0});var s=function(e,t){return n.shallowEqual(e,t)};t.reactor=a}),define("modules/clean/react/file_sidebar/store/middleware/thunk",["require","exports"],function(e,t){"use strict";function n(){return function(e){var t=e.dispatch,n=e.getState;return function(e){return function(o){return"function"==typeof o?o(t,n):e(o)}}}}Object.defineProperty(t,"__esModule",{value:!0}),t.thunk=n}),define("modules/clean/react/file_sidebar/store/sidebar/actions",["require","exports","tslib","modules/clean/react/file_sidebar/store/sidebar/helpers","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/store/file_activity/selectors","modules/clean/file_activity/api","modules/clean/react/file_sidebar/store/comments_adapter","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/types","modules/clean/comments/store"],function(e,t,n,o,i,r,a,s,l,c,u){"use strict";function d(){return{type:c.ActionType.SidebarReset}}function p(e){return function(n,o){var r=o(),a=i.getSidebarContext(r).user;i.getSidebarState(r).open||t.LegacyCommentsStoreAction.setStickyOpen(!0,a?a.id:null),n({type:c.ActionType.SidebarOpen,payload:{reason:e}})}}function f(){return function(e,n){var o=n(),a=i.getSidebarContext(o).user;i.getSidebarState(o).open&&(t.LegacyCommentsStoreAction.setStickyOpen(!1,a?a.id:null),e({type:c.ActionType.SidebarClose}),l.logSidebarClosed({num_comments:i.getTabState(o,"comments").extra.commentCount,num_events:r.getVisibleActivityCount(o),viewing_user_id:a?a.id:null}))}}function m(){return function(e,t){var n=t();e(i.getSidebarState(n).open?f():p("toggle_button"))}}function h(){return function(e){e(p("toggle_button_after_transition"))}}function v(e){return{type:c.ActionType.SidebarSelectTab,payload:{tabName:e}}}function _(e){return function(t,n){var r=n(),a=i.getSidebarContext(r);o.isContextChanged(a,e)&&(t({type:c.ActionType.SidebarOpenFile,payload:e}),t(b(s.getCommentingState())))}}function g(){return{type:c.ActionType.SidebarSetComments2DisabledState}}function y(e){return{type:c.ActionType.SidebarSetComments2ShownState,payload:e}}function b(e){return{type:c.ActionType.SidebarSetCommentState,payload:e}}function w(e,t){t?a.setCommentingPaneVisibility({actorId:t,shouldShow:e}):a.setSessionCommentingPaneVisibility({shouldShow:e})}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),i=n.__importStar(i),r=n.__importStar(r),a=n.__importStar(a),u=n.__importDefault(u),t.reset=d,t.open=p,t.close=f,t.toggle=m,t.completeToggleOpen=h,t.selectTab=v,t.openFile=_,t.setComments2DisabledState=g,t.setComments2ShownState=y,t.setCommentingState=b,t.LegacyCommentsStoreAction={showComments:function(){setTimeout(function(){u.default.onShowComments()})},hideComments:function(){setTimeout(function(){u.default.onHideComments()})},setStickyOpen:function(e,t){w(e,t)}}}),define("modules/clean/react/file_sidebar/store/sidebar/helpers",["require","exports","modules/clean/file_store/utils"],function(e,t,n){"use strict";function o(e,t){return!e&&!t||!!e&&!!t&&n.areFilesEqual(e,t)}function i(e,t){return!e&&!t||!!e&&!!t&&e.id===t.id}function r(e,t){return!o(e.file,t.file)||!i(e.user,t.user)}Object.defineProperty(t,"__esModule",{value:!0}),t.isFileSame=o,t.isUserSame=i,t.isContextChanged=r}),define("modules/clean/react/file_sidebar/store/sidebar/reactors",["require","exports","tslib","external/lodash","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/store/file_activity/selectors"],function(e,t,n,o,i,r,a){"use strict";function s(e){var t=r.getSidebarState(e),n=t.open,o=t.ready;return n&&o}function l(e){return!s(e)}function c(e){return o.values(r.getTabsState(e)).every(function(e){return e.ready})}function u(e){return!c(e)}function d(e){var t=r.getSidebarContext(e);return(t.file?t.file.file_id:-1)+":"+(t.user?t.user.id:-1)}function p(e){var t=r.getSidebarContext(e).user;i.logSidebarOpened({reason:r.getOpenReason(e),num_comments:r.getTabState(e,"comments").extra.commentCount,num_events:a.getVisibleActivityCount(e),viewing_user_id:t?t.id:null})}function f(e){e({changesFrom:l,changesTo:s},function(e){p(e.nextState)}),e({changes:function(e,t){if(s(e)&&s(t)){var n=t.sidebar.tabs,o=e.sidebar.tabs;return!(o.activity.ready&&o.comments.ready)&&n.activity.ready&&n.comments.ready}return!1}},function(e){p(e.nextState)});var t=-1,n="";e({changes:function(e,t){return d(e)!==d(t)}},function(e){var o=e.nextState;t=Date.now(),n=d(o)}),e({changesFrom:u,changesTo:c},function(e){n===d(e.prevState)&&i.logLoadSidebarTiming(Date.now()-t)})}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),r=n.__importStar(r),a=n.__importStar(a),t.reactors=f}),define("modules/clean/react/file_sidebar/store/sidebar/reducer",["require","exports","tslib","modules/constants/comments_panel","modules/clean/react/file_sidebar/store/sidebar/types","modules/clean/react/file_sidebar/store/sidebar/actions"],function(e,t,n,o,i,r){"use strict";function a(e,o){switch(o.type){case i.ActionType.SidebarReset:return n.__assign({},t.INITIAL_STATE,{open:e.open});case i.ActionType.SidebarOpen:return n.__assign({},e,{open:!0,openReason:o.payload.reason});case i.ActionType.SidebarClose:return n.__assign({},e,{open:!1,openReason:void 0});case i.ActionType.SidebarSelectTab:return n.__assign({},e,{activeTab:o.payload.tabName});case i.ActionType.SidebarOpenFile:var r=o.payload,a=r.file,s=r.isVersionHistoryMode,l=r.user;return n.__assign({},e,{openReason:void 0,context:{file:a,isVersionHistoryMode:s,user:l},tabs:{activity:{ready:!l,show:s===!1&&e.tabs.activity.show,count:0},comments:{ready:!1,show:!1,count:0,extra:{commentCount:0}}}});case"FILE_ACTIVITY|LOADING_END":return n.__assign({},e,{tabs:n.__assign({},e.tabs,{activity:{ready:!0,show:e.context.isVersionHistoryMode===!1&&o.state.enabled,count:0}})});case i.ActionType.SidebarSetComments2DisabledState:return n.__assign({},e,{tabs:n.__assign({},e.tabs,{comments:{ready:!0,show:!1,count:0,extra:{commentCount:0,version:2}}})});case i.ActionType.SidebarSetComments2ShownState:return n.__assign({},e,{activeTab:"comments",tabs:n.__assign({},e.tabs,{comments:{ready:!0,show:!0,count:0,extra:{commentCount:o.payload.commentCount,version:2}}})});case i.ActionType.SidebarSetCommentState:if(e.tabs.comments.extra&&2===e.tabs.comments.extra.version)return e;var c=o.payload,u=c.enabled,d=c.canEnable,p=c.commentCount,f=c.initialized,m=c.ready,h=c.unreadCommentCount,v=c.version,_=e.tabs.comments.ready,g=e.tabs.comments.show,y=_||f&&m,b=!y||!_&&y&&(u||d)||g;return n.__assign({},e,{tabs:n.__assign({},e.tabs,{comments:{ready:y,show:b,count:h,extra:{commentCount:p,version:v}}})})}return e}function s(e,n){void 0===e&&(e=t.INITIAL_STATE);var o=a(e,n);return o.ready=e.ready||o.tabs.activity.ready&&o.tabs.comments.ready,!e.ready&&o.ready&&(o.tabs.comments.show&&!o.tabs.activity.show?o.activeTab="comments":!o.tabs.comments.show&&o.tabs.activity.show&&(o.activeTab="activity"),o.tabs.comments.show&&o.tabs.comments.count>0&&(o.open=!0,o.openReason=o.openReason||"unread_comments",o.activeTab="comments"),o.tabs.comments.show&&o.tabs.comments.extra&&2===o.tabs.comments.extra.version&&o.tabs.comments.extra.commentCount>0&&(o.open=!0,o.openReason=o.openReason||"comments2_unresolved_threads",o.activeTab="comments"),"comments"===o.activeTab?r.LegacyCommentsStoreAction.showComments():r.LegacyCommentsStoreAction.hideComments()),o.ready&&o.open&&!o.openReason&&(o.openReason="sticky_state"),!o.open||"comments"!==o.activeTab||"toggle_button"===o.openReason||e.open&&"toggle_button"!==e.openReason&&"comments"===e.activeTab?!e.open||"comments"!==e.activeTab||o.open&&"comments"===o.activeTab||r.LegacyCommentsStoreAction.hideComments():r.LegacyCommentsStoreAction.showComments(),o}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var l=o.SHOW_COMMENTS_PANEL||!1;t.INITIAL_STATE={activeTab:"comments",open:l,openReason:void 0,ready:!1,context:{file:void 0,isVersionHistoryMode:void 0,user:void 0},tabs:{activity:{ready:!1,show:!1,count:0},comments:{ready:!1,show:!1,count:0,extra:{commentCount:0}}}},t.reducer=s}),define("modules/clean/react/file_sidebar/store/sidebar/selectors",["require","exports"],function(e,t){"use strict";function n(e){return e.sidebar}function o(e){var t=n(e);return{activeTab:t.activeTab,open:t.open,ready:t.ready}}function i(e){return n(e).openReason}function r(e){return n(e).context}function a(e){return n(e).tabs}function s(e,t){return a(e)[t]}Object.defineProperty(t,"__esModule",{value:!0}),t.getState=n,t.getSidebarState=o,t.getOpenReason=i,t.getSidebarContext=r,t.getTabsState=a,t.getTabState=s}),define("modules/clean/react/file_sidebar/store/sidebar/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.SidebarOpen="SIDEBAR|OPEN",e.SidebarReset="SIDEBAR|RESET",e.SidebarClose="SIDEBAR|CLOSE",e.SidebarSelectTab="SIDEBAR|SELECT_TAB",e.SidebarOpenFile="SIDEBAR|OPEN_FILE",e.SidebarToggle="SIDEBAR|TOGGLE",e.SidebarSetCommentState="SIDEBAR|SET_COMMENTING_STATE",e.SidebarSetComments2DisabledState="SIDEBAR|SET_COMMENTS2_DISABLED_STATE",e.SidebarSetComments2ShownState="SIDEBAR|SET_COMMENTS2_SHOWN_STATE"})(t.ActionType||(t.ActionType={}))}),define("modules/clean/react/file_viewer/actionable",["require","exports","tslib","external/react","modules/clean/file_store/utils","modules/clean/react/file_viewer/open_button/open_button","modules/clean/react/open_in_app/button","modules/clean/react/share_download/button"],function(e,t,n,o,i,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.Actionable=function(e){var t,n=e.allowOpenInApp,l=e.variant,c=e.location,u=e.user,d=e.userActionContext;return i.isSharedFile(e.file)?(t=e.file,n&&t.open_in_app_data?o.createElement(a.OpenInAppButton,{urls:t.open_in_app_data,userActionContext:d}):o.createElement(s.ShareDownloadButton,{copyable:t,importance:l,location:c,sharedLinkInfo:e.sharedLinkInfo,shareToken:e.shareToken,sharePermission:e.sharePermission,user:u})):(t=e.file,o.createElement(r.OpenButton,{file:t,user:u,justifyRight:!1,location:c,buttonVariant:l,sizeClass:e.sizeClass}))}}),define("modules/clean/react/file_viewer/app_download_interstitial/file_preview_app_download_interstitial",["require","exports","tslib","external/react","modules/clean/analytics","modules/clean/react/file_viewer/constants","modules/clean/file_store/utils","modules/clean/react/file_viewer/models","modules/clean/react/previews/constants","modules/clean/web_timing_logger","modules/clean/react/file_viewer/app_download_interstitial/app_download_interstitial"],function(e,t,n,o,i,r,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onContinue=function(){t.log(r.UserAction.AppDownloadInterstitialContinue),"function"==typeof t.props.onContinue&&t.props.onContinue()},t.onClose=function(){t.log(r.UserAction.AppDownloadInterstitialClose),"function"==typeof t.props.onClose&&t.props.onClose()},t.onAppDownload=function(){t.log(r.UserAction.AppDownloadInterstitialInstall)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){c.mark_time_to_interactive(),this.setupLogger(),this.filePreviewSession.markPrimaryEvent(),this.log(r.UserAction.AppDownloadInterstitialView)},t.prototype.componentWillReceiveProps=function(e){e.file.ns_id===this.props.file.ns_id&&e.file.sjid===this.props.file.sjid&&e.fileViewerSession===this.props.fileViewerSession||this.setupLogger(e)},t.prototype.setupLogger=function(e){void 0===e&&(e=this.props);var t=this.props,n=t.file,o=t.fileViewerSession,i=t.previewSourceAction,r=void 0===i?l.PreviewSourceAction.Visit:i,a=t.previewSourceContext,c=void 0===a?l.PreviewSourceContext.SharedLinkFile:a;o&&(this.filePreviewSession=new s.FilePreviewSession({file:n,isMounted:!1,fileViewerSession:o,sourceAction:r,sourceContext:c}))},t.prototype.log=function(e){var t=this.props,n=t.fileViewerSession,o=t.file;this.filePreviewSession&&n&&o.ns_id&&o.sjid&&i.MobileFilePreviewLogger.log(e,n.id,this.filePreviewSession.id,o.ns_id,o.sjid,{context:r.UserActionContext.AppDownloadInterstitial})},t.prototype.render=function(){var e=this.props,t=e.file,i=e.sharedLinkInfo,r=n.__rest(e,["file","sharedLinkInfo"]);return o.createElement(u.AppDownloadInterstitial,n.__assign({fileOrFolderName:a.getFilename(t),open_in_app_data:t.open_in_app_data,onContinue:this.onContinue,onAppDownload:this.onAppDownload,ownerName:i.ownerName,ownerTeamName:i.ownerTeamName,onClose:this.onClose},r))},t})(o.PureComponent);t.FilePreviewAppDownloadInterstitial=d}),define("modules/clean/react/file_viewer/exp_file_viewer_upsell_banner",["require","exports","tslib","external/react","modules/clean/react/css","modules/constants/payments","modules/core/i18n","modules/clean/react_format"],function(e,t,n,o,i,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),r=n.__importStar(r);var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=r.OUT_OF_SPACE_URL+"?oqa=oq_fp";return o.createElement("div",{className:"fileviewer-upsell-banner"},s.reactFormat(a._("Get more space to add more files to your Dropbox. <a>Upgrade now.</a>"),{a:o.createElement("a",{href:e})}))},t})(o.Component);t.ExpFileViewerUpsellBannerV2=i.requireCssWithComponent(l,["/static/css/exp_file_preview_upsell-vflhhQSQ0.css"])}),define("modules/clean/react/file_viewer/file_preview",["require","exports","tslib","external/classnames","external/react","external/lodash","modules/clean/previews/constants","modules/clean/previews/util","modules/clean/react/async/loadable","modules/clean/previews/data/api_shims","modules/clean/file_store/utils","modules/clean/react/file_viewer/utils","modules/clean/react/previews/constants","modules/clean/react/previews/loading_indicator","modules/clean/react/previews/error/preview_error","modules/clean/react/previews/preview_html","modules/clean/react/previews/preview_image","modules/clean/react/previews/preview_linkfile","modules/clean/react/previews/video/preview_video","modules/clean/react/previews/preview_pdf_loadable","modules/clean/react/previews/archive/preview_archive_loadable","modules/core/i18n","modules/core/browser","modules/core/exception","modules/clean/react/file_viewer/file_preview_logging_manager","modules/clean/react/comments2/util","modules/clean/redux/types"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,m,h,v,_,g,y,b,w,S,C,E,A,T){"use strict";function x(e){var t=e.file,o=e.sharedLinkUrl,r=e.sourceAction,a=e.sourceContext;return i.createElement(E.FilePreviewSessionManager,{file:t,isMounted:!!o,sourceAction:r,sourceContext:a,render:function(t){return i.createElement(F,n.__assign({},e,{filePreviewSession:t}))}})}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),i=n.__importStar(i),r=n.__importStar(r),s=n.__importStar(s),S=n.__importStar(S),C=n.__importStar(C);var P=l.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/preview_image_zoom"],t,n)}).then(n.__importStar).then(function(e){return e.PreviewImageZoom})}}),k=l.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/limited_preview_message"],t,n)}).then(n.__importStar).then(function(e){return e.LimitedPreviewMessage})}}),O=S.get_uri().getQuery(),I=O.forceRivieraException,M=O.forceTestPdf,R=O.forceTestExcelHtml,F=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={hasError:!1},t.onContextMenu=function(e){t.props.sharePermission&&0===t.props.sharePermission.canViewContextMenuRoles.length&&e.preventDefault()},t.onCopy=function(e){t.props.sharePermission&&0===t.props.sharePermission.canDownloadRoles.length&&e.preventDefault()},t.showLoadingIndicator=r.debounce(function(){return i.createElement(f.LoadingIndicator,{className:"loading-indicator"})},1e3),t.handleErrorWithRetry=function(e,n){d.shouldFetchRivieraStatusCode(t.props.file)?t.activeRequest=d.fetchRivieraStatusCode(e,function(e){t.activeRequest=void 0,t.setState({hasError:!0,errorType:n,rivieraStatusCode:e})},function(){t.activeRequest=void 0,t.triggerError(n)}):t.triggerError(n)},t.getErrorMessage=function(e,t,n){if(n&&"sketch"===u.getExtension(n)&&e===p.ErrorType.LoadError&&t===p.RivieraConvertResponseType.UnsupportedFormat)return w._("This file can’t be previewed. Previews are               only available for files created in Sketch v43 and up.")},t.triggerError=function(e){t.setState({hasError:!0,errorType:e})},t}return n.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){r.isEqual(e.file,this.props.file)||this.setState({hasError:!1,errorType:void 0})},
t.prototype.componentDidMount=function(){window.setTimeout(d.cleanupPrerenderPreview)},t.prototype.componentWillUnmount=function(){this.activeRequest&&this.activeRequest.readyState!==XMLHttpRequest.DONE&&this.activeRequest.abort()},t.prototype.renderImagePreview=function(){var e=this,t=this.props,o=t.file,r=t.user,a=o.preview_url||o.thumbnail_url_tmpl;if(null==a)return this.renderUnsupportedErrorPreview();if(this.props.isFullscreen)return i.createElement(P,{thumbnailUrlTmpl:a,fileCount:this.props.count,fileIndex:this.props.index,onError:this.triggerError,onFlipNext:this.props.onNext,onFlipPrevious:this.props.onPrevious,filePreviewSession:this.props.filePreviewSession,onContextMenu:this.onContextMenu,fileName:u.getFilename(this.props.file),setRenderStatusSuccess:this.props.setRenderStatusSuccess});var l={"preview-url":a,"file-extension":u.getExtension(o),isFullscreen:this.props.isFullscreen,comments2AnnotationsEnabled:A.isComments2ImageAnnotationsEnabled(r),shouldDisplayToolbar:this.props.shouldDisplayToolbar&&!s.isLimitedPreview(o),shouldDisableAnnotations:u.isArchiveFile(o),index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onError:function(){return e.handleErrorWithRetry(a,p.ErrorType.LoadError)},onNext:this.props.onNext,filePreviewSession:this.props.filePreviewSession,onContextMenu:this.onContextMenu,nsId:this.props.file.ns_id,sjId:this.props.file.sjid,fileName:u.getFilename(this.props.file),sizeClass:this.props.sizeClass,setRenderStatusSuccess:this.props.setRenderStatusSuccess};return i.createElement(v.PreviewImage,n.__assign({},l))},t.prototype.renderImagePreviewFromMetadata=function(e){var t=this,o=this.props,r=o.file,a=o.user,l=u.getExtension(r);if(this.props.isFullscreen)return i.createElement(P,{thumbnailUrlTmpl:e.thumbnail_url_tmpl,fileCount:this.props.count,fileIndex:this.props.index,onError:this.triggerError,onFlipNext:this.props.onNext,onFlipPrevious:this.props.onPrevious,filePreviewSession:this.props.filePreviewSession,onContextMenu:this.onContextMenu,fileName:u.getFilename(this.props.file),setRenderStatusSuccess:this.props.setRenderStatusSuccess});var c={"preview-url":e.thumbnail_url_tmpl,"file-extension":l,comments2AnnotationsEnabled:A.isComments2ImageAnnotationsEnabled(a),isFullscreen:this.props.isFullscreen,shouldDisplayToolbar:this.props.shouldDisplayToolbar&&!s.isLimitedPreview(r),shouldDisableAnnotations:u.isArchiveFile(r),index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onError:function(){return t.handleErrorWithRetry(e.thumbnail_url_tmpl,p.ErrorType.LoadError)},onNext:this.props.onNext,filePreviewSession:this.props.filePreviewSession,onContextMenu:this.onContextMenu,nsId:this.props.file.ns_id,sjId:this.props.file.sjid,fileName:u.getFilename(this.props.file),sizeClass:this.props.sizeClass,setRenderStatusSuccess:this.props.setRenderStatusSuccess};return i.createElement(v.PreviewImage,n.__assign({},c))},Object.defineProperty(t.prototype,"shouldShowActionables",{get:function(){return this.props.areActionablesEnabled&&!u.isArchiveFile(this.props.file)},enumerable:!0,configurable:!0}),t.prototype.renderVideoPreview=function(e){var t=this.props.file;return i.createElement(g.PreviewVideo,{title:u.getFilenameWithoutExtension(t),fileExtension:u.getExtension(t),previewUrl:e.transcode_url,thumbnailUrlTmpl:e.poster_url_tmpl,videoMetadataUrl:e.metadata_url,videoContainer:e.container,isFullscreen:this.props.isFullscreen,shouldFocusOnReady:this.props.shouldFocusOnReady,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,sourceContext:this.props.sourceContext,vttThumbnailsUrl:e.thumb_scrubber_vtt_url,setRenderStatusSuccess:this.props.setRenderStatusSuccess})},t.prototype.renderLinkfilePreview=function(e){var t=this.props.file,n={url:e.url,authenticated:!!e.authenticated};return i.createElement(_.PreviewLinkfile,{filename:u.getFilename(t),data:n,source:e.authenticated?"browse":"sharedLink",filePreviewSession:this.props.filePreviewSession,setRenderStatusSuccess:this.props.setRenderStatusSuccess})},t.prototype.renderPDFPreview=function(){var e=this.props.file;return e.preview_ssr_image_url_tmpl&&e.preview_ssr_text_url_tmpl?i.createElement(y.PreviewPDFLoadable,{fileExtension:u.getExtension(e),fileHref:e.href,filePreviewSession:this.props.filePreviewSession,imageUrl:e.preview_ssr_image_url_tmpl,isArchiveFile:u.isArchiveFile(e),isFullscreen:this.props.isFullscreen,isSidebarOpen:this.props.isSidebarOpen,isSharedLink:null!=this.props.sharedLinkUrl,onCloseViewer:this.props.onCloseViewer,onError:this.triggerError,forceTestPdf:!!M,previewThumbnailUrl:e.preview_thumbnail_url,refreshUrl:e.preview_ssr_refresh_url||void 0,src:e.preview_url,sharePermission:this.props.sharePermission,shouldDisableAnnotations:u.isArchiveFile(e),sizeClass:this.props.sizeClass,textUrl:e.preview_ssr_text_url_tmpl,invalidateFrameMessenger:this.props.invalidateFrameMessenger,setRenderStatusSuccess:this.props.setRenderStatusSuccess}):this.renderUnsupportedErrorPreview()},t.prototype.renderPDFPreviewFromMetadata=function(e){var t=this.props,n=t.file,o=t.preview;return e.image_url_tmpl&&e.text_url_tmpl?i.createElement(y.PreviewPDFLoadable,{fileExtension:u.getExtension(n),fileHref:n.href,filePreviewSession:this.props.filePreviewSession,imageUrl:e.image_url_tmpl,isArchiveFile:!1,isFullscreen:this.props.isFullscreen,isSidebarOpen:this.props.isSidebarOpen,isSharedLink:null!=this.props.sharedLinkUrl,onCloseViewer:this.props.onCloseViewer,onError:this.triggerError,forceTestPdf:!!M,previewThumbnailUrl:e.placeholder_image_url,refreshUrl:e.refresh_url||void 0,src:o.direct_blockserver_link,sharePermission:this.props.sharePermission,shouldDisableAnnotations:!1,sizeClass:this.props.sizeClass,textUrl:e.text_url_tmpl,invalidateFrameMessenger:this.props.invalidateFrameMessenger,setRenderStatusSuccess:this.props.setRenderStatusSuccess}):this.renderUnsupportedErrorPreview()},t.prototype.getCommonHtmlPreviewProps=function(){var e=this.props.file,t=u.getExtension(e);return{count:this.props.count,fileExtension:t,filePreviewSession:this.props.filePreviewSession,filename:u.getFilename(e),index:this.props.index,isFullscreen:this.props.isFullscreen,onClickNext:this.props.onNext,onClickPrevious:this.props.onPrevious,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharePermission:this.props.sharePermission,sizeClass:this.props.sizeClass}},t.prototype.renderExcelPreviewFromMetadata=function(){var e=this.props.preview.preview_url;return e?i.createElement(h.PreviewHTML,n.__assign({src:e,isExcel:!0,forceRivieraException:Array.isArray(I)?I[0]:"",forceTestExcelHtml:!!R,usesFrameMessenger:!0},this.getCommonHtmlPreviewProps())):this.renderUnsupportedErrorPreview()},t.prototype.renderHtmlifiedPreviewFromMetadata=function(e){var t=e.htmlified_link,o=e.uses_frame_messenger;return t?i.createElement(h.PreviewHTML,n.__assign({src:t,isExcel:!1,usesFrameMessenger:o},this.getCommonHtmlPreviewProps())):this.renderUnsupportedErrorPreview()},t.prototype.renderRawHtmlPreview=function(){var e=this.props.preview.direct_blockserver_link;return e?i.createElement(h.PreviewHTML,n.__assign({src:e,isExcel:!1,usesFrameMessenger:!1},this.getCommonHtmlPreviewProps())):this.renderUnsupportedErrorPreview()},t.prototype.renderHTMLPreview=function(){var e=this.props.file,t=e.preview_type,n=u.getExtension(e),o=t===a.PreviewType.Excel?e.preview_url:e.htmlified_link||e.direct_blockserver_link;return o?i.createElement(h.PreviewHTML,{src:o,filename:u.getFilename(this.props.file),isExcel:t===a.PreviewType.Excel,forceRivieraException:Array.isArray(I)?I[0]:"",forceTestExcelHtml:!!R,isFullscreen:this.props.isFullscreen,onError:this.triggerError,fileExtension:n,usesFrameMessenger:c.usesFrameMessenger(t,n),sharePermission:this.props.sharePermission,filePreviewSession:this.props.filePreviewSession,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sizeClass:this.props.sizeClass,index:this.props.index,count:this.props.count}):this.renderUnsupportedErrorPreview()},t.prototype.renderAudioPreview=function(e){var t=this.props.file;return i.createElement(g.PreviewVideo,{title:u.getFilenameWithoutExtension(t),fileExtension:u.getExtension(t),previewUrl:e.transcode_url,videoContainer:e.container,filePreviewSession:this.props.filePreviewSession,shouldFocusOnReady:this.props.shouldFocusOnReady,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sourceContext:this.props.sourceContext,isAudio:!0,audioUrl:this.props.file.direct_blockserver_link,bytes:t.bytes,waveformUrl:e.waveform_url})},t.prototype.renderArchivePreview=function(){return i.createElement(b.PreviewArchiveLoadable,{file:this.props.file,fileSubpath:this.props.fileSubpath,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharedLinkUrl:this.props.sharedLinkUrl,user:this.props.user})},t.prototype.renderCloudDocPreview=function(){return this.props.file.preview_url?(S.replace_location(this.props.file.preview_url),null):this.renderUnsupportedErrorPreview()},t.prototype.renderCloudDocPreviewFromMetadata=function(e){return e.exit_url?(S.replace_location(e.exit_url),null):this.renderUnsupportedErrorPreview()},t.prototype.renderUnsupportedErrorPreview=function(){return this.renderErrorPreview(p.ErrorType.SupportError)},t.prototype.renderErrorPreview=function(e){var t=this.state.rivieraStatusCode,n=this.props,o=n.count,r=n.file,a=n.filePreviewSession,s=n.index,l=n.isFullscreen,c=n.isMobileUserAgent,p=n.maxFilenameEmLength,f=n.onNext,h=n.onPrevious,v=n.sharedLinkInfo,_=n.sharePermission,g=n.shareToken,y=n.user,b=this.props.shouldDisplayToolbar&&d.FlippableHelpers.isFlippableFile(r)&&!u.isArchiveFile(r);return i.createElement(m.PreviewError,{file:r,maxFilenameEmLength:p,filePreviewSession:a,errorType:e,user:y,areActionablesEnabled:this.shouldShowActionables,sharedLinkInfo:v,shareToken:g,sharePermission:_,shouldDisplayToolbar:b,index:s,isFullscreen:l,isMobileUserAgent:c,count:o,onPrevious:h,onNext:f,message:this.getErrorMessage(e,t,r),sizeClass:this.props.sizeClass})},t.prototype.getPreviewTypeWhitelist=function(){return this.props.previewTypeWhitelist||s.VALID_PREVIEW_TYPES},t.prototype.choosePreviewByMetadata=function(){var e=this.props.file,t=this.getPreviewTypeWhitelist().map(c.convertPreviewType),n=this.validateFile(e);if(n)return n;if(!this.props.preview&&this.props.previewApiData){if(this.props.previewApiData.status===T.ApiClientStatus.Request)return this.showLoadingIndicator();if(this.props.previewApiData.status===T.ApiClientStatus.Error)return this.renderErrorPreview(p.ErrorType.ExtensionError)}if(!this.props.preview||!this.props.preview.content)return this.renderErrorPreview(p.ErrorType.ExtensionError);var o=this.props.preview,i=o.content[".tag"];if(t&&!t.includes(i))return this.renderErrorPreview(p.ErrorType.ExtensionError);var r=o.content;switch(this.showLoadingIndicator.cancel(),r[".tag"]){case"video":return this.renderVideoPreview(r);case"audio":return this.renderAudioPreview(r);case"archive":return this.renderArchivePreview();case"image":return this.renderImagePreviewFromMetadata(r);case"ssr_doc":return this.renderPDFPreviewFromMetadata(r);case"linkfile":return this.renderLinkfilePreview(r);case"cloud_doc":return this.renderCloudDocPreviewFromMetadata(r);case"excel":return this.renderExcelPreviewFromMetadata();case"raw_html":return this.renderRawHtmlPreview();case"html":return this.renderHtmlifiedPreviewFromMetadata(r);case"restricted":return this.renderErrorPreview(p.ErrorType.ExtensionError)}},t.prototype.validateFile=function(e){return e.is_dir&&!s.isSupportedBundleFile(e)?this.renderErrorPreview(p.ErrorType.ExtensionError):null!=e.ns_id||u.isArchiveFile(e)?u.isSymLink(e)?this.renderErrorPreview(p.ErrorType.SymLinkError):s.filesizeSupported(e)?void 0:this.renderErrorPreview(p.ErrorType.FileSizeError):this.renderErrorPreview(p.ErrorType.PendingUploadError)},t.prototype.choosePreview=function(){if(this.props.preview||this.props.previewApiData)return this.choosePreviewByMetadata();var e=this.props.file,t=this.getPreviewTypeWhitelist(),n=this.validateFile(e);if(n)return n;if(s.isEmptyFile(e)&&e.preview_type!==a.PreviewType.CloudDoc)return this.renderErrorPreview(p.ErrorType.EmptyFileError);if(null!=t&&!t.includes(e.preview_type))return this.renderErrorPreview(p.ErrorType.ExtensionError);switch(e.preview_type){case a.PreviewType.Photo:return this.renderImagePreview();case a.PreviewType.Doc:return this.renderPDFPreview();case a.PreviewType.Excel:case a.PreviewType.HTML:case a.PreviewType.Text:return this.renderHTMLPreview();case a.PreviewType.Archive:return this.renderArchivePreview();case a.PreviewType.CloudDoc:return this.renderCloudDocPreview();default:C.assert(!1,"Preview type "+e.preview_type+" in VALID_PREVIEW_TYPES but not implemented")}return null},t.prototype.render=function(){var e=this.props,t=e.file,n=e.sharedLinkInfo,r=e.shareToken,a=e.sharePermission,l=e.sizeClass,c=e.user,d=this.state,p=d.errorType;return d.hasError?this.renderErrorPreview(p):i.createElement("div",{className:o.default({"flex-preview-container":!0,"no-download":a&&0===a.canViewContextMenuRoles.length}),onContextMenu:this.onContextMenu,onCopy:this.onCopy},u.isArchiveFile(t)?null:i.createElement(E.FilePreviewPaasLoggerManager,{file:t}),this.choosePreview(),t.preview_type&&s.isLimitedPreview(t)?i.createElement(k,{extension:u.getExtension(t),file:t,sharedLinkInfo:n,shareToken:r,sharePermission:a,shouldShowActionables:this.shouldShowActionables,sizeClass:l,user:c}):null)},t.defaultProps={areActionablesEnabled:!0,isFullscreen:!1,sharePermission:null,setRenderStatusSuccess:r.noop,user:null},t})(i.Component);t.FilePreview=F,t.FilePreviewWithLogging=x}),define("modules/clean/react/file_viewer/file_preview_logging_manager",["require","exports","tslib","external/react","modules/clean/loggers/file_preview_logger","modules/clean/previews/cookie_preview_tracer","modules/clean/loggers/file_viewer_logger","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/previews/constants","modules/clean/react/previews/frame_messenger_host","external/lodash"],function(e,t,n,o,i,r,a,s,l,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),a=n.__importStar(a),p=n.__importStar(p);var f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setUpFilePreviewLogger=function(e){t.teardownFilePreviewLogger(),t.filePreviewTimelineLogger=new i.FilePreviewTimelineLogger(e),t.filePreviewTimelineLogger.listenTo(l.filePreviewEventEmitter),t.filePreviewUserActionLogger=new i.FilePreviewUserActionLogger,t.filePreviewUserActionLogger.listenTo(l.filePreviewEventEmitter)},t.teardownFilePreviewLogger=function(){null!=t.filePreviewTimelineLogger&&t.filePreviewTimelineLogger.unlistenTo(l.filePreviewEventEmitter),null!=t.filePreviewUserActionLogger&&t.filePreviewUserActionLogger.unlistenTo(l.filePreviewEventEmitter)},t.logPreviewSessionEnded=function(e){void 0===e&&(e=u.PreviewSessionEndReason.Unknown);var n={min_page_width_ratio:"",max_page_width_ratio:"",session_end_reason:e};t.state.filePreviewSession.recordEvent(s.EventType.FilePreviewSessionEnded,n)},t.startNewFilePreviewSession=function(e){var n=e.file,o=e.isMounted,i=e.sourceAction,r=e.sourceContext,a=new c.FilePreviewSession({file:n,fileViewerSession:c.FileViewerSession.currentSession,isMounted:o,sourceAction:i,sourceContext:r});c.FilePreviewSession.currentSession=a,t.setState({filePreviewSession:a}),t.setUpFilePreviewLogger(a.id),t.teardownFilePreviewCookieTracer(),t.setupCookiePreviewTracer(a.id,l.filePreviewEventEmitter),a.recordEvent(s.EventType.FilePreviewAttemptStarted)},t.setupCookiePreviewTracer=function(e,n){t.filePreviewCookieTracer=new r.CookiePreviewTracer(e,n)},t.teardownFilePreviewCookieTracer=function(){t.filePreviewCookieTracer&&t.filePreviewCookieTracer.teardown()},t.windowCloseHandler=function(){t.logPreviewSessionEnded(u.PreviewSessionEndReason.BeforeUnload)},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.startNewFilePreviewSession(this.props)},t.prototype.componentDidMount=function(){window.addEventListener("beforeunload",this.windowCloseHandler)},t.prototype.componentWillUnmount=function(){this.logPreviewSessionEnded(u.PreviewSessionEndReason.Unmount),this.teardownFilePreviewLogger(),this.teardownFilePreviewCookieTracer(),window.removeEventListener("beforeunload",this.windowCloseHandler)},t.prototype.componentWillReceiveProps=function(e){p.isEqual(e.file,this.props.file)||(this.logPreviewSessionEnded(u.PreviewSessionEndReason.NewFile),this.startNewFilePreviewSession(e))},t.prototype.render=function(){return this.props.render(this.state.filePreviewSession)},t})(o.Component);t.FilePreviewSessionManager=f;var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onFrameMessage=function(e){var n=t.props.file,o=e.action,i=e.parameters;"pagerendered"===o&&a.logPageRendered(n,i)},t.startLogger=function(){t.frameMessenger=new d.PreviewFrameMessengerHost,t.frameMessenger.configureChildMessaging(".react-file-viewer__preview iframe",t.onFrameMessage,["pagerendered"]),t.frameMessenger.startListening()},t.stopLogger=function(){t.frameMessenger.stopListening()},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.startLogger()},t.prototype.componentWillUnmount=function(){this.stopLogger()},t.prototype.render=function(){return null},t})(o.Component);t.FilePreviewPaasLoggerManager=m}),define("modules/clean/react/file_viewer/file_viewer",["require","exports","tslib","esignature_prototype/components/esignature_confirmation_page","esignature_prototype/components/esignature_utility_modals","esignature_prototype/data/selectors","external/classnames","external/keymaster","external/lodash","external/react","external/react-dom","external/react-redux","modules/clean/react/comments2/components/mobile_web_comments","modules/clean/react/comments2/util","modules/clean/analytics","modules/clean/history","modules/clean/loggers/file_viewer_logger","modules/clean/previews/constants","modules/clean/react/file_sidebar/file_sidebar","modules/clean/react/file_sidebar/file_sidebar_provider","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/app_download_interstitial/file_preview_app_download_interstitial","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/exp_file_viewer_upsell_banner","modules/clean/react/file_viewer/file_preview","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/location_utils","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/title_bar","modules/clean/react/keyboard_binding/keyboard_binding_provider","modules/clean/react/location/with_location","modules/clean/react/modal","modules/clean/react/open_in_app/banner","modules/clean/react/previews/constants","modules/clean/react/previews/quality_popup/preview_quality_popup","modules/clean/react/size_class/constants","modules/clean/react/size_class/size_class","modules/clean/web_timing_logger","modules/constants/file_activity_stream","modules/constants/file_viewer","modules/constants/python","modules/core/browser","modules/core/dom","modules/core/uri","modules/clean/react/file_viewer/data/selectors","modules/clean/previews/data/selectors","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/utils","modules/clean/file_store/utils","modules/clean/growth/showcase_upsell/preview_loader","modules/clean/react/file_viewer/open_in_paper","modules/clean/react/search_success_banner/constants","modules/clean/react/search_success_banner/search_success_banner","modules/clean/react/search_success_banner/util","esignature_prototype/utils","esignature_prototype/data/actions"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,m,h,v,_,g,y,b,w,S,C,E,A,T,x,P,k,O,I,M,R,F,D,N,L,U,z,H,B,V,q,j,W,K,G,Y,Z,Q,X,J,$,ee,te,ne,oe){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importDefault(a),s=n.__importDefault(s),l=n.__importStar(l),c=n.__importStar(c),u=n.__importStar(u),h=n.__importDefault(h),v=n.__importStar(v),U=n.__importStar(U),z=n.__importStar(z),H=n.__importStar(H),B=n.__importStar(B),V=n.__importStar(V),q=n.__importStar(q);var ie="",re="",ae=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.previewSourceAction=t.props.initialPreviewSourceAction,t.previewSourceContext=t.props.initialPreviewSourceContext,t.focusInViewer=function(){if(!Z.modalIsUp()&&!t.props.shouldFocusCommentInput){var e=u.findDOMNode(t).querySelector(".button-primary");if(e)e.focus();else{var n=q.getTabbableElementsIn(".react-file-viewer");n.length&&n[0].focus()}}},t.flipNext=function(){t.props.onFlipNext&&t.props.onFlipNext()},t.flipPrevious=function(){t.props.onFlipPrevious&&t.props.onFlipPrevious()},t.setupKeymaster=function(){(H.FILE_VIEWER_FLIP_ALL_FILES||Z.FlippableHelpers.isFlippableFile(t.props.file))&&(s.default("left","fileviewer",function(){t.flipPrevious(),b.logUserAction(Y.UserAction.FlipPrevious,Y.UserActionContext.Keyboard)}),s.default("right","fileviewer",function(){t.flipNext(),b.logUserAction(Y.UserAction.FlipNext,Y.UserActionContext.Keyboard)})),s.default("esc","fileviewer",function(e){if(!t.shouldIgnoreEscape(e)&&null!=t.props.onCloseViewer)return t.props.isSendForSignatureMode?void(t.props.hasUnsavedEsignatureData?M.Modal.showInstance(c.createElement(i.EsignatureUnsavedDataModal,{onDiscard:t.props.exitSendForSignature})):t.props.exitSendForSignature&&t.props.exitSendForSignature()):void t.props.onCloseViewer()}),ie=s.default.getScope(),s.default.setScope("fileviewer")},t.cleanupKeymaster=function(){s.default.clearScope("fileviewer"),s.default.setScope(ie)},t.shouldShowOpenInAppBanner=function(){var e=t.props,n=e.hidePageChrome,o=e.isMobileUserAgent;return!n&&(!(!V.is_tablet()||!Z.renderOpenInAppAsBanner())||(o||V.is_mobile_or_tablet()))},t.openInAppBannerOnClick=function(){b.logUserAction(Y.UserAction.OpenInApp,Y.UserActionContext.OpenInAppBanner)},t.onInterstitialClose=function(){t.props.onAppDownloadInterstitialDismissed()},t.onInterstitialContinue=function(){t.props.onAppDownloadInterstitialDismissed()},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.setUpLogging()},t.prototype.componentDidMount=function(){var e=this.props,t=e.file,n=e.fetchShowOverQuotaUpsell,o=e.onComponentDidMount,i=e.user;null!=o&&o(),this.flipNext=l.throttle(this.flipNext,100),this.flipPrevious=l.throttle(this.flipPrevious,100),this.setupPreviewUrl(t),this.setDocumentTitle(Q.getFilename(t),!0),q.scroll_lock_document(),v.start(),this.logView(),n(i)},t.prototype.componentWillUpdate=function(e){var t=e.file;t!==this.props.file&&(this.updatePreviewUrl(t),this.setDocumentTitle(Q.getFilename(t)),this.previewSourceAction=F.PreviewSourceAction.Click,this.previewSourceContext=F.PreviewSourceContext.FileViewer),s.default.setScope("fileviewer")},t.prototype.componentDidUpdate=function(e){Q.areFilesEqual(e.file,this.props.file)||this.logView()},t.prototype.componentWillUnmount=function(){te.resetSearchSuccessBannerSettings(),this.props.exitSendForSignature&&this.props.exitSendForSignature(),this.teardownPreviewUrl(),this.unsetDocumentTitle(),q.scroll_unlock_document(),null!=this.props.onComponentWillUnmount&&this.props.onComponentWillUnmount(),M.Modal.close()},Object.defineProperty(t.prototype,"fileSubpath",{get:function(){return x.getFileSubpath(this.props.location)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isViewingFileSubpath",{get:function(){return this.props.file.preview_type===_.PreviewType.Archive&&!!this.fileSubpath},enumerable:!0,configurable:!0}),t.prototype.shouldSuppressPassInfo=function(){return null==this.props.file.ns_id},t.prototype.setUpLogging=function(){if(P.FileViewerSession.currentSession=new P.FileViewerSession,this.props.fileViewTarget===B.FileViewTargetType.SHARED_CONTENT_LINK){var e=U.start_time(),t=(new Date).getTime();this.props.user&&m.ShareTibEventLogger.log(this.props.user.id,"PREVIEW_RENDER","PREVIEW_PAGE",{timing:t-e,containing_ns_id:this.props.file.ns_id,sjid:this.props.file.sjid})}},t.prototype.setupPreviewUrl=function(e){this.props.skipOuterRouting||this.setPreviewUrl(e)},t.prototype.updatePreviewUrl=function(e){this.setPreviewUrl(e,!1)},t.prototype.teardownPreviewUrl=function(){this.props.skipOuterRouting||this.unsetPreviewUrl()},t.prototype.setPreviewUrl=function(e,t){if(void 0===t&&(t=!0),!this.props.disableRouting){var n=Q.getFilename(e),o=j.URI.parse(h.default.get_url()),i=j.URI.encode_parts(o.getPath()),r=o.removeQuery("select").updateQuery({preview:n}).getQuery();t?h.default.push_state(i,r,{immediatelyRestoreState:!1}):h.default.replace_state(i,r)}},t.prototype.unsetPreviewUrl=function(){if(!this.props.disableRouting){var e=j.URI.parse(h.default.get_url()),t=j.URI.encode_parts(e.getPath()),n=e.removeQuery("select").removeQuery("preview").getQuery();h.default.push_state(t,n,{immediatelyRestoreState:!1})}},t.prototype.isDownloadDisabled=function(){return!(!this.props.sharePermission||!this.props.sharePermission.canDownloadRoles)&&0===this.props.sharePermission.canDownloadRoles.length},t.prototype.shouldShowAppDownloadInterstitial=function(){return!this.props.appDownloadInterstitialDismissed&&this.props.file.open_in_app_data},t.prototype.shouldIgnoreEscape=function(e){return q.focus_in_input()||q.is_input(e.target)||document.querySelector(".annotation-bubble")||this.props.isFullscreen||this.fileSubpath},t.prototype.setDocumentTitle=function(e,t){void 0===t&&(t=!1),t&&(re=document.title),document.title=e},t.prototype.unsetDocumentTitle=function(){""!==re&&(document.title=re)},t.prototype.logView=function(){null===this.props.file.ns_id||Z.determinePathContext()===Y.PathContext.SharedLinkCollection||this.props.hidePageChrome||v.logView(this.props.file,this.props.user,this.props.fileViewTarget,this.props.fileViewOrigin,this.props.fileViewAction,null!=this.props.sharedLinkInfo?this.props.sharedLinkInfo.url:void 0,this.isDownloadDisabled())},t.prototype.isImagePreviewAnnotationEnabled=function(){return!(this.props.sizeClass===N.SizeClass.Small||this.props.hidePageChrome)},t.prototype.renderFlippableControls=function(){if(Z.FlippableHelpers.isFlippableFile(this.props.file)&&!this.props.isFullscreen&&!this.isImagePreviewAnnotationEnabled()&&null!=this.props.fileIndex)return c.createElement(T.FlippableControls,{index:""+(this.props.fileIndex+1),numFlippableFiles:this.props.fileCount,onNext:this.flipNext,onPrevious:this.flipPrevious})},t.prototype.renderShowcaseUpsell=function(){return c.createElement(X.ShowcaseUpsellPreviewLoader,{user:this.props.user,currentFile:this.props.file,sharedLinkInfo:this.props.sharedLinkInfo,variant:H.UJ_SHOWCASE_UPSELL_PREVIEW_VARIANT,sizeClass:this.props.sizeClass,isFullscreen:this.props.isFullscreen,hidePageChrome:this.props.hidePageChrome})},t.prototype.renderFilePreview=function(){return c.createElement("div",{className:"react-file-viewer__preview react-file-preview"},c.createElement("div",{className:"flex-preview-container"},this.renderSearchSuccessBanner(),this.renderPreviewQualityPopup(),this.shouldShowOpenInAppBanner()&&c.createElement(R.OpenInAppBanner,{urls:this.props.file.open_in_app_data,onClick:this.openInAppBannerOnClick}),c.createElement(A.FilePreviewWithLogging,{areActionablesEnabled:!this.props.hidePageChrome&&null!=this.props.file.ns_id,count:this.props.fileCount,file:this.props.file,previewApiData:this.props.previewApiData,preview:this.props.preview,fileSubpath:this.fileSubpath,index:this.props.fileIndex,isFullscreen:this.props.isFullscreen,isMobileUserAgent:this.props.isMobileUserAgent,isSidebarOpen:this.props.isSidebarOpen,maxFilenameEmLength:Y.SizeClassFilenameLengthMap[this.props.sizeClass],onCloseViewer:this.props.onCloseViewer,onNext:this.flipNext,onPrevious:this.flipPrevious,sharedLinkInfo:this.props.sharedLinkInfo,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken,shouldFocusOnReady:!this.props.hidePageChrome,sourceAction:this.previewSourceAction,sourceContext:this.previewSourceContext,sharedLinkUrl:null!=this.props.sharedLinkInfo?this.props.sharedLinkInfo.url:void 0,setRenderStatusSuccess:this.props.setRenderStatusSuccessForCurrentFile,shouldDisplayToolbar:this.isImagePreviewAnnotationEnabled(),sizeClass:this.props.sizeClass,user:this.props.user}),this.renderFlippableControls()))},t.prototype.renderSidebar=function(){return this.props.sizeClass!==N.SizeClass.Large||this.props.isFullscreen||this.props.hidePageChrome||V.is_mobile_or_tablet()||this.isViewingFileSubpath||null==this.props.file.ns_id?null:c.createElement(g.FileSidebar,{activityContext:this.props.activityContext,currentFile:this.props.file,headerComponent:this.props.sidebarHeaderComponent,commentsDisabledOnFile:!!this.props.hideComments,isVersionHistoryMode:!!this.props.isVersionHistoryMode,sharedLinkInfo:this.props.sharedLinkInfo,shouldInitiallyFocusInput:!!this.props.shouldFocusCommentInput,user:this.props.user})},t.prototype.renderMobileComments=function(){var e=this.props,t=e.file,n=e.sharedLinkInfo,o=e.sizeClass,i=e.user;return this.props.isFullscreen||this.isViewingFileSubpath?null:c.createElement(p.MobileWebComments,{currentFile:t,sharedLinkInfo:n,user:i,sizeClass:o})},t.prototype.renderTitleBar=function(){return this.props.isFullscreen||this.props.hidePageChrome&&this.props.file.preview_type!==_.PreviewType.Archive?null:c.createElement("div",{className:"react-file-viewer__title-bar"},c.createElement(k.TitleBar,{canClose:this.props.canClose,canRestoreRevision:this.props.canRestoreRevision,closeUrl:this.props.titleBarCloseUrl,file:this.props.file,fileSubpath:this.fileSubpath,fileViewAction:this.props.fileViewAction,fileViewOrigin:this.props.fileViewOrigin,hidePageChrome:this.props.hidePageChrome,isSeenStatesEnabled:!this.shouldSuppressPassInfo(),isVersionHistoryMode:this.props.isVersionHistoryMode,isViewingFileSubpath:this.isViewingFileSubpath,maxFilenameEmLength:Y.SizeClassFilenameLengthMap[this.props.sizeClass],onClose:this.props.onCloseViewer,onMount:this.focusInViewer,onRestoreRevision:this.props.onRestoreRevision,sharedLinkInfo:this.props.sharedLinkInfo,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken,sizeClass:this.props.sizeClass,user:this.props.user||null}),this.renderUpsellBanner())},t.prototype.shouldAllowFileDonation=function(){return null==this.props.sharedLinkInfo&&(null==this.props.user||this.props.user.home_ns_id===this.props.file.ns_id)},t.prototype.renderSearchSuccessBanner=function(){var e=this.props,t=e.user,n=e.hidePageChrome,o=e.renderStatus,i=e.sizeClass;return t&&Z.shouldShowSearchSuccessBanner({renderStatus:o,hidePageChrome:n,sizeClass:i})&&te.getSearchSuccessBannerVisibility()?c.createElement(ee.SearchSuccessBanner,{user:this.props.user,displayContext:$.SearchSuccessDisplayContext.PREVIEW}):null},t.prototype.renderPreviewQualityPopup=function(){var e=this.props,t=e.file,n=e.hidePageChrome,o=e.renderStatus,i=e.sizeClass;return Z.shouldShowPreviewQualityPopup({sizeClass:i,hidePageChrome:n,renderStatus:o})?c.createElement(D.PreviewQualityPopup,{allowFileDonation:this.shouldAllowFileDonation(),file:t,showProbability:H.PREVIEW_QUALITY_POPUP_PROBABILITY}):null},t.prototype.renderUpsellBanner=function(){return this.props.showOverQuotaUpsell?c.createElement(E.ExpFileViewerUpsellBannerV2,null):null},t.prototype.render=function(){var e=this.props,t=e.className,n=e.file,i=e.hidePageChrome,r=e.isFullscreen,s=e.sharePermission,l=e.sharedLinkInfo,u=e.sizeClass,d=e.transparentBackground,p=e.user,m=Q.getFilename(n);return this.shouldShowAppDownloadInterstitial()?c.createElement("div",{"aria-label":m},c.createElement(w.FilePreviewAppDownloadInterstitial,{sharedLinkInfo:l,file:n,
fileViewerSession:P.FileViewerSession.currentSession,previewSourceAction:this.previewSourceAction,previewSourceContext:this.previewSourceContext,onClose:this.onInterstitialClose,onContinue:this.onInterstitialContinue})):this.props.shouldShowEsignatureConfirmationPage?c.createElement(O.KeyboardBindingProvider,{onDestroy:this.cleanupKeymaster,onSetup:this.setupKeymaster},c.createElement(o.EsignatureConfirmationPage,null,c.createElement(A.FilePreviewWithLogging,{areActionablesEnabled:!1,file:this.props.file,isFullscreen:!1,isMobileUserAgent:this.props.isMobileUserAgent,isSidebarOpen:{pdf:!1},maxFilenameEmLength:Y.SizeClassFilenameLengthMap[this.props.sizeClass],onCloseViewer:this.props.onCloseViewer,sourceAction:this.previewSourceAction,sourceContext:this.previewSourceContext,sharedLinkUrl:null!=this.props.sharedLinkInfo?this.props.sharedLinkInfo.url:void 0,setRenderStatusSuccess:this.props.setRenderStatusSuccessForCurrentFile,shouldDisplayToolbar:!1,sizeClass:this.props.sizeClass}))):c.createElement(O.KeyboardBindingProvider,{onDestroy:this.cleanupKeymaster,onSetup:this.setupKeymaster},c.createElement(se,{ns_id:n.ns_id},c.createElement("div",{"aria-label":m,className:a.default("react-file-viewer",t,{"no-background":d&&!r}),role:"dialog"},this.renderTitleBar(),u!==N.SizeClass.Large||r||i?null:c.createElement(J.OpenInPaperBanner,{currentFile:n,sharedLinkInfo:l,sharePermission:s,user:p}),c.createElement("div",{className:a.default("react-file-viewer__content",{comments2:f.shouldUseComments2({previewType:n.preview_type||void 0,viewer:p}),"comments2-mobile-web":f.shouldUseComments2MobileWeb({previewType:n.preview_type||void 0,viewer:p})})},this.renderFilePreview(),this.renderSidebar(),this.renderShowcaseUpsell(),this.renderMobileComments()))))},t.defaultProps={canClose:!1,canRestoreRevision:!1,className:"",disableRouting:!1,hideComments:!1,hidePageChrome:!1,isVersionHistoryMode:!1,forceFileUnlocked:!1,oref:B.OREF_CONSTANTS.BROWSE_UNKNOWN,shouldFocusCommentInput:!1,sizeClass:N.SizeClass.Large,skipOuterRouting:!1,fileCount:0},t})(c.Component);t._FileViewer=ae;var se=function(e){var t=e.children,n=e.ns_id;return z.IS_ON&&null!=n?c.createElement(y.FileSidebarProvider,null,t):c.Children.only(t)},le=function(e){return null!=e.file?c.createElement(ae,n.__assign({},e)):c.createElement("div",null)},ce=I.withLocation(le),ue=L.withSizeClass(ce,{isResponsiveEnabled:Z.isResponsiveEnabled,responsiveClassName:Y.ResponsiveClassName}),de=d.connect(function(e,t){var n=W.getAppDownloadInterstitial(e);void 0===n&&t&&(n=t.appDownloadInterstitialDismissed);var o=W.getActiveFile(e);return{appDownloadInterstitialDismissed:n,file:o,previewApiData:o&&K.getApiDataForFile(e,o),preview:o&&K.getPreviewMetadataForFile(e,o),isFullscreen:W.getIsFullScreen(e),isSidebarOpen:W.getIsSidebarOpen(e),renderStatus:W.getRenderStatusForCurrentFile(e),showOverQuotaUpsell:W.getShowOverQuotaUpsell(e),shouldShowEsignatureConfirmationPage:r.getShouldShowEsignatureConfirmationPage(e),isSendForSignatureMode:r.getIsSendForSignatureMode(e),hasUnsavedEsignatureData:r.getHasUnsavedData(e)}},{onAppDownloadInterstitialDismissed:S.dismissAppDownloadInterstitial,exitSendForSignature:oe.exitSendForSignature,fetchShowOverQuotaUpsell:S.fetchShowOverQuotaUpsell,setRenderStatusSuccessForCurrentFile:S.setRenderStatusSuccessForCurrentFile})(ue),pe=C.getStoreForFileViewer(),fe=function(e){return c.createElement(d.Provider,{store:pe},c.createElement(de,n.__assign({},e)))},me=["/static/css/preview_flexbox_layout-vflQUUZaq.css","/static/css/react_file_viewer-vflGHVBlL.css","/static/css/react_title_bar-vflI9e9Dq.css","/static/css/spectrum/index.web-vflsx5vgZ.css","/static/js/spectrum_signatures_prototype/index.web-vflTY3ZjY.css"];ne.esignaturesEnabled()&&me.push("/static/js/spectrum_signatures_prototype/index.web-vflTY3ZjY.css");var he=G.requireCssWithComponent(fe,me);t.FileViewer=he}),define("modules/clean/react/file_viewer/flippable_controls",["require","exports","tslib","external/react","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handlePreviousClick=function(){t.props.onPrevious&&t.props.onPrevious()},t.handleNextClick=function(){t.props.onNext&&t.props.onNext()},t}return n.__extends(t,e),t.prototype.getNavText=function(){return r._("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index,num_total_files:this.props.numFlippableFiles})},t.prototype.render=function(){if(this.props.numFlippableFiles<=1)return null;var e=r._("Flip left",{comment:"Flip to the previous file in a series of files when previewing files on the web"}),t=r._("Flip right",{comment:"Flip to the next file in a series of files when previewing files on the web"});return o.createElement("div",{className:"react-file-viewer__controls"},o.createElement("button",{className:"nav-control",onClick:this.handlePreviousClick},o.createElement(i.Sprite,{group:"web",name:"s_flip_left",alt:e})),o.createElement("div",{className:"nav-text"},this.getNavText()),o.createElement("button",{className:"nav-control",onClick:this.handleNextClick},o.createElement(i.Sprite,{group:"web",name:"s_flip_right",alt:t})))},t})(o.Component);t.FlippableControls=a}),define("modules/clean/react/file_viewer/full_screen_helpers",["require","exports","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants"],function(e,t,n,o,i,r){"use strict";function a(e){document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),document.addEventListener("mozfullscreenchange",e)}function s(e){document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e),document.removeEventListener("mozfullscreenchange",e)}function l(e){window.addEventListener("popstate",e)}function c(e){window.removeEventListener("popstate",e)}function u(){var e=document.body;null!=e.requestFullscreen?e.requestFullscreen():null!=e.msRequestFullscreen?e.msRequestFullscreen():null!=e.mozRequestFullScreen?e.mozRequestFullScreen():null!=e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function d(){var e=document;e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()}function p(){S.dispatch(o.openFullScreen())}function f(){S.dispatch(o.closeFullScreen())}function m(){w()||y(r.UserActionContext.Browser)}function h(){y(r.UserActionContext.Browser)}function v(){a(m),l(h)}function _(){s(m),c(h)}function g(e){p(),u(),v(),e&&i.logUserAction(r.UserAction.ToggleFullscreenOn,e)}function y(e){_(),f(),d(),e&&i.logUserAction(r.UserAction.ToggleFullscreenOff,e)}function b(){var e=document.body;return e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen}function w(){var e=document;return null!=e.fullScreen?e.fullScreen:null!=e.webkitIsFullScreen?e.webkitIsFullScreen:null!=e.mozFullScreen?e.mozFullScreen:null!=e.msFullscreenElement||null!=e.fullscreenElement}Object.defineProperty(t,"__esModule",{value:!0});var S=n.getStoreForFileViewer();t.enterFullScreen=g,t.exitFullScreen=y,t.browserSupportFullScreen=b,t.isBrowserFullscreen=w}),define("modules/clean/react/file_viewer/more_dropdown/models",["require","exports","tslib","external/lodash"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var i=(function(){function e(){}return e.prototype.equals=function(e){return o.isEqual(this,e)},e})(),r=(function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return n.className=t.className||null,n.fileActionButtonType=t.fileActionButtonType||null,n.handler=t.handler||o.noop,n.component=t.component||null,n.sortWeight=t.sortWeight||0,n}return n.__extends(t,e),t})(i);t.MoreOption=r;var a=(function(e){function t(t){var n=e.call(this)||this;return n.fileActionButtonGroup=t.fileActionButtonGroup,n.options=t.options||[],n.sortWeight=t.sortWeight||0,n}return n.__extends(t,e),t})(i);t.MoreOptionGroup=a}),define("modules/clean/react/file_viewer/more_dropdown/more_option_registry",["require","exports","tslib","external/lodash","modules/clean/react/file_viewer/more_dropdown/models"],function(e,t,n,o,i){"use strict";function r(e,t){return e.filter(function(e){return e!==t})}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var a=(function(){function e(){this.listeners=[]}return e.prototype.emitChange=function(){return this.listeners.forEach(function(e){return e()})},e.prototype.addListener=function(e){var t=this;return this.listeners.push(e),function(){var n=t.listeners.indexOf(e);n>-1&&t.listeners.splice(n,1)}},e})(),s=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.options=[],t}return n.__extends(t,e),t.prototype.isValidMoreOption=function(e){return null!=e.fileActionButtonType},t.prototype.isValidMoreOptionGroup=function(e){var t=this,n=e.options;return n.length&&n.every(function(e){return t.isValidMoreOption(e)})},t.prototype.isValidOption=function(e){return e instanceof i.MoreOption&&this.isValidMoreOption(e)||e instanceof i.MoreOptionGroup&&this.isValidMoreOptionGroup(e)},t.prototype.getOptionItems=function(){return o.sortBy(this.options.slice(),function(e){return e.sortWeight})},t.prototype.addOption=function(e){if(!this.isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");this.options=this.options.concat([e]),this.emitChange()},t.prototype.removeOption=function(e){if(null!=e&&!this.isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");var t=this.options.length;this.options=r(this.options,e),this.options.length<t&&this.emitChange()},t.prototype.replaceOption=function(e,t){if(null==t)throw new Error("Please provide option to replace it with. Otherwise use removeOption");if(!this.isValidOption(e)||!this.isValidOption(t))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");if(!e.equals(t)){var n=!1;this.options=this.options.map(function(o){return o===e?(n=!0,t):o}),n&&this.emitChange()}},t})(a);t.MoreOptionRegistry=s,t.moreOptionRegistry=new s});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};define("modules/clean/react/file_viewer/open_button/open_button",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenButton=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/file_viewer/open_button/open_button_component"],t,n)}).then(__importStar).then(function(e){return e.OpenButton})}})}),define("modules/clean/react/file_viewer/open_in_paper",["require","exports","tslib","external/react","modules/clean/react/async/loadable","modules/clean/react/file_viewer/utils","modules/constants/file_viewer"],function(e,t,n,o,i,r,a){"use strict";function s(){return"VARIANT_A"===a.OPEN_IN_PAPER_VARIANT}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),a=n.__importStar(a);var l=i.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/paper/open_in_paper_banner"],t,n)}).then(n.__importStar).then(function(e){return e.OpenInPaperBanner})}});t.OpenInPaperBanner=function(e){var t=e.currentFile,n=e.sharedLinkInfo,i=e.sharePermission,a=e.user;return s()&&r.canUserUsePaper(a)&&r.canDownloadFile(n,i)?o.createElement(l,{file:t,sharedLink:n.url,source:null!=n?"shared_file_actions":"mounted_file_actions"}):null}}),define("modules/clean/react/file_viewer/title_bar",["require","exports","tslib","external/react","modules/clean/react/async/loadable"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.TitleBar=i.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/file_viewer/title_bar_component"],t,n)}).then(n.__importStar).then(function(e){return e.TitleBar})},loading:o.createElement("div",{className:"react-title-bar"})})}),define("modules/clean/react/file_viewer/utils",["require","exports","tslib","external/lodash","modules/clean/activity/constants","modules/clean/ajax","modules/core/browser","modules/clean/previews/util","modules/clean/open_with","modules/clean/previews/constants","modules/clean/react/file_viewer/constants","modules/constants/file_viewer","modules/core/uri","modules/clean/react/previews/constants","modules/constants/python","modules/clean/react/file_viewer/constants","modules/clean/react/previews/image_helpers","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/constants","modules/clean/react/size_class/constants","modules/clean/file_store/utils","modules/clean/previews/path_context_utils","modules/clean/previews/responsive_utils"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,m,h,v,_,g,y,b,w,S){"use strict";function C(e){return G.indexOf(e.preview_type)>-1&&!s.isLimitedPreview(e)}function E(e){return Array.isArray(e)?e.filter(function(e){return C(e)}).map(function(e){return e}):[]}function A(e,t){return d.WOPI_BUTTON_VISIBLE&&e.bytes<=l.default.MAX_SUPPORTED_FILE_SIZE_B&&null!==l.default.get_open_handler_for(e,t)}function T(e,t){return l.default.get_open_handler_for(e,t)}function x(e,t){var n=T(e,t),o=n.uri+"?hpt_click_ts="+Date.now();a.redirect(o)}function P(e,t){r.SilentBackgroundRequest({url:"/ow/get_available_tooltips",dataType:"json",success:function(e){return t(e)},subject_user:e})}function k(e,t){for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];for(var i in o)if(o.hasOwnProperty(i)){var r=o[i],a=r.extensions;if(a.indexOf(t)>-1)return{vendor:n,application:i}}}return null}function O(e,t,n){"acrobat_or_reader"===n?r.SilentBackgroundRequest({url:"/ow/log_adobe_tooltip_impression",data:{app_name:n,extension:e},subject_user:t}):r.SilentBackgroundRequest({url:"/ow/msft/log_tooltip_impression",data:{app_type:n,extension:e},subject_user:t})}function I(e,t){if(e===u.SplitButtonActionLocation.Main){if(t===u.FileViewerPane.TitleBar)return u.UserActionContext.TitleBarMain;if(t===u.FileViewerPane.PreviewContent)return u.UserActionContext.PreviewContentMain}else if(e===u.SplitButtonActionLocation.Split){if(t===u.FileViewerPane.TitleBar)return u.UserActionContext.TitleBarSplitButton;if(t===u.FileViewerPane.PreviewContent)return u.UserActionContext.PreviewContentSplitButton}return u.UserActionContext.Unknown}function M(){for(var e=!1,t=document.getElementsByClassName("db-modal-wrapper"),n=0;!e&&n<t.length;n++){e="none"!==window.getComputedStyle(t[n]).display}return e}function R(){var e=document.querySelectorAll(".prerender-preview");Array.prototype.forEach.call(e,function(e){e.style.display="none"})}function F(){return new p.URI({path:"/login",query:{cont:a.get_href()}}).toString()}function D(){return"BANNER"===d.OPEN_IN_APP_VARIANT}function N(e,t){if([i.ActivityContext.BROWSE_FILE_VIEWER,i.ActivityContext.SHARED_LINK_VIEW,i.ActivityContext.SHARED_CONTENT_LINK_VIEW].indexOf(e)>=0)switch(t){case c.PreviewType.Photo:return u.FileViewerInterfaceType.Window;case c.PreviewType.Doc:return u.FileViewerInterfaceType.Frame}}function L(e){return!e}function U(e,t){return L(e)||t&&t.canDownloadRoles.length>0}function z(e){return null!=e&&!e.is_paper_disabled}function H(e){switch(e){case m.FileViewTargetType.SHARED_LINK:return i.ActivityContext.SHARED_LINK_VIEW;case m.FileViewTargetType.SHARED_CONTENT_LINK:return i.ActivityContext.SHARED_CONTENT_LINK_VIEW;default:return i.ActivityContext.BROWSE_FILE_VIEWER}}function B(e){switch(e){case h.PathContext.SharedLinkCollection:return f.PreviewSourceContext.SharedLinkCollection;case h.PathContext.VersionHistory:return f.PreviewSourceContext.VersionHistory;default:return f.PreviewSourceContext.Browse}}function V(e){switch(e){case h.PathContext.SharedLinkFile:case h.PathContext.SharedLinkFolder:return f.PreviewSourceAction.Visit;default:return f.PreviewSourceAction.Click}}function q(e,t){if(0!==e.length){var n=[];[0,1,2,3,4,5,6,-1,-2].forEach(function(o){var i=(t+o+e.length)%e.length;n.indexOf(i)===-1&&n.push(i)}),n.forEach(function(t){if(e.length>t&&e[t].preview_type===c.PreviewType.Photo){var n=e[t],o=n.preview_url||n.thumbnail_url_tmpl;o&&v.preloadResponsiveImage(o).then(function(e){var n=_.FileViewerSession.currentSession;null==n||t in n.imagesFetched||(n.imagesFetched[t]=e)})}})}}function j(e){var t=e.renderStatus,n=e.hidePageChrome,o=e.sizeClass;return d.PREVIEW_QUALITY_POPUP_PROBABILITY<=0&&t===g.PreviewRenderStatus.Succeeded&&!n&&o!==y.SizeClass.Small}function W(e){var t=e.renderStatus,n=e.hidePageChrome,o=e.sizeClass;return!(d.PREVIEW_QUALITY_POPUP_PROBABILITY<=0)&&(t===g.PreviewRenderStatus.Succeeded&&(!n&&o!==y.SizeClass.Small))}function K(e){return"sketch"===b.getExtension(e)}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),r=n.__importStar(r),a=n.__importStar(a),l=n.__importDefault(l),v=n.__importStar(v);var G=[c.PreviewType.Photo];t.FlippableHelpers={isFlippableFile:C,filterFlippableFiles:E},t.OpenWithHelpers={canOpenWith:A,getOpenWithHandlerData:T,openWith:x},t.TooltipHelpers={fetchTooltipInfo:P,getVendorAndApplication:k,logImpression:O},t.getSplitButtonUserActionContext=I,t.modalIsUp=M,t.cleanupPrerenderPreview=R,t.getSharedLinkLoginUrl=F,t.sharedLinkLoginUrl=F(),t.renderOpenInAppAsBanner=D,t.determinePathContext=w.determinePathContext,t.isResponsiveEnabled=S.isResponsiveEnabled,t.getFileViewerInterfaceType=N,t.isMountedFile=L,t.canDownloadFile=U,t.canUserUsePaper=z,t.getActivityContext=H,t.getSourceContext=B,t.getSourceAction=V,t.preloadImages=q,t.shouldShowSearchSuccessBanner=j,t.shouldShowPreviewQualityPopup=W,t.fetchRivieraStatusCode=function(e,t,n){void 0===n&&(n=function(){});var i=new XMLHttpRequest;return i.open("GET",e),i.withCredentials=!0,i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)try{var e=i.getResponseHeader("x-dropbox-metadata");if(e){var r=JSON.parse(e),a=o.get(r,"rivieraStatusCode");void 0!==a&&t(a)}else n()}catch(e){n()}},i.send(),i},t.shouldFetchRivieraStatusCode=K}),define("modules/clean/react/keyboard_binding/keyboard_binding",["require","exports","tslib","external/lodash","modules/clean/keycode"],function(e,t,n,o,i){"use strict";function r(e){return n.__assign({},t.genericKeyboardEventCriteria,{which:e})}function a(e){return n.__assign({},y,{which:e})}function s(e){return{keyboardEventCriteria:n.__assign({},t.genericKeyboardEventCriteria,e.keyboardEventCriteria),callback:null!=e.callback?e.callback:b}}function l(e){return{altKey:!!e.altKey,ctrlKey:!!e.ctrlKey,metaKey:!!e.metaKey,shiftKey:!!e.shiftKey,which:e.which||e.keyCode}}function c(e){return{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,which:e.which||e.keyCode}}function u(e){return n.__assign({},e,{keyCode:null!=e.keyCode?e.keyCode:e.which})}function d(e,t){return[(n={which:e},n[t]=!0,n),(o={which:e},o[t]=!1,o)];var n,o}function p(e){return function(t){return d(t,e)}}function f(e){return o.flatten(e.map(p("shiftKey")))}function m(e,t){return e.map(function(e){return s({keyboardEventCriteria:e,callback:t})})}function h(e){return m(w,e)}function v(e){return m(S,e)}function _(e){return void 0!==e.preventDefault}function g(e){return function(t){e(),_(t)&&t.preventDefault()}}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.genericKeyboardEventCriteria={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0};var y={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0};t.SimpleKeyboardEventKeys=Object.keys(y),t.KeyboardEventCriteriaKeys=Object.keys(t.genericKeyboardEventCriteria),t.generateUnmodifiedKeyboardEventCriteria=r,t.generateUnmodifiedSimpleKeyboardEvent=a;var b=function(){};t.hydrateKeyboardBinding=s,t.getKeyboardEventCriteria=l,t.getSimpleKeyboardEvent=c,t.addLegacyPropertiesToSimpleKeyboardEvent=u;var w=f([i.KeyCode.EQUALS,i.KeyCode.PLUS_EQUALS_FF,i.KeyCode.PLUS_CHROME,i.KeyCode.PLUS_EQUALS_FF_GERMAN]),S=f([i.KeyCode.MINUS_FF_MAC,i.KeyCode.MINUS_FF,i.KeyCode.MINUS_CHROME]);t.getEqualsKeyBindings=h,t.getMinusKeyBindings=v,t.isKeyboardEvent=_,t.withPreventDefault=g}),define("modules/clean/react/keyboard_binding/keyboard_binding_connector",["require","exports","tslib","external/react","modules/clean/react/keyboard_binding/keyboard_binding_provider"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var r=(function(e){function t(t,n){var o=e.call(this,t,n)||this;if(!n.registerKeyBindings||!n.unregisterKeyBindings)throw new Error("KeyboardBindingConnector must be a child of a KeyboardBindingProvider");return o}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.registrationIdentifier=this.context.registerKeyBindings(this.props.keyboardBindings),this.context.registerAllKeyCallback(this.registrationIdentifier,this.props.allKeyCallback)},t.prototype.componentWillReceiveProps=function(e){this.props.keyboardBindings!==e.keyboardBindings&&this.context.updateKeyBindings(this.registrationIdentifier,e.keyboardBindings),this.props.allKeyCallback!==e.allKeyCallback&&this.context.registerAllKeyCallback(this.registrationIdentifier,e.allKeyCallback)},t.prototype.componentWillUnmount=function(){this.context.unregisterKeyBindings(this.registrationIdentifier)},t.prototype.render=function(){return null},t.contextTypes=i.KeyboardBindingProviderContextTypes,t})(o.Component);t.KeyboardBindingConnector=r}),define("modules/clean/react/keyboard_binding/keyboard_binding_provider",["require","exports","tslib","external/react","external/prop-types","modules/clean/callback_chain/callback_chain","modules/clean/keycode","modules/clean/react/keyboard_binding/keyboard_binding"],function(e,t,n,o,i,r,a,s){"use strict";function l(e){var t=s.getKeyboardEventCriteria(e),n="";return s.KeyboardEventCriteriaKeys.forEach(function(e){n+=e+":"+t[e]+","}),n}function c(e){return e.reduce(function(e,t){return t.reduce(function(e,t){var n=t.keyboardEventCriteria,o=t.callback,i=l(n);return e[i]=e[i]||[],e[i].push(o),e},e)},{})}function u(e){var t=s.addLegacyPropertiesToSimpleKeyboardEvent(e);new r.CallbackChain(p).run(t)}function d(e){var t=e.target||e.srcElement;if(!t)return!0;var n=t.tagName,o=e.which,i="INPUT"===n||"SELECT"===n||"TEXTAREA"===n,r=["submit","button"].indexOf(t.type)!==-1,s=t.hasAttribute&&t.hasAttribute("contenteditable")&&"false"!==t.getAttribute("contenteditable").toLowerCase();return!(i&&!r||s)||(o===a.KeyCode.ESC||o===a.KeyCode.TAB)}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),i=n.__importStar(i),t.KeyboardBindingProviderContextTypes={registerAllKeyCallback:i.func,registerKeyBindings:i.func,unregisterKeyBindings:i.func,updateKeyBindings:i.func};var p=[];t.noop=function(e){};var f=(function(e){function i(n){var o=e.call(this,n)||this;return o.registrationIdentifier=0,o.registeredBindings=[],o.keyboardBindingsByCriteria={},o.allKeyHandlers=[],o.registerKeyBindings=function(e){var n=o.registrationIdentifier++;return o.updateKeyBindings(n,e),o.allKeyHandlers[n]||(o.allKeyHandlers[n]=t.noop),n},o.registerAllKeyCallback=function(e,n){o.allKeyHandlers[e]=null!=n?n:t.noop},o.unregisterKeyBindings=function(e){o.updateKeyBindings(e,[]),o.allKeyHandlers[e]=t.noop},o.updateKeyBindings=function(e,t){o.registeredBindings[e]=null!=t?t:[],o.keyboardBindingsByCriteria=c(o.registeredBindings)},o.onKeyDown=function(e){if(d(e)){var t=o.getCallbacksForKey(e);new r.CallbackChain(t).run(e)}},o.allKeyHandlers=[],o.registeredBindings=[],o}return n.__extends(i,e),i.prototype.componentDidMount=function(){document.addEventListener("keydown",this.onKeyDown),this.providerIdentifier=p.length,p.push(this.onKeyDown),this.props.onSetup&&this.props.onSetup()},i.prototype.componentWillUnmount=function(){document.removeEventListener("keydown",this.onKeyDown),p[this.providerIdentifier]=t.noop,this.props.onDestroy&&this.props.onDestroy()},i.prototype.getChildContext=function(){return{registerAllKeyCallback:this.registerAllKeyCallback,registerKeyBindings:this.registerKeyBindings,unregisterKeyBindings:this.unregisterKeyBindings,updateKeyBindings:this.updateKeyBindings}},i.prototype.getCallbacksForKey=function(e){var t=l(e);return(this.keyboardBindingsByCriteria[t]||[]).concat(this.allKeyHandlers)},i.prototype.render=function(){return o.Children.only(this.props.children)},i.childContextTypes=t.KeyboardBindingProviderContextTypes,i})(o.Component);t.KeyboardBindingProvider=f,t.getIndexForkeyboardBindingsByCriteria=l,t.generateKeyboardBindingsByCriteriaFromKeyboardBindings=c,t.simulateKeyEvent=u}),define("modules/clean/react/open_in_app/button",["require","exports","tslib","external/react","spectrum/button","modules/clean/open_in_app/actions","modules/core/i18n","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants"],function(e,t,n,o,i,r,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var c=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleClick=function(){s.logUserAction(l.UserAction.OpenInApp,n.props.userActionContext),r.openInApp(n.props.urls,{onAppNeeded:function(){return n.setState({showInstallAppText:!0})},onAppInstalled:function(){return n.setState({showInstallAppText:!1})}})},n.state={showInstallAppText:!1},n}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){r.cleanUp()},t.prototype.render=function(){return o.createElement(i.Button,{className:"control__button open-in-app-button",variant:"primary",onClick:this.handleClick},this.state.showInstallAppText?a._("Install app?"):a._("Open in app"))},t})(o.Component);t.OpenInAppButton=c});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};define("modules/clean/react/previews/archive/preview_archive_loadable",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewArchiveLoadable=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/archive/preview_archive"],t,n)}).then(__importStar).then(function(e){return e.PreviewArchive})}})}),define("modules/clean/react/previews/error/file_info",["require","exports","tslib","external/react","modules/clean/display_format"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.PreviewErrorFileInfo=function(e){var t=e.bytes,n=e.filename;return o.createElement("div",{className:"preview-error__info"},n,void 0!==t?o.createElement("span",null,o.createElement("span",{className:"bottom-dot"}," · "),i.format_bytes(t)):null)}}),define("modules/clean/react/previews/error/fullscreen_view",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/file_viewer/actionable","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/error/file_info","modules/clean/react/previews/error/message","modules/clean/react/previews/preview_zoom_container"],function(e,t,n,o,i,r,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var d=function(e){var t=e.allowOpenInApp,n=e.areActionablesEnabled,i=e.count,d=e.errorType,p=e.file,f=e.filename,m=e.index,h=e.message,v=e.onNext,_=e.onPrevious,g=e.sharedLinkInfo,y=e.shareToken,b=e.sharePermission,w=e.user;return o.createElement(u.PreviewZoomContainer,{fileCount:i,fileIndex:m,onClose:s.exitFullScreen,onFlipNext:v,onFlipPrevious:_,renderZoomControls:!1},o.createElement("div",{className:"preview-error--fullscreen fullscreen"},o.createElement(c.PreviewErrorMessage,{file:p,errorType:d,message:h}),o.createElement(l.PreviewErrorFileInfo,{bytes:p.bytes,filename:f}),n?o.createElement(r.Actionable,{allowOpenInApp:!!t,file:p,variant:"primary",location:a.FileViewerPane.PreviewContent,sharedLinkInfo:g,shareToken:y,sharePermission:b,user:w,userActionContext:a.UserActionContext.PreviewContentMain}):null))},p=i.requireCssWithComponent(d,["/static/css/preview_image-vflyaNqpo.css","/static/css/preview_error-vflcybjC2.css"]);t.PreviewErrorFullscreenView=p}),define("modules/clean/react/previews/error/image",["require","exports","tslib","external/react","modules/clean/react/image","modules/clean/react/previews/constants","modules/clean/static_urls"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.PreviewErrorImage=function(e){var t,n=e.errorType;switch(n){case r.ErrorType.PendingUploadError:t=o.createElement(i.Image,{src:a.static_url("/static/images/previews/error/file_uploading_1x-vflRuLSg0.png"),srcHiRes:a.static_url("/static/images/previews/error/file_uploading_2x-vflKOdrWj.png")});break;case r.ErrorType.ExtensionError:t=o.createElement(i.Image,{src:a.static_url("/static/images/previews/error/filetype_not_supported_1x-vflmIVODZ.png"),srcHiRes:a.static_url("/static/images/previews/error/filetype_not_supported_2x-vflE8HW8X.png")});break;case r.ErrorType.FileSizeError:t=o.createElement(i.Image,{src:a.static_url("/static/images/previews/error/file_too_large_1x-vflDGNPuo.png"),srcHiRes:a.static_url("/static/images/previews/error/file_too_large_2x-vfl-r0UPt.png")});break;case r.ErrorType.PasswordProtectedError:t=o.createElement(i.Image,{src:a.static_url("/static/images/previews/error/password_protected_1x-vflnFAKjt.png"),srcHiRes:a.static_url("/static/images/previews/error/password_protected_2x-vflnBXZ1k.png")});break;case r.ErrorType.NeedFlashError:case r.ErrorType.SymLinkError:case r.ErrorType.EmptyFileError:case r.ErrorType.LoadError:default:t=o.createElement(i.Image,{src:a.static_url("/static/images/previews/error/unavailable_1x-vflG2AHMd.png"),srcHiRes:a.static_url("/static/images/previews/error/unavailable_2x-vflGPrE5d.png")})}return o.createElement("div",{className:"u-mar-bottom-s preview-error__image"},t)}}),define("modules/clean/react/previews/error/message",["require","exports","tslib","external/react","modules/clean/file_store/utils","modules/clean/react/previews/constants","modules/clean/react_format","modules/core/i18n"],function(e,t,n,o,i,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.PreviewErrorMessage=function(e){var t;if(e.message)t=e.message;else switch(e.errorType){case r.ErrorType.PendingUploadError:t=s._("File is uploading...");break;case r.ErrorType.EmptyFileError:t=s._("Empty files can’t be previewed");break;case r.ErrorType.ExtensionError:if(!e.file)throw new Error("Extension error requires a file prop");var n=i.getExtension(e.file);if(n){var l=i.isArchiveFile(e.file)&&e.file.preview_type?s._("<span>.%(extension)s</span> files can’t be previewed from an archive file.",{comment:"Like '.exe files can’t be previewed from an archive file'"}):s._("<span>.%(extension)s</span> files can’t be previewed.",{comment:"Like '.exe files can’t be previewed'"});t=a.reactFormat(l,{span:o.createElement("span",{className:"preview-error__message--bold"}),extension:n})}else t=s._("This file cannot be previewed. Please check to see if your file extension is correct.");break;case r.ErrorType.FileSizeError:t=s._("This file is too big to preview. To see the full content, please download the file.");break;case r.ErrorType.PasswordProtectedError:t=a.reactFormat(s._("Couldn’t preview file. <br /> The file is password-protected."),{br:o.createElement("br",null)});break;case r.ErrorType.NeedFlashError:t=a.reactFormat(s._("Install <a>Adobe Flash Player</a> to preview this video."),{a:o.createElement("a",{href:"https://get.adobe.com/flashplayer/"})});break;case r.ErrorType.SymLinkError:t=s._("SymLink files cannot be previewed.");break
;case r.ErrorType.LoadError:default:t=s._("This file can’t be previewed")}return o.createElement("div",{className:"preview-error__message"},t)}}),define("modules/clean/react/previews/error/preview_error",["require","exports","tslib","external/react","modules/clean/em_string","modules/clean/previews/pending_upload_watcher","modules/clean/react/css","modules/clean/file_store/utils","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/react/previews/error/fullscreen_view","modules/clean/react/previews/error/view","modules/clean/stormcrow/stormcrow_exposure_logger","modules/clean/web_timing_logger","modules/constants/file_viewer","modules/clean/react/async/loadable"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,m,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),f=n.__importStar(f),m=n.__importStar(m);var v=h.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/file_viewer/exp_autocad_preview_upsell"],t,n)}).then(n.__importStar).then(function(e){return e.AutocadPreviewUpsell})}}),_=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){if(f.set_tti_exclusion_flow("failed previews not included"),f.mark_time_to_view(),f.mark_time_to_interactive(),this.logPreviewSupportDenied(),this.props.errorType===c.ErrorType.PendingUploadError&&this.props.shareToken){new r.PendingUploadWatcher(this.props.shareToken.linkType,this.props.shareToken.linkKey,this.props.shareToken.secureHash).startPolling()}if(this.props.user&&this.props.errorType===c.ErrorType.SupportError&&"dwg"===s.getExtension(this.props.file)){(new p.StormcrowExposureLogger).logExposure("sharegrowth_skyscraper",m.SHAREGROWTH_SKYSCRAPER)}},Object.defineProperty(t.prototype,"allowOpenInApp",{get:function(){return!!this.props.file.open_in_app_data&&!this.props.isMobileUserAgent},enumerable:!0,configurable:!0}),t.prototype.logPreviewSupportDenied=function(){this.props.errorType!==c.ErrorType.LoadError&&this.props.errorType!==c.ErrorType.PendingUploadError&&this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(l.EventType.FilePreviewSupportDenied,{errorType:this.props.errorType})},t.prototype.render=function(){var e=i.Emstring.em_snippet(s.getFilename(this.props.file),this.props.maxFilenameEmLength);return this.props.user&&this.props.errorType===c.ErrorType.SupportError&&"dwg"===s.getExtension(this.props.file)&&"V1"===m.SHAREGROWTH_SKYSCRAPER?o.createElement(v,n.__assign({},this.props,{allowOpenInApp:this.allowOpenInApp,filename:e,sharegrowthSkyscraper:m.SHAREGROWTH_SKYSCRAPER,user:this.props.user})):this.props.isFullscreen?o.createElement(u.PreviewErrorFullscreenView,n.__assign({},this.props,{allowOpenInApp:this.allowOpenInApp,filename:e})):o.createElement(d.PreviewErrorView,n.__assign({},this.props,{allowOpenInApp:this.allowOpenInApp,filename:e}))},t.defaultProps={areActionablesEnabled:!0,isFullscreen:!1},t})(o.Component);t._PreviewError=_;var g=a.requireCssWithComponent(_,["/static/css/preview_error-vflcybjC2.css"]);t.PreviewError=g}),define("modules/clean/react/previews/error/view",["require","exports","tslib","external/classnames","external/react","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/file_store/utils","modules/clean/react/file_viewer/actionable","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/react/previews/error/file_info","modules/clean/react/previews/error/image","modules/clean/react/previews/error/message","modules/core/i18n"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),i=n.__importStar(i),t.PreviewErrorView=function(e){var t=e.areActionablesEnabled,n=e.allowOpenInApp,f=e.count,h=e.errorType,v=e.file,_=e.filename,g=e.index,y=e.message,b=e.onNext,w=e.onPrevious,S=e.sharedLinkInfo,C=e.shareToken,E=e.sharePermission,A=e.shouldDisplayToolbar,T=e.sizeClass,x=e.user;return i.createElement("div",{className:o.default({"preview-content":!0,"preview-content--center":!0,"preview-error":!0,"has-toolbar":A})},i.createElement("div",{className:"preview-error__wrapper"},i.createElement("div",{className:"preview-error__content"},i.createElement(d.PreviewErrorImage,{errorType:h}),i.createElement(p.PreviewErrorMessage,{file:v,errorType:h,message:y}),i.createElement(u.PreviewErrorFileInfo,{filename:_,bytes:v.bytes}),t?i.createElement(s.Actionable,{allowOpenInApp:!!n,file:v,variant:"primary",location:l.FileViewerPane.PreviewContent,sharedLinkInfo:S,shareToken:C,sharePermission:E,user:x,userActionContext:l.UserActionContext.PreviewContentMain,sizeClass:T}):null,h!==c.ErrorType.ExtensionError||a.isArchiveFile(v)?null:i.createElement(m,null)),A&&null!=g&&null!=f?i.createElement("div",{className:"preview-toolbar-container"},i.createElement(r.PreviewImageAnnotationsToolbar,{index:g,count:f,onPrevious:w,onNext:b})):null))};var m=function(){return i.createElement("div",{className:"preview-error__help-link"},i.createElement("a",{href:l.UnsupportedExtensionHelpLink,target:"_blank",rel:"noopener\n    noreferrer"},f._("Learn more.")))}}),define("modules/clean/react/previews/frame_messenger_host",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_host"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(){var t=["www.dropboxstatic.com","cf.dropboxstatic.com","cfl.dropboxstatic.com","www.dropbox.com","dl-web.dropbox.com","dl.dropboxusercontent.com","previews.dropboxusercontent.com","previews.dropbox.com"],n=t.map(function(e){return"https://"+e});return n.push("null"),n.push(RegExp(".*previews.*.dropboxusercontent.com")),e.call(this,n)||this}return n.__extends(t,e),t})(o.FrameMessengerHost);t.PreviewFrameMessengerHost=i}),define("modules/clean/react/previews/image/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IMAGE_LARGE_PADDING_HEIGHT=148,t.IMAGE_LARGE_PADDING_WIDTH=72,t.IMAGE_PADDING_HEIGHT=50,t.IMAGE_PADDING_WIDTH=0}),define("modules/clean/react/previews/image_helpers",["require","exports","tslib","modules/constants/python","modules/clean/photos/thumbnail_url_util"],function(e,t,n,o,i){"use strict";function r(e,t){var n;return n=t?c.filter(function(e){var n=e[0],o=e[1];return n<=t[0]&&o<=t[1]}):c,n.map(function(t){var n=t[0],r=t[1];return i.thumbnailUrlForSize(e,n,r,o.THUMBNAIL_SIZE_MODE.ABSTRACT)+" "+n+"w"}).join(", ")}function a(e){return i.thumbnailUrlForSize(e,800,600,3)}function s(e){return l(a(e),{srcset:r(e),sizes:t.IMG_SIZES_ATTR})}function l(e,t){return new Promise(function(n,o){var i=Date.now(),r=new Image;r.onload=function(){n({started:i,completed:Date.now()})},r.onerror=function(){o({started:i,failed:Date.now()})},t&&(t.srcset&&(r.srcset=t.srcset),t.sizes&&(r.sizes=t.sizes)),r.src=e})}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var c=[[480,320],[640,480],[800,600],[1024,768],[1280,960],[1600,1200],[2048,1536]];t.IMG_SIZES_ATTR="90vw",t.getSrcSet=r,t.getFallbackSrc=a,t.preloadResponsiveImage=s,t.preloadImage=l}),define("modules/clean/react/previews/loading_indicator",["require","exports","tslib","external/classnames","external/react"],function(e,t,n,o,i){"use strict";function r(e){return i.createElement("div",{className:o.default("c-loader",e.className)})}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),i=n.__importStar(i),t.LoadingIndicator=r}),define("modules/clean/react/previews/pdf_viewer/placeholder_image",["require","exports","tslib","external/react","modules/clean/react/previews/image_helpers","modules/core/i18n"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),i=n.__importStar(i),t.PlaceholderImage=function(e){var t=e.url,n=e.addLeftMargin,a=e.onError,s=e.onLoad,l=n?"placeholder-image-wrapper-margin-left__border":"placeholder-image-wrapper__border";return o.createElement("div",{className:"placeholder-image-wrapper"},o.createElement("div",{className:l},o.createElement("img",{className:"placeholder-image disabled-context-menu",alt:r._("Loading"),sizes:i.IMG_SIZES_ATTR,src:i.getFallbackSrc(t),srcSet:i.getSrcSet(t),onError:a,onLoad:s})))}}),define("modules/clean/react/previews/preview_html",["require","exports","tslib","external/react","external/react-dom","modules/clean/react/previews/constants","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/previews/frame_messenger_host","modules/clean/react/previews/preview_toolbar_container","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/core/browser","modules/core/uri"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),i=n.__importStar(i),d=n.__importStar(d),p=n.__importStar(p);var m=["failed","viewer-ready"],h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getIframeProps=function(){var e={title:t.props.filename,name:"preview-content",type:"text/html",src:t.getIframeSrc(),sandbox:"",className:"previewhtml",ref:t.setRefIframe};return t.props.usesFrameMessenger&&(e.sandbox="allow-modals allow-scripts allow-forms"),e},t.handleTrustedMessageFromChild=function(e){switch(e.action){case"failed":t.logFilePreviewEvent(s.EventType.FilePreviewDownloadSucceeded),t.logFilePreviewEvent(s.EventType.FilePreviewRenderFailed);var n=r.RivieraConvertResponseType.Unknown;e.parameters&&(n=e.parameters.rivieraStatusCode),t.props.onError&&t.props.onError(a.mapRivieraStatusToErrorType(n));break;case"viewer-ready":t.markWebTiming(),t.logFilePreviewEvent(s.EventType.FilePreviewDownloadSucceeded),t.logFilePreviewEvent(s.EventType.FilePreviewRenderSucceeded),t.props.setRenderStatusSuccess(),t.props.isFullscreen?t.frameMessenger.postMessageToChildren("enter-fullscreen"):t.frameMessenger.postMessageToChildren("exit-viewer-fullscreen"),t.props.sharePermission&&0===t.props.sharePermission.canDownloadRoles.length&&t.frameMessenger.postMessageToChildren("disable-download"),t.shouldIncreaseTabHeightForExcel()&&t.frameMessenger.postMessageToChildren("increase-tab-height")}},t.handleIframeLoad=function(){t.logFilePreviewEvent(s.EventType.FilePreviewDownloadSucceeded),t.props.usesFrameMessenger||(t.markWebTiming(),t.logFilePreviewEvent(s.EventType.FilePreviewRenderSucceeded))},t.handleIframeError=function(){t.logFilePreviewEvent(s.EventType.FilePreviewDownloadFailed)},t.setRefIframe=function(e){t.iframe=e},t}return n.__extends(t,e),t.prototype.getIframeSrc=function(){var e=f.URI.parse(this.props.src);return this.props.isExcel&&(this.props.forceTestExcelHtml?e.updateQuery({canned_file_name:s.CannedTestFilename.ExcelHTML}):"password_protected"===this.props.forceRivieraException?e.updateQuery({canned_exception:"riviera_exception_password"}):"too_big"===this.props.forceRivieraException&&e.updateQuery({canned_exception:"riviera_exception_too_big"})),e.toString()},t.prototype.shouldIncreaseTabHeightForExcel=function(){return this.props.isExcel&&p.is_mobile_or_tablet()},t.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.markWebTiming=function(){this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent(),d.mark_time_to_view(),d.mark_time_to_interactive()},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(s.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(s.EventType.FilePreviewDownloadAttempted),this.props.usesFrameMessenger&&(this.frameMessenger=new l.PreviewFrameMessengerHost,this.frameMessenger.configureChildMessaging("iframe.previewhtml",this.handleTrustedMessageFromChild,m),this.frameMessenger.startListening());var e=i.findDOMNode(this.iframe);e.onload=this.handleIframeLoad,e.onerror=this.handleIframeError},t.prototype.componentWillUnmount=function(){this.props.usesFrameMessenger&&this.frameMessenger.stopListening()},t.prototype.render=function(){var e={};p.iOS&&(e=a.iOSIframeScrollStyles());var t=this.props,i=t.count,r=t.fileExtension,l=t.index,d=t.isFullscreen,f=t.isExcel,m=t.sharePermission,h=t.sizeClass,v=t.onClickNext,_=t.onClickPrevious;return o.createElement("div",{className:"preview-content",style:e},o.createElement("iframe",n.__assign({},this.getIframeProps())),o.createElement(c.PreviewToolbarContainer,{elevateToolbar:f,isFullscreen:d,previewToolbarProps:{count:i,docType:f?s.DocType.spreadsheet:s.DocType.html,fileExtension:r,index:l,isFullscreen:d,isHidden:h===u.SizeClass.Small,isSidebarOpen:!1,pagesCount:1,sharePermission:m,shouldDisplayRegionCreationButton:!1,sizeClass:h,onClickNext:v,onClickPrevious:_},forceDisableRegionAnnotation:!0,shouldUseImageToolbar:!1}))},t.defaultProps={usesFrameMessenger:!0},t})(o.Component);t.PreviewHTML=h}),define("modules/clean/react/previews/preview_image",["require","exports","tslib","external/classnames","external/lodash","external/react","modules/clean/analytics","modules/clean/image_annotations","modules/clean/image_preview_util","modules/clean/photos/thumbnail_url_util","modules/clean/previews/actions","modules/clean/react/comments2/components/annotation_pane","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/image_helpers","modules/clean/react/previews/loading_indicator","modules/clean/react/previews/preview_toolbar_container","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/clean/react/css","spectrum/dimensions"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,m,h,v,_,g,y,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),i=n.__importStar(i),r=n.__importStar(r),l=n.__importStar(l),u=n.__importStar(u),m=n.__importStar(m),g=n.__importStar(g);var w=(function(t){function y(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={width:"",height:"",zoomPercent:0,margin:"auto",zoomFit:!0,shouldDisplayFullSizeImage:!1,shouldLoadFullSizeImage:!1,imageLoaded:!1,shouldShowLoadingIndicator:!1},e.showLoadingIndicator=i.debounce(function(){e.state.imageLoaded||e.setState({shouldShowLoadingIndicator:!0})},1e3),e.onImageLoad=function(){e.props.filePreviewSession&&e.props.filePreviewSession.markPrimaryEvent(),g.mark_time_to_view(),g.mark_time_to_interactive(),e.logFilePreviewEvent(p.EventType.FilePreviewDownloadSucceeded),e.logFilePreviewEvent(p.EventType.FilePreviewRenderSucceeded),e.setState({shouldLoadFullSizeImage:!!e.props.shouldDisplayToolbar,imageLoaded:!0}),e.hideLoadingIndicator(),e.props.shouldDisplayToolbar&&e.imageAnnotations.onImageLoad(),e.props.setRenderStatusSuccess(),null!=e.props.onLoad&&e.props.onLoad()},e.onFullImageLoad=function(){e.setState({zoomFit:!0,zoomPercent:0})},e.onImageClick=function(){e.shouldDisableZoom()||e.openFullscreen()},e.onImageDoubleClick=function(){e.shouldDisableZoom()&&e.props.sizeClass!==_.SizeClass.Small&&e.openFullscreen()},e.openFullscreen=function(){null!=e.props.isFullscreen?f.enterFullScreen():e.previewImageZoom().open(e.props["preview-url"],e.props["file-extension"],e.props.onContextMenu,e.props.fileName)},e.onImageError=function(){e.logFilePreviewEvent(p.EventType.FilePreviewDownloadFailed),null!=e.props.onError&&e.props.onError()},e.onZoom=function(t,n,o){if(void 0===o&&(o=void 0),t+"px"!==e.state.width){if(void 0===o&&(o=e.calculateZoomPercent(n)),o<=e.minimumZoomPercent)return void e.onZoomFit();if(o>16){if(e.previewImageFullSize){var i=16*e.previewImageFullSize.naturalWidth,r=16*e.previewImageFullSize.naturalHeight;e.onZoom(i,r,16)}}else{var a=e.getImageDOMNode().width,s=t/a,c=l.getPreviewImageWrapper(),u=c.scrollLeft(),d=c.scrollTop(),p=c.width(),f=c.height(),m=p*(s-1)/2+u*s,h=f*(s-1)/2+d*s,v=n>=f?"0":"auto",_=t>=p?"0":"auto",g=v+" "+_;e.setState({shouldDisplayFullSizeImage:!!e.previewImageFullSize,width:t+"px",height:n+"px",margin:g,zoomPercent:o,zoomFit:!1},function(){c.scrollLeft(m),c.scrollTop(h),e.imageAnnotations.onResize(!1)})}}},e.onZoomIn=function(){e.zoomWithMultiplier(1.25)},e.onZoomOut=function(){e.zoomWithMultiplier(.8)},e.onZoomOriginalOrFit=function(){e.state.zoomFit?e.onZoomOriginal():e.onZoomFit()},e.onZoomOriginal=function(){if(e.previewImageFullSize){var t=e.previewImageFullSize.naturalWidth,n=e.previewImageFullSize.naturalHeight;e.onZoom(t,n)}},e.onZoomFit=function(){""!==e.state.width&&e.setState({width:"",height:"",margin:"auto",zoomFit:!0},function(){e.imageAnnotations.onResize(!1)})},e.onPrint=function(){u.imagePrint(c.fullSizeUrl(e.props["preview-url"]))},e.setPreviewImageRef=function(t){e.previewImage=t},e.setPreviewImageFullSizeRef=function(t){e.previewImageFullSize=t},e}return n.__extends(y,t),y.prototype.componentWillUnmount=function(){null==this.props.isFullscreen&&this.previewImageZoom().close(),null!=this.imageAnnotations&&this.imageAnnotations.reset(),this.hideLoadingIndicator()},y.prototype.componentWillMount=function(){this.imageAnnotations=new s.ImageAnnotations},y.prototype.componentDidMount=function(){this.logFilePreviewEvent(p.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(p.EventType.FilePreviewDownloadAttempted),this.logOpen();var t=this.getImageDOMNode();if(null!=t&&t.complete){var o=this.props,i=o.nsId,r=o.sjId,a=i+"_"+r;null!=i&&null!=r&&window._timingData&&window._timingData.img&&window._timingData.img.dl_error_finish&&window._timingData.img.dl_error_finish[a]?this.onImageError():this.onImageLoad()}this.showLoadingIndicator(),new Promise(function(t,n){e(["modules/clean/react/previews/preview_image_zoom"],t,n)}).then(n.__importStar)},y.prototype.componentWillReceiveProps=function(e){if(e["preview-url"]!==this.props["preview-url"]){var t=e.filePreviewSession;this.logFilePreviewEvent(p.EventType.FilePreviewSupportConfirmed,t),this.logFilePreviewEvent(p.EventType.FilePreviewDownloadAttempted,t),this.logOpen(),this.props.shouldDisplayToolbar&&this.imageAnnotations.removeAnnotations(),this.setState({width:"",height:"",margin:"auto",zoomFit:!0,shouldDisplayFullSizeImage:!1,shouldLoadFullSizeImage:!1,imageLoaded:!1}),this.showLoadingIndicator()}},Object.defineProperty(y.prototype,"minimumZoomPercent",{get:function(){if(!this.previewImageFullSize)return 0;var e=this.props,t=e.sizeClass,n=e.windowHeight,o=e.windowWidth,i=this.previewImageFullSize,r=i.naturalHeight,a=i.naturalWidth;if(!r||!a)return 0;var s=l.getImagePadding(t);return l.getMinimumZoomPercent({windowDimensions:{height:n,width:o},imagePadding:s,imageDimensions:{height:r,width:a}})},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"zoomPercent",{get:function(){return this.state.zoomFit?this.minimumZoomPercent:this.state.zoomPercent},enumerable:!0,configurable:!0}),y.prototype.hideLoadingIndicator=function(){this.showLoadingIndicator.cancel(),this.setState({shouldShowLoadingIndicator:!1})},y.prototype.previewImageZoom=function(){return e("modules/clean/react/previews/preview_image_zoom").PreviewImageZoom},y.prototype.logFilePreviewEvent=function(e,t){void 0===t&&(t=this.props.filePreviewSession),null!=t&&t.recordEvent(e)},y.prototype.logOpen=function(){a.PreviewActivityLogger.log("open",{file_ext:this.props["file-extension"]})},y.prototype.shouldDisableZoom=function(){var e=this.props,t=e.sizeClass;return e.shouldDisplayToolbar||t===_.SizeClass.Small},y.prototype.getImageDOMNode=function(){return this.state.shouldDisplayFullSizeImage?this.previewImageFullSize:this.previewImage},y.prototype.zoomWithMultiplier=function(e){if(1!==e&&this.previewImageFullSize){var t=this.previewImageFullSize.width,n=this.previewImageFullSize.height,o=this.calculateZoomPercent(n),i=.05*Math.round(o*e/.05);if(Math.abs(i-o)<.05&&(e>1?i+=.05:i-=.05),!(i<0)){var r=i/o,a=Math.round(t*r),s=Math.round(n*r);this.onZoom(a,s,i)}}},y.prototype.calculateZoomPercent=function(e){if(!this.previewImageFullSize)return 0;var t=this.previewImageFullSize.naturalHeight;return e&&t?e/t:0},y.prototype.renderFullSizeImage=function(e){if(!this.state.shouldLoadFullSizeImage)return null;var t=this.props,i=t.comments2AnnotationsEnabled,a=t.fileName,s=t["preview-url"],u={"absolute-center":!i};u[""+l.PREVIEW_IMAGE]=this.state.shouldDisplayFullSizeImage;var p=n.__assign({},e);this.state.shouldDisplayFullSizeImage||(p=n.__assign({},p,{visibility:"hidden"}));var f=r.createElement("img",{alt:a,ref:this.setPreviewImageFullSizeRef,src:c.fullSizeUrl(s),className:o.default(u),style:p,onClick:this.onImageClick,onDoubleClick:this.onImageDoubleClick,onLoad:this.onFullImageLoad});return i&&this.state.shouldDisplayFullSizeImage?r.createElement(d.AnnotationPane,{childWidth:this.state.width},f):f},y.prototype.renderSmallImage=function(e){if(this.state.shouldDisplayFullSizeImage)return null;var t=this.props,n=t.comments2AnnotationsEnabled,i=t.fileName,a=t.onContextMenu,s=t["preview-url"],c=o.default(l.PREVIEW_IMAGE,"preview-image-small",{"disabled-context-menu":!!a,"absolute-center":!n}),u=r.createElement("img",{ref:this.setPreviewImageRef,sizes:m.IMG_SIZES_ATTR,src:m.getFallbackSrc(s),srcSet:m.getSrcSet(s),className:c,style:e,onLoad:this.onImageLoad,onError:this.onImageError,onClick:this.onImageClick,onContextMenu:a,onDoubleClick:this.onImageDoubleClick,alt:i});return n?r.createElement(d.AnnotationPane,{childWidth:this.state.width},u):u},y.prototype.render=function(){var e=this.props,t=e.count,n=e.index,i=e.onNext,a=e.onPrevious,s=e.shouldDisplayToolbar,c=e.shouldDisableAnnotations,u=e.isFullscreen,d=this.state,p=d.height,f=d.imageLoaded,m=d.margin,_=d.shouldShowLoadingIndicator,g=d.width,y={};return g&&p&&s&&(y={height:p,margin:m,maxHeight:p,maxWidth:g,width:g}),f||(y={display:"none"}),r.createElement("div",{className:o.default("flex-preview-container","image-visible","annotations-visible",l.PREVIEW_IMAGE_CONTAINER,{"zoom-disabled":this.shouldDisableZoom(),"has-toolbar":s,"zoom-fit":this.state.zoomFit})},r.createElement("div",{className:o.default(l.PREVIEW_IMAGE_WRAPPER,"preview-content")},!f&&_&&r.createElement(h.LoadingIndicator,{className:"loading-indicator"}),this.renderFullSizeImage(y),this.renderSmallImage(y)),s&&r.createElement(v.PreviewToolbarContainer,{forceDisableRegionAnnotation:c,isFullscreen:u,previewToolbarProps:{index:n,count:t,zoomPercent:this.zoomPercent,minimumZoomPercent:this.minimumZoomPercent,maximumZoomPercent:16,onPrevious:a,onNext:i,onFullscreen:this.openFullscreen,onZoomIn:this.onZoomIn,onZoomOut:this.onZoomOut,onZoomOriginalOrFit:this.onZoomOriginalOrFit,onPrint:this.onPrint},shouldUseImageToolbar:!0}))},y})(r.Component);t._PreviewImage=w;var S=function(e){return r.createElement(b.Dimensions,{className:"flex-preview-container"},function(t){var o=t.width,i=t.height;return r.createElement(w,n.__assign({},e,{windowHeight:i,windowWidth:o}))})},C=y.requireCssWithComponent(S,["/static/css/preview_image-vflyaNqpo.css"]);t.PreviewImage=C}),define("modules/clean/react/previews/preview_linkfile",["require","exports","tslib","external/classnames","external/react","modules/clean/ajax","modules/clean/em_string","modules/clean/filepath","modules/clean/react/css_timing","modules/clean/react/file_viewer/constants","modules/clean/referrer_cleansing_redirect","modules/clean/web_timing_logger","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),i=n.__importStar(i),r=n.__importStar(r),u=n.__importStar(u),d=n.__importStar(d);var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={description:null,hadError:!1,link:null,isMounted:!1},t.requestLinkfileData=function(e){t.logFilePreviewEvent(c.EventType.FilePreviewDownloadAttempted);var n={url:e,dataType:"json",success:t.handleLinkDataSuccess,error:t.handleLinkDataError,xhrFields:{withCredentials:!1}};t.props.data.authenticated?(n.xhrFields={withCredentials:!0},r.SilentBackgroundRequest(n)):r.Request(n)},t.handleLinkDataSuccess=function(e){if(null==e.uri)return void t.handleLinkDataError();t.logFilePreviewEvent(c.EventType.FilePreviewDownloadSucceeded),t.markWebTiming(),t.setState({description:e.uri,hadError:!1,link:e.uri}),t.logFilePreviewEvent(c.EventType.FilePreviewRenderSucceeded),t.props.setRenderStatusSuccess()},t.handleLinkDataError=function(){t.logFilePreviewEvent(c.EventType.FilePreviewDownloadFailed),t.markWebTiming(),t.state.isMounted&&t.setState({description:f._("Can’t show link. Something’s wrong with this file."),hadError:!0,link:null})},t.handleClickOpenLinkButton=function(e){if(null!=t.state.link){var n=u.get_redirect_uri(t.state.link);window.open(n.toString(),"_blank")}},t}return n.__extends(t,e),t.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.markWebTiming=function(){d.mark_time_to_view(),d.mark_time_to_interactive()},t.prototype.isFileDataFetched=function(){return null==this.state.description},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(c.EventType.FilePreviewSupportConfirmed),this.state.isMounted=!0,this.requestLinkfileData(this.props.data.url)},t.prototype.componentWillUnmount=function(){this.state.isMounted=!1},t.prototype.render=function(){var e={"preview-linkfile-content":!0,"loading-content":this.isFileDataFetched()},n={"preview-linkfile-button-openlink":!0,"button-primary":!0,"has-link":null!=this.state.link},r="-",l="";null!=this.props.filename&&(r=s.filename_without_extension(this.props.filename),l=s.file_extension(this.props.filename),""!==l&&(l="."+l));var c=t.MAX_DISPLAYED_FILENAME_CHARS-l.length,u=a.Emstring.em_snippet(r,c),d="-";null!=this.state.description&&(d=this.state.description);var m={"preview-linkfile-description":!0,"force-show-all-text":this.state.hadError},h=p.static_url("/static/images/icons128/page_white_linkfile-vfloEntlU.png");return i.createElement("div",{className:"flex-preview-container"},i.createElement("div",{className:"preview-content preview-content--center"},i.createElement("div",{className:"preview-linkfile-box"},i.createElement("div",{className:o.default(e)},i.createElement("div",{className:"preview-linkfile-icon"},i.createElement("img",{src:h,alt:""})),i.createElement("div",{className:"preview-linkfile-title"},i.createElement("span",{className:"preview-linkfile-filebase"},u),i.createElement("span",{className:"preview-linkfile-fileext"},l)),i.createElement("div",{className:"preview-linkfile-info"},i.createElement("div",{className:o.default(m)},d),i.createElement("button",{className:o.default(n),onMouseUp:this.handleClickOpenLinkButton,ref:"openLinkButton"},f._("Open in new tab")))))))},t.SPINNER_FADE_DELAY_MSEC=150,t.MAX_DISPLAYED_FILENAME_CHARS=21,t})(i.Component);t._PreviewLinkfile=m;var h=l.requireCssWithComponent(m,["/static/css/preview_linkfile-vflLAlKbW.css"]);t.PreviewLinkfile=h}),define("modules/clean/react/previews/preview_pdf_loadable",["require","exports","tslib","external/react","modules/clean/react/async/loadable","modules/clean/react/css_timing","modules/clean/react/previews/pdf_viewer/placeholder_image"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var s=i.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/preview_pdf"],t,n)}).then(n.__importStar).then(function(e){return e.PreviewPDF})},loading:function(e){var t=e.previewThumbnailUrl;return t?o.createElement("div",{className:"preview-pdf-ssr"},o.createElement("div",{className:"preview-ssr-viewer"},o.createElement(a.PlaceholderImage,{url:t}))):null}}),l=r.requireCssWithComponent(s,["/static/css/preview_pdf-vflUeevnW.css","/static/css/snackbar-vflLtw9Um.css"]);t.PreviewPDFLoadable=l});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};define("modules/clean/react/previews/preview_toolbar_container",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewToolbarContainer=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/preview_toolbar_container_component"],t,n)}).then(__importStar).then(function(e){return e.PreviewToolbarContainer})}})}),define("modules/clean/react/previews/preview_zoom_container",["require","exports","tslib","external/keymaster","external/classnames","external/react","external/lodash","jquery","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/i18n"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),i=n.__importDefault(i),r=n.__importStar(r),a=n.__importStar(a),s=n.__importDefault(s);var m="",h="previewzoomcontainer",v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={controlsHidden:!1},t.flipNext=function(e){void 0===e&&(e=c.UserActionContext.LightboxToolbar),t.props.onFlipNext&&t.props.onFlipNext(),l.logUserAction(c.UserAction.FlipNext,e)},t.flipPrevious=function(e){void 0===e&&(e=c.UserActionContext.LightboxToolbar),t.props.onFlipPrevious&&t.props.onFlipPrevious(),l.logUserAction(c.UserAction.FlipPrevious,e)},t.onClick=function(e){var n="."+t.props.containerClass+", .preview-toolbar-overlay, .preview-zoomer-close";s.default(e.target).is(n)||0!==s.default(e.target).parents(n).length||(e.preventDefault(),t.onCloseFactory({},c.UserActionContext.LightboxFrame))},t.onMouseMove=function(e){0===s.default(e.target).parents(".preview-toolbar-overlay").length?t.startControlsTimer():clearTimeout(t.controlsHideTimer)},t.onCloseFactory=function(e,n){void 0===e&&(e={}),void 0===n&&(n=c.UserActionContext.LightboxCloseButton),l.logUserAction(c.UserAction.ToggleFullscreenOff,n),t.props.onClose()},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;this.flipNext=a.throttle(this.flipNext,100),this.flipPrevious=a.throttle(this.flipPrevious,100),o.default("esc",h,function(){e.onCloseFactory({},c.UserActionContext.Keyboard)}),null!=this.props.zoomOutCallback&&o.default("space",h,this.props.zoomOutCallback),o.default("left",h,function(){e.startControlsTimer(),e.flipPrevious(c.UserActionContext.Keyboard)}),o.default("right",h,function(){e.startControlsTimer(),e.flipNext(c.UserActionContext.Keyboard)}),m=o.default.getScope(),o.default.setScope(h),this.startControlsTimer()},t.prototype.componentWillUpdate=function(){o.default.setScope(h)},t.prototype.componentWillUnmount=function(){o.default.clearScope(h),o.default.setScope(m),clearTimeout(this.controlsHideTimer)},t.prototype.startControlsTimer=function(){var e=this;this.showControls(),clearTimeout(this.controlsHideTimer),this.controlsHideTimer=setTimeout(function(){e.hideControls()},3e3)},t.prototype.showControls=function(){this.setState({controlsHidden:!1})},t.prototype.hideControls=function(){this.setState({controlsHidden:!0})},t.prototype.renderFlippableControls=function(){return this.props.fileCount?r.createElement(u.FlippableControls,{index:""+(this.props.fileIndex+1),numFlippableFiles:this.props.fileCount,onNext:this.flipNext,onPrevious:this.flipPrevious}):null},t.prototype.renderControls=function(){var e=this.props.renderZoomControls,t=i.default("preview-toolbar-container",{hidden:this.state.controlsHidden});return r.createElement("div",{className:t,ref:"previewZoomerToolbarContainer"},r.createElement("div",{className:"preview-toolbar-overlay-container"},r.createElement("div",{className:"preview-toolbar-overlay"},r.createElement("div",{className:"preview-toolbar-content"},this.renderFlippableControls(),e?r.createElement("div",{className:i.default("toolbar-button-entry","zoom-out",{disabled:this.props.zoomOutDisabled}),
ref:"zoomControlZoomOut"},r.createElement(d.Sprite,{alt:f._("Zoom out"),group:"web",name:"zoomout"})):null,e?r.createElement("div",{className:"toolbar-button-entry",ref:"zoomLabelContainer"},r.createElement(p.TitleBubble,{content:f._("View actual size"),position:p.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},r.createElement("span",{className:"zoom-label",ref:"zoomLabel"}))):null,e?r.createElement("div",{className:i.default("toolbar-button-entry","zoom-in",{disabled:this.props.zoomInDisabled}),ref:"zoomControlZoomIn"},r.createElement(d.Sprite,{alt:f._("Zoom in"),group:"web",name:"zoom"})):null))))},t.prototype.renderClose=function(){var e=i.default("preview-zoomer-close",{hidden:this.state.controlsHidden});return r.createElement("span",null,r.createElement("button",{"aria-label":f._("Close"),className:e,onClick:this.onCloseFactory,ref:"previewZoomerClose"},r.createElement(d.Sprite,{alt:f._("Close"),group:"web",name:"xclose"})))},t.prototype.render=function(){var e=i.default("preview-zoomer-container",{"zoomer-drag-disabled":this.props.dragDisabled});return r.createElement("div",{className:e,onClick:this.onClick,onMouseMove:this.onMouseMove,ref:"previewZoomerContainer"},this.props.children,this.renderClose(),this.renderControls())},t.defaultProps={dragDisabled:!0,zoomInDisabled:!0,zoomOutDisabled:!0},t})(r.Component);t.PreviewZoomContainer=v}),define("modules/clean/react/previews/quality_popup/constants",["require","exports"],function(e,t){"use strict";function n(e){return i[e]}Object.defineProperty(t,"__esModule",{value:!0});var o;(function(e){e[e.POPUP=0]="POPUP",e[e.FEEDBACK_MODAL=1]="FEEDBACK_MODAL"})(o=t.QualityPopupStage||(t.QualityPopupStage={}));var i=[];i[o.POPUP]="popup",i[o.FEEDBACK_MODAL]="feedback_modal",t.getPopupStageLoggerKey=n,t.BooleanAnswers={YES:"Y",NO:"N"}});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};define("modules/clean/react/previews/quality_popup/preview_quality_popup",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewQualityPopup=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/quality_popup/preview_quality_popup_component"],t,n)}).then(__importStar).then(function(e){return e.PreviewQualityPopup})}})}),define("modules/clean/react/previews/quality_popup/questions",["require","exports","tslib","modules/core/i18n","modules/constants/file_viewer"],function(e,t,n,o,i){"use strict";function r(e,t){var n=h[e];return"ALL_EXTENSIONS"===n||n.indexOf(t)>-1}function a(e){var t=i.PREVIEW_QUALITY_POPUP_QUESTION;if(!m.hasOwnProperty(t))return null;var n=m[t];return r(n,e)?n:null}function s(e){return!!v[e]}function l(e,t){return _[e][t]||_[e].ALL_EXTENSIONS}function c(e){return A[e]}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var u;(function(e){e[e.LOOK_GOOD=0]="LOOK_GOOD",e[e.LOAD_QUICKLY=1]="LOAD_QUICKLY",e[e.FEEDBACK=2]="FEEDBACK",e[e.DONATE=3]="DONATE"})(u=t.Questions||(t.Questions={}));var d=["3gp","3gpp","3gpp2","asf","avi","dv","flv","m2t","m4v","mkv","mov","mp4","mpg","mpeg","mts","oggtheora","ogv","rm","ts","vob","webm","wmv"],p=["jpg","jpeg","png","tiff","tif","gif","bmp","webp","wbmp"],f=["flac","oga","m4a","mp3","wma","aac","wav"],m={};m.LOOK_GOOD=u.LOOK_GOOD,m.LOAD_QUICKLY=u.LOAD_QUICKLY;var h={};h[u.LOOK_GOOD]="ALL_EXTENSIONS",h[u.LOAD_QUICKLY]="ALL_EXTENSIONS";var v=[];v[u.LOOK_GOOD]=!0;var _=[];_[u.LOOK_GOOD]={};for(var g=0,y=f;g<y.length;g++){var b=y[g];_[u.LOOK_GOOD][b]=o._("Does this audio preview sound okay?")}for(var w=0,S=d;w<S.length;w++){var b=S[w];_[u.LOOK_GOOD][b]=o._("Does this video preview look okay?")}for(var C=0,E=p;C<E.length;C++){var b=E[C];_[u.LOOK_GOOD][b]=o._("Does this image preview look okay?")}_[u.LOOK_GOOD].ALL_EXTENSIONS=o._("Does this file preview look okay?"),_[u.LOAD_QUICKLY]={},_[u.LOAD_QUICKLY].ALL_EXTENSIONS=o._("Did this preview load quickly?");var A=[];A[u.LOOK_GOOD]="look_good",A[u.LOAD_QUICKLY]="load_quickly",A[u.FEEDBACK]="feedback",A[u.DONATE]="donate",t.isQuestionAllowed=r,t.getQuestionToAsk=a,t.shouldShowFeedbackModal=s,t.getQuestionWording=l,t.getQuestionLoggerKey=c}),define("modules/clean/react/previews/toolbar_flip_buttons",["require","exports","tslib","external/react","external/classnames","external/lodash","modules/clean/react/title_bubble","modules/core/i18n","modules/clean/react/sprite"],function(e,t,n,o,i,r,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),i=n.__importDefault(i),r=n.__importStar(r),t.ToolbarFlipButtons=function(e){var t=e.className,n=e.count,c=e.index,u=e.onClickNext,d=void 0===u?r.noop:u,p=e.onClickPrevious,f=void 0===p?r.noop:p;return o.createElement("span",{className:i.default("flip-buttons",t)},o.createElement(a.TitleBubble,{content:s._("Previous"),position:a.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},o.createElement("button",{className:"flip-button flip-button--previous",onClick:f},o.createElement(l.Sprite,{group:"web",name:"s_flip_left",alt:s._("Previous")}))),o.createElement("div",{className:"nav-text"},s._("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:c+1,num_total_files:n})),o.createElement(a.TitleBubble,{content:s._("Next"),position:a.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},o.createElement("button",{className:"flip-button flip-button--next",onClick:d},o.createElement(l.Sprite,{group:"web",name:"s_flip_right",alt:s._("Next")}))))}}),define("modules/clean/react/previews/video/audio_waveform/utils",["require","exports","modules/clean/average_counter"],function(e,t,n){"use strict";function o(e,t,o,i,r){function a(e){return function(){if(e>=t)return void r(l);var c=[],u=Math.ceil(e*s.length/t),d=Math.ceil((e+1)*s.length/t),p=d-u;if(p>o)for(var f=0;f<o;f++){var m=Math.floor(Math.random()*p)+u;c.push(Math.abs(s[m]))}else for(var f=u;f<d;f++){var h=Math.floor(Math.abs(s[f]));c.push(h)}var v=new n.AverageCounter;v.addArray(c),l[e]=v.getAverage(),i()&&setTimeout(a(e+1),0)}}var s=e.getChannelData(0),l=new Array(t);setTimeout(a(0),0)}function i(e,t,o){void 0===o&&(o=1);var i=[];if(0===e.length||t<=0)return i;for(var r=[],a=0;a<t;a++)r.push(new n.AverageCounter);for(var s=0,l=0,a=0;a<e.length;a++){var c=e[a],u=Math.floor(a*t/e.length),d=r[u];d.add(c),i[u]=d.getAverage(),u!==l&&(s=Math.max(s,i[l]),l=u)}return s=Math.max(s,i[t-1]),i.map(function(e){return e*o/s})}Object.defineProperty(t,"__esModule",{value:!0}),t.buildFromBuffer=o,t.returnWaveform=i}),define("modules/clean/react/previews/video/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.PlayerRendered="player_rendered",e.FirstClickPlay="first_click_play",e.ChangePlaybackRate="change_playback_rate",e.ChangeVideoQuality="change_video_quality",e.EnterFullscreen="enter_fullscreen",e.ClosePreview="close_preview",e.SeekVideo="seek_video",e.VideoStartsPlaying="video_starts_playing",e.VideoStalled="video_stalled",e.VideoSegmentFailure="video_segment_failure",e.ScrubberThumbnailsLoaded="scrubber_thumbnails_loaded",e.ScrubberThumbnailsFailed="scrubber_thumbnails_failed",e.AudioWaveformLoaded="audio_waveform_loaded",e.AudioWaveformFailed="audio_waveform_failed"})(t.VideoPreviewEvent||(t.VideoPreviewEvent={})),t.HdLabels=["1080p","720p"],t.QualityLabelOrder=t.HdLabels.concat(["480p","360p","240p"]).reverse()}),define("modules/clean/react/previews/video/preview_video",["require","exports","tslib","external/react","modules/clean/react/previews/video/preview_video_basic","modules/clean/react/previews/video/preview_video_comments2","modules/clean/react/previews/constants"],function(e,t,n,o,i,r,a){"use strict";function s(e){return e.sourceContext!==a.PreviewSourceContext.EmbeddedSharedLinkFile?o.createElement(r.PreviewVideoComments2,n.__assign({},e)):o.createElement(i.PreviewVideoBasic,n.__assign({},e))}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.PreviewVideoProps=i.PreviewVideoProps,t.PreviewVideo=s}),define("modules/clean/react/previews/video/preview_video_basic",["require","exports","tslib","external/classnames","external/lodash","external/react","modules/clean/image_size","modules/clean/keycode","modules/clean/loggers/file_preview_logger","modules/clean/loggers/video_preview_logger","modules/clean/previews/util","modules/clean/react/async/loadable","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/helpers","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/previews/constants","modules/clean/react/previews/preview_zoom_container","modules/clean/react/previews/video/constants","modules/clean/web_timing_logger","modules/core/browser","modules/core/uri","modules/clean/react/previews/video/utils","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/file_viewer/data/actions","external/react-redux"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,m,h,v,_,g,y,b,w,S,C,E,A,T,x){"use strict";function P(e){return C.URI.parse(e).updateQuery({size:a.imageBestFitSize(window.innerWidth,window.innerHeight),size_mode:"2"}).toString()}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),i=n.__importStar(i),r=n.__importStar(r),w=n.__importStar(w),S=n.__importStar(S);var k=d.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/video/video_player"],t,n)}).then(n.__importStar).then(function(e){return e.VideoPlayer})}}),O=(function(e){function t(t){var n=e.call(this,t)||this;return n.lastPlaybackRate=1,n.checkRenderSucceeded=function(e){"hls"===n.props.videoContainer&&!e&&i.every(n.successFlags)&&n.markRenderSucceeded()},n.onEmbed=function(){n.logFilePreviewTimelineEvent(f.EventType.FilePreviewSupportConfirmed),n.logFilePreviewTimelineEvent(f.EventType.FilePreviewDownloadAttempted)},n.onLoadedMetadata=function(e){void 0===e&&(e=0),n.videoLogger.populateVideoDuration(e)},n.onCanPlay=function(){n.markRenderSucceeded()},n.onReady=function(e){void 0===e&&(e=!1),n.logFilePreviewTimelineEvent(f.EventType.FilePreviewDownloadSucceeded),n.successFlags.playerReady=!0,n.checkRenderSucceeded(e),n.props.filePreviewSession&&n.props.filePreviewSession.markPrimaryEvent(),w.mark_time_to_view(),w.mark_time_to_interactive(),n.videoLogger.logEvent(b.VideoPreviewEvent.PlayerRendered)},n.logPlay=i.once(function(){n.markRenderSucceeded(),n.videoLogger.logEvent(b.VideoPreviewEvent.FirstClickPlay)}),n.onPlay=function(){var e=n.props.setMediaPlaying;n.logPlay(),e&&e()},n.onPause=function(){var e=n.props.setMediaPaused;e&&e()},n.onStartsPlaying=i.once(function(e){n.videoLogger.logEvent(b.VideoPreviewEvent.VideoStartsPlaying,{play_latency:e.toString()})}),n.onUserInactive=function(e){e!==n.lastPlaybackRate&&(n.lastPlaybackRate=e,n.logUserAction(f.UserAction.VideoPlaybackRateChanged,{playback_rate:e.toString()}))},n.onScrubberThumbnailsLoaded=function(e){e?n.videoLogger.logEvent(b.VideoPreviewEvent.ScrubberThumbnailsLoaded):n.videoLogger.logEvent(b.VideoPreviewEvent.ScrubberThumbnailsFailed)},n.onAudioWaveformLoaded=function(){n.videoLogger.logEvent(b.VideoPreviewEvent.AudioWaveformLoaded)},n.onAudioWaveformFailed=function(){n.videoLogger.logEvent(b.VideoPreviewEvent.AudioWaveformFailed)},n.onError=function(e){if("needflash"===e)return n.logFilePreviewTimelineEvent(f.EventType.FilePreviewSupportDenied),void("function"==typeof n.props.onError&&n.props.onError(g.ErrorType.NeedFlashError));n.logFilePreviewTimelineEvent(f.EventType.FilePreviewDownloadFailed),w.mark_time_to_view(),w.mark_time_to_interactive(),n.props.onError&&n.props.onError(g.ErrorType.LoadError)},n.onPlaybackRateChange=function(e,t){n.videoLogger.logEvent(b.VideoPreviewEvent.ChangePlaybackRate,{old_playback_rate:e.toString(),new_playback_rate:t.toString()})},n.onSeek=function(e,t){n.videoLogger.logEvent(b.VideoPreviewEvent.SeekVideo,{old_video_time:e.toString(),new_video_time:t.toString()})},n.onStalled=function(e,t){n.videoLogger.logEvent(b.VideoPreviewEvent.VideoStalled,{video_timestamp:e.toString(),playback_rate:t.toString()})},n.onTruncated=function(){m.filePreviewEventEmitter.emit(f.EventType.FilePreviewVideoTruncated),n.videoLogger.setVideoTruncated()},n.onThumbLoad=function(e){void 0===e&&(e=!1),n.successFlags.thumbLoaded=!0,n.checkRenderSucceeded(e)},n.onClose=function(e){n.videoLogger.logEvent(b.VideoPreviewEvent.ClosePreview,{video_time_on_close:e.toString()})},n.onSelectQuality=function(e,t){n.videoLogger.logEvent(b.VideoPreviewEvent.ChangeVideoQuality,{old_video_quality:e,new_video_quality:t})},n.handleKeyPress=function(e){return e.keyCode===s.KeyCode.SPACE&&(n.togglePlayback(),e.preventDefault(),!0)},n.keyboardBindings=[{keyboardEventCriteria:v.generateUnmodifiedKeyboardEventCriteria(s.KeyCode.SPACE),callback:n.handleKeyPress}],n.processGutterClick=function(e){var t=n.props.onGutterClick;t&&e.target===e.currentTarget&&t()},n.successFlags={thumbLoaded:!1,playerReady:!1},n}return n.__extends(t,e),t.prototype.setUpLoggers=function(){this.teardownLoggers(),this.userActionLogger=new l.FilePreviewUserActionLogger,this.userActionLogger.listenTo(m.filePreviewEventEmitter),this.videoLogger=new c.VideoPreviewLogger(this.props.fileExtension,this.props.filePreviewSession)},t.prototype.teardownLoggers=function(){this.userActionLogger&&(this.userActionLogger.unlistenTo(m.filePreviewEventEmitter),delete this.userActionLogger)},t.prototype.logFilePreviewTimelineEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.logUserAction=function(e,t){m.filePreviewEventEmitter.emit(f.EventType.FilePreviewUserAction,this.props.filePreviewSession,e,f.UserActionContext.VideoPlayer,t)},t.prototype.markRenderSucceeded=function(){this.logFilePreviewTimelineEvent(f.EventType.FilePreviewRenderSucceeded),this.props.setRenderStatusSuccess()},t.prototype.getPlaybackRates=function(){return[.5,1,1.25,1.5,2,4]},t.prototype.componentDidMount=function(){this.setUpLoggers()},t.prototype.componentWillUnmount=function(){this.teardownLoggers()},t.prototype.shouldComponentUpdate=function(e){return h.compareStateAndProps(e,{})},t.prototype.componentDidUpdate=function(e){this.props.isFullscreen&&!e.isFullscreen&&this.videoLogger.logEvent(b.VideoPreviewEvent.EnterFullscreen)},t.prototype.togglePlayback=function(){m.filePreviewEventEmitter.emit(f.EventType.FilePreviewVideoToggled)},t.prototype.render=function(){var e=this.props,t=e.title,i=e.isFullscreen,a=e.previewUrl,s=e.sourceContext,l=e.thumbnailUrlTmpl,c=e.videoMetadataUrl,d=e.videoContainer,p=e.vttThumbnailsUrl,f=e.waveformUrl,m=E.video_type(d),h=s!==g.PreviewSourceContext.EmbeddedSharedLinkFile,v=!1,b=!1,w=0;S.is_mobile_or_tablet()&&(v=!0,b=!0,w=1);var C={preload:"auto",playbackRates:this.getPlaybackRates(),nativeControlsForTouch:b,playsinline:w};null!=l&&(C.poster=u.tagCriticalPathContentRequest(P(l),this.props.filePreviewSession));var T={src:a,sourceContentType:m,metadataLink:c,title:t,vttThumbnailsUrl:p,waveformUrl:f},x={onLoadedMetadata:this.onLoadedMetadata,onCanPlay:this.onCanPlay,onError:this.onError,onReady:this.onReady,onPlay:this.onPlay,onPause:this.onPause,onStartsPlaying:this.onStartsPlaying,onThumbLoad:this.onThumbLoad,onUserInactive:this.onUserInactive,onScrubberThumbnailsLoaded:this.onScrubberThumbnailsLoaded,onAudioWaveformLoaded:this.onAudioWaveformLoaded,onAudioWaveformFailed:this.onAudioWaveformFailed,onPlaybackRateChange:this.onPlaybackRateChange,onSeek:this.onSeek,onStalled:this.onStalled,onSelectQuality:this.onSelectQuality,onTimeUpdate:this.props.onTimeUpdate},O={videoProps:T,playerCallbacks:x,playerOptions:C,seekPosition:this.props.seekPosition,shouldEnableControls:!this.props.hideControls,noDownload:v,shouldFocusOnReady:this.props.shouldFocusOnReady,onEmbed:this.onEmbed,onTruncated:this.onTruncated,onClose:this.onClose,shouldShowTruncationMessage:h,isAudio:this.props.isAudio,audioUrl:this.props.audioUrl,bytes:this.props.bytes,showOnboarding:!!this.props.showOnboarding};return i?r.createElement(y.PreviewZoomContainer,{renderZoomControls:!1,onClose:A.exitFullScreen,containerClass:"video-player"},this.props.disableKeyboardShortcuts?null:r.createElement(_.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),r.createElement(k,n.__assign({},O))):r.createElement("div",{className:o.default({"flex-preview-container":!0,"touch-device":S.is_mobile_or_tablet()})},this.props.disableKeyboardShortcuts?null:r.createElement(_.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),r.createElement("div",{className:"preview-content preview-video",onClick:this.processGutterClick},r.createElement("div",{className:"preview-video__wrapper"},r.createElement("div",{className:o.default({"preview-video__aspect-container":!0,"preview-audio-transcoded":this.props.isAudio})},r.createElement("div",{className:"preview-video__container"},r.createElement(k,n.__assign({},O)))))))},t})(r.Component);t._PreviewVideoBasic=O;var I=x.connect(void 0,{setMediaPlaying:T.setMediaPlaying,setMediaPaused:T.setMediaPaused})(O),M=p.requireCssWithComponent(I,["/static/css/preview_video-vfljF09ZK.css","/static/css/video-js-5-custom-v2-vflz5kj-j.css"]);t.PreviewVideoBasic=M}),define("modules/clean/react/previews/video/preview_video_comments2",["require","exports","tslib","external/react","external/react-redux","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/store","modules/clean/react/comments2/data/selectors","modules/clean/react/previews/video/preview_video_basic"],function(e,t,n,o,i,r,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.ConnectedPreviewVideoComments2=i.connect(function(e){return{showOnboarding:s.getShowOnboardingOnVideo(e)}},{onTimeUpdate:r.Actions.updatePlayerCurrentTime,onGutterClick:r.deactivateAllThreads})(l.PreviewVideoBasic);var c=(function(e){function r(t){var n=e.call(this,t)||this;return n.store=a.getStoreForComments2(),n}return n.__extends(r,e),r.prototype.render=function(){return o.createElement(i.Provider,{store:this.store},o.createElement(t.ConnectedPreviewVideoComments2,n.__assign({},this.props)))},r})(o.PureComponent);t.PreviewVideoComments2=c}),define("modules/clean/react/previews/video/utils",["require","exports","tslib","modules/core/browser"],function(e,t,n,o){"use strict";function i(){return o.edge||o.safari}function r(e){return"webm"===e?"video/webm":"application/vnd.apple.mpegurl"}function a(e){return e.tech({IWillNotUseThisInPlugins:!0})}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.showQualityNativeHls=i;t.video_type=r,t.getTechFromPlayer=a});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};define("modules/clean/react/share_download/button",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DownloadSimpleButton=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/share_download/button_component"],t,n)}).then(__importStar).then(function(e){return e.DownloadSimpleButton})}}),t.ShareDownloadButton=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/share_download/button_component"],t,n)}).then(__importStar).then(function(e){return e.ShareDownloadButton})}})}),define("modules/clean/shallow_equal",["require","exports"],function(e,t){"use strict";function n(e,t){return e===t?0!==e||0!==t||1/e===1/t:e!==e&&t!==t}function o(e,t){if(n(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var o=Object.keys(e),r=Object.keys(t);if(o.length!==r.length)return!1;for(var a=0;a<o.length;a++)if(!i.call(t,o[a])||!n(e[o[a]],t[o[a]]))return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.prototype.hasOwnProperty;t.shallowEqual=o}),define("modules/core/type",["require","exports","tslib","external/lodash"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var i=(function(){function e(e,t){if(!o.isString(e)&&!o.isFunction(e))throw new TypeError("First parameter needs to be a string identifying the type");if(!o.isFunction(t))throw new TypeError("Second parameter needs to be a predicate defining the type");o.isFunction(e)?this.getTypeString=e:this.getTypeString=function(){return e},this.predicate=t}return e})();t.Type=i;var r=function(e){if(t.isBasicType(e))return!0;if(e instanceof i)return!0;if(o.isFunction(e))return!0;if(o.isArray(e)){if(1!==e.length)return!1;if(!r(e[0]))return!1}else{if(!(o.isObject(e)&&null==e.prototype&&e.constructor===Object&&Object.keys(e).length>0))return!1;for(var n in e){if(!r(e[n]))return!1}}return!0},a=(function(){var e=new i("undefined",o.isUndefined),t=new i("null",o.isNull),n=new i("Boolean",o.isBoolean),a=new i("Number",o.isNumber),s=new i("String",o.isString),l=new i("Object",function(e){return o.isObject(e)&&!o.isFunction(e)&&!o.isArray(e)}),c=new i("Type",r);return function(o){return void 0===o?e:null===o?t:o===Boolean?n:o===Number?a:o===String?s:o===Object?l:o===i?c:void 0}})();t.isBasicType=function(e){return null!=a(e)},t.firstFailingKeypath=function(e,n,r){if(null==r&&(r=[]),t.isBasicType(e)){if(!a(e).predicate(n))return r}else if(e instanceof i){if(!e.predicate(n))return r}else if(o.isFunction(e)){if(!(n instanceof e))return r}else if(o.isArray(e)){if(t.firstFailingKeypath(Array,n,r))return r;for(var s=0;s<n.length;s++){var l=n[s];if(r.push(s),t.firstFailingKeypath(e[0],l,r))return r;r.pop()}}else{if(t.firstFailingKeypath(Object,n,r))return r;for(var c=Object.keys(e),u=Object.keys(n),d=0,p=Array.from(o.difference(c,u));d<p.length;d++){var f=p[d];if(t.firstFailingKeypath(e[f],void 0,r))return r}for(var m=0,h=Array.from(o.intersection(u,c));m<h.length;m++){var f=h[m];if(r.push(f),t.firstFailingKeypath(e[f],n[f],r))return r;r.pop()}}},t.checkType=function(e,n){return null==t.firstFailingKeypath(e,n)},t.getTypeString=function(e){if(t.isBasicType(e))return a(e).getTypeString();if(e instanceof i)return e.getTypeString();if(o.isFunction(e))return e.name;if(o.isArray(e))return"["+t.getTypeString(e[0])+"]";var n=[];for(var r in e){var s=e[r];n.push(r+": "+t.getTypeString(s))}return"{"+n.join(", ")+"}"}}),define("modules/core/types",["require","exports","tslib","external/lodash","modules/core/type"],function(e,t,n,o,i){"use strict";function r(e,t){var n=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var r=t.apply(this,n),a=i.firstFailingKeypath(e,r);if(null!=a){var s=c(0,a,e,r);throw new TypeError(s)}return r};return t.isTypeChecked&&(n.isTypeChecked=!0),n}o=n.__importStar(o);var a=(function(){try{return Boolean(localStorage.production_typechecking)}catch(e){return!1}})(),s=(function(e){function t(t){return e.call(this,i.getTypeString.bind(null,t),i.checkType.bind(null,t))||this}return n.__extends(t,e),t})(i.Type),l=function(e,t){if(i.isBasicType(e));else if(e instanceof i.Type)null!=e.parameter_types&&o.isFunction(t)&&!t.isTypeChecked&&(t=u.apply(void 0,Array.from(e.parameter_types).concat([t])));else if(o.isFunction(e));else if(o.isArray(e))for(var n=0;n<t.length;n++){var r=t[n],a=l(e[0],r);a!==r&&(t=t.slice(),t[n]=a)}else for(var s in e){var c=e[s],d=l(c,t[s]);d!==t[s]&&(t=o.clone(t),t[s]=d)}return t},c=function(e,t,n,r){for(var a,s=0,l=Array.from(t);s<l.length;s++){var c=l[s];r=r[c],n=o.isArray(n)?n[0]:n[c]}return t.length>0&&(a=", key "+t.join(".")),a=null!=a?a:"","Argument "+e+a+": Value "+JSON.stringify(r,null,"  ")+" doesn't match type "+i.getTypeString(n)},u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Math.max(e.length,1),r=e.slice(0,n-1),a=e[n-1],u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=r,u=o.find(r,function(e){return e instanceof s});if(null!=u){var d=n.indexOf(u),p=Math.max(e.length-n.length+1,0),f=[d,1];o.times(p,function(){return f.push(u)}),n=n.slice(),n.splice.apply(n,Array.from(f||[]))}for(var m=0;m<n.length;m++){var h=n[m],v=i.firstFailingKeypath(h,e[m]);if(null!=v){var _=c(m,v,h,e[m]);throw new TypeError(_)}e[m]=l(h,e[m])}return a.apply(this,e)};return u.isTypeChecked=!0,u},d=function(e){if(e instanceof i.Type&&e.isOptional||e instanceof s)return e;var t=function(){return"?"+i.getTypeString(e)},n=function(t){return null==t||i.checkType(e,t)},o=new i.Type(t,n);return e instanceof i.Type&&null!=e.parameter_types&&(o.parameter_types=e.parameter_types),o.isOptional=!0,o},p=function(e){return new s(e)},f={takes:r(Function,u(p(i.Type),Function,u)),returns:r(Function,u(i.Type,Function,r)),Maybe:r(i.Type,u(i.Type,d)),Any:new i.Type("Any",function(e){return!0})};return a||(f.takes=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Math.max(e.length,1);return e.slice(0,n-1),e[n-1]},f.returns=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Math.max(e.length,1);return e.slice(0,n-1),e[n-1]}),f}),define("spectrum/icon_bundles/document",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ICONS={"date-small":{attrs:{width:"24",height:"24",viewBox:"0 0 24 24"},innerHtml:'<g fill="none" fill-rule="evenodd"><g fill="#000" fill-rule="nonzero"><path d="M4 4h16v16H4V4zm2 2v12h12V6H6z"></path><path d="M5 8h14v2H5zM7 2h2v4H7zM15 2h2v4h-2z"></path></g></g>'},date:{attrs:{width:"32",height:"32",viewBox:"0 0 32 32"},innerHtml:'<g fill="none" fill-rule="evenodd"><g fill="#000" fill-rule="nonzero"><path d="M6 6h20v20H6V6zm2 2v16h16V8H8z"></path><path d="M7 11h18v2H7zM11 4h2v4h-2zM19 4h2v4h-2z"></path></g></g>'},"signature-small":{attrs:{width:"24",height:"24",viewBox:"0 0 24 24"},innerHtml:'<g fill="none" fill-rule="evenodd"><g fill="#000" fill-rule="nonzero"><path d="M1 18h22v1H1z"></path><path d="M10.874 17.262c-1.33 1.046-1.25 2.246-.297 2.723 1.076.537 2.438-.321 3.206-2.953.226-.774.42-1.509.583-2.205-1.06.632-2.251 1.46-3.492 2.435zm4.589.26c-1.044 3.578-3.487 5.118-5.668 4.028-2.131-1.065-2.317-3.844-.003-5.664 1.857-1.46 3.565-2.6 5.014-3.317.634-4.207-.218-6.501-2.436-6.681-1.374-.111-1.993.459-2.027 1.713-.041 1.48.799 3.57 2.34 5.61l-1.397 1.054c-1.76-2.33-2.746-4.782-2.693-6.713.062-2.246 1.534-3.602 3.918-3.408 3.355.272 4.634 3.065 4.144 7.711 1.236-.31 2.137-.102 2.578.742.211.404.28.842.24 1.308a3.4 3.4 0 0 1-.025.205c1.118-.989 1.885-1.388 2.896-1.103.22.063.432.163.632.299l-.986 1.446a.42.42 0 0 0-.121-.06c-.223-.063-.618.152-1.332.792l-.42.379c-.17.151-.308.267-.442.37-.42.32-.786.5-1.217.5-.758 0-1.248-.545-1.188-1.264a2.4 2.4 0 0 1 .12-.543c.034-.105.181-.524.157-.454.11-.32.166-.532.182-.719a.652.652 0 0 0-.037-.325c.02.04.003.044-.143.053-.287.018-.69.127-1.183.324a38.652 38.652 0 0 1-.903 3.717zM1.381 11.619L2.62 10.38l4.95 4.95-1.238 1.237z"></path><path d="M6.377 10.382l1.238 1.236-4.948 4.952-1.238-1.237z"></path></g></g>'},signature:{attrs:{width:"32",height:"32",viewBox:"0 0 32 32"},innerHtml:'<g fill="none" fill-rule="evenodd"><g fill="#000" fill-rule="nonzero"><path d="M3 24h26v1H3z"></path><path d="M12.5 23.31c-1.983 1.56-1.857 3.437-.376 4.177 1.643.821 3.682-.464 4.79-4.26.37-1.271.68-2.47.931-3.594-1.6.917-3.43 2.172-5.345 3.678zm6.334.476c-1.423 4.878-4.698 6.942-7.604 5.49-2.828-1.413-3.075-5.094.034-7.538 2.627-2.065 5.04-3.666 7.065-4.65.94-6.089-.293-9.445-3.584-9.712-2.047-.166-3.02.73-3.072 2.607-.058 2.126 1.133 5.09 3.313 7.976l-1.595 1.206c-2.431-3.218-3.79-6.597-3.717-9.237.082-3.012 2.03-4.805 5.233-4.546 4.596.373 6.315 4.295 5.547 10.86 1.785-.52 3.073-.3 3.663.83.273.523.363 1.094.31 1.705a4.971 4.971 0 0 1-.175.925c.12-.105.252-.223.4-.356 1.565-1.402 2.605-1.969 3.947-1.59.285.08.558.21.818.387l-1.126 1.652a.807.807 0 0 0-.235-.114c-.414-.117-1.015.21-2.07 1.155-.07.063-.47.426-.586.529a10.64 10.64 0 0 1-.604.506c-.55.42-1.024.653-1.565.653-.928 0-1.51-.649-1.437-1.524.018-.219.07-.436.158-.71.046-.143.25-.725.217-.63.16-.462.24-.774.265-1.057.023-.255-.008-.449-.09-.605-.063-.122-.828-.083-2.231.498-.3 1.634-.728 3.4-1.279 5.29z"></path><path d="M8.293 14.294l1.415 1.414-4.997 5-1.414-1.414z"></path><path d="M3.297 15.708l1.414-1.414 5 5-1.414 1.414z"></path></g></g>'},"text-small":{attrs:{width:"24",height:"24",viewBox:"0 0 24 24"},innerHtml:'<g fill="none" fill-rule="evenodd"><g fill="#000" fill-rule="nonzero"><path d="M4 4h16v16H4V4zm2 2v12h12V6H6z"></path><path d="M8 8h8v2H8z"></path><path d="M11 9h2v7h-2z"></path></g></g>'},text:{attrs:{width:"32",height:"32",viewBox:"0 0 32 32"},innerHtml:'<g fill="none" fill-rule="evenodd"><g fill="#000" fill-rule="nonzero"><path d="M6 6h20v20H6V6zm2 2v16h16V8H8z"></path><path d="M11 11h10v2H11zM15 13h2v8h-2z"></path></g></g>'}}}),define("spectrum/icon_document",["require","exports","tslib","tslib","react","spectrum/icon_templates/stateless","spectrum/icon_bundles/document"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),i=n.__importStar(i),t.ICONS=a.ICONS,t.IconDocument=function(e){var t=e.name,n=a.ICONS[t],s=n.attrs,l=n.innerHtml,c=i.createElement("svg",o.__assign({},s,{dangerouslySetInnerHTML:{__html:l}}));return i.createElement(r.Component,o.__assign({icon:c},e,{key:t}))},t.IconDocument.displayName="IconDocument"}),define("re-resizable",["require","exports","module","react"],function(e,t,n){"use strict";var o=e("react"),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=(function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}})(),a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},c={base:{position:"absolute",userSelect:"none",MsUserSelect:"none"},top:{width:"100%",height:"10px",top:"-5px",left:"0px",cursor:"row-resize"},right:{width:"10px",height:"100%",top:"0px",right:"-5px",cursor:"col-resize"},bottom:{width:"100%",height:"10px",bottom:"-5px",left:"0px",cursor:"row-resize"},left:{width:"10px",height:"100%",top:"0px",left:"-5px",cursor:"col-resize"},topRight:{width:"20px",height:"20px",position:"absolute",right:"-10px",top:"-10px",cursor:"ne-resize"},bottomRight:{width:"20px",height:"20px",position:"absolute",right:"-10px",bottom:"-10px",cursor:"se-resize"},bottomLeft:{width:"20px",height:"20px",position:"absolute",left:"-10px",bottom:"-10px",cursor:"sw-resize"},topLeft:{width:"20px",height:"20px",position:"absolute",left:"-10px",top:"-10px",cursor:"nw-resize"}},u=function(e){return o.createElement("div",{className:e.className,style:a({},c.base,c[e.direction],e.replaceStyles||{}),onMouseDown:function(t){e.onResizeStart(t,e.direction)},onTouchStart:function(t){e.onResizeStart(t,e.direction)}},e.children)},d={userSelect:"none",MozUserSelect:"none",WebkitUserSelect:"none",MsUserSelect:"none"},p={userSelect:"auto",MozUserSelect:"auto",WebkitUserSelect:"auto",MsUserSelect:"auto"},f=function(e,t,n){
return Math.max(Math.min(e,n),t)},m=function(e,t){return Math.round(e/t)*t},h=function(e,t){return e.substr(e.length-t.length,t.length)===t},v=function(e){return h(e.toString(),"px")?e.toString():h(e.toString(),"%")?e.toString():e+"px"},_=["style","className","grid","bounds","size","defaultSize","minWidth","minHeight","maxWidth","maxHeight","lockAspectRatio","lockAspectRatioExtraWidth","lockAspectRatioExtraHeight","enable","handleStyles","handleClasses","handleWrapperStyle","handleWrapperClass","children","onResizeStart","onResize","onResizeStop","handleComponent"],g=(function(e){function t(e){i(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={isResizing:!1,resizeCursor:"auto",width:void 0===(n.propsSize&&n.propsSize.width)?"auto":n.propsSize&&n.propsSize.width,height:void 0===(n.propsSize&&n.propsSize.height)?"auto":n.propsSize&&n.propsSize.height,direction:"right",original:{x:0,y:0,width:0,height:0}},n.updateExtendsProps(e),n.onResizeStart=n.onResizeStart.bind(n),n.onMouseMove=n.onMouseMove.bind(n),n.onMouseUp=n.onMouseUp.bind(n),"undefined"!=typeof window&&(window.addEventListener("mouseup",n.onMouseUp),window.addEventListener("mousemove",n.onMouseMove),window.addEventListener("mouseleave",n.onMouseUp),window.addEventListener("touchmove",n.onMouseMove),window.addEventListener("touchend",n.onMouseUp)),n}return s(t,e),r(t,[{key:"updateExtendsProps",value:function(e){this.extendsProps=Object.keys(e).reduce(function(t,n){return _.indexOf(n)!==-1?t:(t[n]=e[n],t)},{})}},{key:"getParentSize",value:function(){var e=this.base;if(!e)return{width:window.innerWidth,height:window.innerHeight};var t=!1,n=this.parentNode.style.flexWrap,o=e.style.minWidth;"wrap"!==n&&(t=!0,this.parentNode.style.flexWrap="wrap"),e.style.position="relative",e.style.minWidth="100%";var i={width:e.offsetWidth,height:e.offsetHeight};return e.style.position="absolute",t&&(this.parentNode.style.flexWrap=n),e.style.minWidth=o,i}},{key:"componentDidMount",value:function(){var e=this.size;this.setState({width:this.state.width||e.width,height:this.state.height||e.height});var t=this.parentNode;if(t instanceof HTMLElement&&!this.base){var n=document.createElement("div");n.style.width="100%",n.style.height="100%",n.style.position="absolute",n.style.transform="scale(0, 0)",n.style.left="-2147483647px",n.style.flex="0",n.classList?n.classList.add("__resizable_base__"):n.className+="__resizable_base__",t.appendChild(n)}}},{key:"componentWillReceiveProps",value:function(e){this.updateExtendsProps(e)}},{key:"componentWillUnmount",value:function(){if("undefined"!=typeof window){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseleave",this.onMouseUp),window.removeEventListener("touchmove",this.onMouseMove),window.removeEventListener("touchend",this.onMouseUp);var e=this.parentNode,t=this.base;if(!t||!e)return;if(!(e instanceof HTMLElement&&t instanceof Node))return;e.removeChild(t)}}},{key:"calculateNewSize",value:function(e,t){var n=this.propsSize&&this.propsSize[t];return"auto"!==this.state[t]||this.state.original[t]!==e||void 0!==n&&"auto"!==n?e:"auto"}},{key:"onResizeStart",value:function(e,t){var n=0,o=0;if(e.nativeEvent instanceof MouseEvent){if(n=e.nativeEvent.clientX,o=e.nativeEvent.clientY,3===e.nativeEvent.which)return}else e.nativeEvent instanceof TouchEvent&&(n=e.nativeEvent.touches[0].clientX,o=e.nativeEvent.touches[0].clientY);this.props.onResizeStart&&this.props.onResizeStart(e,t,this.resizable),this.props.size&&(void 0!==this.props.size.height&&this.props.size.height!==this.state.height&&this.setState({height:this.props.size.height}),void 0!==this.props.size.width&&this.props.size.width!==this.state.width&&this.setState({width:this.props.size.width})),this.setState({original:{x:n,y:o,width:this.size.width,height:this.size.height},isResizing:!0,resizeCursor:window.getComputedStyle(e.target).cursor,direction:t})}},{key:"onMouseMove",value:function(e){if(this.state.isResizing){var t=e instanceof MouseEvent?e.clientX:e.touches[0].clientX,n=e instanceof MouseEvent?e.clientY:e.touches[0].clientY,o=this.state,i=o.direction,r=o.original,a=o.width,s=o.height,l=this.props,c=l.lockAspectRatio,u=l.lockAspectRatioExtraHeight,d=l.lockAspectRatioExtraWidth,p=this.props,v=p.maxWidth,_=p.maxHeight,g=p.minWidth,y=p.minHeight,b=this.getParentSize();if(v&&"string"==typeof v&&h(v,"%")){var w=Number(v.replace("%",""))/100;v=b.width*w}if(_&&"string"==typeof _&&h(_,"%")){var S=Number(_.replace("%",""))/100;_=b.height*S}if(g&&"string"==typeof g&&h(g,"%")){var C=Number(g.replace("%",""))/100;g=b.width*C}if(y&&"string"==typeof y&&h(y,"%")){var E=Number(y.replace("%",""))/100;y=b.height*E}v=void 0===v?void 0:Number(v),_=void 0===_?void 0:Number(_),g=void 0===g?void 0:Number(g),y=void 0===y?void 0:Number(y);var A="number"==typeof c?c:r.width/r.height,T=r.width,x=r.height;if(/right/i.test(i)&&(T=r.width+(t-r.x),c&&(x=(T-d)/A+u)),/left/i.test(i)&&(T=r.width-(t-r.x),c&&(x=(T-d)/A+u)),/bottom/i.test(i)&&(x=r.height+(n-r.y),c&&(T=(x-u)*A+d)),/top/i.test(i)&&(x=r.height-(n-r.y),c&&(T=(x-u)*A+d)),"parent"===this.props.bounds){var P=this.parentNode;if(P instanceof HTMLElement){var k=P.getBoundingClientRect(),O=k.left,I=k.top,M=this.resizable.getBoundingClientRect(),R=M.left,F=M.top,D=P.offsetWidth+(O-R),N=P.offsetHeight+(I-F);v=v&&v<D?v:D,_=_&&_<N?_:N}}else if("window"===this.props.bounds){if("undefined"!=typeof window){var L=this.resizable.getBoundingClientRect(),U=L.left,z=L.top,H=window.innerWidth-U,B=window.innerHeight-z;v=v&&v<H?v:H,_=_&&_<B?_:B}}else if(this.props.bounds instanceof HTMLElement){var V=this.props.bounds.getBoundingClientRect(),q=V.left,j=V.top,W=this.resizable.getBoundingClientRect(),K=W.left,G=W.top;if(!(this.props.bounds instanceof HTMLElement))return;var Y=this.props.bounds.offsetWidth+(q-K),Z=this.props.bounds.offsetHeight+(j-G);v=v&&v<Y?v:Y,_=_&&_<Z?_:Z}var Q=void 0===g?10:g,X=void 0===v||v<0?T:v,J=void 0===y?10:y,$=void 0===_||_<0?x:_;if(c){var ee=(J-u)*A+d,te=($-u)*A+d,ne=(Q-d)/A+u,oe=(X-d)/A+u,ie=Math.max(Q,ee),re=Math.min(X,te),ae=Math.max(J,ne),se=Math.min($,oe);T=f(T,ie,re),x=f(x,ae,se)}else T=f(T,Q,X),x=f(x,J,$);this.props.grid&&(T=m(T,this.props.grid[0])),this.props.grid&&(x=m(x,this.props.grid[1]));var le={width:T-r.width,height:x-r.height};if(a&&"string"==typeof a&&h(a,"%")){T=T/b.width*100+"%"}if(s&&"string"==typeof s&&h(s,"%")){x=x/b.height*100+"%"}this.setState({width:this.calculateNewSize(T,"width"),height:this.calculateNewSize(x,"height")}),this.props.onResize&&this.props.onResize(e,i,this.resizable,le)}}},{key:"onMouseUp",value:function(e){var t=this.state,n=t.isResizing,o=t.direction,i=t.original;if(n){var r={width:this.size.width-i.width,height:this.size.height-i.height};this.props.onResizeStop&&this.props.onResizeStop(e,o,this.resizable,r),this.props.size&&this.setState(this.props.size),this.setState({isResizing:!1,resizeCursor:"auto"})}}},{key:"updateSize",value:function(e){this.setState({width:e.width,height:e.height})}},{key:"renderResizer",value:function(){var e=this,t=this.props,n=t.enable,i=t.handleStyles,r=t.handleClasses,a=t.handleWrapperStyle,s=t.handleWrapperClass,l=t.handleComponent;if(!n)return null;var c=Object.keys(n).map(function(t){return n[t]!==!1?o.createElement(u,{key:t,direction:t,onResizeStart:e.onResizeStart,replaceStyles:i&&i[t],className:r&&r[t]},l&&l[t]?o.createElement(l[t]):null):null});return o.createElement("span",{className:s,style:a},c)}},{key:"render",value:function(){var e=this,t=this.state.isResizing?d:p;return o.createElement("div",a({ref:function(t){t&&(e.resizable=t)},style:a({position:"relative"},t,this.props.style,this.sizeStyle,{maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight,minWidth:this.props.minWidth,minHeight:this.props.minHeight,boxSizing:"border-box"}),className:this.props.className},this.extendsProps),this.state.isResizing&&o.createElement("div",{style:{height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0)",cursor:""+(this.state.resizeCursor||"auto"),opacity:"0",position:"fixed",zIndex:"9999",top:"0",left:"0",bottom:"0",right:"0"}}),this.props.children,this.renderResizer())}},{key:"parentNode",get:function(){return this.resizable.parentNode}},{key:"propsSize",get:function(){return this.props.size||this.props.defaultSize}},{key:"base",get:function(){var e=this.parentNode;if(e)for(var t=[].slice.call(e.children),n=0;n<t.length;n+=1){var o=t[n];if(o instanceof HTMLElement&&o.classList.contains("__resizable_base__"))return o}}},{key:"size",get:function(){var e=0,t=0;if("undefined"!=typeof window){var n=this.resizable.offsetWidth,o=this.resizable.offsetHeight,i=this.resizable.style.position;"relative"!==i&&(this.resizable.style.position="relative"),e="auto"!==this.resizable.style.width?this.resizable.offsetWidth:n,t="auto"!==this.resizable.style.height?this.resizable.offsetHeight:o,this.resizable.style.position=i}return{width:e,height:t}}},{key:"sizeStyle",get:function(){var e=this,t=this.props.size,n=function(t){if(void 0===e.state[t]||"auto"===e.state[t])return"auto";if(e.propsSize&&e.propsSize[t]&&h(e.propsSize[t].toString(),"%")){if(h(e.state[t].toString(),"%"))return e.state[t].toString();var n=e.getParentSize();return Number(e.state[t].toString().replace("px",""))/n[t]*100+"%"}return v(e.state[t])};return{width:t&&void 0!==t.width&&!this.state.isResizing?v(t.width):n("width"),height:t&&void 0!==t.height&&!this.state.isResizing?v(t.height):n("height")}}}]),t})(o.Component);g.defaultProps={onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},enable:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},style:{},grid:[1,1],lockAspectRatio:!1,lockAspectRatioExtraWidth:0,lockAspectRatioExtraHeight:0},n.exports=g}.bind(Object.create(null))),(function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react-dom"),require("react")):"function"==typeof define&&define.amd?define("react-draggable",["react-dom","react"],t):"object"==typeof exports?exports.ReactDraggable=t(require("react-dom"),require("react")):e.ReactDraggable=t(e.ReactDOM,e.React)})(this,function(e,t){return(function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=12)})([function(e,t,n){"use strict";function o(e,t){for(var n=0,o=e.length;n<o;n++)if(t.apply(t,[e[n],n,e]))return e[n]}function i(e){return"function"==typeof e||"[object Function]"===Object.prototype.toString.call(e)}function r(e){return"number"==typeof e&&!isNaN(e)}function a(e){return parseInt(e,10)}function s(e,t,n){if(e[t])return new Error("Invalid prop "+t+" passed to "+n+" - do not set this, set it on the child.")}Object.defineProperty(t,"__esModule",{value:!0}),t.findInArray=o,t.isFunction=i,t.isNum=r,t.int=a,t.dontSetMe=s},function(e,t,n){"use strict";function o(e){return function(){return e}}var i=function(){};i.thatReturns=o,i.thatReturnsFalse=o(!1),i.thatReturnsTrue=o(!0),i.thatReturnsNull=o(null),i.thatReturnsThis=function(){return this},i.thatReturnsArgument=function(e){return e},e.exports=i},function(e,t,n){"use strict";function o(e,t,n,o,r,a,s,l){if(i(t),!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[n,o,r,a,s,l],d=0;c=new Error(t.replace(/%s/g,function(){return u[d++]})),c.name="Invariant Violation"}throw c.framesToPop=1,c}}var i=function(e){};"production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV&&(i=function(e){if(void 0===e)throw new Error("invariant requires an error message argument")}),e.exports=o},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(t,n){t.exports=e},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){return x||(x=(0,E.findInArray)(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],function(t){return(0,E.isFunction)(e[t])})),!!(0,E.isFunction)(e[x])&&e[x](t)}function a(e,t,n){var o=e;do{if(r(o,t))return!0;if(o===n)return!1;o=o.parentNode}while(o);return!1}function s(e,t,n){e&&(e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener?e.addEventListener(t,n,!0):e["on"+t]=n)}function l(e,t,n){e&&(e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener?e.removeEventListener(t,n,!0):e["on"+t]=null)}function c(e){var t=e.clientHeight,n=e.ownerDocument.defaultView.getComputedStyle(e);return t+=(0,E.int)(n.borderTopWidth),t+=(0,E.int)(n.borderBottomWidth)}function u(e){var t=e.clientWidth,n=e.ownerDocument.defaultView.getComputedStyle(e);return t+=(0,E.int)(n.borderLeftWidth),t+=(0,E.int)(n.borderRightWidth)}function d(e){var t=e.clientHeight,n=e.ownerDocument.defaultView.getComputedStyle(e);return t-=(0,E.int)(n.paddingTop),t-=(0,E.int)(n.paddingBottom)}function p(e){var t=e.clientWidth,n=e.ownerDocument.defaultView.getComputedStyle(e);return t-=(0,E.int)(n.paddingLeft),t-=(0,E.int)(n.paddingRight)}function f(e,t){var n=t===t.ownerDocument.body,o=n?{left:0,top:0}:t.getBoundingClientRect();return{x:e.clientX+t.scrollLeft-o.left,y:e.clientY+t.scrollTop-o.top}}function m(e){var t=e.x,n=e.y;return i({},(0,A.browserPrefixToKey)("transform",T.default),"translate("+t+"px,"+n+"px)")}function h(e){return"translate("+e.x+","+e.y+")"}function v(e,t){return e.targetTouches&&(0,E.findInArray)(e.targetTouches,function(e){return t===e.identifier})||e.changedTouches&&(0,E.findInArray)(e.changedTouches,function(e){return t===e.identifier})}function _(e){return e.targetTouches&&e.targetTouches[0]?e.targetTouches[0].identifier:e.changedTouches&&e.changedTouches[0]?e.changedTouches[0].identifier:void 0}function g(e){if(e){var t=e.getElementById("react-draggable-style-el");t||(t=e.createElement("style"),t.type="text/css",t.id="react-draggable-style-el",t.innerHTML=".react-draggable-transparent-selection *::-moz-selection {background: transparent;}\n",t.innerHTML+=".react-draggable-transparent-selection *::selection {background: transparent;}\n",e.getElementsByTagName("head")[0].appendChild(t)),e.body&&w(e.body,"react-draggable-transparent-selection")}}function y(e){try{e&&e.body&&S(e.body,"react-draggable-transparent-selection"),window.getSelection().removeAllRanges()}catch(e){}}function b(){return C({touchAction:"none"},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function w(e,t){e.classList?e.classList.add(t):e.className.match(new RegExp("(?:^|\\s)"+t+"(?!\\S)"))||(e.className+=" "+t)}function S(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(?:^|\\s)"+t+"(?!\\S)","g"),"")}Object.defineProperty(t,"__esModule",{value:!0});var C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};t.matchesSelector=r,t.matchesSelectorAndParentsTo=a,t.addEvent=s,t.removeEvent=l,t.outerHeight=c,t.outerWidth=u,t.innerHeight=d,t.innerWidth=p,t.offsetXYFromParent=f,t.createCSSTransform=m,t.createSVGTransform=h,t.getTouch=v,t.getTouchIdentifier=_,t.addUserSelectStyles=g,t.removeUserSelectStyles=y,t.styleHacks=b,t.addClassName=w,t.removeClassName=S;var E=n(0),A=n(19),T=o(A),x=""},function(e,n){e.exports=t},function(e,t,n){if("production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV){var o="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103,i=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===o};e.exports=n(14)(i,!0)}else e.exports=n(17)()},function(e,t,n){"use strict";var o=n(1),i=o;if("production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV){var r=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var i=0,r="Warning: "+e.replace(/%s/g,function(){return n[i++]});"undefined"!=typeof console&&console.error(r);try{throw new Error(r)}catch(e){}};i=function(e,t){if(void 0===t)throw new Error("`warning(condition, format, ...args)` requires a warning message argument");if(0!==t.indexOf("Failed Composite propType: ")&&!e){for(var n=arguments.length,o=Array(n>2?n-2:0),i=2;i<n;i++)o[i-2]=arguments[i];r.apply(void 0,[t].concat(o))}}}e.exports=i},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){if(!e.props.bounds)return[t,n];var o=e.props.bounds;o="string"==typeof o?o:d(o);var i=p(e);if("string"==typeof o){var r=i.ownerDocument,a=r.defaultView,s=void 0;if(s="parent"===o?i.parentNode:r.querySelector(o),!(s instanceof HTMLElement))throw new Error('Bounds selector "'+o+'" could not find an element.');var l=a.getComputedStyle(i),c=a.getComputedStyle(s);o={left:-i.offsetLeft+(0,f.int)(c.paddingLeft)+(0,f.int)(l.marginLeft),top:-i.offsetTop+(0,f.int)(c.paddingTop)+(0,f.int)(l.marginTop),right:(0,v.innerWidth)(s)-(0,v.outerWidth)(i)-i.offsetLeft+(0,f.int)(c.paddingRight)-(0,f.int)(l.marginRight),bottom:(0,v.innerHeight)(s)-(0,v.outerHeight)(i)-i.offsetTop+(0,f.int)(c.paddingBottom)-(0,f.int)(l.marginBottom)}}return(0,f.isNum)(o.right)&&(t=Math.min(t,o.right)),(0,f.isNum)(o.bottom)&&(n=Math.min(n,o.bottom)),(0,f.isNum)(o.left)&&(t=Math.max(t,o.left)),(0,f.isNum)(o.top)&&(n=Math.max(n,o.top)),[t,n]}function r(e,t,n){return[Math.round(t/e[0])*e[0],Math.round(n/e[1])*e[1]]}function a(e){return"both"===e.props.axis||"x"===e.props.axis}function s(e){return"both"===e.props.axis||"y"===e.props.axis}function l(e,t,n){var o="number"==typeof t?(0,v.getTouch)(e,t):null;if("number"==typeof t&&!o)return null;var i=p(n),r=n.props.offsetParent||i.offsetParent||i.ownerDocument.body;return(0,v.offsetXYFromParent)(o||e,r)}function c(e,t,n){var o=e.state,i=!(0,f.isNum)(o.lastX),r=p(e);return i?{node:r,deltaX:0,deltaY:0,lastX:t,lastY:n,x:t,y:n}:{node:r,deltaX:t-o.lastX,deltaY:n-o.lastY,lastX:o.lastX,lastY:o.lastY,x:t,y:n}}function u(e,t){return{node:t.node,x:e.state.x+t.deltaX,y:e.state.y+t.deltaY,deltaX:t.deltaX,deltaY:t.deltaY,lastX:e.state.x,lastY:e.state.y}}function d(e){return{left:e.left,top:e.top,right:e.right,bottom:e.bottom}}function p(e){var t=h.default.findDOMNode(e);if(!t)throw new Error("<DraggableCore>: Unmounted during event!");return t}Object.defineProperty(t,"__esModule",{value:!0}),t.getBoundPosition=i,t.snapToGrid=r,t.canDragX=a,t.canDragY=s,t.getControlPosition=l,t.createCoreData=c,t.createDraggableData=u;var f=n(0),m=n(4),h=o(m),v=n(5)},function(e,t,n){"use strict";(function(e){function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(e,t){var n=[],o=!0,i=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){i=!0,r=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})(),l=(function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}})(),c=n(6),u=o(c),d=n(7),p=o(d),f=n(4),m=o(f),h=n(5),v=n(9),_=n(0),g=n(11),y=o(g),b={touch:{start:"touchstart",move:"touchmove",stop:"touchend"},mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"}},w=b.mouse,S=(function(e){function t(){var e,n,o,a;i(this,t);for(var l=arguments.length,c=Array(l),u=0;u<l;u++)c[u]=arguments[u];return n=o=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),o.state={dragging:!1,lastX:NaN,lastY:NaN,touchIdentifier:null},o.handleDragStart=function(e){if(o.props.onMouseDown(e),!o.props.allowAnyClick&&"number"==typeof e.button&&0!==e.button)return!1;var t=m.default.findDOMNode(o);if(!t||!t.ownerDocument||!t.ownerDocument.body)throw new Error("<DraggableCore> not mounted on DragStart!");var n=t.ownerDocument;if(!(o.props.disabled||!(e.target instanceof n.defaultView.Node)||o.props.handle&&!(0,h.matchesSelectorAndParentsTo)(e.target,o.props.handle,t)||o.props.cancel&&(0,h.matchesSelectorAndParentsTo)(e.target,o.props.cancel,t))){var i=(0,h.getTouchIdentifier)(e);o.setState({touchIdentifier:i});var r=(0,v.getControlPosition)(e,i,o);if(null!=r){var a=r.x,s=r.y,l=(0,v.createCoreData)(o,a,s);(0,y.default)("DraggableCore: handleDragStart: %j",l),(0,y.default)("calling",o.props.onStart);o.props.onStart(e,l)!==!1&&(o.props.enableUserSelectHack&&(0,h.addUserSelectStyles)(n),o.setState({dragging:!0,lastX:a,lastY:s}),(0,h.addEvent)(n,w.move,o.handleDrag),(0,h.addEvent)(n,w.stop,o.handleDragStop))}}},o.handleDrag=function(e){"touchmove"===e.type&&e.preventDefault();var t=(0,v.getControlPosition)(e,o.state.touchIdentifier,o);if(null!=t){var n=t.x,i=t.y;if(Array.isArray(o.props.grid)){var r=n-o.state.lastX,a=i-o.state.lastY,l=(0,v.snapToGrid)(o.props.grid,r,a),c=s(l,2);if(r=c[0],a=c[1],!r&&!a)return;n=o.state.lastX+r,i=o.state.lastY+a}var u=(0,v.createCoreData)(o,n,i);(0,y.default)("DraggableCore: handleDrag: %j",u);if(o.props.onDrag(e,u)!==!1)o.setState({lastX:n,lastY:i});else try{o.handleDragStop(new MouseEvent("mouseup"))}catch(e){var d=document.createEvent("MouseEvents");d.initMouseEvent("mouseup",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),o.handleDragStop(d)}}},o.handleDragStop=function(e){if(o.state.dragging){var t=(0,v.getControlPosition)(e,o.state.touchIdentifier,o);if(null!=t){var n=t.x,i=t.y,r=(0,v.createCoreData)(o,n,i),a=m.default.findDOMNode(o);a&&o.props.enableUserSelectHack&&(0,h.removeUserSelectStyles)(a.ownerDocument),(0,y.default)("DraggableCore: handleDragStop: %j",r),o.setState({dragging:!1,lastX:NaN,lastY:NaN}),o.props.onStop(e,r),a&&((0,y.default)("DraggableCore: Removing handlers"),(0,h.removeEvent)(a.ownerDocument,w.move,o.handleDrag),(0,h.removeEvent)(a.ownerDocument,w.stop,o.handleDragStop))}}},o.onMouseDown=function(e){return w=b.mouse,o.handleDragStart(e)},o.onMouseUp=function(e){return w=b.mouse,o.handleDragStop(e)},o.onTouchStart=function(e){return w=b.touch,o.handleDragStart(e)},o.onTouchEnd=function(e){return w=b.touch,o.handleDragStop(e)},a=n,r(o,a)}return a(t,e),l(t,[{key:"componentWillUnmount",value:function(){var e=m.default.findDOMNode(this);if(e){var t=e.ownerDocument;(0,h.removeEvent)(t,b.mouse.move,this.handleDrag),(0,h.removeEvent)(t,b.touch.move,this.handleDrag),(0,h.removeEvent)(t,b.mouse.stop,this.handleDragStop),(0,h.removeEvent)(t,b.touch.stop,this.handleDragStop),this.props.enableUserSelectHack&&(0,h.removeUserSelectStyles)(t)}}},{key:"render",value:function(){return u.default.cloneElement(u.default.Children.only(this.props.children),{style:(0,h.styleHacks)(this.props.children.props.style),onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd})}}]),t})(u.default.Component);S.displayName="DraggableCore",S.propTypes={allowAnyClick:p.default.bool,disabled:p.default.bool,enableUserSelectHack:p.default.bool,offsetParent:function(t,n){if(e.browser===!0&&t[n]&&1!==t[n].nodeType)throw new Error("Draggable's offsetParent must be a DOM Node.")},grid:p.default.arrayOf(p.default.number),handle:p.default.string,cancel:p.default.string,onStart:p.default.func,onDrag:p.default.func,onStop:p.default.func,onMouseDown:p.default.func,className:_.dontSetMe,style:_.dontSetMe,transform:_.dontSetMe},S.defaultProps={allowAnyClick:!1,cancel:null,disabled:!1,enableUserSelectHack:!0,offsetParent:null,handle:null,grid:null,transform:null,onStart:function(){},onDrag:function(){},onStop:function(){},onMouseDown:function(){}},t.default=S}).call(t,n(20))},function(e,t,n){"use strict";function o(){}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t,n){"use strict";var o=n(13).default;e.exports=o,e.exports.default=o,e.exports.DraggableCore=n(10).default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},c=(function(){function e(e,t){var n=[],o=!0,i=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){i=!0,r=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})(),u=(function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}})(),d=n(6),p=o(d),f=n(7),m=o(f),h=n(4),v=o(h),_=n(18),g=o(_),y=n(5),b=n(9),w=n(0),S=n(10),C=o(S),E=n(11),A=o(E),T=(function(e){function t(e){r(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onDragStart=function(e,t){if((0,A.default)("Draggable: onDragStart: %j",t),n.props.onStart(e,(0,b.createDraggableData)(n,t))===!1)return!1;n.setState({dragging:!0,dragged:!0})},n.onDrag=function(e,t){if(!n.state.dragging)return!1;(0,A.default)("Draggable: onDrag: %j",t);var o=(0,b.createDraggableData)(n,t),i={x:o.x,y:o.y};if(n.props.bounds){var r=i.x,a=i.y;i.x+=n.state.slackX,i.y+=n.state.slackY;var s=(0,b.getBoundPosition)(n,i.x,i.y),l=c(s,2),u=l[0],d=l[1];i.x=u,i.y=d,i.slackX=n.state.slackX+(r-i.x),i.slackY=n.state.slackY+(a-i.y),o.x=i.x,o.y=i.y,o.deltaX=i.x-n.state.x,o.deltaY=i.y-n.state.y}if(n.props.onDrag(e,o)===!1)return!1;n.setState(i)},n.onDragStop=function(e,t){if(!n.state.dragging)return!1;if(n.props.onStop(e,(0,b.createDraggableData)(n,t))===!1)return!1;(0,A.default)("Draggable: onDragStop: %j",t);var o={dragging:!1,slackX:0,slackY:0};if(Boolean(n.props.position)){var i=n.props.position,r=i.x,a=i.y;o.x=r,o.y=a}n.setState(o)},n.state={dragging:!1,dragged:!1,x:e.position?e.position.x:e.defaultPosition.x,y:e.position?e.position.y:e.defaultPosition.y,slackX:0,slackY:0,isElementSVG:!1},n}return s(t,e),u(t,[{key:"componentWillMount",value:function(){!this.props.position||this.props.onDrag||this.props.onStop||console.warn("A `position` was applied to this <Draggable>, without drag handlers. This will make this component effectively undraggable. Please attach `onDrag` or `onStop` handlers so you can adjust the `position` of this element.")}},{key:"componentDidMount",value:function(){void 0!==window.SVGElement&&v.default.findDOMNode(this)instanceof window.SVGElement&&this.setState({isElementSVG:!0})}},{key:"componentWillReceiveProps",value:function(e){!e.position||this.props.position&&e.position.x===this.props.position.x&&e.position.y===this.props.position.y||this.setState({x:e.position.x,y:e.position.y})}},{key:"componentWillUnmount",value:function(){this.setState({dragging:!1})}},{key:"render",value:function(){var e,t={},n=null,o=Boolean(this.props.position),r=!o||this.state.dragging,a=this.props.position||this.props.defaultPosition,s={x:(0,b.canDragX)(this)&&r?this.state.x:a.x,y:(0,b.canDragY)(this)&&r?this.state.y:a.y};this.state.isElementSVG?n=(0,y.createSVGTransform)(s):t=(0,y.createCSSTransform)(s);var c=this.props,u=c.defaultClassName,d=c.defaultClassNameDragging,f=c.defaultClassNameDragged,m=p.default.Children.only(this.props.children),h=(0,g.default)(m.props.className||"",u,(e={},i(e,d,this.state.dragging),i(e,f,this.state.dragged),e));return p.default.createElement(C.default,l({},this.props,{onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop}),p.default.cloneElement(m,{className:h,style:l({},m.props.style,t),transform:n}))}}]),t})(p.default.Component);T.displayName="Draggable",T.propTypes=l({},C.default.propTypes,{axis:m.default.oneOf(["both","x","y","none"]),bounds:m.default.oneOfType([m.default.shape({left:m.default.number,right:m.default.number,top:m.default.number,bottom:m.default.number}),m.default.string,m.default.oneOf([!1])]),defaultClassName:m.default.string,defaultClassNameDragging:m.default.string,defaultClassNameDragged:m.default.string,defaultPosition:m.default.shape({x:m.default.number,y:m.default.number}),position:m.default.shape({x:m.default.number,y:m.default.number}),className:w.dontSetMe,style:w.dontSetMe,transform:w.dontSetMe}),T.defaultProps=l({},C.default.defaultProps,{axis:"both",bounds:!1,defaultClassName:"react-draggable",defaultClassNameDragging:"react-draggable-dragging",defaultClassNameDragged:"react-draggable-dragged",defaultPosition:{x:0,y:0},position:null}),t.default=T},function(e,t,n){"use strict";var o=n(1),i=n(2),r=n(8),a=n(15),s=n(3),l=n(16);e.exports=function(e,t){function n(e){var t=e&&(k&&e[k]||e["@@iterator"]);if("function"==typeof t)return t}function c(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}function u(e){this.message=e,this.stack=""}function d(e){function n(n,l,c,d,p,f,m){if(d=d||"<<anonymous>>",f=f||c,m!==s)if(t)i(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");else if("production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV&&"undefined"!=typeof console){var h=d+":"+c;!o[h]&&a<3&&(r(!1,"You are manually calling a React.PropTypes validation function for the `%s` prop on `%s`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details.",f,d),o[h]=!0,a++)}return null==l[c]?n?new u(null===l[c]?"The "+p+" `"+f+"` is marked as required in `"+d+"`, but its value is `null`.":"The "+p+" `"+f+"` is marked as required in `"+d+"`, but its value is `undefined`."):null:e(l,c,d,p,f)}if("production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV)var o={},a=0;var l=n.bind(null,!1);return l.isRequired=n.bind(null,!0),l}function p(e){function t(t,n,o,i,r,a){var s=t[n];if(A(s)!==e)return new u("Invalid "+i+" `"+r+"` of type `"+T(s)+"` supplied to `"+o+"`, expected `"+e+"`.");return null}return d(t)}function f(){
return d(o.thatReturnsNull)}function m(e){function t(t,n,o,i,r){if("function"!=typeof e)return new u("Property `"+r+"` of component `"+o+"` has invalid PropType notation inside arrayOf.");var a=t[n];if(!Array.isArray(a)){return new u("Invalid "+i+" `"+r+"` of type `"+A(a)+"` supplied to `"+o+"`, expected an array.")}for(var l=0;l<a.length;l++){var c=e(a,l,o,i,r+"["+l+"]",s);if(c instanceof Error)return c}return null}return d(t)}function h(){function t(t,n,o,i,r){var a=t[n];if(!e(a)){return new u("Invalid "+i+" `"+r+"` of type `"+A(a)+"` supplied to `"+o+"`, expected a single ReactElement.")}return null}return d(t)}function v(e){function t(t,n,o,i,r){if(!(t[n]instanceof e)){var a=e.name||"<<anonymous>>";return new u("Invalid "+i+" `"+r+"` of type `"+P(t[n])+"` supplied to `"+o+"`, expected instance of `"+a+"`.")}return null}return d(t)}function _(e){function t(t,n,o,i,r){for(var a=t[n],s=0;s<e.length;s++)if(c(a,e[s]))return null;return new u("Invalid "+i+" `"+r+"` of value `"+a+"` supplied to `"+o+"`, expected one of "+JSON.stringify(e)+".")}return Array.isArray(e)?d(t):("production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV&&r(!1,"Invalid argument supplied to oneOf, expected an instance of array."),o.thatReturnsNull)}function g(e){function t(t,n,o,i,r){if("function"!=typeof e)return new u("Property `"+r+"` of component `"+o+"` has invalid PropType notation inside objectOf.");var a=t[n],l=A(a);if("object"!==l)return new u("Invalid "+i+" `"+r+"` of type `"+l+"` supplied to `"+o+"`, expected an object.");for(var c in a)if(a.hasOwnProperty(c)){var d=e(a,c,o,i,r+"."+c,s);if(d instanceof Error)return d}return null}return d(t)}function y(e){function t(t,n,o,i,r){for(var a=0;a<e.length;a++){if(null==(0,e[a])(t,n,o,i,r,s))return null}return new u("Invalid "+i+" `"+r+"` supplied to `"+o+"`.")}if(!Array.isArray(e))return"production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV&&r(!1,"Invalid argument supplied to oneOfType, expected an instance of array."),o.thatReturnsNull;for(var n=0;n<e.length;n++){var i=e[n];if("function"!=typeof i)return r(!1,"Invalid argument supplied to oneOfType. Expected an array of check functions, but received %s at index %s.",x(i),n),o.thatReturnsNull}return d(t)}function b(){function e(e,t,n,o,i){return C(e[t])?null:new u("Invalid "+o+" `"+i+"` supplied to `"+n+"`, expected a ReactNode.")}return d(e)}function w(e){function t(t,n,o,i,r){var a=t[n],l=A(a);if("object"!==l)return new u("Invalid "+i+" `"+r+"` of type `"+l+"` supplied to `"+o+"`, expected `object`.");for(var c in e){var d=e[c];if(d){var p=d(a,c,o,i,r+"."+c,s);if(p)return p}}return null}return d(t)}function S(e){function t(t,n,o,i,r){var l=t[n],c=A(l);if("object"!==c)return new u("Invalid "+i+" `"+r+"` of type `"+c+"` supplied to `"+o+"`, expected `object`.");var d=a({},t[n],e);for(var p in d){var f=e[p];if(!f)return new u("Invalid "+i+" `"+r+"` key `"+p+"` supplied to `"+o+"`.\nBad object: "+JSON.stringify(t[n],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(e),null,"  "));var m=f(l,p,o,i,r+"."+p,s);if(m)return m}return null}return d(t)}function C(t){switch(typeof t){case"number":case"string":case"undefined":return!0;case"boolean":return!t;case"object":if(Array.isArray(t))return t.every(C);if(null===t||e(t))return!0;var o=n(t);if(!o)return!1;var i,r=o.call(t);if(o!==t.entries){for(;!(i=r.next()).done;)if(!C(i.value))return!1}else for(;!(i=r.next()).done;){var a=i.value;if(a&&!C(a[1]))return!1}return!0;default:return!1}}function E(e,t){return"symbol"===e||("Symbol"===t["@@toStringTag"]||"function"==typeof Symbol&&t instanceof Symbol)}function A(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":E(t,e)?"symbol":t}function T(e){if(void 0===e||null===e)return""+e;var t=A(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function x(e){var t=T(e);switch(t){case"array":case"object":return"an "+t;case"boolean":case"date":case"regexp":return"a "+t;default:return t}}function P(e){return e.constructor&&e.constructor.name?e.constructor.name:"<<anonymous>>"}var k="function"==typeof Symbol&&Symbol.iterator,O={array:p("array"),bool:p("boolean"),func:p("function"),number:p("number"),object:p("object"),string:p("string"),symbol:p("symbol"),any:f(),arrayOf:m,element:h(),instanceOf:v,node:b(),objectOf:g,oneOf:_,oneOfType:y,shape:w,exact:S};return u.prototype=Error.prototype,O.checkPropTypes=l,O.PropTypes=O,O}},function(e,t,n){"use strict";function o(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function i(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach(function(e){o[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(e){return!1}}var r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;e.exports=i()?Object.assign:function(e,t){for(var n,i,l=o(e),c=1;c<arguments.length;c++){n=Object(arguments[c]);for(var u in n)a.call(n,u)&&(l[u]=n[u]);if(r){i=r(n);for(var d=0;d<i.length;d++)s.call(n,i[d])&&(l[i[d]]=n[i[d]])}}return l}},function(e,t,n){"use strict";function o(e,t,n,o,l){if("production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV)for(var c in e)if(e.hasOwnProperty(c)){var u;try{i("function"==typeof e[c],"%s: %s type `%s` is invalid; it must be a function, usually from the `prop-types` package, but received `%s`.",o||"React class",n,c,typeof e[c]),u=e[c](t,c,o,n,null,a)}catch(e){u=e}if(r(!u||u instanceof Error,"%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",o||"React class",n,c,typeof u),u instanceof Error&&!(u.message in s)){s[u.message]=!0;var d=l?l():"";r(!1,"Failed %s type: %s%s",n,u.message,null!=d?d:"")}}}if("production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV)var i=n(2),r=n(8),a=n(3),s={};e.exports=o},function(e,t,n){"use strict";var o=n(1),i=n(2),r=n(3);e.exports=function(){function e(e,t,n,o,a,s){s!==r&&i(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return n.checkPropTypes=o,n.PropTypes=n,n}},function(e,t,n){var o,i;(function(){"use strict";function n(){for(var e=[],t=0;t<arguments.length;t++){var o=arguments[t];if(o){var i=typeof o;if("string"===i||"number"===i)e.push(o);else if(Array.isArray(o))e.push(n.apply(null,o));else if("object"===i)for(var a in o)r.call(o,a)&&o[a]&&e.push(a)}}return e.join(" ")}var r={}.hasOwnProperty;void 0!==e&&e.exports?e.exports=n:(o=[],i=function(){return n}.apply(t,o),void 0!==i&&(e.exports=i))})()},function(e,t,n){"use strict";function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"transform";if("undefined"==typeof window||void 0===window.document)return"";var t=window.document.documentElement.style;if(e in t)return"";for(var n=0;n<s.length;n++)if(i(e,s[n])in t)return s[n];return""}function i(e,t){return t?""+t+a(e):e}function r(e,t){return t?"-"+t.toLowerCase()+"-"+e:e}function a(e){for(var t="",n=!0,o=0;o<e.length;o++)n?(t+=e[o].toUpperCase(),n=!1):"-"===e[o]?n=!0:t+=e[o];return t}Object.defineProperty(t,"__esModule",{value:!0}),t.getPrefix=o,t.browserPrefixToKey=i,t.browserPrefixToStyle=r;var s=["Moz","Webkit","O","ms"];t.default=o()},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function r(e){if(d===clearTimeout)return clearTimeout(e);if((d===o||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function a(){h&&f&&(h=!1,f.length?m=f.concat(m):v=-1,m.length&&s())}function s(){if(!h){var e=i(a);h=!0;for(var t=m.length;t;){for(f=m,m=[];++v<t;)f&&f[v].run();v=-1,t=m.length}f=null,h=!1,r(e)}}function l(e,t){this.fun=e,this.array=t}function c(){}var u,d,p=e.exports={};(function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{d="function"==typeof clearTimeout?clearTimeout:o}catch(e){d=o}})();var f,m=[],h=!1,v=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];m.push(new l(e,t)),1!==m.length||h||i(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.prependListener=c,p.prependOnceListener=c,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}}])}),define("react-rnd",["require","exports","module","react","react-draggable","re-resizable"],function(e,t,n){"use strict";function o(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(e,t){function n(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function r(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&(n[o[i]]=e[o[i]]);return n}Object.defineProperty(t,"__esModule",{value:!0});var a=e("react"),s=o(e("react-draggable")),l=o(e("re-resizable")),c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},u=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},d={width:"auto",height:"auto",display:"inline-block",position:"absolute",top:0,left:0},p=(function(e){function t(t){var n=e.call(this,t)||this;return n.isResizing=!1,n.state={original:{x:0,y:0},bounds:{top:0,right:0,bottom:0,left:0},maxWidth:t.maxWidth,maxHeight:t.maxHeight},n.onResizeStart=n.onResizeStart.bind(n),n.onResize=n.onResize.bind(n),n.onResizeStop=n.onResizeStop.bind(n),n.onDragStart=n.onDragStart.bind(n),n.onDrag=n.onDrag.bind(n),n.onDragStop=n.onDragStop.bind(n),n.getMaxSizesFromProps=n.getMaxSizesFromProps.bind(n),n}return i(t,e),t.prototype.componentDidMount=function(){var e=this.getOffsetFromParent(),t=e.left,n=e.top,o=this.getDraggablePosition(),i=o.x,r=o.y;this.draggable.setState({x:i-t,y:r-n}),this.forceUpdate()},t.prototype.getDraggablePosition=function(){var e=this.draggable.state;return{x:e.x,y:e.y}},t.prototype.getParent=function(){return this.resizable&&this.resizable.parentNode},t.prototype.getParentSize=function(){return this.resizable.getParentSize()},t.prototype.getMaxSizesFromProps=function(){return{maxWidth:void 0===this.props.maxWidth?Number.MAX_SAFE_INTEGER:this.props.maxWidth,maxHeight:void 0===this.props.maxHeight?Number.MAX_SAFE_INTEGER:this.props.maxHeight}},t.prototype.getSelfElement=function(){return this.resizable&&this.resizable.resizable},t.prototype.onDragStart=function(e,t){if(this.props.onDragStart&&this.props.onDragStart(e,t),this.props.bounds){var n,o=this.getParent();if("parent"===this.props.bounds)n=o;else if("body"===this.props.bounds)n=document.body;else{if("window"===this.props.bounds){if(!this.resizable)return;return this.setState({bounds:{top:0,right:window.innerWidth-this.resizable.size.width,bottom:window.innerHeight-this.resizable.size.height,left:0}})}n=document.querySelector(this.props.bounds)}if(n instanceof HTMLElement&&o instanceof HTMLElement){var i=n.getBoundingClientRect(),r=i.left,a=i.top,s=o.getBoundingClientRect(),l=s.left,c=s.top,u=r-l,d=a-c;if(this.resizable){var p=this.getOffsetFromParent();this.setState({bounds:{top:d-p.top,right:u+(n.offsetWidth-this.resizable.size.width)-p.left,bottom:d+(n.offsetHeight-this.resizable.size.height)-p.top,left:u-p.left}})}}}},t.prototype.onDrag=function(e,t){if(this.props.onDrag){var n=this.getOffsetFromParent();this.props.onDrag(e,u({},t,{x:t.x-n.left,y:t.y-n.top}))}},t.prototype.onDragStop=function(e,t){if(this.props.onDragStop){var n=this.getOffsetFromParent(),o=n.left,i=n.top;this.props.onDragStop(e,u({},t,{x:t.x+o,y:t.y+i}))}},t.prototype.onResizeStart=function(e,t,n){if(e.stopPropagation(),this.isResizing=!0,this.setState({original:this.getDraggablePosition()}),this.props.bounds){var o=this.getParent(),i=void 0;i="parent"===this.props.bounds?o:"body"===this.props.bounds?document.body:"window"===this.props.bounds?window:document.querySelector(this.props.bounds);var r=this.getSelfElement();if(r instanceof Element&&(i instanceof HTMLElement||i===window)&&o instanceof HTMLElement){var a=this.getMaxSizesFromProps(),s=a.maxWidth,l=a.maxHeight,c=this.getParentSize();if(s&&"string"==typeof s)if(s.endsWith("%")){var u=Number(s.replace("%",""))/100;s=c.width*u}else s.endsWith("px")&&(s=Number(s.replace("px","")));if(l&&"string"==typeof l)if(l.endsWith("%")){var u=Number(l.replace("%",""))/100;l=c.width*u}else l.endsWith("px")&&(l=Number(l.replace("px","")));var d=r.getBoundingClientRect(),p=d.left,f=d.top,m="window"===this.props.bounds?{left:0,top:0}:i.getBoundingClientRect(),h=m.left,v=m.top,_="window"===this.props.bounds?window.innerWidth:i.offsetWidth,g="window"===this.props.bounds?window.innerHeight:i.offsetHeight,y=t.toLowerCase().endsWith("left"),b=t.toLowerCase().endsWith("right"),w=t.startsWith("top"),S=t.startsWith("bottom");if(y&&this.resizable){var C=p-h+this.resizable.size.width;this.setState({maxWidth:C>Number(s)?s:C})}if(b||this.props.lockAspectRatio&&!y){var C=_+(h-p);this.setState({maxWidth:C>Number(s)?s:C})}if(w&&this.resizable){var C=f-v+this.resizable.size.height;this.setState({maxHeight:C>Number(l)?l:C})}if(S||this.props.lockAspectRatio&&!w){var C=g+(v-f);this.setState({maxHeight:C>Number(l)?l:C})}}}else this.setState({maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight});this.props.onResizeStart&&this.props.onResizeStart(e,t,n)},t.prototype.onResize=function(e,t,n,o){var i,r,a=this.getOffsetFromParent();/left/i.test(t)&&(i=this.state.original.x-o.width,this.props.position||this.draggable.setState({x:i}),i+=a.left),/top/i.test(t)&&(r=this.state.original.y-o.height,this.props.position||this.draggable.setState({y:r}),r+=a.top),this.props.onResize&&(void 0===i&&(i=this.getDraggablePosition().x+a.left),void 0===r&&(r=this.getDraggablePosition().y+a.top),this.props.onResize(e,t,n,o,{x:i,y:r}))},t.prototype.onResizeStop=function(e,t,n,o){this.isResizing=!1;var i=this.getMaxSizesFromProps(),r=i.maxWidth,a=i.maxHeight;if(this.setState({maxWidth:r,maxHeight:a}),this.props.onResizeStop){var s=this.getDraggablePosition();this.props.onResizeStop(e,t,n,o,s)}},t.prototype.updateSize=function(e){this.resizable&&this.resizable.updateSize({width:e.width,height:e.height})},t.prototype.updatePosition=function(e){this.draggable.setState(e)},t.prototype.getOffsetFromParent=function(){var e=this.getParent();if(!e)return{top:0,left:0};var t=e.getBoundingClientRect(),n=t.left,o=t.top,i=this.getSelfElement().getBoundingClientRect(),r=this.getDraggablePosition();return{left:i.left-n-r.x,top:i.top-o-r.y}},t.prototype.render=function(){var e=this,t=this.props,n=t.disableDragging,o=t.style,i=t.dragHandleClassName,c=t.position,p=t.onMouseDown,f=t.dragAxis,m=t.dragGrid,h=t.bounds,v=t.enableUserSelectHack,_=t.cancel,g=t.children,y=(t.onResizeStart,t.onResize,t.onResizeStop,t.onDragStart,t.onDrag,t.onDragStop,t.resizeHandleStyles),b=t.resizeHandleClasses,w=t.enableResizing,S=t.resizeGrid,C=r(t,["disableDragging","style","dragHandleClassName","position","onMouseDown","dragAxis","dragGrid","bounds","enableUserSelectHack","cancel","children","onResizeStart","onResize","onResizeStop","onDragStart","onDrag","onDragStop","resizeHandleStyles","resizeHandleClasses","enableResizing","resizeGrid"]),E=this.props.default?u({},this.props.default):void 0;delete C.default;var A,T=n||i?{cursor:"normal"}:{cursor:"move"},x=u({},d,T,o),P=this.getOffsetFromParent(),k=P.left,O=P.top;return c&&(A={x:c.x-k,y:c.y-O}),a.createElement(s,{ref:function(t){t&&(e.draggable=t)},handle:i?"."+i:void 0,defaultPosition:E,onMouseDown:p,onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop,axis:f,disabled:n,grid:m,bounds:h?this.state.bounds:void 0,position:A,enableUserSelectHack:v,cancel:_},a.createElement(l,u({},C,{ref:function(t){t&&(e.resizable=t)},defaultSize:E,size:this.props.size,enable:w,onResizeStart:this.onResizeStart,onResize:this.onResize,onResizeStop:this.onResizeStop,style:x,minWidth:this.props.minWidth,minHeight:this.props.minHeight,maxWidth:this.isResizing?this.state.maxWidth:this.props.maxWidth,maxHeight:this.isResizing?this.state.maxHeight:this.props.maxHeight,grid:S,handleWrapperClass:this.props.resizeHandleWrapperClass,handleWrapperStyle:this.props.resizeHandleWrapperStyle,lockAspectRatio:this.props.lockAspectRatio,lockAspectRatioExtraWidth:this.props.lockAspectRatioExtraWidth,lockAspectRatioExtraHeight:this.props.lockAspectRatioExtraHeight,handleStyles:y,handleClasses:b}),g))},t.defaultProps={maxWidth:Number.MAX_SAFE_INTEGER,maxHeight:Number.MAX_SAFE_INTEGER,onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},onDragStart:function(){},onDrag:function(){},onDragStop:function(){}},t})(a.Component);t.Rnd=p}.bind(Object.create(null))),define("spectrum_signatures_prototype/field_marker",["require","exports","react","classnames"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FieldMarker=function(e){var t=e.className,i=e.displayNumber,r=e.style;return n.createElement("div",{className:o("esignature-badge",t),style:r},n.createElement("div",null,i))}}),define("spectrum_signatures_prototype/field_placer",["require","exports","tslib","classnames","react","react-rnd"],function(e,t,n,o,i,r){"use strict";function a(e){var t=e.bottom,n=e.left,o=e.top,r=e.right;return i.createElement("div",{className:"esignature-field-placer-handle",style:{bottom:t,left:n,top:o,right:r}})}function s(e){var t=e.onClick;return i.createElement("div",{className:"esignature-field-placer-cancel",onClick:t},"✕")}Object.defineProperty(t,"__esModule",{value:!0});var l=r.Rnd||e("react-rnd"),c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={x:0,y:0,width:0,height:0},t.handleDrag=function(e,n){t.updateState(n.x,n.y)},t.handleDragStop=function(e,n){t.props.onDrag&&t.props.onDrag(n.x,n.y)},t.handleResize=function(e,n,o,i,r){t.updateState(r.x,r.y,parseInt(o.style.width,10),parseInt(o.style.height,10))},t.handleResizeStop=function(e,n,o,i,r){t.props.onResize&&t.props.onResize(parseInt(o.style.width,10),parseInt(o.style.height,10),r.x,r.y)},t}return n.__extends(t,e),t.prototype.updateState=function(e,t,n,o){this.setState({x:e||this.props.x,y:t||this.props.y,width:n||this.props.width,height:o||this.props.height})},t.prototype.componentDidMount=function(){this.updateState()},t.prototype.componentDidUpdate=function(e){var t=this.props,n=t.x,o=t.y,i=t.width,r=t.height;n===e.x&&o===e.y&&i===e.width&&r===e.height||this.updateState()},t.prototype.getMinWidth=function(){var e=this.props.children;return"date"===(e?e.split(" ")[1]:"")?158:32},t.prototype.render=function(){var e=this.props,t=e.children,n=e.onCancel,r=e.icon;return i.createElement(l,{className:o("esignature-field-placer","esignature-field-placer-"+this.props.colorScheme),size:{width:this.state.width,height:this.state.height},position:{x:this.state.x,y:this.state.y},onDrag:this.handleDrag,onDragStop:this.handleDragStop,onResize:this.handleResize,onResizeStop:this.handleResizeStop,minHeight:32,minWidth:this.getMinWidth()},i.createElement("div",{className:"esignature-field-placer-body"},i.createElement("div",{className:"esignature-field-placer-icon"},r),i.createElement("div",{className:"esignature-field-placer-text"},this.state.width>60?t:null)),i.createElement(a,{bottom:"-2.5px",left:"-4px"}),i.createElement(a,{top:"-3px",left:"-4px"}),i.createElement(a,{bottom:"-2.5px",right:"-4px"}),i.createElement(a,{top:"-3px",right:"-4px"}),i.createElement(s,{onClick:n}))},t})(i.Component);t.FieldPlacer=c}),define("spectrum_signatures_prototype/field_selector",["require","exports","tslib","classnames","react","spectrum/button","spectrum/icon_chooser","spectrum/popover"],function(e,t,n,o,i,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleSelection=function(e){n.setState({selected:e.value}),n.props.onSelect(e)},n.state={selected:t.options.length>0?t.options[0].value:""},n}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=(this.props.options,this.props.options.map(function(t){var n=t.value,r=t.color,l=n===e.state.selected;return i.createElement(s.PopoverContentItem,{className:"esignature-field-selector-button",key:n,value:t},i.createElement("div",{className:o({"esignature-field-selector-option":!0,"esignature-field-selector-option__selected":l})},i.createElement("div",{className:"esignature-field-selector-option-color",style:{backgroundColor:r}}),n),l?i.createElement(a.IconChooser,{className:"esignature-selected-icon",name:"selected-check"}):null)}));return i.createElement(s.Popover,{onSelection:this.handleSelection},i.createElement(s.PopoverTrigger,{className:"esignature-field-selector-popover-trigger"},i.createElement(r.Button,{className:"esignature-field-selector-popover-button",variant:"styleless"},this.state.selected+" ▾")),i.createElement(s.PopoverContent,{className:"esignature-field-selector-popover-content",position:"above"},i.createElement("div",{className:"esignature-field-selector"},i.createElement(s.PopoverContentTitle,{className:"esignature-field-selector-header"},"ADD FIELDS FOR"),t)))},t})(i.Component);t.FieldSelector=l}),define("spectrum_signatures_prototype/signature_creation_modal",["require","exports","tslib","react","spectrum/modal"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={signature:""},t.handleChange=function(e){t.setState({signature:e.currentTarget.value})},t.handleSubmit=function(){""!==t.state.signature&&t.props.onSubmit(t.state.signature)},t}return n.__extends(t,e),t.prototype.render=function(){return o.createElement(i.UtilityModal,{className:"esignature-signature-creation-modal",overlayClassName:"signature-creation-modal-overlay",title:"Add your signature",ariaLabel:"Add your signature",open:this.props.open,displayCloseButton:!0,primaryAction:"Done",onPrimaryAction:this.handleSubmit,secondaryAction:"Close",onSecondaryAction:this.props.onClose,onRequestClose:this.props.onClose,shouldRequestCloseOnActions:!1},o.createElement("input",{className:"signature-input","aria-label":"signature-input",type:"text",placeholder:"Type to sign",value:this.state.signature,onChange:this.handleChange}))},t})(o.Component);t.SignatureCreationModal=r});
//# sourceMappingURL=pkg-file_viewer.min.js-vflZ3-0Cv.map